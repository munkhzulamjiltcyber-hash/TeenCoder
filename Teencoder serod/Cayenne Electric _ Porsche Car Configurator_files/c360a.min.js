// Bundle time - 2025-12-21T15:04:55Z - SalesforceInteractions
// SDK - npm/@salesforce/interactions/2.0/target/dist/scripts/interactions-bundle.min.js [2.0.9]
/*
 regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE  js-cookie v3.0.5 | MIT */
'use strict';var SalesforceInteractions=function(e){function ma(b,a){(null==a||a>b.length)&&(a=b.length);for(var c=0,d=Array(a);c<a;c++)d[c]=b[c];return d}function lc(b,a,c){a=K(a);a=ab()?Reflect.construct(a,c||[],K(b).constructor):a.apply(b,c);if(!a||"object"!=typeof a&&"function"!=typeof a){if(void 0!==a)throw new TypeError("Derived constructors may only return object or undefined");if(void 0===b)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}else b=a;return b}
function L(b,a){if(!(b instanceof a))throw new TypeError("Cannot call a class as a function");}function bb(b,a){for(var c=0;c<a.length;c++){var d=a[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(b,cb(d.key),d)}}function M(b,a,c){return a&&bb(b.prototype,a),c&&bb(b,c),Object.defineProperty(b,"prototype",{writable:!1}),b}function na(b,a){var c="undefined"!=typeof Symbol&&b[Symbol.iterator]||b["@@iterator"];if(!c){if(Array.isArray(b)||(c=oa(b))||
a&&b&&"number"==typeof b.length){c&&(b=c);var d=0;a=function(){};return{s:a,n:function(){return d>=b.length?{done:!0}:{done:!1,value:b[d++]}},e:function(a){throw a;},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var f,h=!0,l=!1;return{s:function(){c=c.call(b)},n:function(){var a=c.next();return h=a.done,a},e:function(a){l=!0;f=a},f:function(){try{h||null==c.return||c.return()}finally{if(l)throw f;
}}}}function X(b,a,c){return(a=cb(a))in b?Object.defineProperty(b,a,{value:c,enumerable:!0,configurable:!0,writable:!0}):b[a]=c,b}function pa(){return pa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(b,a,c){var d;for(d=b;!{}.hasOwnProperty.call(d,a)&&null!==(d=K(d)););if(d)return d=Object.getOwnPropertyDescriptor(d,a),d.get?d.get.call(3>arguments.length?b:c):d.value},pa.apply(null,arguments)}function K(b){return K=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||
Object.getPrototypeOf(a)},K(b)}function mc(b,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");b.prototype=Object.create(a&&a.prototype,{constructor:{value:b,writable:!0,configurable:!0}});Object.defineProperty(b,"prototype",{writable:!1});a&&qa(b,a)}function ab(){try{var b=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(a){}return(ab=function(){return!!b})()}function db(b,a){var c=Object.keys(b);if(Object.getOwnPropertySymbols){var d=
Object.getOwnPropertySymbols(b);a&&(d=d.filter(function(a){return Object.getOwnPropertyDescriptor(b,a).enumerable}));c.push.apply(c,d)}return c}function q(b){for(var a=1;a<arguments.length;a++){var c=null!=arguments[a]?arguments[a]:{};a%2?db(Object(c),!0).forEach(function(a){X(b,a,c[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(c)):db(Object(c)).forEach(function(a){Object.defineProperty(b,a,Object.getOwnPropertyDescriptor(c,a))})}return b}function qa(b,
a){return qa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a},qa(b,a)}function Y(b,a){var c=Array.isArray(b)?b:void 0;if(!c)a:{var d=null==b?null:"undefined"!=typeof Symbol&&b[Symbol.iterator]||b["@@iterator"];if(null!=d){var f,h,l,e=[],p=!0,g=!1;try{if(h=(d=d.call(b)).next,0===a){if(Object(d)!==d){c=void 0;break a}p=!1}else for(;!(p=(f=h.call(d)).done)&&(e.push(f.value),e.length!==a);p=!0);}catch(nc){g=!0;var k=nc}finally{try{if(!p&&null!=d.return&&(l=d.return(),
Object(l)!==l)){c=void 0;break a}}finally{if(g)throw k;}}c=e}else c=void 0}if(!(b=c||oa(b,a)))throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return b}function fb(b,a,c,d){var f=pa(K(1&d?b.prototype:b),a,c);return 2&d?function(a){return f.apply(c,a)}:f}function gb(b){var a=Array.isArray(b)?ma(b):void 0;a||(a="undefined"!=typeof Symbol&&null!=b[Symbol.iterator]||null!=b["@@iterator"]?Array.from(b):
void 0);if(!(b=a||oa(b)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return b}function cb(b){a:if("object"==typeof b&&b){var a=b[Symbol.toPrimitive];if(void 0!==a){b=a.call(b,"string");if("object"!=typeof b)break a;throw new TypeError("@@toPrimitive must return a primitive value.");}b=String(b)}return"symbol"==typeof b?b:b+""}function x(b){"@babel/helpers - typeof";return x="function"==
typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},x(b)}function oa(b,a){if(b){if("string"==typeof b)return ma(b,a);var c={}.toString.call(b).slice(8,-1);return"Object"===c&&b.constructor&&(c=b.constructor.name),"Map"===c||"Set"===c?Array.from(b):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?ma(b,a):void 0}}function hb(b){r.setLoggingLevel(b)}
function ib(){return r.getLoggingLevel()}function ra(b){var a,c,d,f=[],h=[c=1732584193,d=4023233417,~c,~d,3285377520],l=[],e=unescape(encodeURI(b))+"\u0080",p=e.length;for(l[b=--p/4+2|15]=8*p;~p;)l[p>>2]|=e.charCodeAt(p)<<8*~p--;for(a=p=0;a<b;a+=16){for(c=h;80>p;c=[c[4]+(f[p]=16>p?~~l[a+p]:2*e|0>e)+1518500249+[d&g|~d&k,e=341275144+(d^g^k),882459459+(d&g|d&k|g&k),e+1535694389][p++/5>>2]+((e=c[0])<<5|e>>>27),e,d<<30|d>>>2,g,k]){e=f[p-3]^f[p-8]^f[p-14]^f[p-16];d=c[1];var g=c[2];var k=c[3]}for(p=5;p;)h[--p]+=
c[p]}for(e="";40>p;)e+=(h[p>>3]>>4*(7-p++)&15).toString(16);return e}function Z(b){for(var a=1;a<arguments.length;a++){var c=arguments[a],d;for(d in c)b[d]=c[d]}return b}function sa(b,a){function c(c,f,h){if("undefined"!==typeof document){h=Z({},a,h);"number"===typeof h.expires&&(h.expires=new Date(Date.now()+864E5*h.expires));h.expires&&(h.expires=h.expires.toUTCString());c=encodeURIComponent(c).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var d="",e;for(e in h)h[e]&&
(d+="; "+e,!0!==h[e]&&(d+="="+h[e].split(";")[0]));return document.cookie=c+"="+b.write(f,c)+d}}return Object.create({set:c,get:function(a){if("undefined"!==typeof document&&(!arguments.length||a)){for(var c=document.cookie?document.cookie.split("; "):[],d={},l=0;l<c.length;l++){var e=c[l].split("="),g=e.slice(1).join("=");try{var k=decodeURIComponent(e[0]);d[k]=b.read(g,k);if(a===k)break}catch(eb){}}return a?d[a]:d}},remove:function(a,b){c(a,"",Z({},b,{expires:-1}))},withAttributes:function(a){return sa(this.converter,
Z({},this.attributes,a))},withConverter:function(a){return sa(Z({},this.converter,a),this.attributes)}},{attributes:{value:Object.freeze(a)},converter:{value:Object.freeze(b)}})}function jb(){var b=(window.navigator.userAgent||"")+(window.navigator.platform||"")+(new Date).getTime+JSON.stringify({})+Math.random();return aa(b).slice(0,16)}function ta(b){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:z;return a&&9===a.nodeType||a&&1===a.nodeType?oc.test(b)?a.getElementsByClassName(b.slice(1)):
pc.test(b)?a.getElementsByTagName(b):a.querySelectorAll(b):[]}function S(b){return b.replace(qc,function(a,b){return b.toUpperCase()})}function t(b,a,c){if(c)for(c=b.length;c--&&!1!==a.call(b[c],c,b[c]););else{c=0;for(var d=b.length;c<d&&!1!==a.call(b[c],c,b[c]);c++);}return b}function ua(b,a){var c=b&&(b.matches||b.webkitMatchesSelector||b.msMatchesSelector);return!!c&&c.call(b,a)}function va(b){return!!b&&b===b.window}function H(b){return"function"===typeof b}function u(b){return"string"===typeof b}
function kb(b){return!isNaN(parseFloat(b))&&isFinite(b)}function wa(b){return u(b)?function(a,c){return ua(c,b)}:H(b)?b:b instanceof ba?function(a,c){return b.is(c)}:b?function(a,c){return c===b}:function(){return!1}}function N(b,a){return a?b.filter(a):b}function ca(b){return u(b)?b.match(rc)||[]:[]}function B(b,a,c){for(var d=[],f=H(a),h=0,l=b.length;h<l;h++)if(f){var e=a(b[h]);e.length&&sc.apply(d,e)}else for(e=b[h][a];null!=e;)d.push(e),e=c?e[a]:null;return d}function A(b){return 1<b.length?xa.call(b,
function(a,b,d){return lb.call(d,a)===b}):b}function I(b,a,c){if(b&&1===b.nodeType&&a)return b=T.getComputedStyle(b,null),a?c?b.getPropertyValue(a)||void 0:b[a]:b}function O(b,a){return parseInt(I(b,a),10)||0}function mb(b){if(1<arguments.length&&void 0!==arguments[1]?arguments[1]:ya.test(b))return b;if(!za[b]){var a=S(b),c="".concat(a[0].toUpperCase()).concat(a.slice(1));a="".concat(a," ").concat(tc.join("".concat(c," "))).concat(c).split(" ");t(a,function(a,c){if(c in uc)return za[b]=c,!1})}return za[b]}
function nb(b,a){return(2<arguments.length&&void 0!==arguments[2]?arguments[2]:ya.test(b))||vc[b]||!kb(a)?a:"".concat(a,"px")}function ob(b,a){b=b.dataset[a]||b.dataset[S(a)];try{return JSON.parse(b)}catch(c){}return b}function pb(b,a){return O(b,"border".concat(a?"Left":"Top","Width"))+O(b,"padding".concat(a?"Left":"Top"))+O(b,"padding".concat(a?"Right":"Bottom"))+O(b,"border".concat(a?"Right":"Bottom","Width"))}function qb(b,a){return!a||!Aa.call(a,function(a){return 0>b.indexOf(a)})}function wc(b,
a,c,d,f){f.guid=f.guid||k.guid++;var h=b.___ce=b.___ce||{};h[a]=h[a]||[];h[a].push([c,d,f]);b.addEventListener(a,f)}function Ba(b){b=b.split(".");return[b[0],b.slice(1).sort()]}function da(b,a,c,d,f){var h=b.___ce=b.___ce||{};if(a)h[a]&&(h[a]=h[a].filter(function(l){var h=Y(l,3);l=h[0];var e=h[1];h=h[2];if(f&&h.guid!==f.guid||!qb(l,c)||d&&d!==e)return!0;b.removeEventListener(a,h)}));else for(a in h)da(b,a,c,d,f)}function rb(b){return b.multiple&&b.options?B(xa.call(b.options,function(a){return a.selected&&
!a.disabled&&!a.parentNode.disabled}),"value"):b.value||""}function sb(b){if(!u(b))return[];if(xc.test(b))return[J(RegExp.$1)];var a=yc.test(b)&&RegExp.$1;a=tb[a]||tb["*"];a.innerHTML=b;return k(a.childNodes).detach().get()}function zc(b,a){b=k(b);b.filter("script").add(b.find("script")).each(function(b,d){if(Ac.test(d.type)&&Ca.contains(d)){var c=J("script");c.text=d.textContent.replace(Bc,"");t(Cc,function(a,b){d[b]&&(c[b]=d[b])});a.head.insertBefore(c,null);a.head.removeChild(c)}})}function E(b,
a,c,d,f,h,l,e){t(b,function(b,h){t(k(h),function(b,h){t(k(a),function(a,b){var l=c?b:h;b=c?h:b;a=a?l.cloneNode(!0):l;f?b.insertBefore(a,d?b.firstElementChild:null):b.parentNode.insertBefore(a,d?b:b.nextElementSibling);zc(a,b.ownerDocument)},e)},l)},h);return a}function Dc(b){var a=b.pageTypeDefault;b=0<b.pageTypes.length;return!("undefined"===typeof a||null===a)||b}function ub(b,a,c){return"function"===typeof c?{bind:b,selector:a,callback:c}:null}function Ec(){Da=n.onFireException.on(function(b,a){document.dispatchEvent(new CustomEvent(e.CustomEvents.OnException,
{detail:{error:b,context:a}}))});Ea=n.onEventSend.on(function(b){document.dispatchEvent(new CustomEvent(e.CustomEvents.OnBeforeEventSend,{detail:{actionEvent:b},cancelable:!0}))&&document.dispatchEvent(new CustomEvent(e.CustomEvents.OnEventSend,{detail:{actionEvent:b}}))});Fa=n.onPageMatchStatusUpdated.on(function(b){document.dispatchEvent(new CustomEvent(e.CustomEvents.OnPageMatchStatusUpdated,{detail:{matchStatus:b}}))});Ga=n.onInitSitemap.on(function(b){document.dispatchEvent(new CustomEvent(e.CustomEvents.OnInitSitemap,
{detail:{sitemapConfig:b}}))})}function ea(b){Da&&Da();Ea&&Ea();Fa&&Fa();Ga&&Ga();document.dispatchEvent(new CustomEvent(e.CustomEvents.OnShutDown,{detail:{message:b}}));Ha="shutDown";return!1}var vb;(function(b){b[b.NONE=0]="NONE";b[b.ERROR=1]="ERROR";b[b.WARN=2]="WARN";b[b.INFO=3]="INFO";b[b.DEBUG=4]="DEBUG";b[b.TRACE=5]="TRACE"})(vb||(vb={}));var Ia=["error","warn","info","debug","trace"],r=new (function(){function b(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",c=1<arguments.length&&
void 0!==arguments[1]?arguments[1]:0;L(this,b);this.console=window.console;this.level=c;this.prefix=a;this.buildLogFunctions()}return M(b,[{key:"shouldLog",value:function(a){return a<=this.level}},{key:"setLoggingLevel",value:function(a){this.level="string"===typeof a?Ia.indexOf(a.toLowerCase())+1:a||0;this.buildLogFunctions()}},{key:"getLoggingLevel",value:function(){return this.level}},{key:"setPrefix",value:function(a){this.prefix=a;this.buildLogFunctions()}},{key:"getPrefix",value:function(){return this.prefix}},
{key:"buildLogFunctions",value:function(){var a=this;Ia.forEach(function(b,d){b=Ia[d];a[b]=a.shouldLog(d+1)?a.getLogFn(b):function(){}})}},{key:"getLogFn",value:function(a){return Function.prototype.bind.call(this.console.log,this.console,"[".concat(a.toUpperCase(),"]").concat(this.prefix?"("+this.prefix+")":"",":"))}}])}());(function(b){b.OnEventSend="interactions:onEventSend";b.OnBeforeEventSend="interactions:onBeforeEventSend";b.OnException="interactions:onException";b.OnPageMatchStatusUpdated=
"interactions:onPageMatchStatusUpdated";b.OnInit="interactions:onInit";b.OnInitSitemap="interactions:onInitSitemap";b.OnSettledSitemap="interactions:onSettledSitemap";b.OnShutDown="interactions:onShutDown";b.OnSetAnonymousId="interactions:onSetAnonymousId";b.OnResetAnonymousId="interactions:onResetAnonymousId";b.OnClearPersistedIdentities="interactions:onClearPersistedIdentities";b.OnClearCookie="interactions:onClearCookie";b.OnConsentRevoke="interactions:onConsentRevoke";b.OnConsentGrant="interactions:onConsentGrant";
b.OnBeforeInit="interactions:onBeforeInit"})(e.CustomEvents||(e.CustomEvents={}));var Ja={anonymousId:{ids:{},timeoutDays:730}},aa=ra.default?ra.default:ra,wb,P=window.location.hostname,xb=function(){return P},U=function(b){P=b;yb()},yb=function(){wb=aa("".concat(aa(P+"/").slice(0,4))).slice(0,4)},fa=function(){return"".concat("_sfid","_").concat(wb)},zb=!0,Ab="strict",ha=sa({read:function(b){'"'===b[0]&&(b=b.slice(1,-1));return b.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(b){return encodeURIComponent(b).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,
decodeURIComponent)}},{path:"/"});document.addEventListener(e.CustomEvents.OnClearCookie,function(b){var a=b.detail&&b.detail.options||{};a.domain&&U(b.detail.options.domain);Bb(q({domain:P},a))});var Ka=function(){var b=ha.get(fa());return b?JSON.parse(b):void 0},Bb=function(b){ha.remove(fa(),b)},Cb=function(b){Q.write(q(q({},Ka()),{},{consents:b}),Ja.anonymousId.timeoutDays)},Q={read:Ka,write:function(b,a){ha.set(fa(),JSON.stringify(b),{expires:a,domain:P,secure:zb,sameSite:Ab});ha.get(fa())||r.warn("Web SDK cookie (_sfid) could not be set. This is possibly due to a restricted top level domain. See https://publicsuffix.org/learn/ for more information.")},
remove:Bb},Fc=[/bot/i,/spider/i,/facebookexternalhit/i,/simplepie/i,/yahooseeker/i,/embedly/i,/quora link preview/i,/outbrain/i,/vkshare/i,/monit/i,/Pingability/i,/Monitoring/i,/WinHttpRequest/i,/Apache-HttpClient/i,/getprismatic.com/i,/python-requests/i,/Twurly/i,/yandex/i,/browserproxy/i,/crawler/i,/Qwantify/i,/Yahoo! Slurp/i,/pinterest/i,/Tumblr\/14.0.835.186/i,/Tumblr Agent 14.0/i],Gc=function(b){return Fc.some(function(a){return a.test(b)})},Hc=navigator.vendor&&-1<navigator.vendor.indexOf("Apple")&&
navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&-1==navigator.userAgent.indexOf("FxiOS"),C="";document.addEventListener(e.CustomEvents.OnResetAnonymousId,function(b){b=b.detail&&b.detail.options||{};b.domain&&U(b.domain);Q.remove(q({domain:P},b));Db()});document.addEventListener(e.CustomEvents.OnSetAnonymousId,function(b){b.detail&&b.detail.newAnonymousId&&(b=b.detail.newAnonymousId,Q.write(q(q({},Ka()),{},{anonymousId:b}),Ja.anonymousId.timeoutDays))});var Eb=function(){return C},
ia=function(b){var a=C;(C=b)?document.dispatchEvent(new CustomEvent(e.CustomEvents.OnSetAnonymousId,{detail:{previousAnonymousId:a,newAnonymousId:b}})):r.warn("Attempted to setAnonymousId but not parameter is undefined")},Db=function(){Fb()?(C=Q.read().anonymousId,ia(C),r.debug("Loaded anonymous identity record from cookie: ".concat(JSON.stringify(C)))):(ia(jb()),r.debug("Created new anonymous identity record. anonymousId: ".concat(C)));return C},Fb=function(){var b=Q.read();return!!(b&&"object"===
x(b)&&0<Object.keys(b).length)},z=document,T=window,Ca=z.documentElement,J=z.createElement.bind(z),Gb=J("div"),La=J("table"),Ic=J("tbody"),Hb=J("tr"),Ma=Array.isArray,F=Array.prototype,xa=F.filter,lb=F.indexOf,Jc=F.map,sc=F.push,Ib=F.slice,Aa=F.some,Kc=F.splice,Lc=/^#[\w-]*$/,oc=/^\.[\w-]*$/,Mc=/<.+>/,pc=/^\w+$/,ba=function(){function b(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:z;L(this,b);if(a){if(a instanceof ba)return a;var d=a;if(u(a)){if(d=c instanceof ba?c[0]:c,d=Lc.test(a)?
d.getElementById(a.slice(1)):Mc.test(a)?sb(a):ta(a,d),!d)return}else if(H(a))return this.ready(a);if(d.nodeType||d===T)d=[d];this.length=d.length;c=0;for(var f=this.length;c<f;c++)this[c]=d[c]}}return M(b,[{key:"init",value:function(a,c){return new b(a,c)}}])}(),g=ba.prototype,k=g.init;k.fn=k.prototype=g;g.length=0;g.splice=Kc;"function"===typeof Symbol&&(g[Symbol.iterator]=F[Symbol.iterator]);g.map=function(b){return k(Jc.call(this,function(a,c){return b.call(a,c,a)}))};g.slice=function(b,a){return k(Ib.call(this,
b,a))};var qc=/-([a-z])/g;k.camelCase=S;k.each=t;g.each=function(b){return t(this,b)};g.removeProp=function(b){return this.each(function(a,c){delete c[b]})};k.extend=function(b){for(var a=arguments.length,c=Array(1<a?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];a=arguments.length;for(c=2>a?0:1;c<a;c++)for(var f in arguments[c])b[f]=arguments[c][f];return b};g.extend=function(b){return k.extend(g,b)};k.guid=1;k.matches=ua;k.isWindow=va;k.isFunction=H;k.isString=u;k.isNumeric=kb;k.isArray=Ma;g.prop=function(b,
a){if(b){if(u(b))return 2>arguments.length?this[0]&&this[0][b]:this.each(function(c,f){f[b]=a});for(var c in b)this.prop(c,b[c]);return this}};g.get=function(b){return void 0===b?Ib.call(this):this[0>b?b+this.length:b]};g.eq=function(b){return k(this.get(b))};g.first=function(){return this.eq(0)};g.last=function(){return this.eq(-1)};g.filter=function(b){var a=wa(b);return k(xa.call(this,function(b,d){return a.call(b,d,b)}))};var rc=/\S+/g;g.hasClass=function(b){return!!b&&Aa.call(this,function(a){return a.classList.contains(b)})};
g.removeAttr=function(b){var a=ca(b);return this.each(function(b,d){t(a,function(a,b){d.removeAttribute(b)})})};g.attr=function(b,a){if(b){if(u(b)){if(2>arguments.length){if(!this[0])return;var c=this[0].getAttribute(b);return null===c?void 0:c}return void 0===a?this:null===a?this.removeAttr(b):this.each(function(c,f){f.setAttribute(b,a)})}for(c in b)this.attr(c,b[c]);return this}};g.toggleClass=function(b,a){var c=ca(b),d=void 0!==a;return this.each(function(b,h){t(c,function(b,c){d?a?h.classList.add(c):
h.classList.remove(c):h.classList.toggle(c)})})};g.addClass=function(b){return this.toggleClass(b,!0)};g.removeClass=function(b){return arguments.length?this.toggleClass(b,!1):this.attr("class","")};k.unique=A;g.add=function(b,a){return k(A(this.get().concat(k(b,a).get())))};var ya=/^--/,za={},uc=Gb.style,tc=["webkit","moz","ms"];k.prefixedProp=mb;var vc={animationIterationCount:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0};
g.css=function(b,a){if(u(b)){var c=ya.test(b);b=mb(b,c);if(2>arguments.length)return this[0]&&I(this[0],b,c);if(!b)return this;a=nb(b,a,c);return this.each(function(d,h){h&&1===h.nodeType&&(c?h.style.setProperty(b,a):h.style[b]=a)})}for(var d in b)this.css(d,b[d]);return this};g.data=function(b,a){if(!b){if(!this[0])return;var c={},d;for(d in this[0].dataset)c[d]=ob(this[0],d);return c}if(u(b))return 2>arguments.length?this[0]&&ob(this[0],b):this.each(function(c,d){c=a;try{c=JSON.stringify(c)}catch(l){}d.dataset[S(b)]=
c});for(c in b)this.data(c,b[c]);return this};t([!0,!1],function(b,a){t(["Width","Height"],function(b,d){var c="".concat(a?"outer":"inner").concat(d);g[c]=function(f){if(this[0])return va(this[0])?T[c]:this[0]["".concat(a?"offset":"client").concat(d)]+(f&&a?O(this[0],"margin".concat(b?"Top":"Left"))+O(this[0],"margin".concat(b?"Bottom":"Right")):0)}})});t(["width","height"],function(b,a){g[a]=function(c){if(!this[0])return void 0===c?void 0:this;if(!arguments.length)return va(this[0])?this[0][S("outer-".concat(a))]:
this[0].getBoundingClientRect()[a]-pb(this[0],!b);var d=parseInt(c,10);return this.each(function(c,h){h&&1===h.nodeType&&(c=I(h,"boxSizing"),h.style[a]=nb(a,d+("border-box"===c?pb(h,!b):0)))})}});var Na={};g.toggle=function(b){return this.each(function(a,c){if(void 0===b?"none"===I(c,"display"):b){if(c.style.display=c.___cd||"","none"===I(c,"display")){a=c.style;c=c.tagName;if(Na[c])c=Na[c];else{var d=J(c);z.body.insertBefore(d,null);var f=I(d,"display");z.body.removeChild(d);c=Na[c]="none"!==f?f:
"block"}a.display=c}}else c.___cd=I(c,"display"),c.style.display="none"})};g.hide=function(){return this.toggle(!1)};g.show=function(){return this.toggle(!0)};var Oa={focus:"focusin",blur:"focusout"},Jb={mouseenter:"mouseover",mouseleave:"mouseout"},Nc=/^(mouse|pointer|contextmenu|drag|drop|click|dblclick)/i;g.off=function(b,a,c){var d=this;if(void 0===b)this.each(function(a,b){da(b)});else if(u(b))H(a)&&(c=a,a=""),t(ca(b),function(b,f){b=Ba(Jb[f]||Oa[f]||f);b=Y(b,2);var l=b[0],h=b[1];d.each(function(b,
d){da(d,l,h,a,c)})});else for(var f in b)this.off(f,b[f]);return this};g.on=function(b,a,c,d){var f=this;if(!u(b)){for(var h in b)this.on(h,a,b[h]);return this}H(a)&&(c=a,a="");t(ca(b),function(b,h){b=Ba(Jb[h]||Oa[h]||h);b=Y(b,2);var l=b[0],e=b[1];f.each(function(b,f){var h=function(b){if(!b.namespace||qb(e,b.namespace.split("."))){var g=f;if(a){for(var k=b.target;!ua(k,a);){if(k===f)return;k=k.parentNode;if(!k)return}g=k;b.___cd=!0}b.___cd&&Object.defineProperty(b,"currentTarget",{configurable:!0,
get:function(){return g}});k=c.call(g,b,b.data);d&&da(f,l,e,a,h);!1===k&&(b.preventDefault(),b.stopPropagation())}};h.guid=c.guid=c.guid||k.guid++;wc(f,l,e,a,h)})});return this};g.one=function(b,a,c){return this.on(b,a,c,!0)};g.ready=function(b){"loading"!==z.readyState?b(k):z.addEventListener("DOMContentLoaded",function(){b(k)});return this};g.trigger=function(b,a){if(u(b)){var c=Ba(b),d=Y(c,2);c=d[0];d=d[1];var f=Nc.test(c)?"MouseEvents":"HTMLEvents";b=z.createEvent(f);b.initEvent(c,!0,!0);b.namespace=
d.join(".")}b.data=a;var h=b.type in Oa;return this.each(function(a,c){if(h&&H(c[b.type]))c[b.type]();else c.dispatchEvent(b)})};var Oc=/%20/g,Pc=/file|reset|submit|button|image/i,Qc=/radio|checkbox/i;g.serialize=function(){var b="";this.each(function(a,c){t(c.elements||[c],function(a,c){c.disabled||!c.name||"FIELDSET"===c.tagName||Pc.test(c.type)||Qc.test(c.type)&&!c.checked||(a=rb(c),void 0!==a&&(a=Ma(a)?a:[a],t(a,function(a,d){a=b;d="&".concat(encodeURIComponent(c.name),"=").concat(encodeURIComponent(d).replace(Oc,
"+"));b=a+d})))})});return b.slice(1)};g.val=function(b){return void 0===b?this[0]&&rb(this[0]):this.each(function(a,c){if("SELECT"===c.tagName){var d=Ma(b)?b:null===b?[]:[b];t(c.options,function(a,b){b.selected=0<=d.indexOf(b.value)})}else c.value=null===b?"":b})};g.clone=function(){return this.map(function(b,a){return a.cloneNode(!0)})};g.detach=function(){return this.each(function(b,a){a.parentNode&&a.parentNode.removeChild(a)})};var yc=/^\s*<(\w+)[^>]*>/,xc=/^\s*<(\w+)\s*\/?>(?:<\/\1>)?\s*$/,
tb={"*":Gb,tr:Ic,td:Hb,th:Hb,thead:La,tbody:La,tfoot:La};k.parseHTML=sb;g.empty=function(){return this.each(function(b,a){for(;a.firstChild;)a.removeChild(a.firstChild)})};g.html=function(b){return void 0===b?this[0]&&this[0].innerHTML:this.each(function(a,c){c.innerHTML=b})};g.remove=function(){return this.detach().off()};g.text=function(b){return void 0===b?this[0]?this[0].textContent:"":this.each(function(a,c){c.textContent=b})};g.unwrap=function(){this.parent().each(function(b,a){b=k(a);b.replaceWith(b.children())});
return this};g.offset=function(){var b=this[0];if(b)return b=b.getBoundingClientRect(),{top:b.top+T.pageYOffset-Ca.clientTop,left:b.left+T.pageXOffset-Ca.clientLeft}};g.offsetParent=function(){return k(this[0]&&this[0].offsetParent)};g.position=function(){var b=this[0];if(b)return{left:b.offsetLeft,top:b.offsetTop}};g.children=function(b){return N(k(A(B(this,function(a){return a.children}))),b)};g.contents=function(){return k(A(B(this,function(b){return"IFRAME"===b.tagName?[b.contentDocument]:b.childNodes})))};
g.find=function(b){return k(A(B(this,function(a){return ta(b,a)})))};var Bc=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ac=/^$|^module$|\/(java|ecma)script/i,Cc=["type","src","nonce","noModule"];g.after=function(){return E(arguments,this,!1,!1,!1,!0,!0)};g.append=function(){return E(arguments,this,!1,!1,!0)};g.appendTo=function(b){return E(arguments,this,!0,!1,!0)};g.before=function(){return E(arguments,this,!1,!0)};g.insertAfter=function(b){return E(arguments,this,!0,!1,!1,!1,!1,!0)};g.insertBefore=
function(b){return E(arguments,this,!0,!0)};g.prepend=function(){return E(arguments,this,!1,!0,!0,!0,!0)};g.prependTo=function(b){return E(arguments,this,!0,!0,!0,!1,!1,!0)};g.replaceWith=function(b){return this.before(b).remove()};g.replaceAll=function(b){k(b).replaceWith(this);return this};g.wrapAll=function(b){b=k(b);for(var a=b[0];a.children.length;)a=a.firstElementChild;this.first().before(b);return this.appendTo(a)};g.wrap=function(b){return this.each(function(a,c){var d=k(b)[0];k(c).wrapAll(a?
d.cloneNode(!0):d)})};g.wrapInner=function(b){return this.each(function(a,c){a=k(c);c=a.contents();c.length?c.wrapAll(b):a.append(b)})};g.has=function(b){var a=u(b)?function(a,d){return ta(b,d).length}:function(a,d){return d.contains(b)};return this.filter(a)};g.is=function(b){var a=wa(b);return Aa.call(this,function(b,d){return a.call(b,d,b)})};g.next=function(b,a){return N(k(A(B(this,"nextElementSibling",a))),b)};g.nextAll=function(b){return this.next(b,!0)};g.not=function(b){var a=wa(b);return this.filter(function(b,
d){return!a.call(d,b,d)})};g.parent=function(b){return N(k(A(B(this,"parentNode"))),b)};g.index=function(b){var a=b?k(b)[0]:this[0];b=b?this:k(a).parent().children();return lb.call(b,a)};g.closest=function(b){var a=this.filter(b);if(a.length)return a;var c=this.parent();return c.length?c.closest(b):a};g.parents=function(b){return N(k(A(B(this,"parentElement",!0))),b)};g.prev=function(b,a){return N(k(A(B(this,"previousElementSibling",a))),b)};g.prevAll=function(b){return this.prev(b,!0)};g.siblings=
function(b){return N(k(A(B(this,function(a){return k(a).parent().children().not(a)}))),b)};var ja=function(){function b(){L(this,b);this.listeners=[]}return M(b,[{key:"on",value:function(a){var b=this;(this.listeners=this.listeners||[]).push(a);return function(){b.listeners=b.listeners.filter(function(b){return b!==a})}}},{key:"once",value:function(a){var b=this;return this.on(function(){b.unbindAll();try{for(var c=arguments.length,f=Array(c),h=0;h<c;h++)f[h]=arguments[h];a.apply(b,f)}catch(l){r.error("Signal listener callback error: "+
l)}})}},{key:"emit",value:function(){for(var a=this,b=arguments.length,d=Array(b),f=0;f<b;f++)d[f]=arguments[f];0!==this.listeners.length&&this.listeners.forEach(function(b){try{b.apply(a,d)}catch(l){r.error("Signal listener callback error: "+l)}})}},{key:"unbindAll",value:function(){this.listeners=[]}}])}(),Rc=function(b){r.debug("Unbinding all signals for type: ",b);Object.keys(b).forEach(function(a){b[a].unbindAll&&b[a].unbindAll()})},n=M(function a(){L(this,a)});n.onEventSend=new ja;n.onFireException=
new ja;n.onPageMatchStatusUpdated=new ja;n.onInitSitemap=new ja;n.unbindAll=function(){Rc(n)};var m={result:{currentPage:null,matchedConfig:null,matchStatus:null},config:{pageTypes:[]}},v=null,Kb=function(){return m.config},Pa=function(){return m.result};(function(a){a.Pending="pending";a.Running="running";a.Selected="selected";a.Matched="matched";a.Rejected="rejected"})(e.MatchStatus||(e.MatchStatus={}));var Ra=function(a){return new Promise(function(c,d){var f=m.config.pageTypeDefault;f&&V({pageName:f.name,
status:e.MatchStatus.Pending});if(f&&!a.length)Qa(f),c(f);else{Sc(a);var h=function(h){Lb(h);Tc(a)||(f?(Qa(f),c(f)):d("No matching page found"))};a.map(function(a){Uc(a).then(function(d){d?(f&&Lb(f),Qa(a),c(a)):h(a)}).catch(function(c){"sitemap_reinit"!==c&&n.onFireException.emit(Error("isMatch failed while evaluating the ".concat(a.name," page config")),"Site-wide Javascript");h(a)})})}})},Mb=function(){m.result.matchStatus&&(m.result.matchStatus.forEach(function(a){a.status===e.MatchStatus.Running&&
a._reject("sitemap_reinit")}),m.result.matchStatus=[]);n.onPageMatchStatusUpdated.emit(m.result.matchStatus)},Sc=function(a){a.forEach(function(a){V({pageName:a.name,status:e.MatchStatus.Pending})})},Qa=function(a){V({pageName:a.name,endTime:Date.now(),status:m.result.matchStatus.find(function(a){return a.status===e.MatchStatus.Selected})?e.MatchStatus.Matched:e.MatchStatus.Selected})},Lb=function(a){V({pageName:a.name,status:e.MatchStatus.Rejected,endTime:Date.now()})},Tc=function(a){return m.result.matchStatus.filter(function(a){return a.status===
e.MatchStatus.Rejected},0).length<a.length},Uc=function(a){return new Promise(function(c,d){V({pageName:a.name,status:e.MatchStatus.Running,startTime:Date.now(),_reject:d});if("function"===typeof a.isMatch)d=a.isMatch(),"object"===x(d)?d.then(function(a){c(a)}).catch(function(){}):c(d);else{var f="isMatch failed while evaluating the ".concat(a.name," page config. isMatch must be a function.");n.onFireException.emit(Error(f),"Site-wide Javascript");d(f)}})},V=function(a){m.result.matchStatus=[].concat(gb(m.result.matchStatus||
[]),[a]);n.onPageMatchStatusUpdated.emit(m.result.matchStatus)};(function(a){a.ViewCatalogObject="View Catalog Object";a.ViewCatalogObjectDetail="View Catalog Object Detail";a.QuickViewCatalogObject="Quick View Catalog Object";a.ShareCatalogObject="Share Catalog Object";a.ReviewCatalogObject="Review Catalog Object";a.CommentCatalogObject="Comment Catalog Object";a.FavoriteCatalogObject="Favorite Catalog Object"})(e.CatalogObjectInteractionName||(e.CatalogObjectInteractionName={}));(function(a){a.AddToCart=
"Add To Cart";a.RemoveFromCart="Remove From Cart";a.ReplaceCart="Replace Cart"})(e.CartInteractionName||(e.CartInteractionName={}));(function(a){a.Purchase="Purchase";a.Preorder="Preorder";a.Cancel="Cancel";a.Ship="Ship";a.Deliver="Deliver";a.Return="Return";a.Exchange="Exchange"})(e.OrderInteractionName||(e.OrderInteractionName={}));(e.MetadataUpdateInteractionName||(e.MetadataUpdateInteractionName={})).MetadataUpdate="MetadataUpdate";(e.ConsentPurpose||(e.ConsentPurpose={})).Tracking="Tracking";
(function(a){a.OptIn="Opt In";a.OptOut="Opt Out"})(e.ConsentStatus||(e.ConsentStatus={}));var Sa=function(a,c,d){n.onFireException.emit(a,c);r.warn("sendException",{event,errorSection:c})},D=[],Nb=function(){return D},Ob=function(a){return D.find(function(c){return a.purpose==c.consent.purpose})},Ta=function(a){Pb(a,!0)},Pb=function(a,c){Array.isArray(a)?a.forEach(function(a){Qb(a,c)}):Qb(a,c);Cb(D)},Qb=function(a,c){if(a&&"object"==x(a)&&a.purpose&&a.provider&&a.status)var d=!0;else Sa(Error("Invalid consent, check that consent is a valid object and all fields are defined: ".concat(JSON.stringify(a))),
"Salesforce Web SDK"),d=!1;if(d)if(d=Ob(a)){var f=d.consent.status;if(d.consent.status!=a.status||d.consent.provider!=a.provider)d.consent=a,d.lastUpdateTime=(new Date).toISOString();c&&(f==e.ConsentStatus.OptOut&&a.status==e.ConsentStatus.OptIn&&Rb(d),f==e.ConsentStatus.OptIn&&a.status==e.ConsentStatus.OptOut&&Sb(d))}else if(d={consent:a,lastUpdateTime:(new Date).toISOString()},D.push(d),c)switch(a.status){case e.ConsentStatus.OptIn:Rb(d);break;case e.ConsentStatus.OptOut:Sb(d);break;default:r.error("Unrecognized consent status: ".concat(a.status))}},
Rb=function(a){document.dispatchEvent(new CustomEvent(e.CustomEvents.OnConsentGrant,{detail:{grantedConsent:a}}))},Sb=function(a){document.dispatchEvent(new CustomEvent(e.CustomEvents.OnConsentRevoke,{detail:{revokedConsent:a}}))},Vc=function(a){var c=(new Date).toISOString();a.forEach(function(a){Ob(a).lastSentTime=c});Cb(D)},Xc=function(a){Wc();Promise.resolve(a).then(function(a){a&&0<a.length&&Ta(a)})},Wc=function(){var a=Q.read();a&&(D=a.consents||[])},Yc=function(a){return 0<=a.findIndex(function(a){return a.status==
e.ConsentStatus.OptIn})},Tb=function(){return Yc(D.map(function(a){return a.consent}))},Ub=function(a){a.source=a.source||{};var c=q({},a.source||{}),d;(d=a.source.pageType)||(d=m.result.currentPage&&m.result.currentPage.source?m.result.currentPage.source.pageType:void 0);a.source=q(c,{},{pageType:d,url:a.source.url||window.location.href,urlReferrer:a.source.urlReferrer||document.referrer,channel:a.source.channel||"Web"});a.user=q(q({},a.user||{}),{},{anonymousId:C});Zc(a)},Zc=function(a){a.consents&&
Pb(a.consents,!1);a.consents=D.filter(function(a){return!a.lastSentTime||new Date(a.lastUpdateTime)>=new Date(a.lastSentTime)}).map(function(a){return a.consent});Vc(a.consents)};document.addEventListener(e.CustomEvents.OnConsentGrant,function(a){a.detail&&a.detail.grantedConsent&&Vb(a.detail.grantedConsent)});document.addEventListener(e.CustomEvents.OnConsentRevoke,function(a){a.detail&&a.detail.revokedConsent&&Vb(a.detail.revokedConsent)});var Ua=function(a){return Wb(a,Tb).catch(function(c){r.error(c.message);
n.onFireException.emit(c,"Site-wide JavaScript");return a})},Vb=function(a){Wb({interaction:{name:e.MetadataUpdateInteractionName.MetadataUpdate},consents:[a.consent]},function(){return!0}).then(function(){return r.debug("Consent event: ".concat(a.consent.status))},function(a){return n.onFireException.emit(a,"Site-wide JavaScript")})},Wb=function(a,c){a:{var d=a,f=m.result.matchedConfig;try{d=f&&f.onActionEvent?f.onActionEvent(d):d;if("object"===x(d)){a=d;break a}n.onFireException.emit(Error("onActionEvent failed for the ".concat(m.result.matchedConfig.name,
" page config. Must return an object or null.")),"Site-wide Javascript")}catch(h){n.onFireException.emit(Error("onActionEvent failed for the ".concat(m.result.matchedConfig.name," page config. ").concat(h.message,".")),"Site-wide Javascript")}a=void 0}a:{d=a;f=m.config;try{d=f.global&&f.global.onActionEvent?f.global.onActionEvent(d):d;if("object"===x(d)){a=d;break a}n.onFireException.emit(Error("onActionEvent failed for the global page config. Must return an object or null."),"Site-wide Javascript")}catch(h){n.onFireException.emit(Error("onActionEvent failed for the global page config. ".concat(h.message,
".")),"Site-wide Javascript")}a=void 0}Ub(a);c&&!c()&&r.debug("No opt-in consents provided. Event will still be dispatched.");r.debug("Sent event: ",a);n.onEventSend.emit(a);return Promise.resolve(a)},$c=function(a){return new Promise(function(c,d){n.onInitSitemap.once(function(){return d("sitemap_reinit")});var f={name:null},h=[];Object.keys(a.interaction).forEach(function(c){var d=Xb(a.interaction[c],c).then(function(a){f[c]=a});h.push(d)});Promise.all(h).then(function(){c(f)}).catch(function(a){n.onFireException.emit(Error("Catalog object interaction config was rejected"),
"Site-wide Javascript")})})},Xb=function(a,c){try{return v=c,"object"===x(a)&&!Array.isArray(a)&&0<Object.keys(a).length?ad(a):Promise.resolve(a).then(function(a){return"function"===typeof a?a():a})}catch(d){n.onFireException.emit(Error("getValue for ".concat(c," failed on ").concat(m.result.matchedConfig.name," while evaluating custom function. ").concat(d.message,".")),"Site-wide Javascript")}},ad=function(a){var c={},d=Object.keys(a),f={};d.forEach(function(d){var f=Xb(a[d],d);c[d]=f});return Promise.all(Object.values(c)).then(function(a){a.forEach(function(a,
c){f[d[c]]=a});return f})},ka,Zb=function(){la();Yb()&&(ka=setInterval(function(){var a=!1,c=(new Date).getTime(),d=m.result.matchedConfig.listeners.map(function(c){if(c.selectorFound)return c;c=Va(c);a=c.selectorFound||a;return c});a&&Object.assign(m.result.matchedConfig,q(q({},m.result.matchedConfig),{},{listeners:d}));(50<(new Date).getTime()-c||!Yb())&&la()},1E3))},Yb=function(){if(m.result.matchedConfig){var a=m.result.matchedConfig.listeners;return a?a.filter(function(a){return!a.selectorFound}).length:
!1}return!1},la=function(){"number"===typeof ka&&clearInterval(ka);ka=null},Va=function(a){var c=k(a.selector),d=q(q({},a),{},{selectorFound:0<c.length});c.on(d.bind,function(a){try{d.callback(a)}catch(h){n.onFireException.emit(Error("Listener callback on ".concat(d.bind," bound to ").concat(d.selector," failed for the ").concat(m.result.matchedConfig.name," page config. ").concat(h.message,".")),"Site-wide Javascript")}});return d},$b=function(){m.result&&m.result.matchedConfig&&m.result.matchedConfig.listeners&&
m.result.matchedConfig.listeners.forEach(function(a){k(a.selector).off(a.bind)})},G={},W=function(a){if(!a||"string"!==typeof a||"function"!==typeof G[a])return null;G[a]();delete G[a]},ac={resolveWhenTrue:{bind:function(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Math.random().toString(36).slice(2),d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2E3,f=3<arguments.length&&void 0!==arguments[3]?arguments[3]:100;if("function"===typeof a)return new Promise(function(e,l){var h=
0,g=setInterval(function(){try{h+=f;var g=a();g?(W(c),e(g)):h>=d&&(W(c),e(!1))}catch(eb){W(c),l(eb)}},f);G[c]=function(){clearInterval(g)}})},unbind:W,getBindings:function(){return G},clearBindings:function(){for(var a in G)G.hasOwnProperty(a)&&"function"===typeof G[a]&&W(a)}}},bc=function(a){a.global=a.global||{};"object"!=x(a.global)&&n.onFireException.emit(Error("The global config has a type of ".concat(x(a.global),", but it must be an object")),"Sitewide Javascript");Object.assign(m.config,q({},
a));n.onInitSitemap.emit(m.config)},Wa=function(a){bd(a);return!0},ec=function(a){Ra(a.pageTypes).then(cc).then(dc).catch(function(a){"sitemap_reinit"!==a&&n.onFireException.emit(Error("Unhandled exception: ".concat(a)),"Site-wide Javascript")})},dc=function(a){m.result.matchedConfig=q(q({},a),{},{listeners:cd(a)});m.result.currentPage=q(q({},m.result.currentPage||{}),{},{source:{pageType:a.name,locale:dd(a)},user:{anonymousId:null},interaction:null,pageView:!0});return a.interaction?$c(a).then(function(a){m.result.currentPage.interaction=
a}):Promise.resolve()},cd=function(a){return(a.listeners||[]).map(function(a){return Va(a)})},dd=function(a){return"function"===typeof a.locale?a.locale():a.locale},fc=function(){for(var a=arguments.length,c=Array(a),d=0;d<a;d++)c[d]=arguments[d];return c.reduce(function(a,c){Object.keys(c).forEach(function(d){var f=a[d],e=c[d];Array.isArray(f)&&Array.isArray(e)?Object.assign(a,X({},d,f.concat.apply(f,gb(e)))):f&&"object"===x(f)&&e&&"object"===x(e)?Object.assign(a,X({},d,fc(f,e))):Object.assign(a,
X({},d,e))});return a},{})},cc=function(a){var c=m.config.global||{},d=c.onActionEvent;delete c.onActionEvent;a=fc(c,a);c.onActionEvent=d;return a},ed=function(a){a.forEach(function(a){if(!a.name||!a.isMatch)throw Error("All page configs must have a name and isMatch attribute defined");})},fd=function(){var a=m.result;Ua(m.result.currentPage);m.result=a},Xa=function(){document.dispatchEvent(new CustomEvent(e.CustomEvents.OnSettledSitemap,{detail:{result:Pa()}}))},bd=function(a){bc(a);$b();Mb();la();
m.result.currentPage=null;m.result.matchedConfig=null;try{ed(a.pageTypes);var c=!0}catch(d){n.onFireException.emit(Error(d),"Sitemap"),c=!1}c&&Dc(a)?Ra(a.pageTypes).then(cc).then(dc).then(fd).then(Zb).then(Xa).catch(function(a){"sitemap_reinit"!==a&&(n.onFireException.emit(Error("Unhandled exception: ".concat(a)),"Site-wide Javascript"),Xa())}):Xa()},w=function(a,c){if(a)try{return a(c)}catch(d){return n.onFireException.emit(Error("getValue for ".concat(v," failed on ").concat(m.result.matchedConfig.name,
" inside of the custom transform function. ").concat(d)),"Site-wide Javascript"),null}return c},Ya=function(a,c){c=c||window;a=a.split(".");a=na(a);var d;try{for(a.s();!(d=a.n()).done;){var f=d.value;var e=/(\w+)\[([0-9]+)\]/.exec(f);if(c[f])c=c[f];else if(e){if(c[e[1]]&&(c=c[e[1]][parseInt(e[2],10)],!c))return null}else return null}}catch(l){a.e(l)}finally{a.f()}return c},gc={fromSelector:function(a,c){return function(){if("string"!=typeof a)return n.onFireException.emit(Error("getValue for ".concat(v,
" failed on ").concat(m.result.matchedConfig.name,". Selector must be a string.")),"Site-wide Javascript"),null;var d=k(a).first().text();return d=w(c,d)}},fromSelectorAttribute:function(a,c,d){return function(){if("string"!=typeof a)return n.onFireException.emit(Error("getValue for ".concat(v," failed on ").concat(m.result.matchedConfig.name,". Selector must be a string.")),"Site-wide Javascript"),null;if("string"!=typeof c)return n.onFireException.emit(Error("getValue for ".concat(v," failed on ").concat(m.result.matchedConfig.name,
". Attribute must be a string.")),"Site-wide Javascript"),null;var e=k(a).first().attr(c);return e=w(d,e)}},fromSelectorMultiple:function(a,c){return function(){if("string"!=typeof a)return n.onFireException.emit(Error("getValue for ".concat(v," failed on ").concat(m.result.matchedConfig.name,". Selector must be a string.")),"Site-wide Javascript"),null;var d=k(a).get().map(function(a){return k(a).text()});return d=w(c,d)}},fromSelectorAttributeMultiple:function(a,c,d){return function(){if("string"!=
typeof a)return n.onFireException.emit(Error("getValue for ".concat(v," failed on ").concat(m.result.matchedConfig.name,". Selector must be a string.")),"Site-wide Javascript"),null;if("string"!=typeof c)return n.onFireException.emit(Error("getValue for ".concat(v," failed on ").concat(m.result.matchedConfig.name,". Attribute must be a string.")),"Site-wide Javascript"),null;var e=k(a).get().map(function(a){return k(a).attr(c)});return e=w(d,e)}},fromItemProp:function(a,c){return function(){var d=
k("[itemprop='"+a+"']").first().attr("content");return d=w(c,d)}},fromMeta:function(a,c){return function(){var d=k("meta[name='"+a+"']").first().attr("content")||k("meta[property='"+a+"']").first().attr("content");return d=w(c,d)}},fromWindow:function(a,c){return function(){var d=Ya(a);return d=w(c,d)}},fromJsonLd:function(a,c){return function(){var d=k("script[type='application/ld+json']").first().text();try{var e=JSON.parse(d);if(a){var h=Ya(a,e);return w(c,h)}return w(c,e)}catch(l){n.onFireException.emit(Error("Parsing JSON-LD for ".concat(v,
" failed on ").concat(m.result.matchedConfig.name,". ").concat(l)),"Site-wide Javascript")}}},fromCanonical:function(a){return function(){var c=k("link[rel=canonical]").attr("href");return c=w(a,c)}},fromHref:function(a){return function(){var c=window.location.href;return c=w(a,c)}},buildCategoryId:function(a,c,d,e){return function(){var f=Array.from(k(a));c&&(f=f.slice(c));d&&(f=f.slice(0,-1));var l=[];f.forEach(function(a){(a=k(a).text().trim())?l.push(a):n.onFireException.emit(Error("buildCategoryId for ".concat(v,
" failed on ").concat(m.result.matchedConfig.name,". A category part is null.")),"Site-wide Javascript")});f=l.join("|");return f=w(e,f)}},buildCategoryIdAttribute:function(a,c,d,e,h){return function(){var f=Array.from(k(a));d&&(f=f.slice(d));e&&(f=f.slice(0,-1));var g=[];f.forEach(function(a){(a=k(a).attr(c).trim())?g.push(a):n.onFireException.emit(Error("buildCategoryId for ".concat(v," failed on ").concat(m.result.matchedConfig.name,". A category part is null.")),"Site-wide Javascript")});f=g.join("|");
return f=w(h,f)}}},y=k,hc;(function(a){a.INITIALIZED="initialized";a.SHUT_DOWN="shutDown"})(hc||(hc={}));var Ha="shutDown";var R={cookieDomain:null,consents:null},ic=function(){function a(a,c,e){if(e)for(a=Math.random().toString(36).slice(2);d[a];)a=Math.random().toString(36).slice(2);else a=a||c;return a}function c(c,e){return{pageElementLoaded:function(f,g){if("string"!==typeof g||""===g)g=0<y("body").length?"body":"html";if("string"!==typeof f||""===f)throw Error("[pageElementLoaded] Invalid arguments");
return new Promise(function(k){var l=y(f);if(0<l.length)k(l[0]);else{l=y(g)[0];if(!l)throw Error("pageElementLoaded cannot be bound. observerSelector ".concat(g," is not on the page"));var m=new MutationObserver(function(a,d){a=na(a);var e;try{for(a.s();!(e=a.n()).done;){var g=e.value;if(g.addedNodes&&0<g.addedNodes.length){var l=na(g.addedNodes),m;try{for(l.s();!(m=l.n()).done;){var p=m.value,n=y(p).is(f)?p:y(p).find(f).get(0);if(n){c?h.unbind(c):d.disconnect();k(n);return}}}catch(Za){l.e(Za)}finally{l.f()}}}}catch(Za){a.e(Za)}finally{a.f()}});
m.observe(l,{childList:!0,subtree:!0})}c=a(c,"<pageElementLoaded>"+f,e);d[c]=function(){m&&m.disconnect()}})},pageElementVisible:function(f,g){var l=g||0;if("string"!==typeof f||""===f||"number"!==typeof l||0>l||1<l)throw Error("[pageElementVisible] Invalid arguments");return new Promise(function(g){var k=y(f),m=new IntersectionObserver(function(a,d){for(var e=0;e<a.length;e++)if(a[e].isIntersecting){c?h.unbind(c):d.disconnect();g(a[e]);break}},{threshold:l});m.observe(k[0]);c=a(c,"<pageElementVisible>"+
f,e);d[c]=function(){m.disconnect()}})},pageExit:function(f){f=f||0;if("number"!==typeof f||0>f)throw Error("[pageExit] Invalid arguments");return new Promise(function(g){function l(a){clearTimeout(n);10>=a.pageY-window.pageYOffset&&(n=0<f?setTimeout(k.bind(this,a),f):k.call(this,a))}function k(a){c?h.unbind(c):m.off("mousemove",l);clearTimeout(n);g(a)}var m=y(document),n;m.on("mousemove",l);c=a(c,"<pageExit>",e);d[c]=function(){m.off("mousemove",l)}})},pageInactive:function(f){function g(a,d){var e=
new Promise(function(e){function f(a){a=a||new Event("pageInactive");c&&!d.isSubscribe?h.unbind(c):l.off("mousemove click scroll keyup keydown",g);e(a)}function g(c){clearTimeout(k);k=setTimeout(f.bind(this,c),a)}var l=y(document),k;g();l.on("mousemove click scroll keyup keydown",g)});e.subscribe=function(f){delete e.subscribe;d.isSubscribe=!0;e.then(function(e){e.disconnect=function(){c?h.unbind(c):d.isDisconnected=!0};f(e);!d.isDisconnected&&g(a,d).subscribe(f)});return e};return e}if("number"!==
typeof f||0>=f)throw Error("[pageInactive] Invalid arguments");var l={isDisconnected:!1,isSubscribe:!1};c=a(c,"<pageInactive>",e);d[c]=function(){l.isDisconnected=!0};return g(f,l)},pageScroll:function(f){if("number"!==typeof f||0>f||1<f)throw Error("[pageScroll] Invalid arguments");return new Promise(function(g){function l(a){window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)>=f&&(g(a),c?h.unbind(c):k.off("scroll",l))}var k=y(document);k.on("scroll",l);c=a(c,"<pageScroll>",
e);d[c]=function(){k.off("scroll",l)}})}}}var d={},e=c(null,!0),h=function(){return{bind:function(a){a&&d[a]&&(d[a](),delete d[a]);return c(a)},unbind:function(a){if(!a||"string"!==typeof a||"function"!==typeof d[a])return null;d[a]();delete d[a]},getBindings:function(){return d},clearBindings:function(){for(var a in d)d.hasOwnProperty(a)&&(d[a](),delete d[a])}}}();return Object.assign(e,h)}(),jc=function(){function a(c){var d=this;L(this,a);this.clearRateLimiter=function(){d.sentEvents=[]};this.eventWithinLimitTimeRange=
function(a,c,d){return d-c.time<a};this.getTimeRangeMax=function(){return d.eventRateLimiterConfig.globalTimeRange};this.removeOldEvents=function(a){for(var c=d.getTimeRangeMax(),e=d.sentEvents.length-1;0<=e;e--)if(!d.eventWithinLimitTimeRange(c,d.sentEvents[e],a)){d.sentEvents.splice(0,e+1);break}};this.checkGlobalLimits=function(a,c){var e=q({},d.eventRateLimiterConfig),f=e.globalLimit;e=e.globalTimeRange;return d.eventWithinLimitTimeRange(e,d.sentEvents[a],c)&&(d.globalCounter++,d.globalCounter>
f)?(r.info("Event rate limit exceeded. More than ".concat(f," events ")+"sent in ".concat(e,"ms.")),!0):!1};this.checkLimits=function(a,c){return d.checkGlobalLimits(a,c.time)};this.sentEvents=[];this.eventRateLimiterConfig=c}return M(a,[{key:"resetCounters",value:function(){this.globalCounter=0}},{key:"isTriggerLimitExceeded",value:function(a){var c=Date.now();a=q(q({},a),{},{time:c});this.sentEvents.push(a);this.removeOldEvents(c);this.resetCounters();for(c=this.sentEvents.length-1;0<=c;c--)if(this.checkLimits(c,
a))return!0;return!1}}])}(),gd=function(a){function c(a){L(this,c);var d=lc(this,c,[a]);d.getTimeRangeMax=function(){return d.eventRateLimiterConfig.perInteractionTimeRange?Math.max(d.eventRateLimiterConfig.globalTimeRange,d.eventRateLimiterConfig.perInteractionTimeRange):d.eventRateLimiterConfig.globalTimeRange};d.checkInteractionLimits=function(a,c,e){return d.eventRateLimiterConfig.perInteractionLimit&&d.eventRateLimiterConfig.perInteractionTimeRange&&d.eventWithinLimitTimeRange(d.eventRateLimiterConfig.perInteractionTimeRange,
d.sentEvents[a],c)&&d.sentEvents[a].name===e&&(d.perEventCounter++,d.perEventCounter>d.eventRateLimiterConfig.perInteractionLimit)?(r.info("Event rate limit exceeded. More than ".concat(d.eventRateLimiterConfig.perInteractionLimit," events ")+"with interaction name of ".concat(e," sent in ").concat(d.eventRateLimiterConfig.perInteractionTimeRange,"ms.")),!0):!1};d.checkLimits=function(a,c){return d.checkGlobalLimits(a,c.time)||d.checkInteractionLimits(a,c.time,c.name)};return d}mc(c,a);return M(c,
[{key:"resetCounters",value:function(){fb(c,"resetCounters",this,3)([]);this.perEventCounter=0}},{key:"isTriggerLimitExceeded",value:function(a){return fb(c,"isTriggerLimitExceeded",this,3)([a])}}])}(jc),Da,Ea,Fa,Ga,$a=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!(Gc(window.navigator.userAgent||"")?ea("You are a robot."):"prerender"===document.visibilityState&&Hc?ea("Page is pre-rendered and loaded in Safari."):1))return Promise.reject();"initialized"==Ha&&ea("reinitializing Web SDK");
a.cookieDomain&&U(a.cookieDomain);yb();R=q(q({},R),a);document.dispatchEvent(new CustomEvent(e.CustomEvents.OnBeforeInit,{detail:{sdkConfig:R}}));Ec();Db();Ha="initialized";document.dispatchEvent(new CustomEvent(e.CustomEvents.OnInit,{detail:{sdkConfig:R}}));Xc(R.consents);return Promise.resolve()},kc=function(){var a=D.map(function(a){return a.consent});$a(q(q({},R),{},{consents:a})).then(function(){Wa(m.config)})};window.SalesforceInteractions={init:$a,reinit:kc,sendEvent:Ua,sendException:Sa,getAnonymousId:Eb,
setAnonymousId:ia,getCookieDomain:xb,setCookieDomain:U,updateConsents:Ta,getConsents:Nb,ConsentStatus:e.ConsentStatus,log:r,getLoggingLevel:ib,setLoggingLevel:hb,initSitemap:Wa,getSitemapConfig:Kb,getSitemapResult:Pa,CatalogObjectInteractionName:e.CatalogObjectInteractionName,CartInteractionName:e.CartInteractionName,OrderInteractionName:e.OrderInteractionName,listener:ub,build:ec,cashDom:y,resolvers:gc,util:ac,DisplayUtils:ic,CustomEvents:e.CustomEvents};e.DEFAULT_CHANNEL="Web";e.DisplayUtils=ic;
e.EventRateLimiter=jc;e.InteractionEventRateLimiter=gd;e.SITEMAP_REINIT="sitemap_reinit";e.STORAGE_INFO=Ja;e.attemptToBindListener=Va;e.build=ec;e.cancelListenerSearch=la;e.cashDom=y;e.clearPersistedIdentities=function(){document.dispatchEvent(new CustomEvent(e.CustomEvents.OnClearPersistedIdentities))};e.currentConsentOptInExists=Tb;e.generateUuid=jb;e.getAnonymousId=Eb;e.getConsents=Nb;e.getCookieDomain=xb;e.getCurrentSitemapKey=function(){return v};e.getLoggingLevel=ib;e.getSitemapConfig=Kb;e.getSitemapResult=
Pa;e.getState=function(){return m};e.getValueFromNestedObject=Ya;e.identityCookieExists=Fb;e.init=$a;e.initSitemap=Wa;e.listener=ub;e.log=r;e.matchPageConfig=Ra;e.prepareEvent=Ub;e.reinit=kc;e.removeCurrentListeners=$b;e.removeOutstandingPageMatchResolvers=Mb;e.resetAnonymousId=function(){document.dispatchEvent(new CustomEvent(e.CustomEvents.OnResetAnonymousId))};e.resolvers=gc;e.sendEvent=Ua;e.sendException=Sa;e.setAnonymousId=ia;e.setConfig=bc;e.setCookieDomain=U;e.setCurrentSitemapKey=function(a){v=
a};e.setLoggingLevel=hb;e.setSameSiteAttributeOnCookie=function(a){Ab=a};e.setSecureAttributeOnCookie=function(a){zb=a};e.sha1=aa;e.shutDown=ea;e.startListenerSearch=Zb;e.updateConsents=Ta;e.util=ac;return e}({});


// CDP EVENT RECEIVER - npm/@salesforce/interactions-cdp-event-receiver/1.0/build/dist/index.min.js [1.0.15]
(function () {
  var cdpEventReceiver=function(e){"use strict";function t(e,...t){t.forEach(t=>{if(null==e||!1===Object.prototype.hasOwnProperty.call(e,t)||null==e[t])throw new Error(`missing required option "${String(t)}"`)})}function n(e,t){const n=new CustomEvent(e,{detail:t});document.dispatchEvent(n)}async function r(e){return await new Promise((t,n)=>{const r=new XMLHttpRequest;r.onload=()=>t(r),r.onerror=()=>t(r),r.abort=()=>n(new Error("Request aborted")),e(r)})}async function o(e){await new Promise(t=>{setTimeout(t,e)})}function a(e){return 200===(null==e?void 0:e.status)||204===(null==e?void 0:e.status)}function i(){return window.SalesforceInteractions}function c(){const e=i().getAnonymousId();if(null==e||""===e)throw new Error("sessionId is missing");return e}function s(e){var t;return null!==(t=e.deviceId)&&void 0!==t?t:c()}function u(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(e,t)=>{const n=t.toString();return String.fromCharCode(parseInt(`0x${n}`,16))}))}var l;let d;!function(e){e.OnBeforeEventSend="dataCloud:onBeforeEventSend",e.OnEventSend="dataCloud:onEventSend"}(l||(l={})),null!=window.SalesforceInteractions&&(window.SalesforceInteractions.DataCloud={CustomEvents:l,profileHasChanged:!1});const p=new Uint8Array(16);function f(){if(!d&&(d="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!d))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return d(p)}var g=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const v=[];for(let e=0;e<256;++e)v.push((e+256).toString(16).slice(1));function m(e,t=0){return v[e[t+0]]+v[e[t+1]]+v[e[t+2]]+v[e[t+3]]+"-"+v[e[t+4]]+v[e[t+5]]+"-"+v[e[t+6]]+v[e[t+7]]+"-"+v[e[t+8]]+v[e[t+9]]+"-"+v[e[t+10]]+v[e[t+11]]+v[e[t+12]]+v[e[t+13]]+v[e[t+14]]+v[e[t+15]]}function y(e){if(!function(e){return"string"==typeof e&&g.test(e)}(e))throw TypeError("Invalid UUID");let t;const n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n}function h(e,t,n){function r(e,r,o,a){var i;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=y(r)),16!==(null===(i=r)||void 0===i?void 0:i.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+e.length);if(c.set(r),c.set(e,r.length),c=n(c),c[6]=15&c[6]|t,c[8]=63&c[8]|128,o){a=a||0;for(let e=0;e<16;++e)o[a+e]=c[e];return o}return m(c)}try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}function w(e){return 14+(e+64>>>9<<4)+1}function b(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function I(e,t,n,r,o,a){return b((i=b(b(t,e),b(r,a)))<<(c=o)|i>>>32-c,n);var i,c}function O(e,t,n,r,o,a,i){return I(t&n|~t&r,e,t,o,a,i)}function C(e,t,n,r,o,a,i){return I(t&r|n&~r,e,t,o,a,i)}function j(e,t,n,r,o,a,i){return I(t^n^r,e,t,o,a,i)}function E(e,t,n,r,o,a,i){return I(n^(t|~r),e,t,o,a,i)}h("v3",48,function(e){if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){const t=[],n=32*e.length,r="0123456789abcdef";for(let o=0;o<n;o+=8){const n=e[o>>5]>>>o%32&255,a=parseInt(r.charAt(n>>>4&15)+r.charAt(15&n),16);t.push(a)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[w(t)-1]=t;let n=1732584193,r=-271733879,o=-1732584194,a=271733878;for(let t=0;t<e.length;t+=16){const i=n,c=r,s=o,u=a;n=O(n,r,o,a,e[t],7,-680876936),a=O(a,n,r,o,e[t+1],12,-389564586),o=O(o,a,n,r,e[t+2],17,606105819),r=O(r,o,a,n,e[t+3],22,-1044525330),n=O(n,r,o,a,e[t+4],7,-176418897),a=O(a,n,r,o,e[t+5],12,1200080426),o=O(o,a,n,r,e[t+6],17,-1473231341),r=O(r,o,a,n,e[t+7],22,-45705983),n=O(n,r,o,a,e[t+8],7,1770035416),a=O(a,n,r,o,e[t+9],12,-1958414417),o=O(o,a,n,r,e[t+10],17,-42063),r=O(r,o,a,n,e[t+11],22,-1990404162),n=O(n,r,o,a,e[t+12],7,1804603682),a=O(a,n,r,o,e[t+13],12,-40341101),o=O(o,a,n,r,e[t+14],17,-1502002290),r=O(r,o,a,n,e[t+15],22,1236535329),n=C(n,r,o,a,e[t+1],5,-165796510),a=C(a,n,r,o,e[t+6],9,-1069501632),o=C(o,a,n,r,e[t+11],14,643717713),r=C(r,o,a,n,e[t],20,-373897302),n=C(n,r,o,a,e[t+5],5,-701558691),a=C(a,n,r,o,e[t+10],9,38016083),o=C(o,a,n,r,e[t+15],14,-660478335),r=C(r,o,a,n,e[t+4],20,-405537848),n=C(n,r,o,a,e[t+9],5,568446438),a=C(a,n,r,o,e[t+14],9,-1019803690),o=C(o,a,n,r,e[t+3],14,-187363961),r=C(r,o,a,n,e[t+8],20,1163531501),n=C(n,r,o,a,e[t+13],5,-1444681467),a=C(a,n,r,o,e[t+2],9,-51403784),o=C(o,a,n,r,e[t+7],14,1735328473),r=C(r,o,a,n,e[t+12],20,-1926607734),n=j(n,r,o,a,e[t+5],4,-378558),a=j(a,n,r,o,e[t+8],11,-2022574463),o=j(o,a,n,r,e[t+11],16,1839030562),r=j(r,o,a,n,e[t+14],23,-35309556),n=j(n,r,o,a,e[t+1],4,-1530992060),a=j(a,n,r,o,e[t+4],11,1272893353),o=j(o,a,n,r,e[t+7],16,-155497632),r=j(r,o,a,n,e[t+10],23,-1094730640),n=j(n,r,o,a,e[t+13],4,681279174),a=j(a,n,r,o,e[t],11,-358537222),o=j(o,a,n,r,e[t+3],16,-722521979),r=j(r,o,a,n,e[t+6],23,76029189),n=j(n,r,o,a,e[t+9],4,-640364487),a=j(a,n,r,o,e[t+12],11,-421815835),o=j(o,a,n,r,e[t+15],16,530742520),r=j(r,o,a,n,e[t+2],23,-995338651),n=E(n,r,o,a,e[t],6,-198630844),a=E(a,n,r,o,e[t+7],10,1126891415),o=E(o,a,n,r,e[t+14],15,-1416354905),r=E(r,o,a,n,e[t+5],21,-57434055),n=E(n,r,o,a,e[t+12],6,1700485571),a=E(a,n,r,o,e[t+3],10,-1894986606),o=E(o,a,n,r,e[t+10],15,-1051523),r=E(r,o,a,n,e[t+1],21,-2054922799),n=E(n,r,o,a,e[t+8],6,1873313359),a=E(a,n,r,o,e[t+15],10,-30611744),o=E(o,a,n,r,e[t+6],15,-1560198380),r=E(r,o,a,n,e[t+13],21,1309151649),n=E(n,r,o,a,e[t+4],6,-145523070),a=E(a,n,r,o,e[t+11],10,-1120210379),o=E(o,a,n,r,e[t+2],15,718787259),r=E(r,o,a,n,e[t+9],21,-343485551),n=b(n,i),r=b(r,c),o=b(o,s),a=b(a,u)}return[n,r,o,a]}(function(e){if(0===e.length)return[];const t=8*e.length,n=new Uint32Array(w(t));for(let r=0;r<t;r+=8)n[r>>5]|=(255&e[r/8])<<r%32;return n}(e),8*e.length))});var S={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function T(e,t,n){if(S.randomUUID&&!e)return S.randomUUID();const r=(e=e||{}).random||(e.rng||f)();return r[6]=15&r[6]|64,r[8]=63&r[8]|128,m(r)}function A(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function U(e,t){return e<<t|e>>>32-t}function N(e){return("number"==typeof(null==e?void 0:e.time)?new Date(e.time):new Date).toISOString()}function x(e,t){return{eventId:T(),dateTime:N(e),sessionId:c(),deviceId:s(t)}}function R(t,n){var r;const o=null!==(r=t.consents)&&void 0!==r?r:[];if(0===o.length)return[];const a=[];return o.forEach(r=>{const o=function(t,n,r){try{let o;if(t.status===e.ConsentStatus.OptIn)o="opt-in";else{if(t.status!==e.ConsentStatus.OptOut)return i().log.error(`Consent value should be either "${e.ConsentStatus.OptIn}" or "${e.ConsentStatus.OptOut}"`,n),null;o="opt-out"}return Object.assign(Object.assign({},x(n,r)),{eventType:"consentLog",category:"Engagement",purpose:t.purpose,provider:t.provider,status:o})}catch(e){const t=e instanceof Error?e.message:"Unknown error occurred during consent extraction";return i().log.error(t),null}}(r,t,n);null!=o&&a.push(o)}),a}function $(e){var t,n,r,o,a,i;return{interactionName:null===(t=null==e?void 0:e.interaction)||void 0===t?void 0:t.name,pageView:null==e?void 0:e.pageView,sourceUrl:null===(n=null==e?void 0:e.source)||void 0===n?void 0:n.url,sourceUrlReferrer:null===(r=null==e?void 0:e.source)||void 0===r?void 0:r.urlReferrer,sourceChannel:null===(o=null==e?void 0:e.source)||void 0===o?void 0:o.channel,sourceLocale:null===(a=null==e?void 0:e.source)||void 0===a?void 0:a.locale,sourcePageType:null===(i=null==e?void 0:e.source)||void 0===i?void 0:i.pageType}}h("v5",80,function(e){const t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let n=0;n<t.length;++n)e.push(t.charCodeAt(n))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const r=e.length/4+2,o=Math.ceil(r/16),a=new Array(o);for(let t=0;t<o;++t){const n=new Uint32Array(16);for(let r=0;r<16;++r)n[r]=e[64*t+4*r]<<24|e[64*t+4*r+1]<<16|e[64*t+4*r+2]<<8|e[64*t+4*r+3];a[t]=n}a[o-1][14]=8*(e.length-1)/Math.pow(2,32),a[o-1][14]=Math.floor(a[o-1][14]),a[o-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<o;++e){const r=new Uint32Array(80);for(let t=0;t<16;++t)r[t]=a[e][t];for(let e=16;e<80;++e)r[e]=U(r[e-3]^r[e-8]^r[e-14]^r[e-16],1);let o=n[0],i=n[1],c=n[2],s=n[3],u=n[4];for(let e=0;e<80;++e){const n=Math.floor(e/20),a=U(o,5)+A(n,i,c,s)+u+t[n]+r[e]>>>0;u=s,s=c,c=U(i,30)>>>0,i=o,o=a}n[0]=n[0]+o>>>0,n[1]=n[1]+i>>>0,n[2]=n[2]+c>>>0,n[3]=n[3]+s>>>0,n[4]=n[4]+u>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]});const L=/^[a-zA-Z](?!.*__)(?!.*_$)\w{0,79}$/;function D(e){return"string"==typeof e&&L.test(e)?e:(i().log.warn(`[Invalid eventType: "${e}"] Must begin with a letter (a-zA-Z) and can only contain alphanumeric characters and underscores (no spaces.) Also cannot end with or have consecutive underscores. Max 80 characters.`),null)}function k(e){return{eventId:T(),category:e.category,dateTime:e.dateTime,deviceId:e.deviceId,sessionId:e.sessionId,eventType:"",interactionName:e.interactionName}}function q(e){return null!=(null==e?void 0:e.catalogObjectId)&&null!=(null==e?void 0:e.catalogObjectType)&&null!=(null==e?void 0:e.quantity)}function P(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var M,V={exports:{}};var H=function(){if(M)return V.exports;M=1;const e=/[\p{Lu}]/u,t=/[\p{Ll}]/u,n=/^[\p{Lu}](?![\p{Lu}])/gu,r=/([\p{Alpha}\p{N}_]|$)/u,o=/[_.\- ]+/,a=new RegExp("^"+o.source),i=new RegExp(o.source+r.source,"gu"),c=new RegExp("\\d+"+r.source,"gu"),s=(r,o)=>{if("string"!=typeof r&&!Array.isArray(r))throw new TypeError("Expected the input to be `string | string[]`");if(o={pascalCase:!1,preserveConsecutiveUppercase:!1,...o},0===(r=Array.isArray(r)?r.map(e=>e.trim()).filter(e=>e.length).join("-"):r.trim()).length)return"";const s=!1===o.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(o.locale),u=!1===o.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(o.locale);if(1===r.length)return o.pascalCase?u(r):s(r);return r!==s(r)&&(r=((n,r,o)=>{let a=!1,i=!1,c=!1;for(let s=0;s<n.length;s++){const u=n[s];a&&e.test(u)?(n=n.slice(0,s)+"-"+n.slice(s),a=!1,c=i,i=!0,s++):i&&c&&t.test(u)?(n=n.slice(0,s-1)+"-"+n.slice(s-1),c=i,i=!1,a=!0):(a=r(u)===u&&o(u)!==u,c=i,i=o(u)===u&&r(u)!==u)}return n})(r,s,u)),r=r.replace(a,""),r=o.preserveConsecutiveUppercase?((e,t)=>(n.lastIndex=0,e.replace(n,e=>t(e))))(r,s):s(r),o.pascalCase&&(r=u(r.charAt(0))+r.slice(1)),((e,t)=>(i.lastIndex=0,c.lastIndex=0,e.replace(i,(e,n)=>t(n)).replace(c,e=>t(e))))(r,u)};return V.exports=s,V.exports.default=s,V.exports}(),_=P(H);function J(e,t,n={}){return null==e||("object"==typeof e?Object.keys(e).forEach(r=>J(e[r],_(null!=t?t+"."+r:r),n)):null!=t&&(n[t]=e)),n}function B(e){return t(e,"catalogObjectType","catalogObjectId","quantity"),Object.assign({catalogObjectType:e.catalogObjectType,catalogObjectId:e.catalogObjectId,price:e.price,quantity:e.quantity,currency:e.currency},J(e.attributes,"attribute"))}function F(e,t,n){const r=function(e,t){return Object.assign(Object.assign(Object.assign({},x(e,t)),$(e)),{category:"Engagement",eventType:"cart"})}(e,n);return[r,...z(r,t)]}function z(n,r){const o=[];if(function(t){return t.name===e.CartInteractionName.AddToCart}(r)||function(t){return t.name===e.CartInteractionName.RemoveFromCart}(r)){t(r,"lineItem");const e=K(n,r.lineItem);null!=e&&o.push(e)}else!function(t){return t.name===e.CartInteractionName.ReplaceCart}(r)?new Set(r.lineItems).add(r.lineItem).forEach(e=>{if(q(e)){const t=K(n,e);null!=t&&o.push(t)}}):(t(r,"lineItems"),r.lineItems.forEach(e=>{const t=K(n,e);null!=t&&o.push(t)}));return o}function K(e,t){try{return Object.assign(Object.assign(Object.assign({},k(e)),B(t)),{eventType:"cartItem",cartEventId:e.eventId})}catch(e){const t=e instanceof Error?e.message:"Unknown error occurred during cart event extraction";return i().log.error(t),null}}function Z(e,n,r){t(n,"catalogObject");return[Q(e,n.catalogObject,r)]}function Q(e,n,r){return t(n,"id","type"),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},x(e,r)),$(e)),J(n.attributes,"attribute")),J(n.relatedCatalogObjects,"relatedCatalogObject")),{category:"Engagement",eventType:"catalog",id:n.id,type:n.type})}function W(e,n,r){t(n,"order");const o=n.order,a=function(e,n,r){return t(n,"id"),Object.assign(Object.assign(Object.assign(Object.assign({},x(e,r)),$(e)),J(n.attributes,"attribute")),{category:"Engagement",eventType:"order",orderId:n.id,orderCurrency:n.currency,orderTotalValue:n.totalValue})}(e,o,r);return[a,...X(a,o)]}function X(e,t){if(null==t.lineItems)return[];const n=[];return t.lineItems.forEach(t=>{const r=function(e,t){try{return Object.assign(Object.assign(Object.assign({},k(e)),B(t)),{eventType:"orderItem",orderEventId:e.eventId})}catch(e){const t=e instanceof Error?e.message:"Unknown error occurred during order event extraction";return i().log.error(t),null}}(e,t);null!=r&&n.push(r)}),n}function G(e,t,n){var r;const o=D(null!==(r=t.eventType)&&void 0!==r?r:t.name);if(null==o)return[];const a=Object.keys(e.interaction).reduce((e,n)=>("name"!==n&&(e[n]=t[n]),e),{});return[Object.assign(Object.assign(Object.assign(Object.assign({},J(a)),x(e,n)),$(e)),{eventType:o,category:"Engagement"})]}function Y(e,t,n){return null==(null==t?void 0:t.eventType)?[...ee(e,t,n),...te(e,t,n),...ne(e,t,n)]:[]}function ee(e,t,n){return function(e){return t=null==e?void 0:e.order,null!=(null==t?void 0:t.id);var t}(t)?W(e,t,n):[]}function te(e,t,n){return function(e){return t=null==e?void 0:e.catalogObject,null!=(null==t?void 0:t.id)&&null!=(null==t?void 0:t.type);var t}(t)?Z(e,t,n):[]}function ne(e,t,n){return function(e){var t;return q(null==e?void 0:e.lineItem)||(null===(t=null==e?void 0:e.lineItems)||void 0===t?void 0:t.some(q))}(t)?F(e,t,n):[]}function re(n,r){const o=null==n?void 0:n.interaction;return null==o?[]:(t(n.interaction,"name"),function(t){return e.OrderInteractionName.Return===t.name||e.OrderInteractionName.Ship===t.name||e.OrderInteractionName.Preorder===t.name||e.OrderInteractionName.Cancel===t.name||e.OrderInteractionName.Exchange===t.name||e.OrderInteractionName.Purchase===t.name||e.OrderInteractionName.Deliver===t.name}(o)?W(n,o,r):function(t){return e.CatalogObjectInteractionName.ViewCatalogObject===t.name||e.CatalogObjectInteractionName.CommentCatalogObject===t.name||e.CatalogObjectInteractionName.FavoriteCatalogObject===t.name||e.CatalogObjectInteractionName.ReviewCatalogObject===t.name||e.CatalogObjectInteractionName.ShareCatalogObject===t.name||e.CatalogObjectInteractionName.QuickViewCatalogObject===t.name||e.CatalogObjectInteractionName.ViewCatalogObjectDetail===t.name}(o)?Z(n,o,r):function(t){return e.CartInteractionName.ReplaceCart===t.name||e.CartInteractionName.AddToCart===t.name||e.CartInteractionName.RemoveFromCart===t.name}(o)?F(n,o,r):function(e,t,n){return[...Y(e,t,n),...G(e,t,n)]}(n,o,r))}function oe(e,t){var n,r;const o=R(e,t);if(function(e){return e.length>0&&e.every(e=>"opt-out"===e.status)}(o))return o;const a=function(e,t){var n;const r=null===(n=null==e?void 0:e.user)||void 0===n?void 0:n.attributes;if("object"!=typeof r)return[];const o=D(null==r?void 0:r.eventType);if(null==o)throw new Error(`Missing or invalid required "user.attributes.eventType" string in action: ${JSON.stringify(e,null,"\t")}`);return[Object.assign(Object.assign(Object.assign(Object.assign({},x(e,t)),$(e)),r),{eventType:o,category:"Profile"})]}(e,t);return(null===(r=null===(n=i())||void 0===n?void 0:n.DataCloud)||void 0===r?void 0:r.profileHasChanged)&&(0===a.length&&(a.push(Object.assign(Object.assign({},x(e,t)),{category:"Profile",eventType:"identity",isAnonymous:1})),i().log.debug(`Attaching new anonymous identity: ${s(t)}`)),i().DataCloud.profileHasChanged=!1),[...o,...a,...re(e,t)]}const ae="application/json, text/javascript, */*; q=0.01";async function ie(e,t){const o=oe(e,t),c={actionEvent:e,events:o},s=!document.dispatchEvent(new CustomEvent(l.OnBeforeEventSend,{detail:c,cancelable:!0}));if(i().getLoggingLevel()>=4&&i().log.debug(`Events translated for Data Cloud: ${JSON.stringify(o,ce,"\t")}`),o.length>0&&!s){const e=t.tenantSpecificEndpoint+"/web/events/"+t.authenticator.appSourceId,i={events:o},c=JSON.stringify(i,ce);n(l.OnEventSend,JSON.parse(c)),await async function(e,t){!function(){if("function"!=typeof window.fetch)return!1;try{return!!new Request("_",{keepalive:!0}).keepalive}catch(e){return!1}}()?await async function(e,t){const n=await r(n=>{const r=encodeURIComponent(u(t));n.open("POST",e,!0),n.setRequestHeader("Accept",ae),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(`event=${r}`)});if(!a(n)){const e=new Error(`Response was not OK: ${n.responseText}`);throw Object.assign(e,{status:n.status,statusText:n.statusText}),e}}(e,t):await async function(e,t){const n=encodeURIComponent(u(t)),r=new Headers;r.append("Accept",ae),r.append("Content-Type","application/x-www-form-urlencoded");const o={method:"POST",headers:r,body:`event=${n}`,credentials:"omit",keepalive:!0},a=await fetch(e,o);if(await a.text(),!a.ok){const e=new Error(`Response was not OK. Type: ${a.type}, status: ${a.status} (${a.statusText})`);throw Object.assign(e,{status:a.status,statusText:a.statusText,type:a.type}),e}}(e,t)}(e,c)}}function ce(e,t){return"boolean"==typeof t?t?1:0:t}function se(e){const t=function(e){var t,n;const i=e.tenantSpecificEndpoint+"/web/v2/authentication",c=null!==(t=e.authenticator.maxAttempts)&&void 0!==t?t:5,u=null!==(n=e.authenticator.retryDelay)&&void 0!==n?n:5;let l=!1,d=!1;return async()=>{if(l)return!0;if(d)return!1;const t=async()=>{const t=await r(t=>{const n=btoa(JSON.stringify({appSourceId:e.authenticator.appSourceId,deviceId:s(e)}));t.open("POST",i),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(`auth=${n}`)});if(401===t.status)throw d=!0,new Error("Unauthorized");return a(t)};for(let e=c;e>0;e--)try{if(l=await t(),l)return!0}finally{!l&&!d&&e>1&&await o(u)}throw d=!0,new Error("No more authentication retries")}}(e);return async n=>{await t()&&await ie(n,e)}}function ue(e,t){document.addEventListener(e,t),window.addEventListener("pagehide",function n(){document.removeEventListener(e,t),window.removeEventListener("pagehide",n)})}return window.getSalesforceInteractions=()=>i(),window.getSalesforceInteractionsName=()=>"SalesforceInteractions",function(r){t(r,"tenantSpecificEndpoint","authenticator"),t(r.authenticator,"appSourceId"),r.tenantSpecificEndpoint=function(e,t=""){const n="https://";try{if(e=e.trim(),/^.+:\/\/.*/.test(e)||(e=n+e),!(e=n+new URL(e).hostname).endsWith(".salesforce.com"))throw new TypeError("Invalid URL: "+e)}catch(n){if(e="",""!==t)throw new Error(t)}return e}(r.tenantSpecificEndpoint,"tenantSpecificEndpoint is invalid");const o=se(r);ue(e.CustomEvents.OnBeforeInit,async e=>{void 0!==(null==e?void 0:e.detail.sdkConfig)&&(e.detail.sdkConfig.dataCloud=r)}),ue(e.CustomEvents.OnSetAnonymousId,async e=>{const{newAnonymousId:t,previousAnonymousId:n}=e.detail;"previousAnonymousId"in e.detail&&"newAnonymousId"in e.detail&&t!==n&&(i().DataCloud.profileHasChanged=!0,i().log.debug(`deviceId has changed from "${String(n)}" to "${String(t)}"`))}),ue(e.CustomEvents.OnEventSend,async t=>{try{const n=t.detail.actionEvent;i().getConsents().findIndex(t=>t.consent.status===e.ConsentStatus.OptIn)>=0||function(t){var n;return(null===(n=null==t?void 0:t.interaction)||void 0===n?void 0:n.name)===e.MetadataUpdateInteractionName.MetadataUpdate&&Array.isArray(t.consents)&&t.consents.some(t=>t.status===e.ConsentStatus.OptOut)}(n)?await o(n):i().log.debug("event not sent to CDP because consent was not given")}catch(t){const r=t instanceof Error?t.message:"Unknown error occurred during event send";i().log.error(r),n(e.CustomEvents.OnException,{error:t})}})}}(SalesforceInteractions);

  try {
    cdpEventReceiver({
      tenantSpecificEndpoint: "https://g02g0nzzgyzggmjtmrsgcnjzgq.c360a.salesforce.com",
      authenticator: {
        appSourceId: "40da4f2d-bf9e-4dea-85d4-6ddb02759fb2"
      }
    });
  } catch (e) {
    console.error("[Salesforce Data Cloud] Error initializing Web SDK:", e);
  }
})();

      (function () {
      // ----- module personalization - npm/@salesforce/interactions-personalization/1.0/build/dist/index.min.js [1.0.14]
      try {
        (function(y){"use strict";function yl(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var P=yl(y),_l=Object.defineProperty,Zi=Object.getOwnPropertySymbols,Tl=Object.prototype.hasOwnProperty,bl=Object.prototype.propertyIsEnumerable,Ki=(e,t,n)=>t in e?_l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,wl=(e,t)=>{for(var n in t||(t={}))Tl.call(t,n)&&Ki(e,n,t[n]);if(Zi)for(var n of Zi(t))bl.call(t,n)&&Ki(e,n,t[n]);return e},Sl=(e,t,n)=>new Promise((r,i)=>{var o=a=>{try{l(n.next(a))}catch(u){i(u)}},s=a=>{try{l(n.throw(a))}catch(u){i(u)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,s);l((n=n.apply(e,t)).next())});function Xi(e,t=(n=>(n=window==null?void 0:window.location)==null?void 0:n.search)()){if(b(e)&&b(t)){const n=new URLSearchParams(t);return Array.from(n.keys()).find(r=>r.toLowerCase()===e.toLowerCase())!==void 0}return!1}function Il(e,t=(n=>(n=window==null?void 0:window.location)==null?void 0:n.search)()){if(b(e)&&b(t)){const n=new URLSearchParams(t),r=Array.from(n.keys()).find(i=>i.toLowerCase()===e.toLowerCase());if(b(r))return n.get(r)}return null}function Al(e,t=(n=>(n=window==null?void 0:window.location)==null?void 0:n.search)()){if(H(e)&&b(t)){const n=new URLSearchParams(t),r=e.map(o=>o.toLowerCase()),i=Array.from(n.keys()).filter(o=>r.includes(o.toLowerCase()));if(i.length>0){let o={};return i.forEach(s=>{var l;o=wl({[s]:(l=n.get(s))!=null?l:""},o)}),o}}return null}function Cl(e,t=(n=>(n=window==null?void 0:window.location)==null?void 0:n.href)()){const n=new URL(t);if(b(e)){const r=n.searchParams,i=Array.from(r.keys()).find(o=>o.toLowerCase()===e.toLowerCase());b(i)&&n.searchParams.delete(i)}return n}function b(e,t=!1,n=!0){return typeof e!="string"?!1:t?!0:(n?e.trim():e)!==""}function D(e){return typeof e=="undefined"||e===null}function H(e,t=!1){return Array.isArray(e)?t?!0:e.length!==0:!1}function Pl(e,t=!1){return e instanceof Map?t?!0:e.size!==0:!1}function Nl(e,t=!1){return e instanceof Set?t?!0:e.size!==0:!1}function N(e,t=!0){if(typeof e!="object"||e===null||Array.isArray(e))return!1;if(!t){for(const n in e)return!0;return!1}return!0}function J(e,t){return N(e)&&!!Object.prototype.hasOwnProperty.call(e,t)}function Ht(e,t=!0){return typeof e=="number"&&(t?Number.isFinite(e):!0)}function et(e){return typeof e=="boolean"}function mn(e){return e!==null&&!isNaN(e)&&e instanceof Date}function ar(e){return typeof e=="function"}function sr(e,t){return!b(e)||!b(t)?e===t:e.toLowerCase()===t.toLowerCase()}function lr(e){return e+":"+y.generateUuid()}function Qi(e){return`[${e}]`}const Ol=function(){return{pageElementVisible:function(e){return Sl(this,null,function*(){return yield new Promise(function(t){const n=(i,o)=>{for(let s=0;s<i.length;s++)if(i[s].isIntersecting){o.disconnect(),t(e);break}},r=new IntersectionObserver(n);document.addEventListener(y.CustomEvents.OnShutDown,()=>{r.disconnect()}),r.observe(e)})})}}}();class Dl{constructor(t,n=50,r=!0){this.name=t,this.maxEntries=n,this.entries=new Map,r&&document.addEventListener(y.CustomEvents.OnShutDown,()=>{this.clear()})}get(t){return this.entries.get(t)}set(t,n){y.log.debug(`Cache "${this.name}": adding ${t}`,n),this.entries.set(t,n),this.trimIfNecessary()}clear(){y.log.info(`Cache "${this.name}": clearing all ${this.entries.size} entries`),this.entries.clear()}delete(t){y.log.debug(`Cache "${this.name}": deleting ${t}`),this.entries.delete(t)}trimIfNecessary(){let t=this.entries.size-this.maxEntries;if(!(Ht(t)||t<=0)){y.log.info(`Cache "${this.name}": removing oldest ${String(t)} entries`);for(const[n,r]of this.entries)if(y.log.info(`Cache "${this.name}": removing value:`,r),this.entries.delete(n),--t<=0)break}}}function Ft(e,t){let n=null;try{b(t)?n=new Date(t):Ht(t)?n=new Date(t):mn(t)&&(n=t)}catch(r){}if(mn(n))return n;throw new Error(`${e} is not a valid date`)}function Ji(e,t){return e.endsWith("Date")?Ft(e,t):t}function eo(e){let t=0;switch(e){case"ERROR":t=1;break;case"WARN":t=2;break;case"INFO":t=3;break;case"DEBUG":t=4;break;case"TRACE":t=5;break}return y.log.shouldLog(t)}class k{constructor(t,n=new Date){this.detail=t,this.timestamp=n}}class ur{constructor(t){this.updates=[],D(t)?this.setFinished(Promise.reject(new Error("Never updated")),!1):this.setFinished(t)}get finished(){return this._finished}update(t,n){this.updates.push(t),this.setFinished(n)}setFinished(t,n=!0){D(t)||(this._finished=t,this._finished.catch(r=>{if(!n)return;let i;if(r instanceof Error)i=r;else{let o;b(r)?o=r:b(r.message)?o=r.message:o=String(r),i=new Error(o)}this.updates.push(new k(i))}))}}class vn{constructor(t){this.pec=t,this.status=new ur}get revertStatus(){return this._revertStatus}revert(){return D(this._revertStatus)?(D(this.initiateRevert)?this._revertStatus=new ur(Promise.resolve()):this._revertStatus=this.initiateRevert(),this._revertStatus.update(new k("Requested")),this._revertStatus):this._revertStatus}static updateForAll(t,n,r){t.forEach(i=>{i.status.update(n,r)})}}class se extends Error{constructor(t,n,r){var i;super(),this.name=t,this.message=n,this.level=(i=r==null?void 0:r.level)!=null?i:"error",this.cause=r==null?void 0:r.cause,this.context=r==null?void 0:r.context}isContextWithConfigName(t){return N(t)&&"configName"in t&&typeof t.configName=="string"}getConfigName(){return this.isContextWithConfigName(this.context)?this.context.configName:""}getMessageWithContext(){return this.context!==void 0?`${this.message} Context: ${JSON.stringify(this.context)}`:this.message}}var ce=(e=>(e.AnchorDmoNameRequired="ANCHOR_DMO_NAME_REQUIRED",e.AnchorIdNullOrNotEmpty="ANCHOR_ID_NULL_OR_NOT_EMPTY",e.AnchorIdRequiredWithDmoName="ANCHOR_ID_REQUIRED_WITH_DMO_NAME",e.ConsentOptInRequired="CONSENT_OPT_IN_REQUIRED",e.ContextIsNotAnObject="CONTEXT_IS_NOT_AN_OBJECT",e.InitRequiresAppSource="INIT_REQUIRES_APP_SOURCE",e.InitRequiresTSE="INIT_REQUIRES_TSE",e.PersonalizationPointIsNotDefined="PERSONALIZATION_POINT_IS_NOT_DEFINED",e.PersonalizationPointNameIsNotAString="PERSONALIZATION_POINT_NAME_IS_NOT_A_STRING",e.PersonalizationPointDecisionIdIsNotAString="PERSONALIZATION_POINT_DECISION_ID_IS_NOT_A_STRING",e.PersonalizationPointDecisionIdProvidedNonPreview="PERSONALIZATION_POINT_DECISION_ID_PROVIDED_NON_PREVIEW",e.PersonalizationPointsIsNotAnArray="PERSONALIZATION_POINTS_IS_NOT_AN_ARRAY",e.DecisionIdNotValid="DECISION_ID_NOT_VALID",e.EndpointOverrideNotValid="ENDPOINT_OVERRIDE_NOT_VALID",e.IndividualIdNotValid="INDIVIDUAL_ID_NOT_VALID",e))(ce||{});class he extends se{}var to=(e=>(e.PersonalizationFetchFailed="PERSONALIZATION_FETCH_FAILED",e))(to||{});class no extends se{}var mt=(e=>(e.InvalidJsonObject="INVALID_JSON_OBJECT",e.MissingPersonalizationId="MISSING_PERSONALIZATION_ID",e.MissingPersonalizationPointName="MISSING_PERSONALIZATION_POINT_NAME",e.MissingPersonalizationContent="MISSING_PERSONALIZATION_CONTENT",e.MissingPersonalizationsArray="MISSING_PERSONALIZATIONS_ARRAY",e))(mt||{});class zt extends se{}var fe=(e=>(e.MissingPersonalization="MISSING_PERSONALIZATION",e.ElementsNotFound="ELEMENTS_NOT_FOUND",e.FoundNonElement="FOUND_NON_ELEMENT",e.AlreadyPersonalized="ALREADY_PERSONALIZED",e.NotSupported="NOT_SUPPORTED",e.MissingSubstitutions="MISSING_SUBSTITUTIONS",e.MissingPersonalizationDataAttributes="MISSING_PERSONALIZATION_DATA_ATTRIBUTES",e.FlickerDefenseRedisplayElapsed="FLICKER_DEFENSE_REDISPLAY_ELAPSED",e))(fe||{});class ie extends se{}var j=(e=>(e.DuplicateTransformer="DUPLICATE_TRANSFORMER",e.InvalidHandlebarsHelperName="INVALID_HANDLEBARS_HELPER_NAME",e.InvalidHandlebarsHelperFunction="INVALID_HANDLEBARS_HELPER_FUNCTION",e.InvalidLastModifiedDate="INVALID_LAST_MODIFIED_DATE",e.InvalidPublishedDate="INVALID_PUBLISHED_DATE",e.InvalidSubstitutionConfigType="INVALID_SUBSTITUTION_CONFIG_TYPE",e.InvalidSubstitutionDefinitionConfigDataType="INVALID_SUBSTITUTION_DEFINITION_CONFIG_DATA_TYPE",e.InvalidSubstitutionDefinitionConfigType="INVALID_SUBSTITUTION_DEFINITION_CONFIG_TYPE",e.InvalidSubstitutionDefinitionDescription="INVALID_SUBSTITUTION_DEFINITION_DESCRIPTION",e.InvalidSubstitutionDefinitionLabel="INVALID_SUBSTITUTION_DEFINITION_LABEL",e.InvalidSubstitutionDefinitions="INVALID_SUBSTITUTION_DEFINITIONS",e.InvalidSubstitutionDefinitionValue="INVALID_SUBSTITUTION_DEFINITION_VALUE",e.InvalidTransformerCategory="INVALID_TRANSFORMER_CATEGORY",e.InvalidTransformerDescription="INVALID_TRANSFORMER_DESCRIPTION",e.InvalidTransformerLabel="INVALID_TRANSFORMER_LABEL",e.InvalidTransformerSchemaReference="INVALID_TRANSFORMER_SCHEMA_REFERENCE",e.InvalidTransformerType="INVALID_TRANSFORMER_TYPE",e.InvalidTransformerTypeDetails="INVALID_TRANSFORMER_TYPE_DETAILS",e.InvalidTransformerTypeDetailsType="INVALID_TRANSFORMER_TYPE_DETAILS_TYPE",e.InvalidTransformerTypeForCategory="INVALID_TRANSFORMER_TYPE_FOR_CATEGORY",e.MissingImplementation="MISSING_IMPLEMENTATION",e.MissingTransformer="MISSING_TRANSFORMER",e.MissingTransformerName="MISSING_TRANSFORMER_NAME",e.MissingTransformerSubstitutionDefinition="MISSING_TRANSFORMER_SUBSTITUTION_DEFINITION",e.MissingTransformerSubstitutionDefinitionKey="MISSING_TRANSFORMER_SUBSTITUTION_DEFINITION_KEY",e.MissingTransformerTypeDetails="MISSING_TRANSFORMER_TYPE_DETAILS",e.MissingTransformerTypeDetailsHtml="MISSING_TRANSFORMER_TYPE_DETAILS_HTML",e))(j||{});class B extends se{}var R=(e=>(e.ContentZonesNotAvailable="CONTENT_ZONES_NOT_AVAILABLE",e.DisabledTransformer="TRANSFORMER_IS_DISABLED",e.DuplicatePersonalizationExperienceConfig="DUPLICATE_PERSONALIZATION_EXPERIENCE_CONFIG",e.EngagementDestinationsNotAvailable="ENGAGEMENT_DESTINATIONS_NOT_AVAILABLE",e.InvalidDataProviderDataSpaceReferenceType="INVALID_DATA_PROVIDER_DATA_SPACE_REFERENCE_TYPE",e.InvalidDataProviderGroupByReferenceType="INVALID_DATA_PROVIDER_GROUP_BY_REFERENCE_TYPE",e.InvalidDataProviderGroupByType="INVALID_DATA_PROVIDER_GROUP_BY_TYPE",e.InvalidDataProviderReferenceType="INVALID_DATA_PROVIDER_REFERENCE_TYPE",e.InvalidDataProviderType="INVALID_DATA_PROVIDER_TYPE",e.InvalidDescription="INVALID_DESCRIPTION",e.InvalidLabel="INVALID_LABEL",e.InvalidLastModifiedDate="INVALID_LAST_MODIFIED_DATE",e.InvalidPublishedDate="INVALID_PUBLISHED_DATE",e.InvalidRenderIfEmpty="INVALID_RENDER_IF_EMPTY",e.InvalidSourceMatchers="INVALID_SOURCE_MATCHERS",e.InvalidSourceMatcherType="INVALID_SOURCE_MATCHER_TYPE",e.InvalidSourceMatcherValueOnlyStar="INVALID_SOURCE_MATCHER_ONLY_STAR",e.InvalidSourceMatcherValueRepeatedStars="INVALID_SOURCE_MATCHER_REPEATED_STARS",e.InvalidSourceMatcherValueSpaceWithStars="INVALID_SOURCE_MATCHER_SPACE_WITH_STARS",e.InvalidTransformationConfigEngagementDestination="INVALID_TRANSFORMATION_CONFIG_ENGAGEMENT_DESTINATION",e.InvalidTransformationConfigEngagementDestinationName="INVALID_TRANSFORMATION_CONFIG_ENGAGEMENT_DESTINATION_NAME",e.InvalidTransformationConfigMethod="INVALID_TRANSFORMATION_CONFIG_METHOD",e.InvalidTransformationConfigWhen="INVALID_TRANSFORMATION_CONFIG_WHEN",e.InvalidTransformationConfigWhenTypes="INVALID_TRANSFORMATION_CONFIG_WHEN_TYPES",e.InvalidTransformationContentZone="INVALID_TRANSFORMATION_CONTENT_ZONE",e.InvalidTransformations="INVALID_TRANSFORMATIONS",e.InvalidTransformationSubstitutionValue="INVALID_TRANSFORMATION_SUBSTITUTION_VALUE",e.InvalidTransformationSubstitutionValues="INVALID_TRANSFORMATION_SUBSTITUTION_VALUES",e.InvalidTransformationSubstitutionValueType="INVALID_TRANSFORMATION_SUBSTITUTION_VALUE_TYPE",e.InvalidTransformationType="INVALID_TRANSFORMATION_TYPE",e.InvalidTransformerName="INVALID_TRANSFORMER_NAME",e.InvalidWhenValueDelay="INVALID_WHEN_VALUE_DELAY",e.InvalidWhenValuePath="INVALID_WHEN_VALUE_PATH",e.InvalidWhenValuePercent="INVALID_WHEN_VALUE_PERCENT",e.InvalidWhenValueTag="INVALID_WHEN_VALUE_TAG",e.MethodRequiresSpecificTransformations="METHOD_REQUIRES_SPECIFIC_TRANSFORMATIONS",e.MissingConfig="MISSING_CONFIG",e.MissingDataGroupByValue="MISSING_DATA_PROVIDER_GROUP_BY_VALUE",e.MissingDataProvider="MISSING_DATA_PROVIDER",e.MissingDataProviderValue="MISSING_DATA_PROVIDER_VALUE",e.MissingDataSpaceValue="MISSING_DATA_SPACE_VALUE",e.MissingEngagementConfig=" MISSING_ENGAGEMENT_CONFIG",e.MissingEngagementConfigDefaults=" MISSING_ENGAGEMENT_CONFIG_DEFAULTS",e.MissingEngagementConfigGlobalDefault=" MISSING_ENGAGEMENT_CONFIG_GLOBAL_DEFAULT",e.MissingName="MISSING_NAME",e.MissingSourceMatchers="MISSING_SOURCE_MATCHERS",e.MissingSourceMatcherValue="MISSING_SOURCE_MATCHER_VALUE",e.MissingSubstitutionDefinitionDefaultValue="MISSING_SUBSTITUTION_DEFINITION_DEFAULT_VALUE",e.MissingTransformation="MISSING_TRANSFORMATION",e.MissingTransformationConfig="MISSING_TRANSFORMATION_CONFIG",e.MissingTransformationConfigMethod="MISSING_TRANSFORMATION_CONFIG_METHOD",e.MissingTransformationName="MISSING_TRANSFORMATION_NAME",e.MissingTransformationPath="MISSING_TRANSFORMATION_PATH",e.MissingTransformationSubstitutionValues="MISSING_TRANSFORMATION_SUBSTITUTION_VALUES",e.MissingTransformationTag="MISSING_TRANSFORMATION_TAG",e.MissingTransformerName="MISSING_TRANSFORMER_NAME",e.PaddedSourceMatcherValue="PADDED_SOURCE_MATCHER_VALUE",e.SubstitutionDefinitionKeyNotSupported="SUBSTITUTION_DEFINITION_KEY_NOT_SUPPORTED",e.TransformerDoesNotSupportSubstitutionValues="TRANSFORMER_DOES_NOT_SUPPORT_SUBSTITUTION_VALUES",e.TransformationConfigMethodNotSupported="TRANSFORMATION_CONFIG_METHOD_NOT_SUPPORTED",e.TransformationNameNotSupported="TRANSFORMATION_NAME_NOT_SUPPORTED",e.TransformationPathNotSupported="TRANSFORMATION_PATH_NOT_SUPPORTED",e.TransformationTagNotSupported="TRANSFORMATION_TAG_NOT_SUPPORTED",e.TransformersNotAvailable="TRANSFORMATIONS_NOT_AVAILABLE",e.UnexpectedError="UNEXPECTED_ERROR",e.WhenValuesNotSupported="WHEN_VALUES_NOT_SUPPORTED",e.WhenValuesValidationLogicNotImplemented="WHEN_VALUES_VALIDATION_LOGIC_NOT_IMPLEMENTED",e.WhenTypeRequiresSpecificMethodType="WHEN_TYPE_REQUIRES_SPECIFIC_METHOD_TYPE",e))(R||{});class M extends se{}var vt=(e=>(e.MissingPersonalizationExperienceConfig="MISSING_PERSONALIZATION_EXPERIENCE_CONFIG",e.DuplicatePersonalizationExperienceConfigs="DUPLICATE_PERSONALIZATION_EXPERIENCE_CONFIGS",e.PointOptionsNotValid="POINT_OPTIONS_NOT_VALID",e.PointOptionKeyInvalid="POINT_OPTION_KEY_INVALID",e))(vt||{});class Vt extends se{}var cr=(e=>(e.OnlySupportConfiguredDataSpace="ONLY_SUPPORT_CONFIGURED_DATA_SPACE",e.OnlySupportDataProviderApiName="ONLY_SUPPORT_DATA_PROVIDER_API_NAME",e.OnlySupportDataSpaceApiName="ONLY_SUPPORT_DATA_SPACE_API_NAME",e.OnlySupportPersonalizationPoint="ONLY_SUPPORT_PERSONALIZATION_POINT",e))(cr||{});class En extends se{}var De=(e=>(e.AddingClickListenerError="ADDING_CLICK_LISTENER_ERROR",e.DisplayUtilsPageExitError="DISPLAY_UTILS_PAGE_EXIT_ERROR",e.DisplayUtilsPageScrollError="DISPLAY_UTILS_PAGE_SCROLL_ERROR",e.NotWaitingForElementClick="NOT_WAITING_FOR_ELEMENT_CLICK",e.NotWaitingForElementPath="NOT_WAITING_FOR_ELEMENT_PATH",e.NotWaitingForPageExit="NOT_WAITING_FOR_PAGE_EXIT",e.NotWaitingForPageScroll="NOT_WAITING_FOR_PAGE_SCROLL",e))(De||{});class Ve extends se{}var pe=(e=>(e.InvalidAllowedElements="INVALID_ALLOWED_ELEMENTS",e.InvalidAllowedElementKey="INVALID_ALLOWED_ELEMENT_KEY",e.InvalidAllowedProperties="INVALID_ALLOWED_PROPERTIES",e.InvalidAllowedTargetMethodTypeMethod="INVALID_ALLOWED_TARGET_METHOD_TYPE_METHOD",e.InvalidAllowedTargetMethodTypes="INVALID_ALLOWED_TARGET_METHOD_TYPES",e.InvalidAllowedTransformers="INVALID_ALLOWED_TRANSFORMERS",e.InvalidConfig="INVALID_CONFIG",e.InvalidConfigOptions="INVALID_CONFIG_OPTIONS",e))(pe||{});class ye extends se{}var st=(e=>(e.ConfigIsRequired="CONFIG_IS_REQUIRED",e.TransformersAreRequired="TRANSFORMERS_ARE_REQUIRED",e.WpmConfigIsRequired="WPM_CONFIG_IS_REQUIRED",e))(st||{});class Et extends se{}var Ae=(e=>(e.MethodIsRequired="METHOD_IS_REQUIRED",e.MethodNotAllowed="METHOD_NOT_ALLOWED",e.OnlyElementsSupported="ONLY_TARGET_ELEMENTS_ARE_SUPPORTED",e.OneSourceMatcherSupported="ONE_SOURCE_MATCHER_IS_SUPPORTED",e.OneTransformerSupported="ONE_TRANSFORMER_IS_SUPPORTED",e.PropertyNotAllowed="PROPERTY_NOT_ALLOWED",e.SubstitutionValuesNotAllowed="SUBSTITUTION_VALUES_NOT_ALLOWED",e.TagsNotAllowed="TAGS_NOT_ALLOWED",e.TransformersAreDisabled="TRANSFORMERS_ARE_DISABLED",e))(Ae||{});class Me extends se{}var q=(e=>(e.DestinationEventModifiersAreRequired="DESTINATION_EVENT_MODIFIERS_ARE_REQUIRED",e.EngagementDestinationsAreRequired="ENGAGEMENT_DESTINATIONS_ARE_REQUIRED",e.EngagementDestinationDefaultsAreRequired="ENGAGEMENT_DESTINATION_DEFAULTS_ARE_REQUIRED",e.InvalidConfig="INVALID_CONFIG",e.InvalidDestinationEventModifier="INVALID_DESTINATION_EVENT_MODIFIER",e.InvalidEngagementDestinationDefaultByName="INVALID_ENGAGEMENT_DESTINATION_DEFAULT_BY_NAME",e.InvalidEngagementDestinationDefaultByNameValue="INVALID_ENGAGEMENT_DESTINATION_DEFAULT_BY_NAME_VALUE",e.InvalidEngagementDestinationDefaultByType="INVALID_ENGAGEMENT_DESTINATION_DEFAULT_BY_TYPE",e.InvalidEngagementDestinationDefaultByTypeValue="INVALID_ENGAGEMENT_DESTINATION_DEFAULT_BY_TYPE_VALUE",e.InvalidEngagementDestinationDefaultGlobal="INVALID_ENGAGEMENT_DESTINATION_DEFAULT_GLOBAL",e.InvalidEngagementDestinationDescription="INVALID_ENGAGEMENT_DESTINATION_DESCRIPTION",e.InvalidEngagementDestinationAttributeDescription="INVALID_ENGAGEMENT_DESTINATION_ATTRIBUTE_DESCRIPTION",e.InvalidEngagementDestinationAttributeEngagements="INVALID_ENGAGEMENT_DESTINATION_ATTRIBUTE_ENGAGEMENTS",e.InvalidEngagementDestinationAttributeEngagementHandle="INVALID_ENGAGEMENT_DESTINATION_ATTRIBUTE_ENGAGEMENT_HANDLE",e.InvalidEngagementDestinationAttributeEngagementObserve="INVALID_ENGAGEMENT_DESTINATION_ATTRIBUTE_ENGAGEMENT_OBSERVE",e.InvalidEngagementDestinationAttributeEngagementQualify="INVALID_ENGAGEMENT_DESTINATION_ATTRIBUTE_ENGAGEMENT_QUALIFY",e.InvalidEngagementDestinationAttributeEngagementValue="INVALID_ENGAGEMENT_DESTINATION_ATTRIBUTE_ENGAGEMENT_VALUE",e.InvalidEngagementDestinationAttributeEventModifierModifyEvent="INVALID_ENGAGEMENT_DESTINATION_ATTRIBUTE_EVENT_MODIFIER_MODIFY_EVENT",e.InvalidEngagementDestinationAttributeEventModifiers="INVALID_ENGAGEMENT_DESTINATION_ATTRIBUTE_EVENT_MODIFIERS",e.InvalidEngagementDestinationAttributeEventModifiersValue="INVALID_ENGAGEMENT_DESTINATION_ATTRIBUTE_EVENT_MODIFIERS_VALUE",e.InvalidEngagementDestinationAttributeEventModifierValueDefault="INVALID_ENGAGEMENT_DESTINATION_ATTRIBUTE_EVENT_MODIFIER_VALUE_DEFAULT",e.InvalidEngagementDestinationAttributeEventModifierValueType="INVALID_ENGAGEMENT_DESTINATION_ATTRIBUTE_EVENT_MODIFIER_VALUE_TYPE",e.InvalidEngagementDestinationAttributes="INVALID_ENGAGEMENT_DESTINATION_ATTRIBUTES",e.InvalidEngagementDestinationAttributeScope="INVALID_ENGAGEMENT_DESTINATION_ATTRIBUTE_SCOPE",e.MissingEngagementDestinationAttributeEngagementHandle="MISSING_ENGAGEMENT_DESTINATION_ATTRIBUTE_ENGAGEMENT_HANDLE",e.MissingEngagementDestinationAttributeEngagementObserve="MISSING_ENGAGEMENT_DESTINATION_ATTRIBUTE_ENGAGEMENT_OBSERVE",e.MissingEngagementDestinationAttributeEngagementQualify="MISSING_ENGAGEMENT_DESTINATION_ATTRIBUTE_ENGAGEMENT_QUALIFY",e.MissingEngagementDestinationAttributeEventModifierModifyEvent="MISSING_ENGAGEMENT_DESTINATION_ATTRIBUTE_EVENT_MODIFIER_MODIFY_EVENT",e))(q||{});class Y extends se{}var Be=(e=>(e.InvalidContentZoneHandlerName="INVALID_CONTENT_ZONE_HANDLER_NAME",e.InvalidContentZoneHandlerProperties="INVALID_CONTENT_ZONE_HANDLER_PROPERTIES",e.InvalidContentZoneHandlerProperty="INVALID_CONTENT_ZONE_HANDLER_PROPERTY",e))(Be||{});class tt extends se{}class fr extends Error{constructor(t){super(t),this.name=this.constructor.name}}function Ml(e){return N(e)&&"message"in e&&typeof e.message=="string"}function K(e){if(e instanceof se)return{message:e.getMessageWithContext()};if(Ml(e))return e;if(b(e))return{message:e};try{return new Error(JSON.stringify(e))}catch(t){return new Error(String(e))}}const Rl="personalization/decisions";var Ll=Object.defineProperty,ro=Object.getOwnPropertySymbols,xl=Object.prototype.hasOwnProperty,kl=Object.prototype.propertyIsEnumerable,io=(e,t,n)=>t in e?Ll(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,oo=(e,t)=>{for(var n in t||(t={}))xl.call(t,n)&&io(e,n,t[n]);if(ro)for(var n of ro(t))kl.call(t,n)&&io(e,n,t[n]);return e};let yn,dr,ao="",yt={};function hr(){return yn!=null?yn:""}function Ul(){return dr!=null?dr:""}function Hl(){return yt}function Bt(){var e;return(e=yt==null?void 0:yt.dataspace)!=null?e:""}function _n(){return ao}function Fl(){document.addEventListener(P.CustomEvents.OnBeforeInit,e=>{var t;const n=e==null?void 0:e.detail.sdkConfig;n!==void 0&&(yt=oo(oo({},yt),(t=n.personalization)!=null?t:{}),e.detail.sdkConfig.personalization=yt)})}function zl(){document.addEventListener(P.CustomEvents.OnInit,e=>{var t,n,r;const i=(n=(t=e==null?void 0:e.detail)==null?void 0:t.sdkConfig)==null?void 0:n.dataCloud;if(D(i)){P.log.warn("OnInit did not include Data Cloud config");return}if(!b(i.tenantSpecificEndpoint))P.log.warn("Tenant Specific Endpoint URL was not provided in Data Cloud config");else try{yn=new URL(Rl,i.tenantSpecificEndpoint).toString()}catch(o){P.log.warn(`Tenant Specific Endpoint URL is not valid: ${i.tenantSpecificEndpoint}`)}!N(i.authenticator)||!b(i.authenticator.appSourceId)?P.log.warn("App Source Id was not provided in Data Cloud config"):dr=i.authenticator.appSourceId,N(document.currentScript)&&(ao=(r=document.currentScript.nonce)!=null?r:"")})}function so(e){if(e===void 0){if(!b(yn))throw new he(ce.InitRequiresTSE,"Tenant Specific Endpoint URL must be set by calling SalesforceInteractions.init.")}else if(!b(e))throw new he(ce.EndpointOverrideNotValid,"Endpoint URL must be a valid string if provided.")}function Ge(){return!b(hr())}var nt=(e=>(e.EmbeddedContent="EmbeddedContent",e.Agent="Agent",e))(nt||{}),ge=(e=>(e.HtmlElementModifier="HTMLElementModifier",e.Handlebars="Handlebars",e.AgentScript="AgentScript",e))(ge||{});const Vl={EmbeddedContent:{supportedTypes:["HTMLElementModifier","Handlebars"]},Agent:{supportedTypes:["AgentScript"]}};var Tn=(e=>(e.String="String",e))(Tn||{}),Re=(e=>(e.SchemaPath="SchemaPath",e.Static="Static",e))(Re||{}),bn=(e=>(e.PersonalizationPoint="PersonalizationPoint",e))(bn||{}),wn=(e=>(e.ApiName="ApiName",e))(wn||{}),lo=(e=>(e.DataGraph="DataGraph",e))(lo||{}),Ce=(e=>(e.Immediately="Immediately",e.ExitIntent="ExitIntent",e.ElementClick="ElementClick",e.ScrollPercent="ScrollPercent",e))(Ce||{}),$=(e=>(e.ReplaceContentZoneContent="ReplaceContentZoneContent",e.ReplaceElementContent="ReplaceElementContent",e.AddAfterElement="AddAfterElement",e.AddBeforeElement="AddBeforeElement",e.AddOverlay="AddOverlay",e.ContentZoneHandler="ContentZoneHandler",e))($||{});function _t(e){return e!==void 0&&e==="AddOverlay"}function rt(e){return(e==null?void 0:e.tag)!==void 0}function Gt(e){return(e==null?void 0:e.name)!==void 0}function Sn(e,t){return Gt(e)&&t!==void 0&&t==="ReplaceContentZoneContent"}function pr(e,t){return Gt(e)&&t!==void 0&&t==="ContentZoneHandler"}function uo(e){return e===ge.AgentScript}function co(e){return(e==null?void 0:e.path)!==void 0}function fo(e){return(e==null?void 0:e.percent)!==void 0}function ho(e){return(e==null?void 0:e.delay)!==void 0}function In(e){return D(e)||e==="PersonalizationPoint"}const Bl="_unknown_";/*! @license DOMPurify 3.3.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.0/LICENSE */const{entries:po,setPrototypeOf:go,isFrozen:Gl,getPrototypeOf:jl,getOwnPropertyDescriptor:Wl}=Object;let{freeze:me,seal:be,create:gr}=Object,{apply:mr,construct:vr}=typeof Reflect!="undefined"&&Reflect;me||(me=function(t){return t}),be||(be=function(t){return t}),mr||(mr=function(t,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return t.apply(n,i)}),vr||(vr=function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return new t(...r)});const An=Ee(Array.prototype.forEach),ql=Ee(Array.prototype.lastIndexOf),mo=Ee(Array.prototype.pop),jt=Ee(Array.prototype.push),$l=Ee(Array.prototype.splice),Cn=Ee(String.prototype.toLowerCase),Er=Ee(String.prototype.toString),yr=Ee(String.prototype.match),Wt=Ee(String.prototype.replace),Yl=Ee(String.prototype.indexOf),Zl=Ee(String.prototype.trim),Pe=Ee(Object.prototype.hasOwnProperty),ve=Ee(RegExp.prototype.test),qt=Kl(TypeError);function Ee(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return mr(e,t,r)}}function Kl(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return vr(e,n)}}function F(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Cn;go&&go(e,null);let r=t.length;for(;r--;){let i=t[r];if(typeof i=="string"){const o=n(i);o!==i&&(Gl(t)||(t[r]=o),i=o)}e[i]=!0}return e}function Xl(e){for(let t=0;t<e.length;t++)Pe(e,t)||(e[t]=null);return e}function je(e){const t=gr(null);for(const[n,r]of po(e))Pe(e,n)&&(Array.isArray(r)?t[n]=Xl(r):r&&typeof r=="object"&&r.constructor===Object?t[n]=je(r):t[n]=r);return t}function $t(e,t){for(;e!==null;){const r=Wl(e,t);if(r){if(r.get)return Ee(r.get);if(typeof r.value=="function")return Ee(r.value)}e=jl(e)}function n(){return null}return n}const vo=me(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),_r=me(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Tr=me(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Ql=me(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),br=me(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Jl=me(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Eo=me(["#text"]),yo=me(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),wr=me(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),_o=me(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Pn=me(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),eu=be(/\{\{[\w\W]*|[\w\W]*\}\}/gm),tu=be(/<%[\w\W]*|[\w\W]*%>/gm),nu=be(/\$\{[\w\W]*/gm),ru=be(/^data-[\-\w.\u00B7-\uFFFF]+$/),iu=be(/^aria-[\-\w]+$/),To=be(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ou=be(/^(?:\w+script|data):/i),au=be(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),bo=be(/^html$/i),su=be(/^[a-z][.\w]*(-[.\w]+)+$/i);var wo=Object.freeze({__proto__:null,ARIA_ATTR:iu,ATTR_WHITESPACE:au,CUSTOM_ELEMENT:su,DATA_ATTR:ru,DOCTYPE_NAME:bo,ERB_EXPR:tu,IS_ALLOWED_URI:To,IS_SCRIPT_OR_DATA:ou,MUSTACHE_EXPR:eu,TMPLIT_EXPR:nu});const Yt={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},lu=function(){return typeof window=="undefined"?null:window},uu=function(t,n){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let r=null;const i="data-tt-policy-suffix";n&&n.hasAttribute(i)&&(r=n.getAttribute(i));const o="dompurify"+(r?"#"+r:"");try{return t.createPolicy(o,{createHTML(s){return s},createScriptURL(s){return s}})}catch(s){return console.warn("TrustedTypes policy "+o+" could not be created."),null}},So=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Io(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:lu();const t=x=>Io(x);if(t.version="3.3.0",t.removed=[],!e||!e.document||e.document.nodeType!==Yt.document||!e.Element)return t.isSupported=!1,t;let{document:n}=e;const r=n,i=r.currentScript,{DocumentFragment:o,HTMLTemplateElement:s,Node:l,Element:a,NodeFilter:u,NamedNodeMap:f=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:p,DOMParser:c,trustedTypes:h}=e,d=a.prototype,g=$t(d,"cloneNode"),E=$t(d,"remove"),w=$t(d,"nextSibling"),_=$t(d,"childNodes"),I=$t(d,"parentNode");if(typeof s=="function"){const x=n.createElement("template");x.content&&x.content.ownerDocument&&(n=x.content.ownerDocument)}let m,T="";const{implementation:O,createNodeIterator:A,createDocumentFragment:U,getElementsByTagName:Q}=n,{importNode:W}=r;let V=So();t.isSupported=typeof po=="function"&&typeof I=="function"&&O&&O.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:He,ERB_EXPR:Fe,TMPLIT_EXPR:Ui,DATA_ATTR:pg,ARIA_ATTR:gg,IS_SCRIPT_OR_DATA:mg,ATTR_WHITESPACE:Ys,CUSTOM_ELEMENT:vg}=wo;let{IS_ALLOWED_URI:Zs}=wo,oe=null;const Ks=F({},[...vo,..._r,...Tr,...br,...Eo]);let le=null;const Xs=F({},[...yo,...wr,..._o,...Pn]);let ne=Object.seal(gr(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),hn=null,Hi=null;const Ot=Object.seal(gr(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Qs=!0,Fi=!0,Js=!1,el=!0,Dt=!1,Qn=!0,pt=!1,zi=!1,Vi=!1,Mt=!1,Jn=!1,er=!1,tl=!0,nl=!1;const Eg="user-content-";let Bi=!0,pn=!1,Rt={},Lt=null;const rl=F({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let il=null;const ol=F({},["audio","video","img","source","image","track"]);let Gi=null;const al=F({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),tr="http://www.w3.org/1998/Math/MathML",nr="http://www.w3.org/2000/svg",Xe="http://www.w3.org/1999/xhtml";let xt=Xe,ji=!1,Wi=null;const yg=F({},[tr,nr,Xe],Er);let rr=F({},["mi","mo","mn","ms","mtext"]),ir=F({},["annotation-xml"]);const _g=F({},["title","style","font","a","script"]);let gn=null;const Tg=["application/xhtml+xml","text/html"],bg="text/html";let ae=null,kt=null;const wg=n.createElement("form"),sl=function(v){return v instanceof RegExp||v instanceof Function},qi=function(){let v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(kt&&kt===v)){if((!v||typeof v!="object")&&(v={}),v=je(v),gn=Tg.indexOf(v.PARSER_MEDIA_TYPE)===-1?bg:v.PARSER_MEDIA_TYPE,ae=gn==="application/xhtml+xml"?Er:Cn,oe=Pe(v,"ALLOWED_TAGS")?F({},v.ALLOWED_TAGS,ae):Ks,le=Pe(v,"ALLOWED_ATTR")?F({},v.ALLOWED_ATTR,ae):Xs,Wi=Pe(v,"ALLOWED_NAMESPACES")?F({},v.ALLOWED_NAMESPACES,Er):yg,Gi=Pe(v,"ADD_URI_SAFE_ATTR")?F(je(al),v.ADD_URI_SAFE_ATTR,ae):al,il=Pe(v,"ADD_DATA_URI_TAGS")?F(je(ol),v.ADD_DATA_URI_TAGS,ae):ol,Lt=Pe(v,"FORBID_CONTENTS")?F({},v.FORBID_CONTENTS,ae):rl,hn=Pe(v,"FORBID_TAGS")?F({},v.FORBID_TAGS,ae):je({}),Hi=Pe(v,"FORBID_ATTR")?F({},v.FORBID_ATTR,ae):je({}),Rt=Pe(v,"USE_PROFILES")?v.USE_PROFILES:!1,Qs=v.ALLOW_ARIA_ATTR!==!1,Fi=v.ALLOW_DATA_ATTR!==!1,Js=v.ALLOW_UNKNOWN_PROTOCOLS||!1,el=v.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Dt=v.SAFE_FOR_TEMPLATES||!1,Qn=v.SAFE_FOR_XML!==!1,pt=v.WHOLE_DOCUMENT||!1,Mt=v.RETURN_DOM||!1,Jn=v.RETURN_DOM_FRAGMENT||!1,er=v.RETURN_TRUSTED_TYPE||!1,Vi=v.FORCE_BODY||!1,tl=v.SANITIZE_DOM!==!1,nl=v.SANITIZE_NAMED_PROPS||!1,Bi=v.KEEP_CONTENT!==!1,pn=v.IN_PLACE||!1,Zs=v.ALLOWED_URI_REGEXP||To,xt=v.NAMESPACE||Xe,rr=v.MATHML_TEXT_INTEGRATION_POINTS||rr,ir=v.HTML_INTEGRATION_POINTS||ir,ne=v.CUSTOM_ELEMENT_HANDLING||{},v.CUSTOM_ELEMENT_HANDLING&&sl(v.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ne.tagNameCheck=v.CUSTOM_ELEMENT_HANDLING.tagNameCheck),v.CUSTOM_ELEMENT_HANDLING&&sl(v.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ne.attributeNameCheck=v.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),v.CUSTOM_ELEMENT_HANDLING&&typeof v.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ne.allowCustomizedBuiltInElements=v.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Dt&&(Fi=!1),Jn&&(Mt=!0),Rt&&(oe=F({},Eo),le=[],Rt.html===!0&&(F(oe,vo),F(le,yo)),Rt.svg===!0&&(F(oe,_r),F(le,wr),F(le,Pn)),Rt.svgFilters===!0&&(F(oe,Tr),F(le,wr),F(le,Pn)),Rt.mathMl===!0&&(F(oe,br),F(le,_o),F(le,Pn))),v.ADD_TAGS&&(typeof v.ADD_TAGS=="function"?Ot.tagCheck=v.ADD_TAGS:(oe===Ks&&(oe=je(oe)),F(oe,v.ADD_TAGS,ae))),v.ADD_ATTR&&(typeof v.ADD_ATTR=="function"?Ot.attributeCheck=v.ADD_ATTR:(le===Xs&&(le=je(le)),F(le,v.ADD_ATTR,ae))),v.ADD_URI_SAFE_ATTR&&F(Gi,v.ADD_URI_SAFE_ATTR,ae),v.FORBID_CONTENTS&&(Lt===rl&&(Lt=je(Lt)),F(Lt,v.FORBID_CONTENTS,ae)),Bi&&(oe["#text"]=!0),pt&&F(oe,["html","head","body"]),oe.table&&(F(oe,["tbody"]),delete hn.tbody),v.TRUSTED_TYPES_POLICY){if(typeof v.TRUSTED_TYPES_POLICY.createHTML!="function")throw qt('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof v.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw qt('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');m=v.TRUSTED_TYPES_POLICY,T=m.createHTML("")}else m===void 0&&(m=uu(h,i)),m!==null&&typeof T=="string"&&(T=m.createHTML(""));me&&me(v),kt=v}},ll=F({},[..._r,...Tr,...Ql]),ul=F({},[...br,...Jl]),Sg=function(v){let C=I(v);(!C||!C.tagName)&&(C={namespaceURI:xt,tagName:"template"});const L=Cn(v.tagName),ee=Cn(C.tagName);return Wi[v.namespaceURI]?v.namespaceURI===nr?C.namespaceURI===Xe?L==="svg":C.namespaceURI===tr?L==="svg"&&(ee==="annotation-xml"||rr[ee]):!!ll[L]:v.namespaceURI===tr?C.namespaceURI===Xe?L==="math":C.namespaceURI===nr?L==="math"&&ir[ee]:!!ul[L]:v.namespaceURI===Xe?C.namespaceURI===nr&&!ir[ee]||C.namespaceURI===tr&&!rr[ee]?!1:!ul[L]&&(_g[L]||!ll[L]):!!(gn==="application/xhtml+xml"&&Wi[v.namespaceURI]):!1},ze=function(v){jt(t.removed,{element:v});try{I(v).removeChild(v)}catch(C){E(v)}},gt=function(v,C){try{jt(t.removed,{attribute:C.getAttributeNode(v),from:C})}catch(L){jt(t.removed,{attribute:null,from:C})}if(C.removeAttribute(v),v==="is")if(Mt||Jn)try{ze(C)}catch(L){}else try{C.setAttribute(v,"")}catch(L){}},cl=function(v){let C=null,L=null;if(Vi)v="<remove></remove>"+v;else{const re=yr(v,/^[\r\n\t ]+/);L=re&&re[0]}gn==="application/xhtml+xml"&&xt===Xe&&(v='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+v+"</body></html>");const ee=m?m.createHTML(v):v;if(xt===Xe)try{C=new c().parseFromString(ee,gn)}catch(re){}if(!C||!C.documentElement){C=O.createDocument(xt,"template",null);try{C.documentElement.innerHTML=ji?T:ee}catch(re){}}const de=C.body||C.documentElement;return v&&L&&de.insertBefore(n.createTextNode(L),de.childNodes[0]||null),xt===Xe?Q.call(C,pt?"html":"body")[0]:pt?C.documentElement:de},fl=function(v){return A.call(v.ownerDocument||v,v,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},$i=function(v){return v instanceof p&&(typeof v.nodeName!="string"||typeof v.textContent!="string"||typeof v.removeChild!="function"||!(v.attributes instanceof f)||typeof v.removeAttribute!="function"||typeof v.setAttribute!="function"||typeof v.namespaceURI!="string"||typeof v.insertBefore!="function"||typeof v.hasChildNodes!="function")},dl=function(v){return typeof l=="function"&&v instanceof l};function Qe(x,v,C){An(x,L=>{L.call(t,v,C,kt)})}const hl=function(v){let C=null;if(Qe(V.beforeSanitizeElements,v,null),$i(v))return ze(v),!0;const L=ae(v.nodeName);if(Qe(V.uponSanitizeElement,v,{tagName:L,allowedTags:oe}),Qn&&v.hasChildNodes()&&!dl(v.firstElementChild)&&ve(/<[/\w!]/g,v.innerHTML)&&ve(/<[/\w!]/g,v.textContent)||v.nodeType===Yt.progressingInstruction||Qn&&v.nodeType===Yt.comment&&ve(/<[/\w]/g,v.data))return ze(v),!0;if(!(Ot.tagCheck instanceof Function&&Ot.tagCheck(L))&&(!oe[L]||hn[L])){if(!hn[L]&&gl(L)&&(ne.tagNameCheck instanceof RegExp&&ve(ne.tagNameCheck,L)||ne.tagNameCheck instanceof Function&&ne.tagNameCheck(L)))return!1;if(Bi&&!Lt[L]){const ee=I(v)||v.parentNode,de=_(v)||v.childNodes;if(de&&ee){const re=de.length;for(let _e=re-1;_e>=0;--_e){const Je=g(de[_e],!0);Je.__removalCount=(v.__removalCount||0)+1,ee.insertBefore(Je,w(v))}}}return ze(v),!0}return v instanceof a&&!Sg(v)||(L==="noscript"||L==="noembed"||L==="noframes")&&ve(/<\/no(script|embed|frames)/i,v.innerHTML)?(ze(v),!0):(Dt&&v.nodeType===Yt.text&&(C=v.textContent,An([He,Fe,Ui],ee=>{C=Wt(C,ee," ")}),v.textContent!==C&&(jt(t.removed,{element:v.cloneNode()}),v.textContent=C)),Qe(V.afterSanitizeElements,v,null),!1)},pl=function(v,C,L){if(tl&&(C==="id"||C==="name")&&(L in n||L in wg))return!1;if(!(Fi&&!Hi[C]&&ve(pg,C))){if(!(Qs&&ve(gg,C))){if(!(Ot.attributeCheck instanceof Function&&Ot.attributeCheck(C,v))){if(!le[C]||Hi[C]){if(!(gl(v)&&(ne.tagNameCheck instanceof RegExp&&ve(ne.tagNameCheck,v)||ne.tagNameCheck instanceof Function&&ne.tagNameCheck(v))&&(ne.attributeNameCheck instanceof RegExp&&ve(ne.attributeNameCheck,C)||ne.attributeNameCheck instanceof Function&&ne.attributeNameCheck(C,v))||C==="is"&&ne.allowCustomizedBuiltInElements&&(ne.tagNameCheck instanceof RegExp&&ve(ne.tagNameCheck,L)||ne.tagNameCheck instanceof Function&&ne.tagNameCheck(L))))return!1}else if(!Gi[C]){if(!ve(Zs,Wt(L,Ys,""))){if(!((C==="src"||C==="xlink:href"||C==="href")&&v!=="script"&&Yl(L,"data:")===0&&il[v])){if(!(Js&&!ve(mg,Wt(L,Ys,"")))){if(L)return!1}}}}}}}return!0},gl=function(v){return v!=="annotation-xml"&&yr(v,vg)},ml=function(v){Qe(V.beforeSanitizeAttributes,v,null);const{attributes:C}=v;if(!C||$i(v))return;const L={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:le,forceKeepAttr:void 0};let ee=C.length;for(;ee--;){const de=C[ee],{name:re,namespaceURI:_e,value:Je}=de,Ut=ae(re),Yi=Je;let ue=re==="value"?Yi:Zl(Yi);if(L.attrName=Ut,L.attrValue=ue,L.keepAttr=!0,L.forceKeepAttr=void 0,Qe(V.uponSanitizeAttribute,v,L),ue=L.attrValue,nl&&(Ut==="id"||Ut==="name")&&(gt(re,v),ue=Eg+ue),Qn&&ve(/((--!?|])>)|<\/(style|title|textarea)/i,ue)){gt(re,v);continue}if(Ut==="attributename"&&yr(ue,"href")){gt(re,v);continue}if(L.forceKeepAttr)continue;if(!L.keepAttr){gt(re,v);continue}if(!el&&ve(/\/>/i,ue)){gt(re,v);continue}Dt&&An([He,Fe,Ui],El=>{ue=Wt(ue,El," ")});const vl=ae(v.nodeName);if(!pl(vl,Ut,ue)){gt(re,v);continue}if(m&&typeof h=="object"&&typeof h.getAttributeType=="function"&&!_e)switch(h.getAttributeType(vl,Ut)){case"TrustedHTML":{ue=m.createHTML(ue);break}case"TrustedScriptURL":{ue=m.createScriptURL(ue);break}}if(ue!==Yi)try{_e?v.setAttributeNS(_e,re,ue):v.setAttribute(re,ue),$i(v)?ze(v):mo(t.removed)}catch(El){gt(re,v)}}Qe(V.afterSanitizeAttributes,v,null)},Ig=function x(v){let C=null;const L=fl(v);for(Qe(V.beforeSanitizeShadowDOM,v,null);C=L.nextNode();)Qe(V.uponSanitizeShadowNode,C,null),hl(C),ml(C),C.content instanceof o&&x(C.content);Qe(V.afterSanitizeShadowDOM,v,null)};return t.sanitize=function(x){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},C=null,L=null,ee=null,de=null;if(ji=!x,ji&&(x="<!-->"),typeof x!="string"&&!dl(x))if(typeof x.toString=="function"){if(x=x.toString(),typeof x!="string")throw qt("dirty is not a string, aborting")}else throw qt("toString is not a function");if(!t.isSupported)return x;if(zi||qi(v),t.removed=[],typeof x=="string"&&(pn=!1),pn){if(x.nodeName){const Je=ae(x.nodeName);if(!oe[Je]||hn[Je])throw qt("root node is forbidden and cannot be sanitized in-place")}}else if(x instanceof l)C=cl("<!---->"),L=C.ownerDocument.importNode(x,!0),L.nodeType===Yt.element&&L.nodeName==="BODY"||L.nodeName==="HTML"?C=L:C.appendChild(L);else{if(!Mt&&!Dt&&!pt&&x.indexOf("<")===-1)return m&&er?m.createHTML(x):x;if(C=cl(x),!C)return Mt?null:er?T:""}C&&Vi&&ze(C.firstChild);const re=fl(pn?x:C);for(;ee=re.nextNode();)hl(ee),ml(ee),ee.content instanceof o&&Ig(ee.content);if(pn)return x;if(Mt){if(Jn)for(de=U.call(C.ownerDocument);C.firstChild;)de.appendChild(C.firstChild);else de=C;return(le.shadowroot||le.shadowrootmode)&&(de=W.call(r,de,!0)),de}let _e=pt?C.outerHTML:C.innerHTML;return pt&&oe["!doctype"]&&C.ownerDocument&&C.ownerDocument.doctype&&C.ownerDocument.doctype.name&&ve(bo,C.ownerDocument.doctype.name)&&(_e="<!DOCTYPE "+C.ownerDocument.doctype.name+`>
`+_e),Dt&&An([He,Fe,Ui],Je=>{_e=Wt(_e,Je," ")}),m&&er?m.createHTML(_e):_e},t.setConfig=function(){let x=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};qi(x),zi=!0},t.clearConfig=function(){kt=null,zi=!1},t.isValidAttribute=function(x,v,C){kt||qi({});const L=ae(x),ee=ae(v);return pl(L,ee,C)},t.addHook=function(x,v){typeof v=="function"&&jt(V[x],v)},t.removeHook=function(x,v){if(v!==void 0){const C=ql(V[x],v);return C===-1?void 0:$l(V[x],C,1)[0]}return mo(V[x])},t.removeHooks=function(x){V[x]=[]},t.removeAllHooks=function(){V=So()},t}var cu=Io();class fu{sanitizeString(t){if(!b(t))return"";try{return cu.sanitize(t)}catch(n){return y.log.error("could not verify that content was safe",n),""}}sanitizeObject(t){const n=H(t);if(!N(t)&&!n)if(b(t))try{return this.sanitizeString(String(t))}catch(r){return y.log.error("could not verify that content was safe",r),""}else return t;if(n)return this.sanitizeArray(t);for(const r in t)N(t[r])?t[r]=this.sanitizeObject(t[r]):H(t[r])?t[r]=this.sanitizeArray(t[r]):J(t,r)&&(t[r]=this.sanitizeObject(t[r]));return t}sanitizeArray(t){if(!H(t))return[];for(let n=0;n<t.length;n++)t[n]=this.sanitizeObject(t[n]);return t}}const Tt="data-sf-personalization-",Le=`${Tt}id`,lt="view",bt=`${Tt}${lt}`,xe="click",wt=`${Tt}${xe}`,du=[lt,xe],St="destination",It="object-id",At="content-id",Nn="interaction-name",On="event-type",Sr="type",hu=[At,It,St,Nn,On,Sr],Ao="Product",Co="Other",Po=[Ao,Co];var ut=(e=>(e.TransformerConfig="TransformerConfig",e.Element="Element",e.Any="Any",e))(ut||{}),Dn=(e=>(e.SchemaPath="SchemaPath",e))(Dn||{});class pu{add(t,n,r){if(typeof arguments[0]!="string")for(let i in arguments[0])this.add(i,arguments[0][i],arguments[1]);else(Array.isArray(t)?t:[t]).forEach(function(i){this[i]=this[i]||[],n&&this[i][r?"unshift":"push"](n)},this)}run(t,n){this[t]=this[t]||[],this[t].forEach(function(r){r.call(n&&n.context?n.context:n,n)})}}class gu{constructor(t){this.jsep=t,this.registered={}}register(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach(i=>{if(typeof i!="object"||!i.name||!i.init)throw new Error("Invalid JSEP plugin format");this.registered[i.name]||(i.init(this.jsep),this.registered[i.name]=i)})}}class S{static get version(){return"1.4.0"}static toString(){return"JavaScript Expression Parser (JSEP) v"+S.version}static addUnaryOp(t){return S.max_unop_len=Math.max(t.length,S.max_unop_len),S.unary_ops[t]=1,S}static addBinaryOp(t,n,r){return S.max_binop_len=Math.max(t.length,S.max_binop_len),S.binary_ops[t]=n,r?S.right_associative.add(t):S.right_associative.delete(t),S}static addIdentifierChar(t){return S.additional_identifier_chars.add(t),S}static addLiteral(t,n){return S.literals[t]=n,S}static removeUnaryOp(t){return delete S.unary_ops[t],t.length===S.max_unop_len&&(S.max_unop_len=S.getMaxKeyLen(S.unary_ops)),S}static removeAllUnaryOps(){return S.unary_ops={},S.max_unop_len=0,S}static removeIdentifierChar(t){return S.additional_identifier_chars.delete(t),S}static removeBinaryOp(t){return delete S.binary_ops[t],t.length===S.max_binop_len&&(S.max_binop_len=S.getMaxKeyLen(S.binary_ops)),S.right_associative.delete(t),S}static removeAllBinaryOps(){return S.binary_ops={},S.max_binop_len=0,S}static removeLiteral(t){return delete S.literals[t],S}static removeAllLiterals(){return S.literals={},S}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(t){this.expr=t,this.index=0}static parse(t){return new S(t).parse()}static getMaxKeyLen(t){return Math.max(0,...Object.keys(t).map(n=>n.length))}static isDecimalDigit(t){return t>=48&&t<=57}static binaryPrecedence(t){return S.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!S.binary_ops[String.fromCharCode(t)]||S.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return S.isIdentifierStart(t)||S.isDecimalDigit(t)}throwError(t){const n=new Error(t+" at character "+this.index);throw n.index=this.index,n.description=t,n}runHook(t,n){if(S.hooks[t]){const r={context:this,node:n};return S.hooks.run(t,r),r.node}return n}searchHook(t){if(S.hooks[t]){const n={context:this};return S.hooks[t].find(function(r){return r.call(n.context,n),n.node}),n.node}}gobbleSpaces(){let t=this.code;for(;t===S.SPACE_CODE||t===S.TAB_CODE||t===S.LF_CODE||t===S.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");const t=this.gobbleExpressions(),n=t.length===1?t[0]:{type:S.COMPOUND,body:t};return this.runHook("after-all",n)}gobbleExpressions(t){let n=[],r,i;for(;this.index<this.expr.length;)if(r=this.code,r===S.SEMCOL_CODE||r===S.COMMA_CODE)this.index++;else if(i=this.gobbleExpression())n.push(i);else if(this.index<this.expr.length){if(r===t)break;this.throwError('Unexpected "'+this.char+'"')}return n}gobbleExpression(){const t=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",t)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,S.max_binop_len),n=t.length;for(;n>0;){if(S.binary_ops.hasOwnProperty(t)&&(!S.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!S.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=n,t;t=t.substr(0,--n)}return!1}gobbleBinaryExpression(){let t,n,r,i,o,s,l,a,u;if(s=this.gobbleToken(),!s||(n=this.gobbleBinaryOp(),!n))return s;for(o={value:n,prec:S.binaryPrecedence(n),right_a:S.right_associative.has(n)},l=this.gobbleToken(),l||this.throwError("Expected expression after "+n),i=[s,o,l];n=this.gobbleBinaryOp();){if(r=S.binaryPrecedence(n),r===0){this.index-=n.length;break}o={value:n,prec:r,right_a:S.right_associative.has(n)},u=n;const f=p=>o.right_a&&p.right_a?r>p.prec:r<=p.prec;for(;i.length>2&&f(i[i.length-2]);)l=i.pop(),n=i.pop().value,s=i.pop(),t={type:S.BINARY_EXP,operator:n,left:s,right:l},i.push(t);t=this.gobbleToken(),t||this.throwError("Expected expression after "+u),i.push(o,t)}for(a=i.length-1,t=i[a];a>1;)t={type:S.BINARY_EXP,operator:i[a-1].value,left:i[a-2],right:t},a-=2;return t}gobbleToken(){let t,n,r,i;if(this.gobbleSpaces(),i=this.searchHook("gobble-token"),i)return this.runHook("after-token",i);if(t=this.code,S.isDecimalDigit(t)||t===S.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===S.SQUOTE_CODE||t===S.DQUOTE_CODE)i=this.gobbleStringLiteral();else if(t===S.OBRACK_CODE)i=this.gobbleArray();else{for(n=this.expr.substr(this.index,S.max_unop_len),r=n.length;r>0;){if(S.unary_ops.hasOwnProperty(n)&&(!S.isIdentifierStart(this.code)||this.index+n.length<this.expr.length&&!S.isIdentifierPart(this.expr.charCodeAt(this.index+n.length)))){this.index+=r;const o=this.gobbleToken();return o||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:S.UNARY_EXP,operator:n,argument:o,prefix:!0})}n=n.substr(0,--r)}S.isIdentifierStart(t)?(i=this.gobbleIdentifier(),S.literals.hasOwnProperty(i.name)?i={type:S.LITERAL,value:S.literals[i.name],raw:i.name}:i.name===S.this_str&&(i={type:S.THIS_EXP})):t===S.OPAREN_CODE&&(i=this.gobbleGroup())}return i?(i=this.gobbleTokenProperty(i),this.runHook("after-token",i)):this.runHook("after-token",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let n=this.code;for(;n===S.PERIOD_CODE||n===S.OBRACK_CODE||n===S.OPAREN_CODE||n===S.QUMARK_CODE;){let r;if(n===S.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==S.PERIOD_CODE)break;r=!0,this.index+=2,this.gobbleSpaces(),n=this.code}this.index++,n===S.OBRACK_CODE?(t={type:S.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()},t.property||this.throwError('Unexpected "'+this.char+'"'),this.gobbleSpaces(),n=this.code,n!==S.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):n===S.OPAREN_CODE?t={type:S.CALL_EXP,arguments:this.gobbleArguments(S.CPAREN_CODE),callee:t}:(n===S.PERIOD_CODE||r)&&(r&&this.index--,this.gobbleSpaces(),t={type:S.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),r&&(t.optional=!0),this.gobbleSpaces(),n=this.code}return t}gobbleNumericLiteral(){let t="",n,r;for(;S.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(this.code===S.PERIOD_CODE)for(t+=this.expr.charAt(this.index++);S.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(n=this.char,n==="e"||n==="E"){for(t+=this.expr.charAt(this.index++),n=this.char,(n==="+"||n==="-")&&(t+=this.expr.charAt(this.index++));S.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);S.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+t+this.char+")")}return r=this.code,S.isIdentifierStart(r)?this.throwError("Variable names cannot start with a number ("+t+this.char+")"):(r===S.PERIOD_CODE||t.length===1&&t.charCodeAt(0)===S.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:S.LITERAL,value:parseFloat(t),raw:t}}gobbleStringLiteral(){let t="";const n=this.index,r=this.expr.charAt(this.index++);let i=!1;for(;this.index<this.expr.length;){let o=this.expr.charAt(this.index++);if(o===r){i=!0;break}else if(o==="\\")switch(o=this.expr.charAt(this.index++),o){case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=o}else t+=o}return i||this.throwError('Unclosed quote after "'+t+'"'),{type:S.LITERAL,value:t,raw:this.expr.substring(n,this.index)}}gobbleIdentifier(){let t=this.code,n=this.index;for(S.isIdentifierStart(t)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(t=this.code,S.isIdentifierPart(t));)this.index++;return{type:S.IDENTIFIER,name:this.expr.slice(n,this.index)}}gobbleArguments(t){const n=[];let r=!1,i=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let o=this.code;if(o===t){r=!0,this.index++,t===S.CPAREN_CODE&&i&&i>=n.length&&this.throwError("Unexpected token "+String.fromCharCode(t));break}else if(o===S.COMMA_CODE){if(this.index++,i++,i!==n.length){if(t===S.CPAREN_CODE)this.throwError("Unexpected token ,");else if(t===S.CBRACK_CODE)for(let s=n.length;s<i;s++)n.push(null)}}else if(n.length!==i&&i!==0)this.throwError("Expected comma");else{const s=this.gobbleExpression();(!s||s.type===S.COMPOUND)&&this.throwError("Expected comma"),n.push(s)}}return r||this.throwError("Expected "+String.fromCharCode(t)),n}gobbleGroup(){this.index++;let t=this.gobbleExpressions(S.CPAREN_CODE);if(this.code===S.CPAREN_CODE)return this.index++,t.length===1?t[0]:t.length?{type:S.SEQUENCE_EXP,expressions:t}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:S.ARRAY_EXP,elements:this.gobbleArguments(S.CBRACK_CODE)}}}const mu=new pu;Object.assign(S,{hooks:mu,plugins:new gu(S),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"??":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10,"**":11},right_associative:new Set(["**"]),additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"}),S.max_unop_len=S.getMaxKeyLen(S.unary_ops),S.max_binop_len=S.getMaxKeyLen(S.binary_ops);const We=e=>new S(e).parse(),vu=Object.getOwnPropertyNames(class{});Object.getOwnPropertyNames(S).filter(e=>!vu.includes(e)&&We[e]===void 0).forEach(e=>{We[e]=S[e]}),We.Jsep=S;const Eu="ConditionalExpression";var yu={name:"ternary",init(e){e.hooks.add("after-expression",function(n){if(n.node&&this.code===e.QUMARK_CODE){this.index++;const r=n.node,i=this.gobbleExpression();if(i||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;const o=this.gobbleExpression();if(o||this.throwError("Expected expression"),n.node={type:Eu,test:r,consequent:i,alternate:o},r.operator&&e.binary_ops[r.operator]<=.9){let s=r;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;n.node.test=s.right,s.right=n.node,n.node=r}}else this.throwError("Expected :")}})}};We.plugins.register(yu);const No=47,_u=92;var Tu={name:"regex",init(e){e.hooks.add("gobble-token",function(n){if(this.code===No){const r=++this.index;let i=!1;for(;this.index<this.expr.length;){if(this.code===No&&!i){const o=this.expr.slice(r,this.index);let s="";for(;++this.index<this.expr.length;){const a=this.code;if(a>=97&&a<=122||a>=65&&a<=90||a>=48&&a<=57)s+=this.char;else break}let l;try{l=new RegExp(o,s)}catch(a){this.throwError(a.message)}return n.node={type:e.LITERAL,value:l,raw:this.expr.slice(r-1,this.index)},n.node=this.gobbleTokenProperty(n.node),n.node}this.code===e.OBRACK_CODE?i=!0:i&&this.code===e.CBRACK_CODE&&(i=!1),this.index+=this.code===_u?2:1}this.throwError("Unclosed Regex")}})}};const Ir=43,Ct={name:"assignment",assignmentOperators:new Set(["=","*=","**=","/=","%=","+=","-=","<<=",">>=",">>>=","&=","^=","|=","||=","&&=","??="]),updateOperators:[Ir,45],assignmentPrecedence:.9,init(e){const t=[e.IDENTIFIER,e.MEMBER_EXP];Ct.assignmentOperators.forEach(r=>e.addBinaryOp(r,Ct.assignmentPrecedence,!0)),e.hooks.add("gobble-token",function(i){const o=this.code;Ct.updateOperators.some(s=>s===o&&s===this.expr.charCodeAt(this.index+1))&&(this.index+=2,i.node={type:"UpdateExpression",operator:o===Ir?"++":"--",argument:this.gobbleTokenProperty(this.gobbleIdentifier()),prefix:!0},(!i.node.argument||!t.includes(i.node.argument.type))&&this.throwError(`Unexpected ${i.node.operator}`))}),e.hooks.add("after-token",function(i){if(i.node){const o=this.code;Ct.updateOperators.some(s=>s===o&&s===this.expr.charCodeAt(this.index+1))&&(t.includes(i.node.type)||this.throwError(`Unexpected ${i.node.operator}`),this.index+=2,i.node={type:"UpdateExpression",operator:o===Ir?"++":"--",argument:i.node,prefix:!1})}}),e.hooks.add("after-expression",function(i){i.node&&n(i.node)});function n(r){Ct.assignmentOperators.has(r.operator)?(r.type="AssignmentExpression",n(r.left),n(r.right)):r.operator||Object.values(r).forEach(i=>{i&&typeof i=="object"&&n(i)})}}};We.plugins.register(Tu,Ct),We.addUnaryOp("typeof"),We.addLiteral("null",null),We.addLiteral("undefined",void 0);const bu=new Set(["constructor","__proto__","__defineGetter__","__defineSetter__"]),Z={evalAst(e,t){switch(e.type){case"BinaryExpression":case"LogicalExpression":return Z.evalBinaryExpression(e,t);case"Compound":return Z.evalCompound(e,t);case"ConditionalExpression":return Z.evalConditionalExpression(e,t);case"Identifier":return Z.evalIdentifier(e,t);case"Literal":return Z.evalLiteral(e,t);case"MemberExpression":return Z.evalMemberExpression(e,t);case"UnaryExpression":return Z.evalUnaryExpression(e,t);case"ArrayExpression":return Z.evalArrayExpression(e,t);case"CallExpression":return Z.evalCallExpression(e,t);case"AssignmentExpression":return Z.evalAssignmentExpression(e,t);default:throw SyntaxError("Unexpected expression",e)}},evalBinaryExpression(e,t){return{"||":(r,i)=>r||i(),"&&":(r,i)=>r&&i(),"|":(r,i)=>r|i(),"^":(r,i)=>r^i(),"&":(r,i)=>r&i(),"==":(r,i)=>r==i(),"!=":(r,i)=>r!=i(),"===":(r,i)=>r===i(),"!==":(r,i)=>r!==i(),"<":(r,i)=>r<i(),">":(r,i)=>r>i(),"<=":(r,i)=>r<=i(),">=":(r,i)=>r>=i(),"<<":(r,i)=>r<<i(),">>":(r,i)=>r>>i(),">>>":(r,i)=>r>>>i(),"+":(r,i)=>r+i(),"-":(r,i)=>r-i(),"*":(r,i)=>r*i(),"/":(r,i)=>r/i(),"%":(r,i)=>r%i()}[e.operator](Z.evalAst(e.left,t),()=>Z.evalAst(e.right,t))},evalCompound(e,t){let n;for(let r=0;r<e.body.length;r++){e.body[r].type==="Identifier"&&["var","let","const"].includes(e.body[r].name)&&e.body[r+1]&&e.body[r+1].type==="AssignmentExpression"&&(r+=1);const i=e.body[r];n=Z.evalAst(i,t)}return n},evalConditionalExpression(e,t){return Z.evalAst(e.test,t)?Z.evalAst(e.consequent,t):Z.evalAst(e.alternate,t)},evalIdentifier(e,t){if(Object.hasOwn(t,e.name))return t[e.name];throw ReferenceError(`${e.name} is not defined`)},evalLiteral(e){return e.value},evalMemberExpression(e,t){const n=String(e.computed?Z.evalAst(e.property):e.property.name),r=Z.evalAst(e.object,t);if(r==null)throw TypeError(`Cannot read properties of ${r} (reading '${n}')`);if(!Object.hasOwn(r,n)&&bu.has(n))throw TypeError(`Cannot read properties of ${r} (reading '${n}')`);const i=r[n];return typeof i=="function"?i.bind(r):i},evalUnaryExpression(e,t){return{"-":r=>-Z.evalAst(r,t),"!":r=>!Z.evalAst(r,t),"~":r=>~Z.evalAst(r,t),"+":r=>+Z.evalAst(r,t),typeof:r=>typeof Z.evalAst(r,t)}[e.operator](e.argument)},evalArrayExpression(e,t){return e.elements.map(n=>Z.evalAst(n,t))},evalCallExpression(e,t){const n=e.arguments.map(i=>Z.evalAst(i,t));return Z.evalAst(e.callee,t)(...n)},evalAssignmentExpression(e,t){if(e.left.type!=="Identifier")throw SyntaxError("Invalid left-hand side in assignment");const n=e.left.name,r=Z.evalAst(e.right,t);return t[n]=r,t[n]}};class wu{constructor(t){this.code=t,this.ast=We(this.code)}runInNewContext(t){const n=Object.assign(Object.create(null),t);return Z.evalAst(this.ast,n)}}function it(e,t){return e=e.slice(),e.push(t),e}function Ar(e,t){return t=t.slice(),t.unshift(e),t}class Su extends Error{constructor(t){super('JSONPath should not be called with "new" (it prevents return of (unwrapped) scalar values)'),this.avoidNew=!0,this.value=t,this.name="NewError"}}function G(e,t,n,r,i){if(!(this instanceof G))try{return new G(e,t,n,r,i)}catch(s){if(!s.avoidNew)throw s;return s.value}typeof e=="string"&&(i=r,r=n,n=t,t=e,e=null);const o=e&&typeof e=="object";if(e=e||{},this.json=e.json||n,this.path=e.path||t,this.resultType=e.resultType||"value",this.flatten=e.flatten||!1,this.wrap=Object.hasOwn(e,"wrap")?e.wrap:!0,this.sandbox=e.sandbox||{},this.eval=e.eval===void 0?"safe":e.eval,this.ignoreEvalErrors=typeof e.ignoreEvalErrors=="undefined"?!1:e.ignoreEvalErrors,this.parent=e.parent||null,this.parentProperty=e.parentProperty||null,this.callback=e.callback||r||null,this.otherTypeCallback=e.otherTypeCallback||i||function(){throw new TypeError("You must supply an otherTypeCallback callback option with the @other() operator.")},e.autostart!==!1){const s={path:o?e.path:t};o?"json"in e&&(s.json=e.json):s.json=n;const l=this.evaluate(s);if(!l||typeof l!="object")throw new Su(l);return l}}G.prototype.evaluate=function(e,t,n,r){let i=this.parent,o=this.parentProperty,{flatten:s,wrap:l}=this;if(this.currResultType=this.resultType,this.currEval=this.eval,this.currSandbox=this.sandbox,n=n||this.callback,this.currOtherTypeCallback=r||this.otherTypeCallback,t=t||this.json,e=e||this.path,e&&typeof e=="object"&&!Array.isArray(e)){if(!e.path&&e.path!=="")throw new TypeError('You must supply a "path" property when providing an object argument to JSONPath.evaluate().');if(!Object.hasOwn(e,"json"))throw new TypeError('You must supply a "json" property when providing an object argument to JSONPath.evaluate().');({json:t}=e),s=Object.hasOwn(e,"flatten")?e.flatten:s,this.currResultType=Object.hasOwn(e,"resultType")?e.resultType:this.currResultType,this.currSandbox=Object.hasOwn(e,"sandbox")?e.sandbox:this.currSandbox,l=Object.hasOwn(e,"wrap")?e.wrap:l,this.currEval=Object.hasOwn(e,"eval")?e.eval:this.currEval,n=Object.hasOwn(e,"callback")?e.callback:n,this.currOtherTypeCallback=Object.hasOwn(e,"otherTypeCallback")?e.otherTypeCallback:this.currOtherTypeCallback,i=Object.hasOwn(e,"parent")?e.parent:i,o=Object.hasOwn(e,"parentProperty")?e.parentProperty:o,e=e.path}if(i=i||null,o=o||null,Array.isArray(e)&&(e=G.toPathString(e)),!e&&e!==""||!t)return;const a=G.toPathArray(e);a[0]==="$"&&a.length>1&&a.shift(),this._hasParentSelector=null;const u=this._trace(a,t,["$"],i,o,n).filter(function(f){return f&&!f.isParentSelector});return u.length?!l&&u.length===1&&!u[0].hasArrExpr?this._getPreferredOutput(u[0]):u.reduce((f,p)=>{const c=this._getPreferredOutput(p);return s&&Array.isArray(c)?f=f.concat(c):f.push(c),f},[]):l?[]:void 0},G.prototype._getPreferredOutput=function(e){const t=this.currResultType;switch(t){case"all":{const n=Array.isArray(e.path)?e.path:G.toPathArray(e.path);return e.pointer=G.toPointer(n),e.path=typeof e.path=="string"?e.path:G.toPathString(e.path),e}case"value":case"parent":case"parentProperty":return e[t];case"path":return G.toPathString(e[t]);case"pointer":return G.toPointer(e.path);default:throw new TypeError("Unknown result type")}},G.prototype._handleCallback=function(e,t,n){if(t){const r=this._getPreferredOutput(e);e.path=typeof e.path=="string"?e.path:G.toPathString(e.path),t(r,n,e)}},G.prototype._trace=function(e,t,n,r,i,o,s,l){let a;if(!e.length)return a={path:n,value:t,parent:r,parentProperty:i,hasArrExpr:s},this._handleCallback(a,o,"value"),a;const u=e[0],f=e.slice(1),p=[];function c(h){Array.isArray(h)?h.forEach(d=>{p.push(d)}):p.push(h)}if((typeof u!="string"||l)&&t&&Object.hasOwn(t,u))c(this._trace(f,t[u],it(n,u),t,u,o,s));else if(u==="*")this._walk(t,h=>{c(this._trace(f,t[h],it(n,h),t,h,o,!0,!0))});else if(u==="..")c(this._trace(f,t,n,r,i,o,s)),this._walk(t,h=>{typeof t[h]=="object"&&c(this._trace(e.slice(),t[h],it(n,h),t,h,o,!0))});else{if(u==="^")return this._hasParentSelector=!0,{path:n.slice(0,-1),expr:f,isParentSelector:!0};if(u==="~")return a={path:it(n,u),value:i,parent:r,parentProperty:null},this._handleCallback(a,o,"property"),a;if(u==="$")c(this._trace(f,t,n,null,null,o,s));else if(/^(-?\d*):(-?\d*):?(\d*)$/u.test(u))c(this._slice(u,f,t,n,r,i,o));else if(u.indexOf("?(")===0){if(this.currEval===!1)throw new Error("Eval [?(expr)] prevented in JSONPath expression.");const h=u.replace(/^\?\((.*?)\)$/u,"$1"),d=/@.?([^?]*)[['](\??\(.*?\))(?!.\)\])[\]']/gu.exec(h);d?this._walk(t,g=>{const E=[d[2]],w=d[1]?t[g][d[1]]:t[g];this._trace(E,w,n,r,i,o,!0).length>0&&c(this._trace(f,t[g],it(n,g),t,g,o,!0))}):this._walk(t,g=>{this._eval(h,t[g],g,n,r,i)&&c(this._trace(f,t[g],it(n,g),t,g,o,!0))})}else if(u[0]==="("){if(this.currEval===!1)throw new Error("Eval [(expr)] prevented in JSONPath expression.");c(this._trace(Ar(this._eval(u,t,n.at(-1),n.slice(0,-1),r,i),f),t,n,r,i,o,s))}else if(u[0]==="@"){let h=!1;const d=u.slice(1,-2);switch(d){case"scalar":(!t||!["object","function"].includes(typeof t))&&(h=!0);break;case"boolean":case"string":case"undefined":case"function":typeof t===d&&(h=!0);break;case"integer":Number.isFinite(t)&&!(t%1)&&(h=!0);break;case"number":Number.isFinite(t)&&(h=!0);break;case"nonFinite":typeof t=="number"&&!Number.isFinite(t)&&(h=!0);break;case"object":t&&typeof t===d&&(h=!0);break;case"array":Array.isArray(t)&&(h=!0);break;case"other":h=this.currOtherTypeCallback(t,n,r,i);break;case"null":t===null&&(h=!0);break;default:throw new TypeError("Unknown value type "+d)}if(h)return a={path:n,value:t,parent:r,parentProperty:i},this._handleCallback(a,o,"value"),a}else if(u[0]==="`"&&t&&Object.hasOwn(t,u.slice(1))){const h=u.slice(1);c(this._trace(f,t[h],it(n,h),t,h,o,s,!0))}else if(u.includes(",")){const h=u.split(",");for(const d of h)c(this._trace(Ar(d,f),t,n,r,i,o,!0))}else!l&&t&&Object.hasOwn(t,u)&&c(this._trace(f,t[u],it(n,u),t,u,o,s,!0))}if(this._hasParentSelector)for(let h=0;h<p.length;h++){const d=p[h];if(d&&d.isParentSelector){const g=this._trace(d.expr,t,d.path,r,i,o,s);if(Array.isArray(g)){p[h]=g[0];const E=g.length;for(let w=1;w<E;w++)h++,p.splice(h,0,g[w])}else p[h]=g}}return p},G.prototype._walk=function(e,t){if(Array.isArray(e)){const n=e.length;for(let r=0;r<n;r++)t(r)}else e&&typeof e=="object"&&Object.keys(e).forEach(n=>{t(n)})},G.prototype._slice=function(e,t,n,r,i,o,s){if(!Array.isArray(n))return;const l=n.length,a=e.split(":"),u=a[2]&&Number.parseInt(a[2])||1;let f=a[0]&&Number.parseInt(a[0])||0,p=a[1]&&Number.parseInt(a[1])||l;f=f<0?Math.max(0,f+l):Math.min(l,f),p=p<0?Math.max(0,p+l):Math.min(l,p);const c=[];for(let h=f;h<p;h+=u)this._trace(Ar(h,t),n,r,i,o,s,!0).forEach(g=>{c.push(g)});return c},G.prototype._eval=function(e,t,n,r,i,o){this.currSandbox._$_parentProperty=o,this.currSandbox._$_parent=i,this.currSandbox._$_property=n,this.currSandbox._$_root=this.json,this.currSandbox._$_v=t;const s=e.includes("@path");s&&(this.currSandbox._$_path=G.toPathString(r.concat([n])));const l=this.currEval+"Script:"+e;if(!G.cache[l]){let a=e.replaceAll("@parentProperty","_$_parentProperty").replaceAll("@parent","_$_parent").replaceAll("@property","_$_property").replaceAll("@root","_$_root").replaceAll(/@([.\s)[])/gu,"_$_v$1");if(s&&(a=a.replaceAll("@path","_$_path")),this.currEval==="safe"||this.currEval===!0||this.currEval===void 0)G.cache[l]=new this.safeVm.Script(a);else if(this.currEval==="native")G.cache[l]=new this.vm.Script(a);else if(typeof this.currEval=="function"&&this.currEval.prototype&&Object.hasOwn(this.currEval.prototype,"runInNewContext")){const u=this.currEval;G.cache[l]=new u(a)}else if(typeof this.currEval=="function")G.cache[l]={runInNewContext:u=>this.currEval(a,u)};else throw new TypeError(`Unknown "eval" property "${this.currEval}"`)}try{return G.cache[l].runInNewContext(this.currSandbox)}catch(a){if(this.ignoreEvalErrors)return!1;throw new Error("jsonPath: "+a.message+": "+e)}},G.cache={},G.toPathString=function(e){const t=e,n=t.length;let r="$";for(let i=1;i<n;i++)/^(~|\^|@.*?\(\))$/u.test(t[i])||(r+=/^[0-9*]+$/u.test(t[i])?"["+t[i]+"]":"['"+t[i]+"']");return r},G.toPointer=function(e){const t=e,n=t.length;let r="";for(let i=1;i<n;i++)/^(~|\^|@.*?\(\))$/u.test(t[i])||(r+="/"+t[i].toString().replaceAll("~","~0").replaceAll("/","~1"));return r},G.toPathArray=function(e){const{cache:t}=G;if(t[e])return t[e].concat();const n=[],i=e.replaceAll(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\(\)/gu,";$&;").replaceAll(/[['](\??\(.*?\))[\]'](?!.\])/gu,function(o,s){return"[#"+(n.push(s)-1)+"]"}).replaceAll(/\[['"]([^'\]]*)['"]\]/gu,function(o,s){return"['"+s.replaceAll(".","%@%").replaceAll("~","%%@@%%")+"']"}).replaceAll("~",";~;").replaceAll(/['"]?\.['"]?(?![^[]*\])|\[['"]?/gu,";").replaceAll("%@%",".").replaceAll("%%@@%%","~").replaceAll(/(?:;)?(\^+)(?:;)?/gu,function(o,s){return";"+s.split("").join(";")+";"}).replaceAll(/;;;|;;/gu,";..;").replaceAll(/;$|'?\]|'$/gu,"").split(";").map(function(o){const s=o.match(/#(\d+)/u);return!s||!s[1]?o:n[s[1]]});return t[e]=i,t[e].concat()},G.prototype.safeVm={Script:wu};const Iu=function(e,t,n){const r=e.length;for(let i=0;i<r;i++){const o=e[i];n(o)&&t.push(e.splice(i--,1)[0])}};class Au{constructor(t){this.code=t}runInNewContext(t){let n=this.code;const r=Object.keys(t),i=[];Iu(r,i,u=>typeof t[u]=="function");const o=r.map(u=>t[u]);n=i.reduce((u,f)=>{let p=t[f].toString();return/function/u.test(p)||(p="function "+p),"var "+f+"="+p+";"+u},"")+n,!/(['"])use strict\1/u.test(n)&&!r.includes("arguments")&&(n="var arguments = undefined;"+n),n=n.replace(/;\s*$/u,"");const l=n.lastIndexOf(";"),a=l!==-1?n.slice(0,l+1)+" return "+n.slice(l+1):" return "+n;return new Function(...r,a)(...o)}}G.prototype.vm={Script:Au};class Cu{constructor(t){this._highlight=!1,D(t)||this.setProperties(t)}setProperties(t){this.validateProperties(t),this.path=t.path,this.label=t.label,this._onRevert=t.onRevert,this._onReady=t.onReady,!D(this._onReady)&&!D(this._content)&&!D(this._metadata)&&this._onReady(this._content,this._metadata),this._onHighlight=t.onHighlight,!D(this._onHighlight)&&this._highlight&&D(this.path)&&(D(this._metadata)?this._onHighlight(this._highlight):this._onHighlight(this._highlight,this._metadata))}validateProperties(t){if(D(t.onReady))throw new tt(Be.InvalidContentZoneHandlerProperty,"onReady property must defined");if(J(t,"onReady")&&!ar(t.onReady))throw new tt(Be.InvalidContentZoneHandlerProperty,"onReady property must be a function");if(J(t,"onRevert")&&!ar(t.onRevert))throw new tt(Be.InvalidContentZoneHandlerProperty,"onRevert property must be a function");if(J(t,"onHighlight")&&!ar(t.onHighlight))throw new tt(Be.InvalidContentZoneHandlerProperty,"onHighlight property must be a function");if(J(t,"path")&&!b(t.path))throw new tt(Be.InvalidContentZoneHandlerProperty,"Path property must be a non-empty string");if(J(t,"label")&&!b(t.label))throw new tt(Be.InvalidContentZoneHandlerProperty,"Label property must be a non-empty string")}triggerReady(t,n){if(D(t)||D(n)){y.log.warn("Handling a call to ready for a content zone handler transformation, but the content or the metadata parameter is not defined. The ready handler will not be called.");return}this._content=t,this._metadata=n,D(this._onReady)||this._onReady(t,n)}triggerRevert(){this._content=null;const t=this._metadata;if(this._metadata=null,D(t)){y.log.warn("Handling a call to revert for a content zone handler transformation, but the content zone handler metadata is not defined. The revert handler will not be called.");return}D(this._onRevert)||this._onRevert(t)}triggerHighlight(t){if(!et(t)){y.log.warn("Handling a call to highlight for a content zone handler transformation, but the highlight parameter is not a boolean. The highlight handler will not be called.");return}this._highlight=t,!D(this._onHighlight)&&D(this.path)&&(D(this._metadata)?this._onHighlight(this._highlight):this._onHighlight(this._highlight,this._metadata))}}let Zt={};function Pu(){Zt={}}function Nu(e,t){try{if(!N(t,!1))throw new tt(Be.InvalidContentZoneHandlerProperties,"Content Zone Handler Properties must be a non-empty object");const n=Cr(e);D(n)?Oo(e,t):n.setProperties(t)}catch(n){y.log.error(`Content Zone Handler could not be set due to: ${K(n).message}`)}}function Ou(e){const t=Cr(e);if(D(t))return t;const{label:n,path:r}=t;return{label:n,path:r}}function Cr(e){if(!b(e))throw new tt(Be.InvalidContentZoneHandlerName,"Name must be a non-empty string");return Zt[e]}function Oo(e,t){return Zt[e]=new Cu(t),Zt[e]}function Du(){return Zt}var Mu=Object.defineProperty,Ru=Object.defineProperties,Lu=Object.getOwnPropertyDescriptors,Do=Object.getOwnPropertySymbols,xu=Object.prototype.hasOwnProperty,ku=Object.prototype.propertyIsEnumerable,Mo=(e,t,n)=>t in e?Mu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Uu=(e,t)=>{for(var n in t||(t={}))xu.call(t,n)&&Mo(e,n,t[n]);if(Do)for(var n of Do(t))ku.call(t,n)&&Mo(e,n,t[n]);return e},Hu=(e,t)=>Ru(e,Lu(t));let Ro=null;function Fu(e){var t;if(N(e)&&(J(e,"anchorId")||J(e,"anchorDmoName"))){const n=Hu(Uu({},J(e,"anchorDmoName")&&{anchorDmoName:e.anchorDmoName}),{anchorId:(t=e.anchorId)!=null?t:""});return zu(n),n.anchorId===null?null:n}else return Ro}function zu(e){if(J(e,"anchorDmoName")&&(!b(e.anchorDmoName)||!b(e.anchorId)))throw b(e.anchorId)?new he(ce.AnchorDmoNameRequired,"Anchor Dmo Name must be a non-empty string when provided."):new he(ce.AnchorIdRequiredWithDmoName,"Anchor Id cannot be null if Anchor Dmo Name is provided.");if(e.anchorId!==null&&!b(e.anchorId))throw new he(ce.AnchorIdNullOrNotEmpty,"Anchor Id must be null or a non-empty string.")}document.addEventListener(P.CustomEvents.OnEventSend,e=>{var t,n,r;if(((r=(n=(t=e==null?void 0:e.detail)==null?void 0:t.actionEvent)==null?void 0:n.interaction)==null?void 0:r.name)===P.CatalogObjectInteractionName.ViewCatalogObject){const i=e.detail.actionEvent.interaction.catalogObject;N(i)&&b(i.id)&&b(i.type)&&Lo({anchorId:i.id})}}),document.addEventListener(P.CustomEvents.OnInit,()=>{Lo(null)});function Lo(e){Ro=e}var xo=(e,t,n)=>new Promise((r,i)=>{var o=a=>{try{l(n.next(a))}catch(u){i(u)}},s=a=>{try{l(n.throw(a))}catch(u){i(u)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,s);l((n=n.apply(e,t)).next())});const ko="TestMode",Uo="Web";class Vu{constructor(t,n){this.statuses=t,this.finished=Promise.allSettled(Object.values(t).map(r=>xo(this,null,function*(){return yield r.finished}))).then(r=>{const i=r.filter(o=>o.status==="rejected").map(o=>K(o.reason).message);if(i.length>0)throw new Error(`Issue(s) with preview (see 'statuses' for more detail): ${JSON.stringify(i)}`)}),this.finished.catch(()=>{}),this.revert=()=>(D(this._revertResponse)&&(this._revertResponse=n()),this._revertResponse)}}class Bu{constructor(t){this.statuses=t,this.finished=Promise.allSettled(Object.values(t).map(n=>xo(this,null,function*(){return yield n.finished}))).then(n=>{const r=n.filter(i=>i.status==="rejected").map(i=>K(i.reason).message);if(r.length>0)throw new Error(`Issue(s) with revert (see 'statuses' for more detail): ${JSON.stringify(r)}`)}),this.finished.catch(()=>{})}}let qe=null;function Gu(e){const t={};let n=!1;return b(e==null?void 0:e.pageType)?(t.pageType=e.pageType,n=!0):b(qe==null?void 0:qe.pageType)&&(t.pageType=qe==null?void 0:qe.pageType,n=!0),b(e==null?void 0:e.interaction)?(t.interaction=e.interaction,n=!0):b(qe==null?void 0:qe.interaction)&&(t.interaction=qe==null?void 0:qe.interaction,n=!0),n?t:null}function Pr(e){qe=e}function ju(){document.addEventListener(y.CustomEvents.OnShutDown,()=>Pr(null)),document.addEventListener(y.CustomEvents.OnInit,()=>Pr(null)),document.addEventListener(y.CustomEvents.OnSettledSitemap,e=>{var t,n;((t=e==null?void 0:e.detail)==null?void 0:t.result)!==void 0&&Wu((n=e==null?void 0:e.detail)==null?void 0:n.result)})}function Wu(e){var t,n,r,i,o,s,l,a,u,f,p,c;const h={};let d=!1;const g=(i=(t=e==null?void 0:e.matchedConfig)==null?void 0:t.name)!=null?i:(r=(n=e==null?void 0:e.currentPage)==null?void 0:n.source)==null?void 0:r.pageType;b(g)&&(h.pageType=g,d=!0),b((s=(o=e==null?void 0:e.matchedConfig)==null?void 0:o.interaction)==null?void 0:s.name)?(h.interaction=(a=(l=e==null?void 0:e.matchedConfig)==null?void 0:l.interaction)==null?void 0:a.name,d=!0):b((f=(u=e==null?void 0:e.currentPage)==null?void 0:u.interaction)==null?void 0:f.name)&&(h.interaction=(c=(p=e==null?void 0:e.currentPage)==null?void 0:p.interaction)==null?void 0:c.name,d=!0),Pr(d?h:null)}var Nr=(e,t,n)=>new Promise((r,i)=>{var o=a=>{try{l(n.next(a))}catch(u){i(u)}},s=a=>{try{l(n.throw(a))}catch(u){i(u)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,s);l((n=n.apply(e,t)).next())});function qu(e){return Nr(this,null,function*(){var t,n;const r=y.getSitemapResult(),i=y.getSitemapConfig();return(r==null?void 0:r.matchedConfig)!=null?(y.log.trace(`Evaluating context attributes from matched page type [${r==null?void 0:r.matchedConfig.name}] for dataspace [${(t=e==null?void 0:e.dataspace)!=null?t:""}].`),yield Or(r.matchedConfig,e)):(i==null?void 0:i.global)!=null?(y.log.trace(`Evaluating context attributes from global page type for dataspace [${(n=e==null?void 0:e.dataspace)!=null?n:""}].`),yield Or(i.global,e)):{}})}function Or(e,t){return Nr(this,null,function*(){if((e==null?void 0:e.contextualAttributes)==null)return{};const n=e.contextualAttributes,r=Object.keys(n),i={},o={};return r.forEach(s=>{i[s]=$u(s,n[s],t)}),yield Promise.all(Object.values(i)).then(s=>(s.forEach((l,a)=>{if(l!==void 0){const u=r[a];o[u]=l}}),o))})}function $u(e,t,n){return Nr(this,null,function*(){try{return N(n)&&J(n,e)?n[e]:yield Promise.resolve(t).then(r=>typeof r=="function"?r():r)}catch(r){y.log.error(`Error when evaluating contextual attribute [${e}]: ${K(r).message}`,r)}})}function Ho(){return P.getConsents().findIndex(e=>e.consent.status===y.ConsentStatus.OptIn)>=0}var Yu=Object.defineProperty,Zu=Object.defineProperties,Ku=Object.getOwnPropertyDescriptors,Fo=Object.getOwnPropertySymbols,Xu=Object.prototype.hasOwnProperty,Qu=Object.prototype.propertyIsEnumerable,zo=(e,t,n)=>t in e?Yu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ke=(e,t)=>{for(var n in t||(t={}))Xu.call(t,n)&&zo(e,n,t[n]);if(Fo)for(var n of Fo(t))Qu.call(t,n)&&zo(e,n,t[n]);return e},Ju=(e,t)=>Zu(e,Ku(t)),Mn=(e,t,n)=>new Promise((r,i)=>{var o=a=>{try{l(n.next(a))}catch(u){i(u)}},s=a=>{try{l(n.throw(a))}catch(u){i(u)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,s);l((n=n.apply(e,t)).next())});const Kt=new Dl("PreviewMeta");function Vo(e,t){return Mn(this,null,function*(){let n=hr();const r=yield e;if(so(t==null?void 0:t.endpoint),D(t==null?void 0:t.endpoint)||(n=t.endpoint,P.log.debug(`Using specified endpoint of ${n} as endpoint for fetching personalization.`)),!Ho()&&!Dr(r))throw new he(ce.ConsentOptInRequired,"Consent opt-in is required to fetch personalization.",{level:"warning"});const i={method:"POST",cache:"no-store",headers:{"Content-Type":"application/json",Accept:"application/json, text/javascript, */*; q=0.01"},body:JSON.stringify(r)};return Dr(r)&&(i.credentials="include",i.mode="cors"),yield window.fetch(n,i).then(o=>Mn(this,null,function*(){if(!o.ok){const s=yield o.text();throw new no(to.PersonalizationFetchFailed,"Personalization fetch failed.",{context:{status:o.status,message:s}})}return yield o.json().then(s=>(uc(s),Dr(r)&&s.personalizations.forEach(l=>{jo({personalizationId:l.personalizationId,personalizationPointName:l.personalizationPointName})}),s))})).catch(o=>Mn(this,null,function*(){return o instanceof no||P.log.error("Unexpected error with browser fetch."),yield Promise.reject(o)}))})}function ec(e,t){if(!H(e))throw new he(ce.PersonalizationPointsIsNotAnArray,"The Personalization Points parameter must be an array of length >= 1.");e.forEach(n=>{if(D(n))throw new he(ce.PersonalizationPointIsNotDefined,"The Personalization Point must be an object containing a name value.",{context:{value:n}});if(!b(n.name))throw new he(ce.PersonalizationPointNameIsNotAString,"The Personalization Point name parameter must be a non empty string.",{context:{value:n.name}});if(J(n,"decisionId")){if(t!==!0)throw new he(ce.PersonalizationPointDecisionIdProvidedNonPreview,"The Personalization Point decisionId parameter can only be provided during previews.",{context:{value:n.decisionId}});if(!b(n.decisionId))throw new he(ce.PersonalizationPointDecisionIdIsNotAString,"The Personalization Point decisionId parameter must be a non empty string if provided.",{context:{value:n.decisionId}})}})}function tc(e){if(!N(e))throw new he(ce.ContextIsNotAnObject,"The Context parameter must be an object.")}function Bo(e,t,n){return Mn(this,null,function*(){ec(e,n),t!==void 0&&tc(t);const r=et(n)&&n;t=ke(ke({},yield qu(t)),t);const i={personalizationPoints:e,context:ke(ke(Ju(ke(ke(ke(ke(ke(ke({},t),Fu(t)),ic(t)),oc(t)),Gu(t)),ac(t)),{individualId:sc(r,t)}),nc(t)),rc())};return r&&(i.executionFlags=[ko]),i})}function nc(e){const t={};if(b(e==null?void 0:e.dataspace))t.dataspace=e==null?void 0:e.dataspace;else{const n=Bt();b(n)&&(t.dataspace=n)}return t}function rc(){var e;const t=(e=window==null?void 0:window.location)==null?void 0:e.hostname;return t===void 0?(P.log.warn("Channel context (window.location.hostname) is undefined \u2014 not sending channelContext"),{channel:Uo}):{channel:Uo,channelContext:t}}function ic(e){var t;const n={};if(b(e==null?void 0:e.requestUrl))n.requestUrl=e==null?void 0:e.requestUrl;else{const r=(t=window==null?void 0:window.location)==null?void 0:t.href;b(r)&&(n.requestUrl=r)}return n}function oc(e){const t={};if(b(e==null?void 0:e.p13n_sys_requestTimeZone))t.p13n_sys_requestTimeZone=e.p13n_sys_requestTimeZone;else try{const n=window.Intl.DateTimeFormat().resolvedOptions().timeZone;b(n)&&(t.p13n_sys_requestTimeZone=n)}catch(n){P.log.error("Error getting request time zone from browser. The contextual attribute p13n_sys_requestTimeZone will not be set.",n)}return t}function ac(e){const t={};if([Xt(e==null?void 0:e.utm_source,n=>{t.utm_source=n}),Xt(e==null?void 0:e.utm_campaign,n=>{t.utm_campaign=n}),Xt(e==null?void 0:e.utm_medium,n=>{t.utm_medium=n}),Xt(e==null?void 0:e.utm_content,n=>{t.utm_content=n}),Xt(e==null?void 0:e.utm_term,n=>{t.utm_term=n})].every(n=>!n)){const n=Al(["utm_source","utm_campaign","utm_medium","utm_content","utm_term"]);Qt("utm_source",n,r=>{t.utm_source=r}),Qt("utm_campaign",n,r=>{t.utm_campaign=r}),Qt("utm_medium",n,r=>{t.utm_medium=r}),Qt("utm_content",n,r=>{t.utm_content=r}),Qt("utm_term",n,r=>{t.utm_term=r})}return t}function Xt(e,t){return b(e)?(t(e),!0):!1}function Qt(e,t,n){const r=t!==null?t[e]:null;b(r)&&n(r)}function sc(e,t){if(e&&N(t)&&J(t,"individualId")){const n=t.individualId;if(b(n))return n}return P.getAnonymousId()}function Dr(e){var t,n;return(n=(t=e==null?void 0:e.executionFlags)==null?void 0:t.includes(ko))!=null?n:!1}function Mr(e,t){return b(e)&&Go(e)||b(t)&&lc(t)}function Go(e){return!D(Kt.get(e))}function lc(e){return!D(Kt.get(e))}function jo(e){J(e,"personalizationId")?Kt.set(e.personalizationId,e):J(e,"personalizationExperienceConfigName")&&Kt.set(e.personalizationExperienceConfigName,e)}function Rr(e){Kt.delete(e)}function Wo(e){return H(e.data)||N(e.attributes,!1)}function uc(e){let t=!0;if(!N(e))throw new zt(mt.InvalidJsonObject,"Personalization response invalid: Expected a JSON object.");if(!H(e.personalizations,!0))throw new zt(mt.MissingPersonalizationsArray,'Personalization response invalid: Expected "personalizations" array.');if(e.personalizations.length===0&&(t=!1),e.personalizations.forEach(n=>{if(!b(n.personalizationId))throw new zt(mt.MissingPersonalizationId,'Personalization response invalid: Expected each "personalization" to include "personalizationId".');if(!b(n.personalizationPointName))throw new zt(mt.MissingPersonalizationPointName,'Personalization response invalid: Expected each "personalization" to include "personalizationPointName".');if(!Wo(n))if(!b(n.decisionId))P.log.debug(`User did not qualify for a decision. Id ${n.personalizationId}, Name ${n.personalizationPointName}`);else{P.log.error(`User qualified for a decision but there is no "data" nor "attributes". Id ${n.personalizationId}, Name ${n.personalizationPointName}, Decision Id ${n.decisionId}`);return}t=!1}),t)throw new zt(mt.MissingPersonalizationContent,'Personalization response invalid. Expected each "personalization" to include either "data" or "attributes".')}function cc(e){var t;return(t=e==null?void 0:e.contentZones)!=null?t:[]}function qo(e,t=!0){return cc(e).reduce((n,r)=>{const[i,o]=fc(r,t);return b(i==null?void 0:i.name)&&o&&n.push(r),n},[])}function fc(e,t=!0){const n=N(e)?e:{name:"",selector:""},r=b(n==null?void 0:n.selector);b(n==null?void 0:n.name)&&!r&&y.log.debug(`Content Zone ${n.name} has no Selector configured`);const i=r&&(!t||dc(n==null?void 0:n.selector));return[e,i]}const dc=e=>y.cashDom(e).length>0;function $o(e){if(!b(e))return null;const t=y.getSitemapResult().matchedConfig;if(t.contentZones!==void 0){const n=t.contentZones;if(!H(n))return null;const r=n.find(i=>i.name===e);return b(r==null?void 0:r.selector)?r.selector:null}return null}function Lr(e,t=!0){return qo(e,t).map(n=>n.name)}function hc(e,t=!0){return xr([e],void 0,void 0,!0,t)}function pc(e,t=!0){return xr(e,void 0,void 0,!0,t)}function gc(e){return N(e)?xr(e.pageTypes,e.global,e.pageTypeDefault,!0,!1):[]}function xr(e,t,n,r=!0,i=!0){const o=[];if(N(t)&&o.push(...Lr(t,i)),H(e)&&e.forEach(s=>{o.push(...Lr(s,i))}),N(n)&&o.push(...Lr(n,i)),r){const s=mc(o);if(s.length>0)return y.log.warn(`The following content zones are duplicated which are not supported by personalization: ${vc(s).join(", ")}`),Ec(o,s)}return o}function mc(e){return e.filter((t,n)=>e.indexOf(t)!==n)}function vc(e){return e.filter((t,n)=>e.indexOf(t)===n)}function Ec(e,t){return e.filter(n=>!t.includes(n))}const yc={redisplayTimeoutMilliseconds:2e3,renderPersonalizationAfterTimeoutElapsed:!1};var Te=(e=>(e.PageType="PageType",e.PageUrlMatcher="PageUrlMatcher",e))(Te||{}),_c=Object.defineProperty,Yo=Object.getOwnPropertySymbols,Tc=Object.prototype.hasOwnProperty,bc=Object.prototype.propertyIsEnumerable,Zo=(e,t,n)=>t in e?_c(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ko=(e,t)=>{for(var n in t||(t={}))Tc.call(t,n)&&Zo(e,n,t[n]);if(Yo)for(var n of Yo(t))bc.call(t,n)&&Zo(e,n,t[n]);return e};let Rn=yc,Xo=!1;const wc="head > style.personalizationFlickerDefense",ct={PageUrlMatcher:[],PageType:[]};function Ln(){return Rn!=null?Rn:{}}function Sc(e){Rn=Ko(Ko({},Rn),e)}function Ic(e){if(!N(e))throw new fr("flicker defense config is required");if(J(e,"redisplayTimeoutMilliseconds")&&(!Ht(e.redisplayTimeoutMilliseconds)||e.redisplayTimeoutMilliseconds<0))throw new fr("redisplayTimeoutMilliseconds must be a number greater than or equal to 0");if(J(e,"renderPersonalizationAfterTimeoutElapsed")&&!et(e.renderPersonalizationAfterTimeoutElapsed))throw new fr("renderPersonalizationAfterTimeoutElapsed must be a boolean")}function Qo(e){Xo=e}function Ac(){return Xo}function Cc(e){try{return document.querySelector(e),!0}catch(t){return P.log.warn(`Invalid path ${e} detected while trying to prevent flicker.`),!1}}function Pc(){const e=Nc();return Object.values(ct).flat().map(t=>{var n;if(Gt(t)){const r=(n=e.find(i=>t.name===i.name))==null?void 0:n.selector;if(b(r))return r}else if(rt(t))return t.path;return""}).filter(Cc).join(",")}function Nc(){const{pageTypes:e,global:t,pageTypeDefault:n}=P.getSitemapConfig();return[...e,...N(t)?[t]:[],...N(n)?[n]:[]].flatMap(r=>qo(r,!1))}function Oc(e){return e.transformationConfig.transformations.filter(rt).length>0}function Jo(e){if(et(e.isEnabled)&&!e.isEnabled)return!1;const t=e.transformationConfig.method;return t===$.ReplaceContentZoneContent||t===$.ReplaceElementContent||D(t)&&Oc(e)}function ea(e){return e.filter(Jo).flatMap(t=>t.transformationConfig.transformations)}function Dc(){const e=P.cashDom("<style></style>"),t=_n();return b(t)&&e.attr("nonce",t),e.attr({type:"text/css",class:"personalizationFlickerDefense"}).appendTo(document.head)}function kr(){const e=()=>{let t=P.cashDom(wc);t.length===0&&(t=Dc());const n=Pc();b(n)?(P.log.debug(`flicker defense style tag updated to ${n}`),t.text(`${n} { visibility: hidden !important; }`)):(P.log.debug("flicker defense style tag removed"),t.remove())};window.requestAnimationFrame(e)}function Ur(e){const t=ea(e);for(const n of t)xn(n)}function xn(e){for(const t of Object.values(Te))ct[t]=ct[t].filter(n=>(n===e&&P.log.debug(`flicker defense reshowing hidden transformation with source matcher type of ${t}: ${JSON.stringify(e)}`),n!==e));kr()}function ta(e,t,n){if(!Mr(e,t.pec.name)&&Jo(t.pec)&&!Ln().renderPersonalizationAfterTimeoutElapsed&&Ac()){const r=`Blocking transform and render of following transformation for config ${t.pec.name} due to flicker defense: ${JSON.stringify(n)}`;throw t.status.update(new k(r)),xn(n),new ie(fe.FlickerDefenseRedisplayElapsed,`Blocking transform and render of following transformation for config ${t.pec.name} due to flicker defense`)}}function na(e){if(Ge()){if(!N(e,!1)){P.log.error("A config is required when setting Flicker Defense Config.");return}try{Ic(e),Sc(e),P.log.info("Set Flicker Defense Config to the following: ",e)}catch(t){P.log.error(`Flicker Defense Config could not be set due to: ${K(t).message}`)}}else P.log.error("Flicker Defense Config can only be set before SalesforceInteractions.init is called.")}var Mc=(e,t,n)=>new Promise((r,i)=>{var o=a=>{try{l(n.next(a))}catch(u){i(u)}},s=a=>{try{l(n.throw(a))}catch(u){i(u)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,s);l((n=n.apply(e,t)).next())});const ra=class or{validateTransformerDetails(t){}validateMethod(t){}validateSubstitutionValues(t){}supportsEngagementSelection(){return!0}setContent(t,n,r,i,o,s,l=$.ReplaceElementContent){const a=`pec ${o.pec.name}, transformation ${r.transformerName}`+(s!==void 0?`, personalizationId ${s}`:"");o.status.update(new k(`Awaiting element/conditions ${a}`));const u=t.then(f=>{if(!(f instanceof Element))throw new ie(fe.FoundNonElement,"Found non-Element");if(s!==void 0&&ta(s,o,r),!D(o.revertStatus)){const p=`Aborting ${a}, revert has been called`;return y.log.info(p),o.status.update(new k(p)),c=>{c.update(new k(`Nothing to revert, since revert was requested before transformation, ${a}`))}}if(o.status.update(new k(`About to transform/render, element/conditions ready ${a}`)),uo(i)){const p=document.head;if(D(p))throw new ie(fe.ElementsNotFound,"Could not add agent script, head not found");const c=document.createElement("script");return c.type="text/javascript",c.textContent=n(),c.nonce=_n(),this.insertAdjacentHtmlUnlessAlreadyPersonalized(p,"beforeend",()=>c,a)}else{if(pr(r,l))return this.triggerReadyHandlerWithHtml(r.name,o,s,n,a);if(_t(l)){const p=f.closest("body");if(D(p))throw new ie(fe.ElementsNotFound,"Could not add overlay, body not found");return this.insertAdjacentHtmlUnlessAlreadyPersonalized(p,"beforeend",n,a)}else{if(Sn(r,l))return this.setInnerHtmlUnlessAlreadyPersonalized(f,n,a);if(rt(r)){const p=l!=null?l:$.ReplaceElementContent;switch(p){case $.ReplaceElementContent:return this.setInnerHtmlUnlessAlreadyPersonalized(f,n,a);case $.AddAfterElement:return this.insertAdjacentHtmlUnlessAlreadyPersonalized(f,"afterend",n,a);case $.AddBeforeElement:return this.insertAdjacentHtmlUnlessAlreadyPersonalized(f,"beforebegin",n,a);default:throw new ie(fe.NotSupported,`method "${p}" is not supported for Element transformations`)}}else throw new ie(fe.NotSupported,"transformation is not of a known type")}}});return u.catch(f=>{const p=new Error(`Could not set content for ${a}: ${K(f).message}`);o.status.update(new k(p)),y.log.error(p.message)}),{promise:u.then(),revert:f=>Mc(this,null,function*(){f.update(new k("Awaiting transformPromise"));const p=u.then(c=>{c(f)},c=>{if(c instanceof ie){f.update(new k(`Nothing to revert, no transformation attempt, ${a}`));return}throw c});p.catch(c=>{const h=new Error(`Issue reverting ${a}: `+K(c).message);y.log.error(h),f.update(new k(h))}),yield p})}}setInnerHtmlUnlessAlreadyPersonalized(t,n,r){if(t.children.length>0&&this.isElementAlreadyPersonalized(t.children[0]))throw new ie(fe.AlreadyPersonalized,`Aborting setting innerHTML, element ${t.localName} already personalized`);const i=n();y.log.trace(`Setting element ${t.localName}'s innerHTML to ${i}, ${r}`,t);const o=t.innerHTML;return t.innerHTML=i,s=>{let l=`Reverting, ${r}`;s.update(new k(l)),y.log.debug(l),t.innerHTML=o,l=`Reverted, ${r}`,s.update(new k(l)),y.log.debug(l)}}insertAdjacentHtmlUnlessAlreadyPersonalized(t,n,r,i){let o;switch(n){case"beforebegin":o=t.previousSibling;break;case"afterbegin":o=t.firstChild;break;case"beforeend":o=t.lastChild;break;case"afterend":o=t.nextSibling;break;default:throw new Error(`Unsupported insertAdjacentHTML position: ${String(n)}`)}if(o instanceof Element&&this.isElementAlreadyPersonalized(t))throw new ie(fe.AlreadyPersonalized,`Aborting inserting adjacent HTML, adjacent element ${o.localName} ${n} from ${t.localName} is already personalized`);const s=r();y.log.trace(`Inserting adjacent HTML ${n} element ${t.localName}'s with ${b(s)?s:s.outerHTML}, ${i}`,t);const l=b(s)?this.getHTMLElements(s):[s];return this.insertAdjacentElements(t,n,l),a=>{let u=`Reverting, ${i}`;a.update(new k(u)),y.log.debug(u),l.forEach(f=>f.remove()),u=`Reverted, ${i}`,a.update(new k(u)),y.log.debug(u)}}triggerReadyHandlerWithHtml(t,n,r,i,o){var s;const l=i(),a=(s=Cr(t))!=null?s:Oo(t);return a.triggerReady(l,{personalizationExperienceConfig:n.pec,isPreview:Mr(r,n.pec.name)}),u=>{let f=`Reverting, ${o}`;u.update(new k(f)),y.log.debug(f),a.triggerRevert(),f=`Reverted, ${o}`,u.update(new k(f)),y.log.debug(f)}}isElementAlreadyPersonalized(t){return t.getAttributeNames().some(n=>n.startsWith(Tt))}autoInjectDefaultRootAttributes(t,n,r,i=!0){const o=[];t.hasAttribute(Le)?y.log.debug(`Element already has root attribute "${Le}"`,t):(y.log.debug(`Adding root attribute "${Le}"="${n}" to element`,t),t.setAttribute(Le,n),o.push(()=>{t.removeAttribute(Le)}));const s={};b(r)&&(s[St]=r);const l=JSON.stringify(s);return i&&(t.hasAttribute(bt)?y.log.debug(`Element already has root attribute "${bt}"`,t):(y.log.debug(`Adding root attribute "${bt}"="${l}" to element`,t),t.setAttribute(bt,l),o.push(()=>{t.removeAttribute(bt)}))),t.hasAttribute(wt)?y.log.debug(`Element already has attribute "${wt}"`,t):(y.log.debug(`Adding attribute "${wt}"="${l}" to element`,t),t.setAttribute(wt,l),o.push(()=>{t.removeAttribute(wt)})),a=>{o.forEach(u=>u==null?void 0:u(a))}}autoInjectDefaultItemAttributes(t,n,r,i=!0){const o=[];D(n)||(t.setAttribute(Le,n),o.push(()=>{t.removeAttribute(Le)}));const s=JSON.stringify(r);if(i){const a=this.assignMaybeOverrideAttribute(t,bt,s);o.push(a)}const l=this.assignMaybeOverrideAttribute(t,wt,s);return o.push(l),a=>{o.forEach(u=>u==null?void 0:u(a))}}assignMaybeOverrideAttribute(t,n,r){return t.hasAttribute(n)?y.log.debug(`Overwriting item attribute "${n}"="${r}" on element`,t):y.log.debug(`Adding item attribute "${n}"="${r}" to element`,t),t.setAttribute(n,r),()=>{t.removeAttribute(n)}}static findValueDefaultForContentId(t){var n,r,i;return(i=(r=(n=t.attributes)==null?void 0:n.eventModifiers)==null?void 0:r[At])==null?void 0:i.valueDefault}static findValueDefaultForObjectId(t){var n,r,i;return(i=(r=(n=t.attributes)==null?void 0:n.eventModifiers)==null?void 0:r[It])==null?void 0:i.valueDefault}buildModifiersIfItemRelated(t,n,r){if(!N(t))return;const i={},o=or.findValueDefaultForContentId(r);if(b(o)){const l=this.getSanitizedContentString(o,t);b(l)&&(i[At]=l)}const s=or.findValueDefaultForObjectId(r);if(b(s)){const l=this.getSanitizedContentString(s,t);b(l)&&(i[It]=l)}if(Object.keys(i).length!==0)return b(n)&&(i[St]=n),i}getHTMLElements(t){const n=document.createElement("div");return n.innerHTML=t,Array.from(n.children)}getPathParentObject(t,n){if(!b(t))return;const r=G({path:`$.${t}`,json:n,wrap:!1,resultType:"parent"});return N(r)?r:void 0}getSanitizedContentString(t,n){const r=G({path:`$${t}`,json:n,wrap:!1});if(D(r))return;const i=String(r),o=or.sanitizer.sanitizeString(i);return y.log.debug(`sanitized data for dataPath ${t}: ${o}`),o}insertAdjacentElement(t,n,r){if(r==="beforeend")t.appendChild(n);else{if(t.parentNode===null)throw new Error("Unable to find parent element");r==="beforebegin"?t.parentNode.insertBefore(n,t):r==="afterbegin"?t.parentNode.insertBefore(n,t.firstChild):r==="afterend"&&t.parentNode.insertBefore(n,t.nextSibling)}}insertAdjacentElements(t,n,r){const i=[];if(n==="beforeend"||n==="afterend"?r.forEach(o=>{try{this.insertAdjacentElement(t,o,n)}catch(s){i.push(K(s).message)}}):(n==="beforebegin"||n==="afterbegin")&&r.reverse().forEach(o=>{try{this.insertAdjacentElement(t,o,n)}catch(s){i.push(K(s).message)}}),i.length>0)throw new Error(`Issues with insertAdjacentElements: ${JSON.stringify(i)}`)}};ra.sanitizer=new fu;let Hr=ra;function kn(e,t,n){var r,i;if(!b(e,!0))throw new M(R.MissingTransformerName,"Transformer Name is required.");if(!N(n))throw new M(R.MissingEngagementConfig,"Engagement Configuration or Destinations are not defined.");const o=n.destinationDefaults;if(o===void 0)throw new M(R.MissingEngagementConfigDefaults,"Engagement Configuration Defaults are not defined.");let s=e!==""?(r=o.byName)==null?void 0:r[e]:void 0;if(b(s)||(s=(i=o.byType)==null?void 0:i[t],b(s)))return s;if(!b(o.global))throw new M(R.MissingEngagementConfigGlobalDefault,"Engagement Configuration Global Default is not defined.");return o.global}function ia(e,t,n,r){if(b(e))return e;try{return kn(t,n,r)}catch(i){return}}const Rc={destinations:{[Ao]:{label:"Product Engagement",description:"Engagement events (e.g. view/click) on this personalization are intended for the stock Product Browse Engagement DMO",disableSendingNonItemEngagementEvents:!0,eventModifiers:{[On]:"catalog",[Nn]:e=>{switch(e.name){case lt:return"catalog-object-view-start";case xe:return"catalog-object-click";default:return}},[Sr]:"Product"}},[Co]:{label:"Website Engagement",description:"Engagement events (e.g. view/click) on this personalization are intended for the stock Website Engagement DMO",eventModifiers:{[On]:"userEngagement",[Nn]:e=>{switch(e.name){case lt:return"personalization-view";case xe:return"personalization-click";default:return}}}}},destinationDefaults:{byType:{HTMLElementModifier:"Other",Handlebars:"Product",AgentScript:"Other"},global:"Other"},attributes:{engagements:{[lt]:{description:'Apply to specific items/recs, and to the entire personalization (to generate an "overall" view/impression, especially relevant for a banner not using recs).',scope:ut.Any,qualify:()=>da(lt),observe:(e,t)=>Hc(e,t),handle:e=>ha(lt,e)},[xe]:{description:"Apply to an element in the personalization, to listen for click events (including bubbled ones), for engagement/attribution.",scope:ut.Element,qualify:()=>da(xe),observe:(e,t)=>Fc(e,t),handle:e=>ha(xe,e)}},eventModifiers:{[At]:{description:"Apply to an Engagement attribute, to specify the personalization content id (which rec in the decision) in the resulting engagement event.",scope:ut.Element,valueType:Dn.SchemaPath,valueDefault:"[personalizationContentId]",modifyEvent:(e,t,n)=>{D(n.personalization)&&(n.personalization={}),n.personalization.contentId=e}},[It]:{description:"Apply to an Engagement attribute, to specify the object id (e.g. product id) in the resulting engagement event.",scope:ut.Element,valueType:Dn.SchemaPath,valueDefault:"[ssot__Id__c]",modifyEvent:(e,t,n)=>{if(t.eventModifiers===void 0)return;const r=t.eventModifiers[St];switch(r){case"Product":n.interaction.id=e;return;case"Other":n.interaction.catalogObjectId=e;return;default:P.log.warn(`Unknown Engagement Destination "${r!=null?r:""}"`)}}},[St]:{description:'Chosen entry from "engagementDestinations", which will modify the resulting engagement event accordingly.',scope:ut.Any,modifyEvent:(e,t,n)=>{const r=ca(e);if(r===void 0){P.log.warn(`Destination name "${e}" not found, cannot be applied to the event.`);return}for(const i in r.eventModifiers){const o=Fr(i);if(o===void 0){P.log.warn(`Modifier name "${i}" unknown, cannot be applied to the event.`);continue}const s=r.eventModifiers[i];let l;if(b(s)?l=s:l=s(t),l===void 0){P.log.warn(`Modifier Name "${i}" resulted in no value and as such is not applied to the event.`);continue}o.modifyEvent(l,t,n)}}},[Nn]:{description:'Defined by chosen entry in "engagementDestinations", for the "interaction name" in the resulting engagement event.',modifyEvent:(e,t,n)=>{D(n.interaction)?n.interaction={name:e}:n.interaction.name=e}},[On]:{description:'Defined by chosen entry in "engagementDestinations", for the "event type" in the resulting engagement event.',modifyEvent:(e,t,n)=>{D(n.interaction)&&(n.interaction={name:""}),n.interaction.eventType=e}},[Sr]:{description:'Defined by chosen entry in "engagementDestinations", for the "type" in the resulting engagement event.',modifyEvent:(e,t,n)=>{D(n.interaction)&&(n.interaction={name:""}),n.interaction.type=e}}}}},oa={destinations:{},destinationDefaults:{global:""}};let Jt=Rc,aa=!0;function Ue(){return Jt!=null?Jt:oa}function Lc(e){e===void 0?Jt=oa:Jt=e,aa=xc(Jt)}function xc(e){var t,n;return!(!N((t=e==null?void 0:e.attributes)==null?void 0:t.engagements)||du.some(r=>{var i;return D((i=e.attributes)==null?void 0:i.engagements[r])})||!N((n=e==null?void 0:e.attributes)==null?void 0:n.eventModifiers)||hu.some(r=>{var i;return D((i=e.attributes)==null?void 0:i.eventModifiers[r])})||!N(e==null?void 0:e.destinations,!1)||Po.some(r=>D(e.destinations[r]))||!N(e==null?void 0:e.destinationDefaults)||!Po.includes(e.destinationDefaults.global))}function sa(){return aa}function la(){const e=Ue();if(e===void 0||e.destinations===void 0||Object.keys(e.destinations).length===0){P.log.warn("Engagement Configuration does not have any Config for Destinations");return}return e}function ua(){const e=la();return e===void 0?[]:Object.keys(e.destinations)}function ca(e){if(!b(e)){P.log.warn("A valid destination string must be provided in order to find its Engagement Destination configuration");return}const t=la();if(t!==void 0){if(!(e in t.destinations)){P.log.warn(`Engagement Configuration does not Config for Destination "${e}"`);return}return t.destinations[e]}}function fa(e){if(!b(e)){P.log.warn("A valid attribute name string must be provided in order to find its Engagement Attribute configuration");return}const t=Ue();if(t===void 0||t.attributes===void 0){P.log.warn("Engagement Configuration does not have any Config for Attributes");return}if(!(e in t.attributes.engagements)){P.log.warn(`Engagement Configuration does not Config for Attribute "${e}"`);return}return t.attributes.engagements[e]}function Fr(e){if(!b(e)){P.log.warn("A valid modifier name string must be provided in order to find its Engagement Modifier configuration");return}const t=Ue();if(t===void 0||t.attributes===void 0){P.log.warn("Engagement Configuration does not have any Config for Attributes");return}if(!(e in t.attributes.eventModifiers)){P.log.warn(`Engagement Configuration does not have Config for Event Modifier "${e}"`);return}return t.attributes.eventModifiers[e]}function da(e){const t=fa(e);if(t===void 0)return;const n=`${Tt}${e}`,r=Qi(n),i=Array.of(...document.querySelectorAll(r));for(const s of i)t.observe(s,t);const o=new MutationObserver(s=>{if(document===void 0){o.disconnect();return}s.forEach(l=>{switch(l.type){case"attributes":kc(l,n,t);break;case"childList":Uc(l,n,t);break;default:P.log.error(`Unsupported mutation type: ${l.type}`)}})});o.observe(document,{attributes:!0,attributeFilter:[n],attributeOldValue:!1,childList:!0,subtree:!0}),document.addEventListener(P.CustomEvents.OnShutDown,()=>{o.disconnect()})}function kc(e,t,n){if(!(e.target instanceof Element)||t!==e.attributeName)return;const r=e.target.getAttribute(t);b(r)&&n.observe(e.target,n)}function Uc(e,t,n){if(!(e.target instanceof Element))return;const r=Array.from(e.addedNodes).filter(o=>o instanceof Element);if(r.length===0)return;const i=Qi(t);r.forEach(o=>{o.hasAttribute(t)&&n.observe(o,n),o.querySelectorAll(i).forEach(s=>{n.observe(s,n)})})}let Pt=new WeakMap;function Hc(e,t){if(Pt.has(e)){P.log.debug("Already observing element for visibility",e);return}P.log.debug("Observing element for visibility",e);const n=Ol.pageElementVisible(e);Pt.set(e,n),n.then(r=>{if(Pt.get(r)!==n){P.log.debug("Element now visible, but aborting, no longer current observer",r);return}P.log.debug("Element now visible, calling handle",r),t.handle(r)}).catch(r=>{P.log.warn("Failed to observe element for visibility",e,r)}).finally(()=>{if(Pt.get(e)!==n){P.log.debug("Observing element for visibility completed, was no longer current observer",e);return}P.log.debug("Observing element for visibility completed",e),Pt.delete(e)})}let Un=new WeakMap;function Fc(e,t){if(Un.has(e)){P.log.debug("Already observing element for click",e);return}P.log.debug("Observing element for click",e);const n=r=>{r.target instanceof Element?e.contains(r.target)?Un.get(e)!==n?(P.log.debug("Click within element, but aborting, no longer current observer",r.target,e),e.removeEventListener(xe,n)):(P.log.debug("Click within element, calling handle",r.target,e),t.handle(e)):P.log.warn("Click event target is not contained by expected element",r.target,e):P.log.warn("Click event target is not an element",r.target,e)};Un.set(e,n),e.addEventListener(xe,n),document.addEventListener(P.CustomEvents.OnShutDown,()=>{e.removeEventListener(xe,n)})}function zc(){Pt=new WeakMap,Un=new WeakMap}function ha(e,t){const n=Vc(e,t);if(D(n))return;const r=Bc(n);D(r)||P.sendEvent(r).catch(i=>{P.log.error(`Failed to send personalization engagement event ${JSON.stringify(r)}`,i)})}function Vc(e,t){var n,r;const i=(n=t.closest(`[${Le}]`))==null?void 0:n.getAttribute(Le);if(!b(i))return P.log.warn(`${Le} not found in DOM hierarchy for element`,t),null;if(fa(e)===void 0)return P.log.warn(`No engagement attribute definition found for ${e}`),null;const o=`${Tt}${e}`;if(!t.hasAttribute(o))return P.log.warn(`Engagement attribute ${e} not found on element`,t),null;const s={},l=o.substring(5),a=(r=P.cashDom(t).attr(o))!=null?r:"",u=P.cashDom(t).data(l);P.log.debug(`Found ${e} with modifiers ${a}`,t),N(u,!1)?Object.keys(u).forEach(p=>{if(!b(p)){P.log.warn(`Ignoring empty/non-string modifier key within: ${a}`);return}const c=Fr(p);if(D(c)){P.log.warn(`Ignoring unknown modifier: ${p}`);return}const h=u[p];if(!b(h)){P.log.warn(`The value for event modifier "${p}" for engagement attribute of "${e}" is not a string and thus can't be used`);return}s[p]=h}):a.trim().length>0&&P.log.warn(`The value for engagement attribute ${e} was not valid JSON, so cannot process modifiers.`);const f={name:e,element:t,eventModifiers:s,personalizationId:i};return Go(i)&&(f.isPreview=!0),f}function Bc(e){var t,n,r;if(D(e))return null;const i={interaction:{name:""},personalization:{id:e.personalizationId}};et(e.isPreview)&&e.isPreview&&(i.personalization.isTesting=!0);for(const l in e.eventModifiers){const a=Fr(l);if(D(a)){P.log.warn(`Ignoring unknown modifier: ${l}`);break}const u=e.eventModifiers[l];if(!b(u)){P.log.warn(`The value for event modifier "${l}" for engagement attribute of "${e.name}" is not a string and thus can't be used`);break}try{a.modifyEvent(u,e,i)}catch(f){P.log.error(`Could not set the value for event modifier "${l}" for engagement attribute of "${e.name}"`,f)}}b((t=i.interaction)==null?void 0:t.name)||P.log.warn("Resulting engagement event has no/empty interaction.name, is likely misconfigured, and will likely be suppressed from sending");const o=(n=e.eventModifiers)==null?void 0:n[St],s=b(o)?ca(o):void 0;return(s==null?void 0:s.disableSendingNonItemEngagementEvents)===!0&&!b((r=i.personalization)==null?void 0:r.contentId)?(P.log.debug(`Not sending event due to disableSendingNonItemEngagementEvents and no contentId string: ${JSON.stringify(i)}`),null):i}function Gc(e){if(!N(e))throw new Y(q.DestinationEventModifiersAreRequired,"Engagement destination event modifiers are required.");Object.entries(e).forEach(([t,n])=>{if(!b(n)&&typeof n!="function")throw new Y(q.InvalidDestinationEventModifier,"Engagement destinations event modifier must be a function or a valid string.")})}function jc(e){if(!N(e)||Object.keys(e).length===0)throw new Y(q.EngagementDestinationsAreRequired,"Engagement destinations are required.");Object.entries(e).forEach(([t,n])=>{if(n.description!==void 0&&!b(n.description))throw new Y(q.InvalidEngagementDestinationDescription,"Engagement destination description must be a string if provided.");Gc(n.eventModifiers)})}function Wc(e){if(!N(e))throw new Y(q.EngagementDestinationDefaultsAreRequired,"Engagement destination defaults are required.");if(e.byName!==void 0){if(!N(e.byName))throw new Y(q.InvalidEngagementDestinationDefaultByName,"Engagement destination defaults by name must be an object if provided.");Object.entries(e.byName).forEach(([,t])=>{if(!b(t))throw new Y(q.InvalidEngagementDestinationDefaultByNameValue,"Engagement destination by name must have a valid string value.")})}if(e.byType!==void 0){if(!N(e.byType))throw new Y(q.InvalidEngagementDestinationDefaultByType,"Engagement destination defaults by type must be an object if provided.");Object.entries(e.byType).forEach(([,t])=>{if(!b(t))throw new Y(q.InvalidEngagementDestinationDefaultByTypeValue,"Engagement destination by type must have a valid string value.")})}if(!b(e.global))throw new Y(q.InvalidEngagementDestinationDefaultGlobal,"Engagement destination global default must be valid string value.")}function pa(e,t){var n;if(e.description!==void 0&&!b(e.description))throw new Y(q.InvalidEngagementDestinationAttributeDescription,"Engagement destination attribute description must be a valid string if provided.",{context:{type:t}});if(e.scope!==void 0&&!((n=Object.values(ut))!=null&&n.includes(e.scope)))throw new Y(q.InvalidEngagementDestinationAttributeScope,"Engagement destination attribute scope should be a valid Engagement Attribute Scope if provided.",{context:{type:t,scope:e.scope}})}function qc(e){if(!N(e))throw new Y(q.InvalidEngagementDestinationAttributeEngagements,"Engagement destination attribute engagements must be a valid object.");Object.entries(e).forEach(([,t])=>{if(!N(t))throw new Y(q.InvalidEngagementDestinationAttributeEngagementValue,"Engagement destination attribute engagements value must be a valid object.");if(pa(t,"engagements"),t.qualify===void 0)throw new Y(q.MissingEngagementDestinationAttributeEngagementQualify,"Engagement destination attribute engagements must define a qualify function.");if(typeof t.qualify!="function")throw new Y(q.InvalidEngagementDestinationAttributeEngagementQualify,"Engagement destination attribute engagements qualify must be a function.");if(t.observe===void 0)throw new Y(q.MissingEngagementDestinationAttributeEngagementObserve,"Engagement destination attribute engagements must define an observe function.");if(typeof t.observe!="function")throw new Y(q.InvalidEngagementDestinationAttributeEngagementObserve,"Engagement destination attribute engagements observe must be a function.");if(t.handle===void 0)throw new Y(q.MissingEngagementDestinationAttributeEngagementHandle,"Engagement destination attribute engagements must define a handle function.");if(typeof t.handle!="function")throw new Y(q.InvalidEngagementDestinationAttributeEngagementHandle,"Engagement destination attribute engagements handle must be a function.")})}function $c(e){if(!N(e))throw new Y(q.InvalidEngagementDestinationAttributeEventModifiers,"Engagement destination attribute event modifiers must be a valid object.");Object.entries(e).forEach(([,t])=>{var n;if(!N(t))throw new Y(q.InvalidEngagementDestinationAttributeEventModifiersValue,"Engagement destination attribute event modifiers value must be a valid object.");if(pa(t,"eventModifiers"),t.modifyEvent===void 0)throw new Y(q.MissingEngagementDestinationAttributeEventModifierModifyEvent,"Engagement destination attribute event modifiers must define a modifyEvent function.");if(typeof t.modifyEvent!="function")throw new Y(q.InvalidEngagementDestinationAttributeEventModifierModifyEvent,"Engagement destination attribute event modifiers modifyEvent must be a function.");if(t.valueType!==void 0&&!((n=Object.values(Dn))!=null&&n.includes(t.valueType)))throw new Y(q.InvalidEngagementDestinationAttributeEventModifierValueType,"Engagement destination attribute event modifiers value type should be a valid Engagement Attribute Value Type if provided.",{context:{valueType:t.valueType}});if(t.valueDefault!==void 0&&!b(t.valueDefault,!1,!0))throw new Y(q.InvalidEngagementDestinationAttributeEventModifierValueDefault,"Engagement destination attribute event modifiers value default should be a valid non-empty string if provided.")})}function Yc(e){if(!N(e))throw new Y(q.InvalidEngagementDestinationAttributes,"Engagement destination attributes must be a valid object if provided.");qc(e.engagements),$c(e.eventModifiers)}function ga(e){if(!N(e))throw new Y(q.InvalidConfig,"Config is required.");jc(e.destinations),Wc(e.destinationDefaults),e.attributes!==void 0&&Yc(e.attributes)}function ma(e){if(Ge()){if(!N(e,!1)){P.log.error("A config is required when setting Engagement Config.");return}try{ga(e),Lc(e),P.log.info("Set Engagement Config to the following: ",e)}catch(t){P.log.error(`Engagement Config could not be set due to: ${K(t).message}`)}}else P.log.error("Engagement Config can only be set before SalesforceInteractions.init is called.")}var zr=(e,t,n)=>new Promise((r,i)=>{var o=a=>{try{l(n.next(a))}catch(u){i(u)}},s=a=>{try{l(n.throw(a))}catch(u){i(u)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,s);l((n=n.apply(e,t)).next())});class Zc extends Hr{validateMethod(t){if(t!==void 0&&t!==$.ReplaceElementContent)throw new M(R.TransformationConfigMethodNotSupported,"Transformation Config method not supported for the specific type of transformer.",{context:{transformerType:ge.HtmlElementModifier,provided:t,required:$.ReplaceElementContent}})}validateSubstitutionValues(t){if(t===void 0||Object.entries(t).length===0)throw new M(R.MissingTransformationSubstitutionValues,"Transformation substitution values are required for the specific type of transformer.",{context:{transformerType:ge.HtmlElementModifier}})}transform(t,n,r,i,o){const s=o.pec.name,l=i.personalizationId,a=n.transformerName,u=`pec ${s} transformer ${a} for personalization ${l}`;if(n.substitutionValues===void 0){const p=new ie(fe.MissingSubstitutions,`missing substitutionValues for transformation so cannot get the data from Personalization response, ${u}`);return y.log.warn(p.message),o.status.update(new k(p)),{promise:Promise.reject(p),revert:c=>zr(this,null,function*(){c.update(new k(`Nothing to revert, no transformation attempt, ${p.message}`)),yield Promise.resolve()})}}if(Object.entries(n.substitutionValues).length===0){const p=new ie(fe.MissingSubstitutions,"missing an entry in substitutionValues for transformation so cannot get the data from Personalization response");return y.log.warn(p.message),o.status.update(new k(p)),{promise:Promise.reject(p),revert:c=>zr(this,null,function*(){c.update(new k(`Nothing to revert, no transformation attempt, ${p.message}`)),yield Promise.resolve()})}}o.status.update(new k(`Awaiting element/conditions ${u}`));const f=r.then(p=>{if(this.isElementAlreadyPersonalized(p)){y.log.error("Aborting personalization, element is already personalized",p);const I=new ie(fe.AlreadyPersonalized,`Aborting ${u}, element is already personalized`);throw o.status.update(new k(I)),I}if(ta(l,o,n),!D(o.revertStatus)){const I=`Aborting ${u}, revert has been called`;return y.log.info(I),o.status.update(new k(I)),m=>{m.update(new k(`Nothing to revert, since revert was requested before transformation, ${u}`))}}o.status.update(new k(`About to transform/render, element/conditions ready ${u}`));const c=p.outerHTML;let h,d;const g=Ue(),E=ia(o.pec.transformationConfig.engagementDestination,t.name,t.transformerType,g),w=sa();for(const I in n.substitutionValues){const m=n.substitutionValues[I];if(!b(m)){const O=`substitutionValues is missing a value for property "${I}" for transformation so cannot get the data from Personalization response`;y.log.warn(O),o.status.update(new k(O));continue}if(y.log.debug(`using dataPath ${m} to get data from personalization response`),w){const O=this.getPathParentObject(m,i),A=this.buildModifiersIfItemRelated(O,E,g);D(A)||(D(d)?(y.log.debug(`Using item-related modifiers ${JSON.stringify(A)} found adjacent to path "${m}"`),h=m,d=A):(A[At]!==d[At]||A[It]!==d[It])&&y.log.warn(`Ignoring different item-related modifiers ${JSON.stringify(A)} found adjacent to path "${m}", already using modifiers from path "${h}"`))}const T=this.isAttributeAssignment(I);if(T!==void 0)try{const O=this.getSanitizedContentString(m,i);if(b(O))if(T){this.setAttributeContent(p,I,O);const A=`Set attribute ${I} to ${O}, ${u}`;y.log.trace(A+", element:",p),o.status.update(new k(A))}else{this.setProperty(p,I,O);const A=`Set property ${I} to ${O}, ${u}`;y.log.trace(A+", element:",p),o.status.update(new k(A))}else{const A=`Could not set property ${I}, nothing found at path ${m}`;y.log.debug(A+", element:",p),o.status.update(new k(A))}}catch(O){const A=`Could not set content for ${u}, subVal "${I}"`;y.log.error(A,O);const U=new Error(A+": "+K(O).message);o.status.update(new k(U))}}let _;return w?(D(d)?(this.autoInjectDefaultRootAttributes(p,l,E,!0),_="Auto-injected engagement attributes without item ids"):(this.autoInjectDefaultItemAttributes(p,l,d,!0),_="Auto-injected engagement attributes with item ids"),y.log.trace(_+`, ${u}`)):(_="Engagement Config does not support auto-injection of default engagement attributes",y.log.trace(_)),o.status.update(new k(_)),I=>{let m=`Reverting ${u}`;y.log.debug(m,p),I.update(new k(m)),p.insertAdjacentHTML("beforebegin",c),p.remove(),m=`Reverted ${u}`,y.log.debug(m,p),I.update(new k(m))}});return{promise:f.then(),revert:p=>zr(this,null,function*(){p.update(new k("Awaiting transformPromise"));const c=f.then(h=>{h(p)},h=>{if(h instanceof ie){p.update(new k(`Nothing to revert, no transformation attempt, ${u}`));return}throw h});c.catch(h=>{const d=new Error(`Issue reverting ${u}: `+K(h).message);y.log.error(d),p.update(new k(d))}),yield c})}}isAttributeAssignment(t){const n=t.split(".");if(n[0].toLowerCase()==="attributes"){if(n.length===2)return!0;y.log.warn(`multiple objects for 'attributes' with propertyName '${t}' is not supported`);return}return!1}getAttributeContent(t,n){const r=n.split(".");return t.getAttribute(r[1])}removeAttribute(t,n){const r=n.split(".");t.removeAttribute(r[1])}setAttributeContent(t,n,r){const i=n.split(".");t.setAttribute(i[1],r)}setProperty(t,n,r){r=this.handleSpecialValues(n,r);const i=n.split(".");i.length>1?this.setProperty(t[i[0]],i[1],r):Object.assign(t,{[n]:r})}getProperty(t,n){const r=n.split(".");return r.length>1?this.getProperty(t[r[0]],r[1]):t[n]}handleSpecialValues(t,n){if(t.toLowerCase()==="style.backgroundimage"&&b(n))try{return`url(${encodeURI(n)})`}catch(r){y.log.warn(`Could not set style.backgroundImage to a URL "${n}" due to: `,r)}return n}}function Kc(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Vr={exports:{}},Br={exports:{}},we={},X={};X.__esModule=!0,X.extend=va,X.indexOf=tf,X.escapeExpression=nf,X.isEmpty=rf,X.createFrame=of,X.blockParams=af,X.appendContextPath=sf;var Xc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},Qc=/[&<>"'`=]/g,Jc=/[&<>"'`=]/;function ef(e){return Xc[e]}function va(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e}var Gr=Object.prototype.toString;X.toString=Gr;var jr=function(t){return typeof t=="function"};jr(/x/)&&(X.isFunction=jr=function(e){return typeof e=="function"&&Gr.call(e)==="[object Function]"}),X.isFunction=jr;var Ea=Array.isArray||function(e){return e&&typeof e=="object"?Gr.call(e)==="[object Array]":!1};X.isArray=Ea;function tf(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function nf(e){if(typeof e!="string"){if(e&&e.toHTML)return e.toHTML();if(e==null)return"";if(!e)return e+"";e=""+e}return Jc.test(e)?e.replace(Qc,ef):e}function rf(e){return!e&&e!==0?!0:!!(Ea(e)&&e.length===0)}function of(e){var t=va({},e);return t._parent=e,t}function af(e,t){return e.path=t,e}function sf(e,t){return(e?e+".":"")+t}var Wr={exports:{}};(function(e,t){t.__esModule=!0;var n=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function r(i,o){var s=o&&o.loc,l=void 0,a=void 0,u=void 0,f=void 0;s&&(l=s.start.line,a=s.end.line,u=s.start.column,f=s.end.column,i+=" - "+l+":"+u);for(var p=Error.prototype.constructor.call(this,i),c=0;c<n.length;c++)this[n[c]]=p[n[c]];Error.captureStackTrace&&Error.captureStackTrace(this,r);try{s&&(this.lineNumber=l,this.endLineNumber=a,Object.defineProperty?(Object.defineProperty(this,"column",{value:u,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:f,enumerable:!0})):(this.column=u,this.endColumn=f))}catch(h){}}r.prototype=new Error,t.default=r,e.exports=t.default})(Wr,Wr.exports);var Ne=Wr.exports,en={},qr={exports:{}};(function(e,t){t.__esModule=!0;var n=X;t.default=function(r){r.registerHelper("blockHelperMissing",function(i,o){var s=o.inverse,l=o.fn;if(i===!0)return l(this);if(i===!1||i==null)return s(this);if(n.isArray(i))return i.length>0?(o.ids&&(o.ids=[o.name]),r.helpers.each(i,o)):s(this);if(o.data&&o.ids){var a=n.createFrame(o.data);a.contextPath=n.appendContextPath(o.data.contextPath,o.name),o={data:a}}return l(i,o)})},e.exports=t.default})(qr,qr.exports);var lf=qr.exports,$r={exports:{}};(function(e,t){t.__esModule=!0;function n(s){return s&&s.__esModule?s:{default:s}}var r=X,i=Ne,o=n(i);t.default=function(s){s.registerHelper("each",function(l,a){if(!a)throw new o.default("Must pass iterator to #each");var u=a.fn,f=a.inverse,p=0,c="",h=void 0,d=void 0;a.data&&a.ids&&(d=r.appendContextPath(a.data.contextPath,a.ids[0])+"."),r.isFunction(l)&&(l=l.call(this)),a.data&&(h=r.createFrame(a.data));function g(m,T,O){h&&(h.key=m,h.index=T,h.first=T===0,h.last=!!O,d&&(h.contextPath=d+m)),c=c+u(l[m],{data:h,blockParams:r.blockParams([l[m],m],[d+m,null])})}if(l&&typeof l=="object")if(r.isArray(l))for(var E=l.length;p<E;p++)p in l&&g(p,p,p===l.length-1);else if(typeof Symbol=="function"&&l[Symbol.iterator]){for(var w=[],_=l[Symbol.iterator](),I=_.next();!I.done;I=_.next())w.push(I.value);l=w;for(var E=l.length;p<E;p++)g(p,p,p===l.length-1)}else(function(){var m=void 0;Object.keys(l).forEach(function(T){m!==void 0&&g(m,p-1),m=T,p++}),m!==void 0&&g(m,p-1,!0)})();return p===0&&(c=f(this)),c})},e.exports=t.default})($r,$r.exports);var uf=$r.exports,Yr={exports:{}};(function(e,t){t.__esModule=!0;function n(o){return o&&o.__esModule?o:{default:o}}var r=Ne,i=n(r);t.default=function(o){o.registerHelper("helperMissing",function(){if(arguments.length!==1)throw new i.default('Missing helper: "'+arguments[arguments.length-1].name+'"')})},e.exports=t.default})(Yr,Yr.exports);var cf=Yr.exports,Zr={exports:{}};(function(e,t){t.__esModule=!0;function n(s){return s&&s.__esModule?s:{default:s}}var r=X,i=Ne,o=n(i);t.default=function(s){s.registerHelper("if",function(l,a){if(arguments.length!=2)throw new o.default("#if requires exactly one argument");return r.isFunction(l)&&(l=l.call(this)),!a.hash.includeZero&&!l||r.isEmpty(l)?a.inverse(this):a.fn(this)}),s.registerHelper("unless",function(l,a){if(arguments.length!=2)throw new o.default("#unless requires exactly one argument");return s.helpers.if.call(this,l,{fn:a.inverse,inverse:a.fn,hash:a.hash})})},e.exports=t.default})(Zr,Zr.exports);var ff=Zr.exports,Kr={exports:{}};(function(e,t){t.__esModule=!0,t.default=function(n){n.registerHelper("log",function(){for(var r=[void 0],i=arguments[arguments.length-1],o=0;o<arguments.length-1;o++)r.push(arguments[o]);var s=1;i.hash.level!=null?s=i.hash.level:i.data&&i.data.level!=null&&(s=i.data.level),r[0]=s,n.log.apply(n,r)})},e.exports=t.default})(Kr,Kr.exports);var df=Kr.exports,Xr={exports:{}};(function(e,t){t.__esModule=!0,t.default=function(n){n.registerHelper("lookup",function(r,i,o){return r&&o.lookupProperty(r,i)})},e.exports=t.default})(Xr,Xr.exports);var hf=Xr.exports,Qr={exports:{}};(function(e,t){t.__esModule=!0;function n(s){return s&&s.__esModule?s:{default:s}}var r=X,i=Ne,o=n(i);t.default=function(s){s.registerHelper("with",function(l,a){if(arguments.length!=2)throw new o.default("#with requires exactly one argument");r.isFunction(l)&&(l=l.call(this));var u=a.fn;if(r.isEmpty(l))return a.inverse(this);var f=a.data;return a.data&&a.ids&&(f=r.createFrame(a.data),f.contextPath=r.appendContextPath(a.data.contextPath,a.ids[0])),u(l,{data:f,blockParams:r.blockParams([l],[f&&f.contextPath])})})},e.exports=t.default})(Qr,Qr.exports);var pf=Qr.exports;en.__esModule=!0,en.registerDefaultHelpers=Nf,en.moveHelperToHooks=Of;function ft(e){return e&&e.__esModule?e:{default:e}}var gf=lf,mf=ft(gf),vf=uf,Ef=ft(vf),yf=cf,_f=ft(yf),Tf=ff,bf=ft(Tf),wf=df,Sf=ft(wf),If=hf,Af=ft(If),Cf=pf,Pf=ft(Cf);function Nf(e){mf.default(e),Ef.default(e),_f.default(e),bf.default(e),Sf.default(e),Af.default(e),Pf.default(e)}function Of(e,t,n){e.helpers[t]&&(e.hooks[t]=e.helpers[t],n||delete e.helpers[t])}var Jr={},ei={exports:{}};(function(e,t){t.__esModule=!0;var n=X;t.default=function(r){r.registerDecorator("inline",function(i,o,s,l){var a=i;return o.partials||(o.partials={},a=function(u,f){var p=s.partials;s.partials=n.extend({},p,o.partials);var c=i(u,f);return s.partials=p,c}),o.partials[l.args[0]]=l.fn,a})},e.exports=t.default})(ei,ei.exports);var Df=ei.exports;Jr.__esModule=!0,Jr.registerDefaultDecorators=xf;function Mf(e){return e&&e.__esModule?e:{default:e}}var Rf=Df,Lf=Mf(Rf);function xf(e){Lf.default(e)}var ti={exports:{}};(function(e,t){t.__esModule=!0;var n=X,r={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(o){if(typeof o=="string"){var s=n.indexOf(r.methodMap,o.toLowerCase());s>=0?o=s:o=parseInt(o,10)}return o},log:function(o){if(o=r.lookupLevel(o),typeof console!="undefined"&&r.lookupLevel(r.level)<=o){var s=r.methodMap[o];console[s]||(s="log");for(var l=arguments.length,a=Array(l>1?l-1:0),u=1;u<l;u++)a[u-1]=arguments[u];console[s].apply(console,a)}}};t.default=r,e.exports=t.default})(ti,ti.exports);var ya=ti.exports,Nt={},ni={};ni.__esModule=!0,ni.createNewLookupObject=Uf;var kf=X;function Uf(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return kf.extend.apply(void 0,[Object.create(null)].concat(t))}Nt.__esModule=!0,Nt.createProtoAccessControl=Vf,Nt.resultIsAllowed=Bf,Nt.resetLoggedProperties=jf;function Hf(e){return e&&e.__esModule?e:{default:e}}var _a=ni,Ff=ya,zf=Hf(Ff),Hn=Object.create(null);function Vf(e){var t=Object.create(null);t.constructor=!1,t.__defineGetter__=!1,t.__defineSetter__=!1,t.__lookupGetter__=!1;var n=Object.create(null);return n.__proto__=!1,{properties:{whitelist:_a.createNewLookupObject(n,e.allowedProtoProperties),defaultValue:e.allowProtoPropertiesByDefault},methods:{whitelist:_a.createNewLookupObject(t,e.allowedProtoMethods),defaultValue:e.allowProtoMethodsByDefault}}}function Bf(e,t,n){return Ta(typeof e=="function"?t.methods:t.properties,n)}function Ta(e,t){return e.whitelist[t]!==void 0?e.whitelist[t]===!0:e.defaultValue!==void 0?e.defaultValue:(Gf(t),!1)}function Gf(e){Hn[e]!==!0&&(Hn[e]=!0,zf.default.log("error",'Handlebars: Access has been denied to resolve the property "'+e+`" because it is not an "own property" of its parent.
You can add a runtime option to disable the check or this warning:
See https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details`))}function jf(){Object.keys(Hn).forEach(function(e){delete Hn[e]})}we.__esModule=!0,we.HandlebarsEnvironment=oi;function ba(e){return e&&e.__esModule?e:{default:e}}var dt=X,Wf=Ne,ri=ba(Wf),qf=en,$f=Jr,Yf=ya,Fn=ba(Yf),Zf=Nt,Kf="4.7.8";we.VERSION=Kf;var Xf=8;we.COMPILER_REVISION=Xf;var Qf=7;we.LAST_COMPATIBLE_COMPILER_REVISION=Qf;var Jf={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};we.REVISION_CHANGES=Jf;var ii="[object Object]";function oi(e,t,n){this.helpers=e||{},this.partials=t||{},this.decorators=n||{},qf.registerDefaultHelpers(this),$f.registerDefaultDecorators(this)}oi.prototype={constructor:oi,logger:Fn.default,log:Fn.default.log,registerHelper:function(t,n){if(dt.toString.call(t)===ii){if(n)throw new ri.default("Arg not supported with multiple helpers");dt.extend(this.helpers,t)}else this.helpers[t]=n},unregisterHelper:function(t){delete this.helpers[t]},registerPartial:function(t,n){if(dt.toString.call(t)===ii)dt.extend(this.partials,t);else{if(typeof n=="undefined")throw new ri.default('Attempting to register a partial called "'+t+'" as undefined');this.partials[t]=n}},unregisterPartial:function(t){delete this.partials[t]},registerDecorator:function(t,n){if(dt.toString.call(t)===ii){if(n)throw new ri.default("Arg not supported with multiple decorators");dt.extend(this.decorators,t)}else this.decorators[t]=n},unregisterDecorator:function(t){delete this.decorators[t]},resetLoggedPropertyAccesses:function(){Zf.resetLoggedProperties()}};var ed=Fn.default.log;we.log=ed,we.createFrame=dt.createFrame,we.logger=Fn.default;var ai={exports:{}};(function(e,t){t.__esModule=!0;function n(r){this.string=r}n.prototype.toString=n.prototype.toHTML=function(){return""+this.string},t.default=n,e.exports=t.default})(ai,ai.exports);var td=ai.exports,ot={},si={};si.__esModule=!0,si.wrapHelper=nd;function nd(e,t){if(typeof e!="function")return e;var n=function(){var i=arguments[arguments.length-1];return arguments[arguments.length-1]=t(i),e.apply(this,arguments)};return n}ot.__esModule=!0,ot.checkRevision=ld,ot.template=ud,ot.wrapProgram=zn,ot.resolvePartial=cd,ot.invokePartial=fd,ot.noop=Ia;function rd(e){return e&&e.__esModule?e:{default:e}}function id(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}var od=X,$e=id(od),ad=Ne,Ye=rd(ad),Ze=we,wa=en,sd=si,Sa=Nt;function ld(e){var t=e&&e[0]||1,n=Ze.COMPILER_REVISION;if(!(t>=Ze.LAST_COMPATIBLE_COMPILER_REVISION&&t<=Ze.COMPILER_REVISION))if(t<Ze.LAST_COMPATIBLE_COMPILER_REVISION){var r=Ze.REVISION_CHANGES[n],i=Ze.REVISION_CHANGES[t];throw new Ye.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+r+") or downgrade your runtime to an older version ("+i+").")}else throw new Ye.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}function ud(e,t){if(!t)throw new Ye.default("No environment passed to template");if(!e||!e.main)throw new Ye.default("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);var n=e.compiler&&e.compiler[0]===7;function r(s,l,a){a.hash&&(l=$e.extend({},l,a.hash),a.ids&&(a.ids[0]=!0)),s=t.VM.resolvePartial.call(this,s,l,a);var u=$e.extend({},a,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),f=t.VM.invokePartial.call(this,s,l,u);if(f==null&&t.compile&&(a.partials[a.name]=t.compile(s,e.compilerOptions,t),f=a.partials[a.name](l,u)),f!=null){if(a.indent){for(var p=f.split(`
`),c=0,h=p.length;c<h&&!(!p[c]&&c+1===h);c++)p[c]=a.indent+p[c];f=p.join(`
`)}return f}else throw new Ye.default("The partial "+a.name+" could not be compiled when running in runtime-only mode")}var i={strict:function(l,a,u){if(!l||!(a in l))throw new Ye.default('"'+a+'" not defined in '+l,{loc:u});return i.lookupProperty(l,a)},lookupProperty:function(l,a){var u=l[a];if(u==null||Object.prototype.hasOwnProperty.call(l,a)||Sa.resultIsAllowed(u,i.protoAccessControl,a))return u},lookup:function(l,a){for(var u=l.length,f=0;f<u;f++){var p=l[f]&&i.lookupProperty(l[f],a);if(p!=null)return l[f][a]}},lambda:function(l,a){return typeof l=="function"?l.call(a):l},escapeExpression:$e.escapeExpression,invokePartial:r,fn:function(l){var a=e[l];return a.decorator=e[l+"_d"],a},programs:[],program:function(l,a,u,f,p){var c=this.programs[l],h=this.fn(l);return a||p||f||u?c=zn(this,l,h,a,u,f,p):c||(c=this.programs[l]=zn(this,l,h)),c},data:function(l,a){for(;l&&a--;)l=l._parent;return l},mergeIfNeeded:function(l,a){var u=l||a;return l&&a&&l!==a&&(u=$e.extend({},a,l)),u},nullContext:Object.seal({}),noop:t.VM.noop,compilerInfo:e.compiler};function o(s){var l=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],a=l.data;o._setup(l),!l.partial&&e.useData&&(a=dd(s,a));var u=void 0,f=e.useBlockParams?[]:void 0;e.useDepths&&(l.depths?u=s!=l.depths[0]?[s].concat(l.depths):l.depths:u=[s]);function p(c){return""+e.main(i,c,i.helpers,i.partials,a,f,u)}return p=Aa(e.main,p,i,l.depths||[],a,f),p(s,l)}return o.isTop=!0,o._setup=function(s){if(s.partial)i.protoAccessControl=s.protoAccessControl,i.helpers=s.helpers,i.partials=s.partials,i.decorators=s.decorators,i.hooks=s.hooks;else{var l=$e.extend({},t.helpers,s.helpers);hd(l,i),i.helpers=l,e.usePartial&&(i.partials=i.mergeIfNeeded(s.partials,t.partials)),(e.usePartial||e.useDecorators)&&(i.decorators=$e.extend({},t.decorators,s.decorators)),i.hooks={},i.protoAccessControl=Sa.createProtoAccessControl(s);var a=s.allowCallsToHelperMissing||n;wa.moveHelperToHooks(i,"helperMissing",a),wa.moveHelperToHooks(i,"blockHelperMissing",a)}},o._child=function(s,l,a,u){if(e.useBlockParams&&!a)throw new Ye.default("must pass block params");if(e.useDepths&&!u)throw new Ye.default("must pass parent depths");return zn(i,s,e[s],l,0,a,u)},o}function zn(e,t,n,r,i,o,s){function l(a){var u=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],f=s;return s&&a!=s[0]&&!(a===e.nullContext&&s[0]===null)&&(f=[a].concat(s)),n(e,a,e.helpers,e.partials,u.data||r,o&&[u.blockParams].concat(o),f)}return l=Aa(n,l,e,s,r,o),l.program=t,l.depth=s?s.length:0,l.blockParams=i||0,l}function cd(e,t,n){return e?!e.call&&!n.name&&(n.name=e,e=n.partials[e]):n.name==="@partial-block"?e=n.data["partial-block"]:e=n.partials[n.name],e}function fd(e,t,n){var r=n.data&&n.data["partial-block"];n.partial=!0,n.ids&&(n.data.contextPath=n.ids[0]||n.data.contextPath);var i=void 0;if(n.fn&&n.fn!==Ia&&function(){n.data=Ze.createFrame(n.data);var o=n.fn;i=n.data["partial-block"]=function(l){var a=arguments.length<=1||arguments[1]===void 0?{}:arguments[1];return a.data=Ze.createFrame(a.data),a.data["partial-block"]=r,o(l,a)},o.partials&&(n.partials=$e.extend({},n.partials,o.partials))}(),e===void 0&&i&&(e=i),e===void 0)throw new Ye.default("The partial "+n.name+" could not be found");if(e instanceof Function)return e(t,n)}function Ia(){return""}function dd(e,t){return(!t||!("root"in t))&&(t=t?Ze.createFrame(t):{},t.root=e),t}function Aa(e,t,n,r,i,o){if(e.decorator){var s={};t=e.decorator(t,s,n,r&&r[0],i,o,r),$e.extend(t,s)}return t}function hd(e,t){Object.keys(e).forEach(function(n){var r=e[n];e[n]=pd(r,t)})}function pd(e,t){var n=t.lookupProperty;return sd.wrapHelper(e,function(r){return $e.extend({lookupProperty:n},r)})}var li={exports:{}};(function(e,t){t.__esModule=!0,t.default=function(n){(function(){typeof globalThis!="object"&&(Object.prototype.__defineGetter__("__magic__",function(){return this}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__)})();var r=globalThis.Handlebars;n.noConflict=function(){return globalThis.Handlebars===n&&(globalThis.Handlebars=r),n}},e.exports=t.default})(li,li.exports);var Ca=li.exports;(function(e,t){t.__esModule=!0;function n(_){return _&&_.__esModule?_:{default:_}}function r(_){if(_&&_.__esModule)return _;var I={};if(_!=null)for(var m in _)Object.prototype.hasOwnProperty.call(_,m)&&(I[m]=_[m]);return I.default=_,I}var i=we,o=r(i),s=td,l=n(s),a=Ne,u=n(a),f=X,p=r(f),c=ot,h=r(c),d=Ca,g=n(d);function E(){var _=new o.HandlebarsEnvironment;return p.extend(_,o),_.SafeString=l.default,_.Exception=u.default,_.Utils=p,_.escapeExpression=p.escapeExpression,_.VM=h,_.template=function(I){return h.template(I,_)},_}var w=E();w.create=E,g.default(w),w.default=w,t.default=w,e.exports=t.default})(Br,Br.exports);var gd=Br.exports,ui={exports:{}};(function(e,t){t.__esModule=!0;var n={helpers:{helperExpression:function(i){return i.type==="SubExpression"||(i.type==="MustacheStatement"||i.type==="BlockStatement")&&!!(i.params&&i.params.length||i.hash)},scopedId:function(i){return/^\.|this\b/.test(i.original)},simpleId:function(i){return i.parts.length===1&&!n.helpers.scopedId(i)&&!i.depth}}};t.default=n,e.exports=t.default})(ui,ui.exports);var Pa=ui.exports,tn={},ci={exports:{}};(function(e,t){t.__esModule=!0;var n=function(){var r={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,0],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(l,a,u,f,p,c,h){var d=c.length-1;switch(p){case 1:return c[d-1];case 2:this.$=f.prepareProgram(c[d]);break;case 3:this.$=c[d];break;case 4:this.$=c[d];break;case 5:this.$=c[d];break;case 6:this.$=c[d];break;case 7:this.$=c[d];break;case 8:this.$=c[d];break;case 9:this.$={type:"CommentStatement",value:f.stripComment(c[d]),strip:f.stripFlags(c[d],c[d]),loc:f.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:c[d],value:c[d],loc:f.locInfo(this._$)};break;case 11:this.$=f.prepareRawBlock(c[d-2],c[d-1],c[d],this._$);break;case 12:this.$={path:c[d-3],params:c[d-2],hash:c[d-1]};break;case 13:this.$=f.prepareBlock(c[d-3],c[d-2],c[d-1],c[d],!1,this._$);break;case 14:this.$=f.prepareBlock(c[d-3],c[d-2],c[d-1],c[d],!0,this._$);break;case 15:this.$={open:c[d-5],path:c[d-4],params:c[d-3],hash:c[d-2],blockParams:c[d-1],strip:f.stripFlags(c[d-5],c[d])};break;case 16:this.$={path:c[d-4],params:c[d-3],hash:c[d-2],blockParams:c[d-1],strip:f.stripFlags(c[d-5],c[d])};break;case 17:this.$={path:c[d-4],params:c[d-3],hash:c[d-2],blockParams:c[d-1],strip:f.stripFlags(c[d-5],c[d])};break;case 18:this.$={strip:f.stripFlags(c[d-1],c[d-1]),program:c[d]};break;case 19:var g=f.prepareBlock(c[d-2],c[d-1],c[d],c[d],!1,this._$),E=f.prepareProgram([g],c[d-1].loc);E.chained=!0,this.$={strip:c[d-2].strip,program:E,chain:!0};break;case 20:this.$=c[d];break;case 21:this.$={path:c[d-1],strip:f.stripFlags(c[d-2],c[d])};break;case 22:this.$=f.prepareMustache(c[d-3],c[d-2],c[d-1],c[d-4],f.stripFlags(c[d-4],c[d]),this._$);break;case 23:this.$=f.prepareMustache(c[d-3],c[d-2],c[d-1],c[d-4],f.stripFlags(c[d-4],c[d]),this._$);break;case 24:this.$={type:"PartialStatement",name:c[d-3],params:c[d-2],hash:c[d-1],indent:"",strip:f.stripFlags(c[d-4],c[d]),loc:f.locInfo(this._$)};break;case 25:this.$=f.preparePartialBlock(c[d-2],c[d-1],c[d],this._$);break;case 26:this.$={path:c[d-3],params:c[d-2],hash:c[d-1],strip:f.stripFlags(c[d-4],c[d])};break;case 27:this.$=c[d];break;case 28:this.$=c[d];break;case 29:this.$={type:"SubExpression",path:c[d-3],params:c[d-2],hash:c[d-1],loc:f.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:c[d],loc:f.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:f.id(c[d-2]),value:c[d],loc:f.locInfo(this._$)};break;case 32:this.$=f.id(c[d-1]);break;case 33:this.$=c[d];break;case 34:this.$=c[d];break;case 35:this.$={type:"StringLiteral",value:c[d],original:c[d],loc:f.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(c[d]),original:Number(c[d]),loc:f.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:c[d]==="true",original:c[d]==="true",loc:f.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:f.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:f.locInfo(this._$)};break;case 40:this.$=c[d];break;case 41:this.$=c[d];break;case 42:this.$=f.preparePath(!0,c[d],this._$);break;case 43:this.$=f.preparePath(!1,c[d],this._$);break;case 44:c[d-2].push({part:f.id(c[d]),original:c[d],separator:c[d-1]}),this.$=c[d-2];break;case 45:this.$=[{part:f.id(c[d]),original:c[d]}];break;case 46:this.$=[];break;case 47:c[d-1].push(c[d]);break;case 48:this.$=[];break;case 49:c[d-1].push(c[d]);break;case 50:this.$=[];break;case 51:c[d-1].push(c[d]);break;case 58:this.$=[];break;case 59:c[d-1].push(c[d]);break;case 64:this.$=[];break;case 65:c[d-1].push(c[d]);break;case 70:this.$=[];break;case 71:c[d-1].push(c[d]);break;case 78:this.$=[];break;case 79:c[d-1].push(c[d]);break;case 82:this.$=[];break;case 83:c[d-1].push(c[d]);break;case 86:this.$=[];break;case 87:c[d-1].push(c[d]);break;case 90:this.$=[];break;case 91:c[d-1].push(c[d]);break;case 94:this.$=[];break;case 95:c[d-1].push(c[d]);break;case 98:this.$=[c[d]];break;case 99:c[d-1].push(c[d]);break;case 100:this.$=[c[d]];break;case 101:c[d-1].push(c[d]);break}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{15:[2,48],17:39,18:[2,48]},{20:41,56:40,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:44,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:45,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:41,56:48,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:49,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,50]},{72:[1,35],86:51},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:52,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:53,38:55,39:[1,57],43:56,44:[1,58],45:54,47:[2,54]},{28:59,43:60,44:[1,58],47:[2,56]},{13:62,15:[1,20],18:[1,61]},{33:[2,86],57:63,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:64,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:65,47:[1,66]},{30:67,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:68,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:69,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:70,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:74,33:[2,80],50:71,63:72,64:75,65:[1,43],69:73,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,79]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,50]},{20:74,53:80,54:[2,84],63:81,64:75,65:[1,43],69:82,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:83,47:[1,66]},{47:[2,55]},{4:84,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:85,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:86,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:87,47:[1,66]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:74,33:[2,88],58:88,63:89,64:75,65:[1,43],69:90,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:91,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:92,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,31:93,33:[2,60],63:94,64:75,65:[1,43],69:95,70:76,71:77,72:[1,78],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,66],36:96,63:97,64:75,65:[1,43],69:98,70:76,71:77,72:[1,78],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,22:99,23:[2,52],63:100,64:75,65:[1,43],69:101,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,92],62:102,63:103,64:75,65:[1,43],69:104,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,105]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:106,72:[1,107],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,108],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,109]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:55,39:[1,57],43:56,44:[1,58],45:111,46:110,47:[2,76]},{33:[2,70],40:112,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,113]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:74,63:115,64:75,65:[1,43],67:114,68:[2,96],69:116,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,117]},{32:118,33:[2,62],74:119,75:[1,120]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:121,74:122,75:[1,120]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,123]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,124]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,108]},{20:74,63:125,64:75,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:74,33:[2,72],41:126,63:127,64:75,65:[1,43],69:128,70:76,71:77,72:[1,78],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,129]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,130]},{33:[2,63]},{72:[1,132],76:131},{33:[1,133]},{33:[2,69]},{15:[2,12],18:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:134,74:135,75:[1,120]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,137],77:[1,136]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,138]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],54:[2,55],56:[2,20],60:[2,57],73:[2,81],82:[2,85],86:[2,18],90:[2,89],101:[2,53],104:[2,93],110:[2,19],111:[2,77],116:[2,97],119:[2,63],122:[2,69],135:[2,75],136:[2,32]},parseError:function(l,a){throw new Error(l)},parse:function(l){var a=this,u=[0],f=[null],p=[],c=this.table,h="",d=0,g=0;this.lexer.setInput(l),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var E=this.lexer.yylloc;p.push(E);var w=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);function _(){var Fe;return Fe=a.lexer.lex()||1,typeof Fe!="number"&&(Fe=a.symbols_[Fe]||Fe),Fe}for(var I,m,T,O,A={},U,Q,W,V;;){if(m=u[u.length-1],this.defaultActions[m]?T=this.defaultActions[m]:((I===null||typeof I=="undefined")&&(I=_()),T=c[m]&&c[m][I]),typeof T=="undefined"||!T.length||!T[0]){var He="";{V=[];for(U in c[m])this.terminals_[U]&&U>2&&V.push("'"+this.terminals_[U]+"'");this.lexer.showPosition?He="Parse error on line "+(d+1)+`:
`+this.lexer.showPosition()+`
Expecting `+V.join(", ")+", got '"+(this.terminals_[I]||I)+"'":He="Parse error on line "+(d+1)+": Unexpected "+(I==1?"end of input":"'"+(this.terminals_[I]||I)+"'"),this.parseError(He,{text:this.lexer.match,token:this.terminals_[I]||I,line:this.lexer.yylineno,loc:E,expected:V})}}if(T[0]instanceof Array&&T.length>1)throw new Error("Parse Error: multiple actions possible at state: "+m+", token: "+I);switch(T[0]){case 1:u.push(I),f.push(this.lexer.yytext),p.push(this.lexer.yylloc),u.push(T[1]),I=null,g=this.lexer.yyleng,h=this.lexer.yytext,d=this.lexer.yylineno,E=this.lexer.yylloc;break;case 2:if(Q=this.productions_[T[1]][1],A.$=f[f.length-Q],A._$={first_line:p[p.length-(Q||1)].first_line,last_line:p[p.length-1].last_line,first_column:p[p.length-(Q||1)].first_column,last_column:p[p.length-1].last_column},w&&(A._$.range=[p[p.length-(Q||1)].range[0],p[p.length-1].range[1]]),O=this.performAction.call(A,h,g,d,this.yy,T[1],f,p),typeof O!="undefined")return O;Q&&(u=u.slice(0,-1*Q*2),f=f.slice(0,-1*Q),p=p.slice(0,-1*Q)),u.push(this.productions_[T[1]][0]),f.push(A.$),p.push(A._$),W=c[u[u.length-2]][u[u.length-1]],u.push(W);break;case 3:return!0}}return!0}},i=function(){var s={EOF:1,parseError:function(a,u){if(this.yy.parser)this.yy.parser.parseError(a,u);else throw new Error(a)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a;var u=a.match(/(?:\r\n?|\n).*/g);return u?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var u=a.length,f=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-u-1),this.offset-=u;var p=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),f.length-1&&(this.yylineno-=f.length-1);var c=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:f?(f.length===p.length?this.yylloc.first_column:0)+p[p.length-f.length].length-f[0].length:this.yylloc.first_column-u},this.options.ranges&&(this.yylloc.range=[c[0],c[0]+this.yyleng-u]),this},more:function(){return this._more=!0,this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),u=new Array(a.length+1).join("-");return a+this.upcomingInput()+`
`+u+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,u,f,p,c;this._more||(this.yytext="",this.match="");for(var h=this._currentRules(),d=0;d<h.length&&(f=this._input.match(this.rules[h[d]]),!(f&&(!u||f[0].length>u[0].length)&&(u=f,p=d,!this.options.flex)));d++);return u?(c=u[0].match(/(?:\r\n?|\n).*/g),c&&(this.yylineno+=c.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:c?c[c.length-1].length-c[c.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+u[0].length},this.yytext+=u[0],this.match+=u[0],this.matches=u,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(u[0].length),this.matched+=u[0],a=this.performAction.call(this,this.yy,this,h[p],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),a||void 0):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return typeof a!="undefined"?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(a){this.begin(a)}};return s.options={},s.performAction=function(a,u,f,p){function c(h,d){return u.yytext=u.yytext.substring(h,u.yyleng-d+h)}switch(f){case 0:if(u.yytext.slice(-2)==="\\\\"?(c(0,1),this.begin("mu")):u.yytext.slice(-1)==="\\"?(c(0,1),this.begin("emu")):this.begin("mu"),u.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),this.conditionStack[this.conditionStack.length-1]==="raw"?15:(c(5,9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:return this.popState(),44;case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(u.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:return 72;case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return u.yytext=c(1,2).replace(/\\"/g,'"'),80;case 32:return u.yytext=c(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:return 82;case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return u.yytext=u.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},s.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]+?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],s.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}},s}();r.lexer=i;function o(){this.yy={}}return o.prototype=r,r.Parser=o,new o}();t.default=n,e.exports=t.default})(ci,ci.exports);var md=ci.exports,fi={exports:{}},di={exports:{}};(function(e,t){t.__esModule=!0;function n(u){return u&&u.__esModule?u:{default:u}}var r=Ne,i=n(r);function o(){this.parents=[]}o.prototype={constructor:o,mutating:!1,acceptKey:function(f,p){var c=this.accept(f[p]);if(this.mutating){if(c&&!o.prototype[c.type])throw new i.default('Unexpected node type "'+c.type+'" found when accepting '+p+" on "+f.type);f[p]=c}},acceptRequired:function(f,p){if(this.acceptKey(f,p),!f[p])throw new i.default(f.type+" requires "+p)},acceptArray:function(f){for(var p=0,c=f.length;p<c;p++)this.acceptKey(f,p),f[p]||(f.splice(p,1),p--,c--)},accept:function(f){if(f){if(!this[f.type])throw new i.default("Unknown type: "+f.type,f);this.current&&this.parents.unshift(this.current),this.current=f;var p=this[f.type](f);if(this.current=this.parents.shift(),!this.mutating||p)return p;if(p!==!1)return f}},Program:function(f){this.acceptArray(f.body)},MustacheStatement:s,Decorator:s,BlockStatement:l,DecoratorBlock:l,PartialStatement:a,PartialBlockStatement:function(f){a.call(this,f),this.acceptKey(f,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:s,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(f){this.acceptArray(f.pairs)},HashPair:function(f){this.acceptRequired(f,"value")}};function s(u){this.acceptRequired(u,"path"),this.acceptArray(u.params),this.acceptKey(u,"hash")}function l(u){s.call(this,u),this.acceptKey(u,"program"),this.acceptKey(u,"inverse")}function a(u){this.acceptRequired(u,"name"),this.acceptArray(u.params),this.acceptKey(u,"hash")}t.default=o,e.exports=t.default})(di,di.exports);var Na=di.exports;(function(e,t){t.__esModule=!0;function n(f){return f&&f.__esModule?f:{default:f}}var r=Na,i=n(r);function o(){var f=arguments.length<=0||arguments[0]===void 0?{}:arguments[0];this.options=f}o.prototype=new i.default,o.prototype.Program=function(f){var p=!this.options.ignoreStandalone,c=!this.isRootSeen;this.isRootSeen=!0;for(var h=f.body,d=0,g=h.length;d<g;d++){var E=h[d],w=this.accept(E);if(w){var _=s(h,d,c),I=l(h,d,c),m=w.openStandalone&&_,T=w.closeStandalone&&I,O=w.inlineStandalone&&_&&I;w.close&&a(h,d,!0),w.open&&u(h,d,!0),p&&O&&(a(h,d),u(h,d)&&E.type==="PartialStatement"&&(E.indent=/([ \t]+$)/.exec(h[d-1].original)[1])),p&&m&&(a((E.program||E.inverse).body),u(h,d)),p&&T&&(a(h,d),u((E.inverse||E.program).body))}}return f},o.prototype.BlockStatement=o.prototype.DecoratorBlock=o.prototype.PartialBlockStatement=function(f){this.accept(f.program),this.accept(f.inverse);var p=f.program||f.inverse,c=f.program&&f.inverse,h=c,d=c;if(c&&c.chained)for(h=c.body[0].program;d.chained;)d=d.body[d.body.length-1].program;var g={open:f.openStrip.open,close:f.closeStrip.close,openStandalone:l(p.body),closeStandalone:s((h||p).body)};if(f.openStrip.close&&a(p.body,null,!0),c){var E=f.inverseStrip;E.open&&u(p.body,null,!0),E.close&&a(h.body,null,!0),f.closeStrip.open&&u(d.body,null,!0),!this.options.ignoreStandalone&&s(p.body)&&l(h.body)&&(u(p.body),a(h.body))}else f.closeStrip.open&&u(p.body,null,!0);return g},o.prototype.Decorator=o.prototype.MustacheStatement=function(f){return f.strip},o.prototype.PartialStatement=o.prototype.CommentStatement=function(f){var p=f.strip||{};return{inlineStandalone:!0,open:p.open,close:p.close}};function s(f,p,c){p===void 0&&(p=f.length);var h=f[p-1],d=f[p-2];if(!h)return c;if(h.type==="ContentStatement")return(d||!c?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(h.original)}function l(f,p,c){p===void 0&&(p=-1);var h=f[p+1],d=f[p+2];if(!h)return c;if(h.type==="ContentStatement")return(d||!c?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(h.original)}function a(f,p,c){var h=f[p==null?0:p+1];if(!(!h||h.type!=="ContentStatement"||!c&&h.rightStripped)){var d=h.value;h.value=h.value.replace(c?/^\s+/:/^[ \t]*\r?\n?/,""),h.rightStripped=h.value!==d}}function u(f,p,c){var h=f[p==null?f.length-1:p-1];if(!(!h||h.type!=="ContentStatement"||!c&&h.leftStripped)){var d=h.value;return h.value=h.value.replace(c?/\s+$/:/[ \t]+$/,""),h.leftStripped=h.value!==d,h.leftStripped}}t.default=o,e.exports=t.default})(fi,fi.exports);var vd=fi.exports,Se={};Se.__esModule=!0,Se.SourceLocation=_d,Se.id=Td,Se.stripFlags=bd,Se.stripComment=wd,Se.preparePath=Sd,Se.prepareMustache=Id,Se.prepareRawBlock=Ad,Se.prepareBlock=Cd,Se.prepareProgram=Pd,Se.preparePartialBlock=Nd;function Ed(e){return e&&e.__esModule?e:{default:e}}var yd=Ne,hi=Ed(yd);function pi(e,t){if(t=t.path?t.path.original:t,e.path.original!==t){var n={loc:e.path.loc};throw new hi.default(e.path.original+" doesn't match "+t,n)}}function _d(e,t){this.source=e,this.start={line:t.first_line,column:t.first_column},this.end={line:t.last_line,column:t.last_column}}function Td(e){return/^\[.*\]$/.test(e)?e.substring(1,e.length-1):e}function bd(e,t){return{open:e.charAt(2)==="~",close:t.charAt(t.length-3)==="~"}}function wd(e){return e.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function Sd(e,t,n){n=this.locInfo(n);for(var r=e?"@":"",i=[],o=0,s=0,l=t.length;s<l;s++){var a=t[s].part,u=t[s].original!==a;if(r+=(t[s].separator||"")+a,!u&&(a===".."||a==="."||a==="this")){if(i.length>0)throw new hi.default("Invalid path: "+r,{loc:n});a===".."&&o++}else i.push(a)}return{type:"PathExpression",data:e,depth:o,parts:i,original:r,loc:n}}function Id(e,t,n,r,i,o){var s=r.charAt(3)||r.charAt(2),l=s!=="{"&&s!=="&",a=/\*/.test(r);return{type:a?"Decorator":"MustacheStatement",path:e,params:t,hash:n,escaped:l,strip:i,loc:this.locInfo(o)}}function Ad(e,t,n,r){pi(e,n),r=this.locInfo(r);var i={type:"Program",body:t,strip:{},loc:r};return{type:"BlockStatement",path:e.path,params:e.params,hash:e.hash,program:i,openStrip:{},inverseStrip:{},closeStrip:{},loc:r}}function Cd(e,t,n,r,i,o){r&&r.path&&pi(e,r);var s=/\*/.test(e.open);t.blockParams=e.blockParams;var l=void 0,a=void 0;if(n){if(s)throw new hi.default("Unexpected inverse block on decorator",n);n.chain&&(n.program.body[0].closeStrip=r.strip),a=n.strip,l=n.program}return i&&(i=l,l=t,t=i),{type:s?"DecoratorBlock":"BlockStatement",path:e.path,params:e.params,hash:e.hash,program:t,inverse:l,openStrip:e.strip,inverseStrip:a,closeStrip:r&&r.strip,loc:this.locInfo(o)}}function Pd(e,t){if(!t&&e.length){var n=e[0].loc,r=e[e.length-1].loc;n&&r&&(t={source:n.source,start:{line:n.start.line,column:n.start.column},end:{line:r.end.line,column:r.end.column}})}return{type:"Program",body:e,strip:{},loc:t}}function Nd(e,t,n,r){return pi(e,n),{type:"PartialBlockStatement",name:e.path,params:e.params,hash:e.hash,program:t,openStrip:e.strip,closeStrip:n&&n.strip,loc:this.locInfo(r)}}tn.__esModule=!0,tn.parseWithoutProcessing=Da,tn.parse=Ud;function Od(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function Oa(e){return e&&e.__esModule?e:{default:e}}var Dd=md,gi=Oa(Dd),Md=vd,Rd=Oa(Md),Ld=Se,xd=Od(Ld),kd=X;tn.parser=gi.default;var Vn={};kd.extend(Vn,xd);function Da(e,t){if(e.type==="Program")return e;gi.default.yy=Vn,Vn.locInfo=function(r){return new Vn.SourceLocation(t&&t.srcName,r)};var n=gi.default.parse(e);return n}function Ud(e,t){var n=Da(e,t),r=new Rd.default(t);return r.accept(n)}var nn={};nn.__esModule=!0,nn.Compiler=mi,nn.precompile=Vd,nn.compile=Bd;function Ma(e){return e&&e.__esModule?e:{default:e}}var Hd=Ne,rn=Ma(Hd),on=X,Fd=Pa,an=Ma(Fd),zd=[].slice;function mi(){}mi.prototype={compiler:mi,equals:function(t){var n=this.opcodes.length;if(t.opcodes.length!==n)return!1;for(var r=0;r<n;r++){var i=this.opcodes[r],o=t.opcodes[r];if(i.opcode!==o.opcode||!Ra(i.args,o.args))return!1}n=this.children.length;for(var r=0;r<n;r++)if(!this.children[r].equals(t.children[r]))return!1;return!0},guid:0,compile:function(t,n){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=n,this.stringParams=n.stringParams,this.trackIds=n.trackIds,n.blockParams=n.blockParams||[],n.knownHelpers=on.extend(Object.create(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},n.knownHelpers),this.accept(t)},compileProgram:function(t){var n=new this.compiler,r=n.compile(t,this.options),i=this.guid++;return this.usePartial=this.usePartial||r.usePartial,this.children[i]=r,this.useDepths=this.useDepths||r.useDepths,i},accept:function(t){if(!this[t.type])throw new rn.default("Unknown type: "+t.type,t);this.sourceNode.unshift(t);var n=this[t.type](t);return this.sourceNode.shift(),n},Program:function(t){this.options.blockParams.unshift(t.blockParams);for(var n=t.body,r=n.length,i=0;i<r;i++)this.accept(n[i]);return this.options.blockParams.shift(),this.isSimple=r===1,this.blockParams=t.blockParams?t.blockParams.length:0,this},BlockStatement:function(t){La(t);var n=t.program,r=t.inverse;n=n&&this.compileProgram(n),r=r&&this.compileProgram(r);var i=this.classifySexpr(t);i==="helper"?this.helperSexpr(t,n,r):i==="simple"?(this.simpleSexpr(t),this.opcode("pushProgram",n),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("blockValue",t.path.original)):(this.ambiguousSexpr(t,n,r),this.opcode("pushProgram",n),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(t){var n=t.program&&this.compileProgram(t.program),r=this.setupFullMustacheParams(t,n,void 0),i=t.path;this.useDecorators=!0,this.opcode("registerDecorator",r.length,i.original)},PartialStatement:function(t){this.usePartial=!0;var n=t.program;n&&(n=this.compileProgram(t.program));var r=t.params;if(r.length>1)throw new rn.default("Unsupported number of partial arguments: "+r.length,t);r.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):r.push({type:"PathExpression",parts:[],depth:0}));var i=t.name.original,o=t.name.type==="SubExpression";o&&this.accept(t.name),this.setupFullMustacheParams(t,n,void 0,!0);var s=t.indent||"";this.options.preventIndent&&s&&(this.opcode("appendContent",s),s=""),this.opcode("invokePartial",o,i,s),this.opcode("append")},PartialBlockStatement:function(t){this.PartialStatement(t)},MustacheStatement:function(t){this.SubExpression(t),t.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(t){this.DecoratorBlock(t)},ContentStatement:function(t){t.value&&this.opcode("appendContent",t.value)},CommentStatement:function(){},SubExpression:function(t){La(t);var n=this.classifySexpr(t);n==="simple"?this.simpleSexpr(t):n==="helper"?this.helperSexpr(t):this.ambiguousSexpr(t)},ambiguousSexpr:function(t,n,r){var i=t.path,o=i.parts[0],s=n!=null||r!=null;this.opcode("getContext",i.depth),this.opcode("pushProgram",n),this.opcode("pushProgram",r),i.strict=!0,this.accept(i),this.opcode("invokeAmbiguous",o,s)},simpleSexpr:function(t){var n=t.path;n.strict=!0,this.accept(n),this.opcode("resolvePossibleLambda")},helperSexpr:function(t,n,r){var i=this.setupFullMustacheParams(t,n,r),o=t.path,s=o.parts[0];if(this.options.knownHelpers[s])this.opcode("invokeKnownHelper",i.length,s);else{if(this.options.knownHelpersOnly)throw new rn.default("You specified knownHelpersOnly, but used the unknown helper "+s,t);o.strict=!0,o.falsy=!0,this.accept(o),this.opcode("invokeHelper",i.length,o.original,an.default.helpers.simpleId(o))}},PathExpression:function(t){this.addDepth(t.depth),this.opcode("getContext",t.depth);var n=t.parts[0],r=an.default.helpers.scopedId(t),i=!t.depth&&!r&&this.blockParamIndex(n);i?this.opcode("lookupBlockParam",i,t.parts):n?t.data?(this.options.data=!0,this.opcode("lookupData",t.depth,t.parts,t.strict)):this.opcode("lookupOnContext",t.parts,t.falsy,t.strict,r):this.opcode("pushContext")},StringLiteral:function(t){this.opcode("pushString",t.value)},NumberLiteral:function(t){this.opcode("pushLiteral",t.value)},BooleanLiteral:function(t){this.opcode("pushLiteral",t.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(t){var n=t.pairs,r=0,i=n.length;for(this.opcode("pushHash");r<i;r++)this.pushParam(n[r].value);for(;r--;)this.opcode("assignToHash",n[r].key);this.opcode("popHash")},opcode:function(t){this.opcodes.push({opcode:t,args:zd.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(t){t&&(this.useDepths=!0)},classifySexpr:function(t){var n=an.default.helpers.simpleId(t.path),r=n&&!!this.blockParamIndex(t.path.parts[0]),i=!r&&an.default.helpers.helperExpression(t),o=!r&&(i||n);if(o&&!i){var s=t.path.parts[0],l=this.options;l.knownHelpers[s]?i=!0:l.knownHelpersOnly&&(o=!1)}return i?"helper":o?"ambiguous":"simple"},pushParams:function(t){for(var n=0,r=t.length;n<r;n++)this.pushParam(t[n])},pushParam:function(t){var n=t.value!=null?t.value:t.original||"";if(this.stringParams)n.replace&&(n=n.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),t.depth&&this.addDepth(t.depth),this.opcode("getContext",t.depth||0),this.opcode("pushStringParam",n,t.type),t.type==="SubExpression"&&this.accept(t);else{if(this.trackIds){var r=void 0;if(t.parts&&!an.default.helpers.scopedId(t)&&!t.depth&&(r=this.blockParamIndex(t.parts[0])),r){var i=t.parts.slice(1).join(".");this.opcode("pushId","BlockParam",r,i)}else n=t.original||n,n.replace&&(n=n.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",t.type,n)}this.accept(t)}},setupFullMustacheParams:function(t,n,r,i){var o=t.params;return this.pushParams(o),this.opcode("pushProgram",n),this.opcode("pushProgram",r),t.hash?this.accept(t.hash):this.opcode("emptyHash",i),o},blockParamIndex:function(t){for(var n=0,r=this.options.blockParams.length;n<r;n++){var i=this.options.blockParams[n],o=i&&on.indexOf(i,t);if(i&&o>=0)return[n,o]}}};function Vd(e,t,n){if(e==null||typeof e!="string"&&e.type!=="Program")throw new rn.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);t=t||{},"data"in t||(t.data=!0),t.compat&&(t.useDepths=!0);var r=n.parse(e,t),i=new n.Compiler().compile(r,t);return new n.JavaScriptCompiler().compile(i,t)}function Bd(e,t,n){if(t===void 0&&(t={}),e==null||typeof e!="string"&&e.type!=="Program")throw new rn.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);t=on.extend({},t),"data"in t||(t.data=!0),t.compat&&(t.useDepths=!0);var r=void 0;function i(){var s=n.parse(e,t),l=new n.Compiler().compile(s,t),a=new n.JavaScriptCompiler().compile(l,t,void 0,!0);return n.template(a)}function o(s,l){return r||(r=i()),r.call(this,s,l)}return o._setup=function(s){return r||(r=i()),r._setup(s)},o._child=function(s,l,a,u){return r||(r=i()),r._child(s,l,a,u)},o}function Ra(e,t){if(e===t)return!0;if(on.isArray(e)&&on.isArray(t)&&e.length===t.length){for(var n=0;n<e.length;n++)if(!Ra(e[n],t[n]))return!1;return!0}}function La(e){if(!e.path.parts){var t=e.path;e.path={type:"PathExpression",data:!1,depth:0,parts:[t.original+""],original:t.original+"",loc:t.loc}}}var vi={exports:{}},Ei={exports:{}},sn={},yi={},Bn={},Gn={},xa;function Gd(){if(xa)return Gn;xa=1;var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return Gn.encode=function(t){if(0<=t&&t<e.length)return e[t];throw new TypeError("Must be between 0 and 63: "+t)},Gn.decode=function(t){var n=65,r=90,i=97,o=122,s=48,l=57,a=43,u=47,f=26,p=52;return n<=t&&t<=r?t-n:i<=t&&t<=o?t-i+f:s<=t&&t<=l?t-s+p:t==a?62:t==u?63:-1},Gn}var ka;function Ua(){if(ka)return Bn;ka=1;var e=Gd(),t=5,n=1<<t,r=n-1,i=n;function o(l){return l<0?(-l<<1)+1:(l<<1)+0}function s(l){var a=(l&1)===1,u=l>>1;return a?-u:u}return Bn.encode=function(a){var u="",f,p=o(a);do f=p&r,p>>>=t,p>0&&(f|=i),u+=e.encode(f);while(p>0);return u},Bn.decode=function(a,u,f){var p=a.length,c=0,h=0,d,g;do{if(u>=p)throw new Error("Expected more digits in base 64 VLQ value.");if(g=e.decode(a.charCodeAt(u++)),g===-1)throw new Error("Invalid base64 digit: "+a.charAt(u-1));d=!!(g&i),g&=r,c=c+(g<<h),h+=t}while(d);f.value=s(c),f.rest=u},Bn}var _i={},Ha;function ln(){return Ha||(Ha=1,function(e){function t(m,T,O){if(T in m)return m[T];if(arguments.length===3)return O;throw new Error('"'+T+'" is a required argument.')}e.getArg=t;var n=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,r=/^data:.+\,.+$/;function i(m){var T=m.match(n);return T?{scheme:T[1],auth:T[2],host:T[3],port:T[4],path:T[5]}:null}e.urlParse=i;function o(m){var T="";return m.scheme&&(T+=m.scheme+":"),T+="//",m.auth&&(T+=m.auth+"@"),m.host&&(T+=m.host),m.port&&(T+=":"+m.port),m.path&&(T+=m.path),T}e.urlGenerate=o;function s(m){var T=m,O=i(m);if(O){if(!O.path)return m;T=O.path}for(var A=e.isAbsolute(T),U=T.split(/\/+/),Q,W=0,V=U.length-1;V>=0;V--)Q=U[V],Q==="."?U.splice(V,1):Q===".."?W++:W>0&&(Q===""?(U.splice(V+1,W),W=0):(U.splice(V,2),W--));return T=U.join("/"),T===""&&(T=A?"/":"."),O?(O.path=T,o(O)):T}e.normalize=s;function l(m,T){m===""&&(m="."),T===""&&(T=".");var O=i(T),A=i(m);if(A&&(m=A.path||"/"),O&&!O.scheme)return A&&(O.scheme=A.scheme),o(O);if(O||T.match(r))return T;if(A&&!A.host&&!A.path)return A.host=T,o(A);var U=T.charAt(0)==="/"?T:s(m.replace(/\/+$/,"")+"/"+T);return A?(A.path=U,o(A)):U}e.join=l,e.isAbsolute=function(m){return m.charAt(0)==="/"||n.test(m)};function a(m,T){m===""&&(m="."),m=m.replace(/\/$/,"");for(var O=0;T.indexOf(m+"/")!==0;){var A=m.lastIndexOf("/");if(A<0||(m=m.slice(0,A),m.match(/^([^\/]+:\/)?\/*$/)))return T;++O}return Array(O+1).join("../")+T.substr(m.length+1)}e.relative=a;var u=function(){var m=Object.create(null);return!("__proto__"in m)}();function f(m){return m}function p(m){return h(m)?"$"+m:m}e.toSetString=u?f:p;function c(m){return h(m)?m.slice(1):m}e.fromSetString=u?f:c;function h(m){if(!m)return!1;var T=m.length;if(T<9||m.charCodeAt(T-1)!==95||m.charCodeAt(T-2)!==95||m.charCodeAt(T-3)!==111||m.charCodeAt(T-4)!==116||m.charCodeAt(T-5)!==111||m.charCodeAt(T-6)!==114||m.charCodeAt(T-7)!==112||m.charCodeAt(T-8)!==95||m.charCodeAt(T-9)!==95)return!1;for(var O=T-10;O>=0;O--)if(m.charCodeAt(O)!==36)return!1;return!0}function d(m,T,O){var A=E(m.source,T.source);return A!==0||(A=m.originalLine-T.originalLine,A!==0)||(A=m.originalColumn-T.originalColumn,A!==0||O)||(A=m.generatedColumn-T.generatedColumn,A!==0)||(A=m.generatedLine-T.generatedLine,A!==0)?A:E(m.name,T.name)}e.compareByOriginalPositions=d;function g(m,T,O){var A=m.generatedLine-T.generatedLine;return A!==0||(A=m.generatedColumn-T.generatedColumn,A!==0||O)||(A=E(m.source,T.source),A!==0)||(A=m.originalLine-T.originalLine,A!==0)||(A=m.originalColumn-T.originalColumn,A!==0)?A:E(m.name,T.name)}e.compareByGeneratedPositionsDeflated=g;function E(m,T){return m===T?0:m===null?1:T===null?-1:m>T?1:-1}function w(m,T){var O=m.generatedLine-T.generatedLine;return O!==0||(O=m.generatedColumn-T.generatedColumn,O!==0)||(O=E(m.source,T.source),O!==0)||(O=m.originalLine-T.originalLine,O!==0)||(O=m.originalColumn-T.originalColumn,O!==0)?O:E(m.name,T.name)}e.compareByGeneratedPositionsInflated=w;function _(m){return JSON.parse(m.replace(/^\)]}'[^\n]*\n/,""))}e.parseSourceMapInput=_;function I(m,T,O){if(T=T||"",m&&(m[m.length-1]!=="/"&&T[0]!=="/"&&(m+="/"),T=m+T),O){var A=i(O);if(!A)throw new Error("sourceMapURL could not be parsed");if(A.path){var U=A.path.lastIndexOf("/");U>=0&&(A.path=A.path.substring(0,U+1))}T=l(o(A),T)}return s(T)}e.computeSourceURL=I}(_i)),_i}var Ti={},Fa;function za(){if(Fa)return Ti;Fa=1;var e=ln(),t=Object.prototype.hasOwnProperty,n=typeof Map!="undefined";function r(){this._array=[],this._set=n?new Map:Object.create(null)}return r.fromArray=function(o,s){for(var l=new r,a=0,u=o.length;a<u;a++)l.add(o[a],s);return l},r.prototype.size=function(){return n?this._set.size:Object.getOwnPropertyNames(this._set).length},r.prototype.add=function(o,s){var l=n?o:e.toSetString(o),a=n?this.has(o):t.call(this._set,l),u=this._array.length;(!a||s)&&this._array.push(o),a||(n?this._set.set(o,u):this._set[l]=u)},r.prototype.has=function(o){if(n)return this._set.has(o);var s=e.toSetString(o);return t.call(this._set,s)},r.prototype.indexOf=function(o){if(n){var s=this._set.get(o);if(s>=0)return s}else{var l=e.toSetString(o);if(t.call(this._set,l))return this._set[l]}throw new Error('"'+o+'" is not in the set.')},r.prototype.at=function(o){if(o>=0&&o<this._array.length)return this._array[o];throw new Error("No element indexed by "+o)},r.prototype.toArray=function(){return this._array.slice()},Ti.ArraySet=r,Ti}var bi={},Va;function jd(){if(Va)return bi;Va=1;var e=ln();function t(r,i){var o=r.generatedLine,s=i.generatedLine,l=r.generatedColumn,a=i.generatedColumn;return s>o||s==o&&a>=l||e.compareByGeneratedPositionsInflated(r,i)<=0}function n(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}return n.prototype.unsortedForEach=function(i,o){this._array.forEach(i,o)},n.prototype.add=function(i){t(this._last,i)?(this._last=i,this._array.push(i)):(this._sorted=!1,this._array.push(i))},n.prototype.toArray=function(){return this._sorted||(this._array.sort(e.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},bi.MappingList=n,bi}var Ba;function Ga(){if(Ba)return yi;Ba=1;var e=Ua(),t=ln(),n=za().ArraySet,r=jd().MappingList;function i(o){o||(o={}),this._file=t.getArg(o,"file",null),this._sourceRoot=t.getArg(o,"sourceRoot",null),this._skipValidation=t.getArg(o,"skipValidation",!1),this._sources=new n,this._names=new n,this._mappings=new r,this._sourcesContents=null}return i.prototype._version=3,i.fromSourceMap=function(s){var l=s.sourceRoot,a=new i({file:s.file,sourceRoot:l});return s.eachMapping(function(u){var f={generated:{line:u.generatedLine,column:u.generatedColumn}};u.source!=null&&(f.source=u.source,l!=null&&(f.source=t.relative(l,f.source)),f.original={line:u.originalLine,column:u.originalColumn},u.name!=null&&(f.name=u.name)),a.addMapping(f)}),s.sources.forEach(function(u){var f=u;l!==null&&(f=t.relative(l,u)),a._sources.has(f)||a._sources.add(f);var p=s.sourceContentFor(u);p!=null&&a.setSourceContent(u,p)}),a},i.prototype.addMapping=function(s){var l=t.getArg(s,"generated"),a=t.getArg(s,"original",null),u=t.getArg(s,"source",null),f=t.getArg(s,"name",null);this._skipValidation||this._validateMapping(l,a,u,f),u!=null&&(u=String(u),this._sources.has(u)||this._sources.add(u)),f!=null&&(f=String(f),this._names.has(f)||this._names.add(f)),this._mappings.add({generatedLine:l.line,generatedColumn:l.column,originalLine:a!=null&&a.line,originalColumn:a!=null&&a.column,source:u,name:f})},i.prototype.setSourceContent=function(s,l){var a=s;this._sourceRoot!=null&&(a=t.relative(this._sourceRoot,a)),l!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[t.toSetString(a)]=l):this._sourcesContents&&(delete this._sourcesContents[t.toSetString(a)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))},i.prototype.applySourceMap=function(s,l,a){var u=l;if(l==null){if(s.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);u=s.file}var f=this._sourceRoot;f!=null&&(u=t.relative(f,u));var p=new n,c=new n;this._mappings.unsortedForEach(function(h){if(h.source===u&&h.originalLine!=null){var d=s.originalPositionFor({line:h.originalLine,column:h.originalColumn});d.source!=null&&(h.source=d.source,a!=null&&(h.source=t.join(a,h.source)),f!=null&&(h.source=t.relative(f,h.source)),h.originalLine=d.line,h.originalColumn=d.column,d.name!=null&&(h.name=d.name))}var g=h.source;g!=null&&!p.has(g)&&p.add(g);var E=h.name;E!=null&&!c.has(E)&&c.add(E)},this),this._sources=p,this._names=c,s.sources.forEach(function(h){var d=s.sourceContentFor(h);d!=null&&(a!=null&&(h=t.join(a,h)),f!=null&&(h=t.relative(f,h)),this.setSourceContent(h,d))},this)},i.prototype._validateMapping=function(s,l,a,u){if(l&&typeof l.line!="number"&&typeof l.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(s&&"line"in s&&"column"in s&&s.line>0&&s.column>=0&&!l&&!a&&!u)){if(s&&"line"in s&&"column"in s&&l&&"line"in l&&"column"in l&&s.line>0&&s.column>=0&&l.line>0&&l.column>=0&&a)return;throw new Error("Invalid mapping: "+JSON.stringify({generated:s,source:a,original:l,name:u}))}},i.prototype._serializeMappings=function(){for(var s=0,l=1,a=0,u=0,f=0,p=0,c="",h,d,g,E,w=this._mappings.toArray(),_=0,I=w.length;_<I;_++){if(d=w[_],h="",d.generatedLine!==l)for(s=0;d.generatedLine!==l;)h+=";",l++;else if(_>0){if(!t.compareByGeneratedPositionsInflated(d,w[_-1]))continue;h+=","}h+=e.encode(d.generatedColumn-s),s=d.generatedColumn,d.source!=null&&(E=this._sources.indexOf(d.source),h+=e.encode(E-p),p=E,h+=e.encode(d.originalLine-1-u),u=d.originalLine-1,h+=e.encode(d.originalColumn-a),a=d.originalColumn,d.name!=null&&(g=this._names.indexOf(d.name),h+=e.encode(g-f),f=g)),c+=h}return c},i.prototype._generateSourcesContent=function(s,l){return s.map(function(a){if(!this._sourcesContents)return null;l!=null&&(a=t.relative(l,a));var u=t.toSetString(a);return Object.prototype.hasOwnProperty.call(this._sourcesContents,u)?this._sourcesContents[u]:null},this)},i.prototype.toJSON=function(){var s={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(s.file=this._file),this._sourceRoot!=null&&(s.sourceRoot=this._sourceRoot),this._sourcesContents&&(s.sourcesContent=this._generateSourcesContent(s.sources,s.sourceRoot)),s},i.prototype.toString=function(){return JSON.stringify(this.toJSON())},yi.SourceMapGenerator=i,yi}var un={},wi={},ja;function Wd(){return ja||(ja=1,function(e){e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2;function t(n,r,i,o,s,l){var a=Math.floor((r-n)/2)+n,u=s(i,o[a],!0);return u===0?a:u>0?r-a>1?t(a,r,i,o,s,l):l==e.LEAST_UPPER_BOUND?r<o.length?r:-1:a:a-n>1?t(n,a,i,o,s,l):l==e.LEAST_UPPER_BOUND?a:n<0?-1:n}e.search=function(r,i,o,s){if(i.length===0)return-1;var l=t(-1,i.length,r,i,o,s||e.GREATEST_LOWER_BOUND);if(l<0)return-1;for(;l-1>=0&&o(i[l],i[l-1],!0)===0;)--l;return l}}(wi)),wi}var Si={},Wa;function qd(){if(Wa)return Si;Wa=1;function e(r,i,o){var s=r[i];r[i]=r[o],r[o]=s}function t(r,i){return Math.round(r+Math.random()*(i-r))}function n(r,i,o,s){if(o<s){var l=t(o,s),a=o-1;e(r,l,s);for(var u=r[s],f=o;f<s;f++)i(r[f],u)<=0&&(a+=1,e(r,a,f));e(r,a+1,f);var p=a+1;n(r,i,o,p-1),n(r,i,p+1,s)}}return Si.quickSort=function(r,i){n(r,i,0,r.length-1)},Si}var qa;function $d(){if(qa)return un;qa=1;var e=ln(),t=Wd(),n=za().ArraySet,r=Ua(),i=qd().quickSort;function o(u,f){var p=u;return typeof u=="string"&&(p=e.parseSourceMapInput(u)),p.sections!=null?new a(p,f):new s(p,f)}o.fromSourceMap=function(u,f){return s.fromSourceMap(u,f)},o.prototype._version=3,o.prototype.__generatedMappings=null,Object.defineProperty(o.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),o.prototype.__originalMappings=null,Object.defineProperty(o.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),o.prototype._charIsMappingSeparator=function(f,p){var c=f.charAt(p);return c===";"||c===","},o.prototype._parseMappings=function(f,p){throw new Error("Subclasses must implement _parseMappings")},o.GENERATED_ORDER=1,o.ORIGINAL_ORDER=2,o.GREATEST_LOWER_BOUND=1,o.LEAST_UPPER_BOUND=2,o.prototype.eachMapping=function(f,p,c){var h=p||null,d=c||o.GENERATED_ORDER,g;switch(d){case o.GENERATED_ORDER:g=this._generatedMappings;break;case o.ORIGINAL_ORDER:g=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var E=this.sourceRoot;g.map(function(w){var _=w.source===null?null:this._sources.at(w.source);return _=e.computeSourceURL(E,_,this._sourceMapURL),{source:_,generatedLine:w.generatedLine,generatedColumn:w.generatedColumn,originalLine:w.originalLine,originalColumn:w.originalColumn,name:w.name===null?null:this._names.at(w.name)}},this).forEach(f,h)},o.prototype.allGeneratedPositionsFor=function(f){var p=e.getArg(f,"line"),c={source:e.getArg(f,"source"),originalLine:p,originalColumn:e.getArg(f,"column",0)};if(c.source=this._findSourceIndex(c.source),c.source<0)return[];var h=[],d=this._findMapping(c,this._originalMappings,"originalLine","originalColumn",e.compareByOriginalPositions,t.LEAST_UPPER_BOUND);if(d>=0){var g=this._originalMappings[d];if(f.column===void 0)for(var E=g.originalLine;g&&g.originalLine===E;)h.push({line:e.getArg(g,"generatedLine",null),column:e.getArg(g,"generatedColumn",null),lastColumn:e.getArg(g,"lastGeneratedColumn",null)}),g=this._originalMappings[++d];else for(var w=g.originalColumn;g&&g.originalLine===p&&g.originalColumn==w;)h.push({line:e.getArg(g,"generatedLine",null),column:e.getArg(g,"generatedColumn",null),lastColumn:e.getArg(g,"lastGeneratedColumn",null)}),g=this._originalMappings[++d]}return h},un.SourceMapConsumer=o;function s(u,f){var p=u;typeof u=="string"&&(p=e.parseSourceMapInput(u));var c=e.getArg(p,"version"),h=e.getArg(p,"sources"),d=e.getArg(p,"names",[]),g=e.getArg(p,"sourceRoot",null),E=e.getArg(p,"sourcesContent",null),w=e.getArg(p,"mappings"),_=e.getArg(p,"file",null);if(c!=this._version)throw new Error("Unsupported version: "+c);g&&(g=e.normalize(g)),h=h.map(String).map(e.normalize).map(function(I){return g&&e.isAbsolute(g)&&e.isAbsolute(I)?e.relative(g,I):I}),this._names=n.fromArray(d.map(String),!0),this._sources=n.fromArray(h,!0),this._absoluteSources=this._sources.toArray().map(function(I){return e.computeSourceURL(g,I,f)}),this.sourceRoot=g,this.sourcesContent=E,this._mappings=w,this._sourceMapURL=f,this.file=_}s.prototype=Object.create(o.prototype),s.prototype.consumer=o,s.prototype._findSourceIndex=function(u){var f=u;if(this.sourceRoot!=null&&(f=e.relative(this.sourceRoot,f)),this._sources.has(f))return this._sources.indexOf(f);var p;for(p=0;p<this._absoluteSources.length;++p)if(this._absoluteSources[p]==u)return p;return-1},s.fromSourceMap=function(f,p){var c=Object.create(s.prototype),h=c._names=n.fromArray(f._names.toArray(),!0),d=c._sources=n.fromArray(f._sources.toArray(),!0);c.sourceRoot=f._sourceRoot,c.sourcesContent=f._generateSourcesContent(c._sources.toArray(),c.sourceRoot),c.file=f._file,c._sourceMapURL=p,c._absoluteSources=c._sources.toArray().map(function(O){return e.computeSourceURL(c.sourceRoot,O,p)});for(var g=f._mappings.toArray().slice(),E=c.__generatedMappings=[],w=c.__originalMappings=[],_=0,I=g.length;_<I;_++){var m=g[_],T=new l;T.generatedLine=m.generatedLine,T.generatedColumn=m.generatedColumn,m.source&&(T.source=d.indexOf(m.source),T.originalLine=m.originalLine,T.originalColumn=m.originalColumn,m.name&&(T.name=h.indexOf(m.name)),w.push(T)),E.push(T)}return i(c.__originalMappings,e.compareByOriginalPositions),c},s.prototype._version=3,Object.defineProperty(s.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});function l(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}s.prototype._parseMappings=function(f,p){for(var c=1,h=0,d=0,g=0,E=0,w=0,_=f.length,I=0,m={},T={},O=[],A=[],U,Q,W,V,He;I<_;)if(f.charAt(I)===";")c++,I++,h=0;else if(f.charAt(I)===",")I++;else{for(U=new l,U.generatedLine=c,V=I;V<_&&!this._charIsMappingSeparator(f,V);V++);if(Q=f.slice(I,V),W=m[Q],W)I+=Q.length;else{for(W=[];I<V;)r.decode(f,I,T),He=T.value,I=T.rest,W.push(He);if(W.length===2)throw new Error("Found a source, but no line and column");if(W.length===3)throw new Error("Found a source and line, but no column");m[Q]=W}U.generatedColumn=h+W[0],h=U.generatedColumn,W.length>1&&(U.source=E+W[1],E+=W[1],U.originalLine=d+W[2],d=U.originalLine,U.originalLine+=1,U.originalColumn=g+W[3],g=U.originalColumn,W.length>4&&(U.name=w+W[4],w+=W[4])),A.push(U),typeof U.originalLine=="number"&&O.push(U)}i(A,e.compareByGeneratedPositionsDeflated),this.__generatedMappings=A,i(O,e.compareByOriginalPositions),this.__originalMappings=O},s.prototype._findMapping=function(f,p,c,h,d,g){if(f[c]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+f[c]);if(f[h]<0)throw new TypeError("Column must be greater than or equal to 0, got "+f[h]);return t.search(f,p,d,g)},s.prototype.computeColumnSpans=function(){for(var f=0;f<this._generatedMappings.length;++f){var p=this._generatedMappings[f];if(f+1<this._generatedMappings.length){var c=this._generatedMappings[f+1];if(p.generatedLine===c.generatedLine){p.lastGeneratedColumn=c.generatedColumn-1;continue}}p.lastGeneratedColumn=1/0}},s.prototype.originalPositionFor=function(f){var p={generatedLine:e.getArg(f,"line"),generatedColumn:e.getArg(f,"column")},c=this._findMapping(p,this._generatedMappings,"generatedLine","generatedColumn",e.compareByGeneratedPositionsDeflated,e.getArg(f,"bias",o.GREATEST_LOWER_BOUND));if(c>=0){var h=this._generatedMappings[c];if(h.generatedLine===p.generatedLine){var d=e.getArg(h,"source",null);d!==null&&(d=this._sources.at(d),d=e.computeSourceURL(this.sourceRoot,d,this._sourceMapURL));var g=e.getArg(h,"name",null);return g!==null&&(g=this._names.at(g)),{source:d,line:e.getArg(h,"originalLine",null),column:e.getArg(h,"originalColumn",null),name:g}}}return{source:null,line:null,column:null,name:null}},s.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(f){return f==null}):!1},s.prototype.sourceContentFor=function(f,p){if(!this.sourcesContent)return null;var c=this._findSourceIndex(f);if(c>=0)return this.sourcesContent[c];var h=f;this.sourceRoot!=null&&(h=e.relative(this.sourceRoot,h));var d;if(this.sourceRoot!=null&&(d=e.urlParse(this.sourceRoot))){var g=h.replace(/^file:\/\//,"");if(d.scheme=="file"&&this._sources.has(g))return this.sourcesContent[this._sources.indexOf(g)];if((!d.path||d.path=="/")&&this._sources.has("/"+h))return this.sourcesContent[this._sources.indexOf("/"+h)]}if(p)return null;throw new Error('"'+h+'" is not in the SourceMap.')},s.prototype.generatedPositionFor=function(f){var p=e.getArg(f,"source");if(p=this._findSourceIndex(p),p<0)return{line:null,column:null,lastColumn:null};var c={source:p,originalLine:e.getArg(f,"line"),originalColumn:e.getArg(f,"column")},h=this._findMapping(c,this._originalMappings,"originalLine","originalColumn",e.compareByOriginalPositions,e.getArg(f,"bias",o.GREATEST_LOWER_BOUND));if(h>=0){var d=this._originalMappings[h];if(d.source===c.source)return{line:e.getArg(d,"generatedLine",null),column:e.getArg(d,"generatedColumn",null),lastColumn:e.getArg(d,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},un.BasicSourceMapConsumer=s;function a(u,f){var p=u;typeof u=="string"&&(p=e.parseSourceMapInput(u));var c=e.getArg(p,"version"),h=e.getArg(p,"sections");if(c!=this._version)throw new Error("Unsupported version: "+c);this._sources=new n,this._names=new n;var d={line:-1,column:0};this._sections=h.map(function(g){if(g.url)throw new Error("Support for url field in sections not implemented.");var E=e.getArg(g,"offset"),w=e.getArg(E,"line"),_=e.getArg(E,"column");if(w<d.line||w===d.line&&_<d.column)throw new Error("Section offsets must be ordered and non-overlapping.");return d=E,{generatedOffset:{generatedLine:w+1,generatedColumn:_+1},consumer:new o(e.getArg(g,"map"),f)}})}return a.prototype=Object.create(o.prototype),a.prototype.constructor=o,a.prototype._version=3,Object.defineProperty(a.prototype,"sources",{get:function(){for(var u=[],f=0;f<this._sections.length;f++)for(var p=0;p<this._sections[f].consumer.sources.length;p++)u.push(this._sections[f].consumer.sources[p]);return u}}),a.prototype.originalPositionFor=function(f){var p={generatedLine:e.getArg(f,"line"),generatedColumn:e.getArg(f,"column")},c=t.search(p,this._sections,function(d,g){var E=d.generatedLine-g.generatedOffset.generatedLine;return E||d.generatedColumn-g.generatedOffset.generatedColumn}),h=this._sections[c];return h?h.consumer.originalPositionFor({line:p.generatedLine-(h.generatedOffset.generatedLine-1),column:p.generatedColumn-(h.generatedOffset.generatedLine===p.generatedLine?h.generatedOffset.generatedColumn-1:0),bias:f.bias}):{source:null,line:null,column:null,name:null}},a.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(f){return f.consumer.hasContentsOfAllSources()})},a.prototype.sourceContentFor=function(f,p){for(var c=0;c<this._sections.length;c++){var h=this._sections[c],d=h.consumer.sourceContentFor(f,!0);if(d)return d}if(p)return null;throw new Error('"'+f+'" is not in the SourceMap.')},a.prototype.generatedPositionFor=function(f){for(var p=0;p<this._sections.length;p++){var c=this._sections[p];if(c.consumer._findSourceIndex(e.getArg(f,"source"))!==-1){var h=c.consumer.generatedPositionFor(f);if(h){var d={line:h.line+(c.generatedOffset.generatedLine-1),column:h.column+(c.generatedOffset.generatedLine===h.line?c.generatedOffset.generatedColumn-1:0)};return d}}}return{line:null,column:null}},a.prototype._parseMappings=function(f,p){this.__generatedMappings=[],this.__originalMappings=[];for(var c=0;c<this._sections.length;c++)for(var h=this._sections[c],d=h.consumer._generatedMappings,g=0;g<d.length;g++){var E=d[g],w=h.consumer._sources.at(E.source);w=e.computeSourceURL(h.consumer.sourceRoot,w,this._sourceMapURL),this._sources.add(w),w=this._sources.indexOf(w);var _=null;E.name&&(_=h.consumer._names.at(E.name),this._names.add(_),_=this._names.indexOf(_));var I={source:w,generatedLine:E.generatedLine+(h.generatedOffset.generatedLine-1),generatedColumn:E.generatedColumn+(h.generatedOffset.generatedLine===E.generatedLine?h.generatedOffset.generatedColumn-1:0),originalLine:E.originalLine,originalColumn:E.originalColumn,name:_};this.__generatedMappings.push(I),typeof I.originalLine=="number"&&this.__originalMappings.push(I)}i(this.__generatedMappings,e.compareByGeneratedPositionsDeflated),i(this.__originalMappings,e.compareByOriginalPositions)},un.IndexedSourceMapConsumer=a,un}var Ii={},$a;function Yd(){if($a)return Ii;$a=1;var e=Ga().SourceMapGenerator,t=ln(),n=/(\r?\n)/,r=10,i="$$$isSourceNode$$$";function o(s,l,a,u,f){this.children=[],this.sourceContents={},this.line=s==null?null:s,this.column=l==null?null:l,this.source=a==null?null:a,this.name=f==null?null:f,this[i]=!0,u!=null&&this.add(u)}return o.fromStringWithSourceMap=function(l,a,u){var f=new o,p=l.split(n),c=0,h=function(){var _=m(),I=m()||"";return _+I;function m(){return c<p.length?p[c++]:void 0}},d=1,g=0,E=null;return a.eachMapping(function(_){if(E!==null)if(d<_.generatedLine)w(E,h()),d++,g=0;else{var I=p[c]||"",m=I.substr(0,_.generatedColumn-g);p[c]=I.substr(_.generatedColumn-g),g=_.generatedColumn,w(E,m),E=_;return}for(;d<_.generatedLine;)f.add(h()),d++;if(g<_.generatedColumn){var I=p[c]||"";f.add(I.substr(0,_.generatedColumn)),p[c]=I.substr(_.generatedColumn),g=_.generatedColumn}E=_},this),c<p.length&&(E&&w(E,h()),f.add(p.splice(c).join(""))),a.sources.forEach(function(_){var I=a.sourceContentFor(_);I!=null&&(u!=null&&(_=t.join(u,_)),f.setSourceContent(_,I))}),f;function w(_,I){if(_===null||_.source===void 0)f.add(I);else{var m=u?t.join(u,_.source):_.source;f.add(new o(_.originalLine,_.originalColumn,m,I,_.name))}}},o.prototype.add=function(l){if(Array.isArray(l))l.forEach(function(a){this.add(a)},this);else if(l[i]||typeof l=="string")l&&this.children.push(l);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+l);return this},o.prototype.prepend=function(l){if(Array.isArray(l))for(var a=l.length-1;a>=0;a--)this.prepend(l[a]);else if(l[i]||typeof l=="string")this.children.unshift(l);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+l);return this},o.prototype.walk=function(l){for(var a,u=0,f=this.children.length;u<f;u++)a=this.children[u],a[i]?a.walk(l):a!==""&&l(a,{source:this.source,line:this.line,column:this.column,name:this.name})},o.prototype.join=function(l){var a,u,f=this.children.length;if(f>0){for(a=[],u=0;u<f-1;u++)a.push(this.children[u]),a.push(l);a.push(this.children[u]),this.children=a}return this},o.prototype.replaceRight=function(l,a){var u=this.children[this.children.length-1];return u[i]?u.replaceRight(l,a):typeof u=="string"?this.children[this.children.length-1]=u.replace(l,a):this.children.push("".replace(l,a)),this},o.prototype.setSourceContent=function(l,a){this.sourceContents[t.toSetString(l)]=a},o.prototype.walkSourceContents=function(l){for(var a=0,u=this.children.length;a<u;a++)this.children[a][i]&&this.children[a].walkSourceContents(l);for(var f=Object.keys(this.sourceContents),a=0,u=f.length;a<u;a++)l(t.fromSetString(f[a]),this.sourceContents[f[a]])},o.prototype.toString=function(){var l="";return this.walk(function(a){l+=a}),l},o.prototype.toStringWithSourceMap=function(l){var a={code:"",line:1,column:0},u=new e(l),f=!1,p=null,c=null,h=null,d=null;return this.walk(function(g,E){a.code+=g,E.source!==null&&E.line!==null&&E.column!==null?((p!==E.source||c!==E.line||h!==E.column||d!==E.name)&&u.addMapping({source:E.source,original:{line:E.line,column:E.column},generated:{line:a.line,column:a.column},name:E.name}),p=E.source,c=E.line,h=E.column,d=E.name,f=!0):f&&(u.addMapping({generated:{line:a.line,column:a.column}}),p=null,f=!1);for(var w=0,_=g.length;w<_;w++)g.charCodeAt(w)===r?(a.line++,a.column=0,w+1===_?(p=null,f=!1):f&&u.addMapping({source:E.source,original:{line:E.line,column:E.column},generated:{line:a.line,column:a.column},name:E.name})):a.column++}),this.walkSourceContents(function(g,E){u.setSourceContent(g,E)}),{code:a.code,map:u}},Ii.SourceNode=o,Ii}var Ya;function Zd(){return Ya||(Ya=1,sn.SourceMapGenerator=Ga().SourceMapGenerator,sn.SourceMapConsumer=$d().SourceMapConsumer,sn.SourceNode=Yd().SourceNode),sn}(function(e,t){t.__esModule=!0;var n=X,r=void 0;try{var i=Zd();r=i.SourceNode}catch(l){}r||(r=function(l,a,u,f){this.src="",f&&this.add(f)},r.prototype={add:function(a){n.isArray(a)&&(a=a.join("")),this.src+=a},prepend:function(a){n.isArray(a)&&(a=a.join("")),this.src=a+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}});function o(l,a,u){if(n.isArray(l)){for(var f=[],p=0,c=l.length;p<c;p++)f.push(a.wrap(l[p],u));return f}else if(typeof l=="boolean"||typeof l=="number")return l+"";return l}function s(l){this.srcFile=l,this.source=[]}s.prototype={isEmpty:function(){return!this.source.length},prepend:function(a,u){this.source.unshift(this.wrap(a,u))},push:function(a,u){this.source.push(this.wrap(a,u))},merge:function(){var a=this.empty();return this.each(function(u){a.add(["  ",u,`
`])}),a},each:function(a){for(var u=0,f=this.source.length;u<f;u++)a(this.source[u])},empty:function(){var a=this.currentLocation||{start:{}};return new r(a.start.line,a.start.column,this.srcFile)},wrap:function(a){var u=arguments.length<=1||arguments[1]===void 0?this.currentLocation||{start:{}}:arguments[1];return a instanceof r?a:(a=o(a,this,u),new r(u.start.line,u.start.column,this.srcFile,a))},functionCall:function(a,u,f){return f=this.generateList(f),this.wrap([a,u?"."+u+"(":"(",f,")"])},quotedString:function(a){return'"'+(a+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(a){var u=this,f=[];Object.keys(a).forEach(function(c){var h=o(a[c],u);h!=="undefined"&&f.push([u.quotedString(c),":",h])});var p=this.generateList(f);return p.prepend("{"),p.add("}"),p},generateList:function(a){for(var u=this.empty(),f=0,p=a.length;f<p;f++)f&&u.add(","),u.add(o(a[f],this));return u},generateArray:function(a){var u=this.generateList(a);return u.prepend("["),u.add("]"),u}},t.default=s,e.exports=t.default})(Ei,Ei.exports);var Kd=Ei.exports;(function(e,t){t.__esModule=!0;function n(c){return c&&c.__esModule?c:{default:c}}var r=we,i=Ne,o=n(i),s=X,l=Kd,a=n(l);function u(c){this.value=c}function f(){}f.prototype={nameLookup:function(h,d){return this.internalNameLookup(h,d)},depthedLookup:function(h){return[this.aliasable("container.lookup"),"(depths, ",JSON.stringify(h),")"]},compilerInfo:function(){var h=r.COMPILER_REVISION,d=r.REVISION_CHANGES[h];return[h,d]},appendToBuffer:function(h,d,g){return s.isArray(h)||(h=[h]),h=this.source.wrap(h,d),this.environment.isSimple?["return ",h,";"]:g?["buffer += ",h,";"]:(h.appendToBuffer=!0,h)},initializeBuffer:function(){return this.quotedString("")},internalNameLookup:function(h,d){return this.lookupPropertyFunctionIsUsed=!0,["lookupProperty(",h,",",JSON.stringify(d),")"]},lookupPropertyFunctionIsUsed:!1,compile:function(h,d,g,E){this.environment=h,this.options=d,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!E,this.name=this.environment.name,this.isChild=!!g,this.context=g||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(h,d),this.useDepths=this.useDepths||h.useDepths||h.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||h.useBlockParams;var w=h.opcodes,_=void 0,I=void 0,m=void 0,T=void 0;for(m=0,T=w.length;m<T;m++)_=w[m],this.source.currentLocation=_.loc,I=I||_.loc,this[_.opcode].apply(this,_.args);if(this.source.currentLocation=I,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new o.default("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend(["var decorators = container.decorators, ",this.lookupPropertyFunctionVarDeclaration(),`;
`]),this.decorators.push("return fn;"),E?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend(`function(fn, props, container, depth0, data, blockParams, depths) {
`),this.decorators.push(`}
`),this.decorators=this.decorators.merge()));var O=this.createFunctionContext(E);if(this.isChild)return O;var A={compiler:this.compilerInfo(),main:O};this.decorators&&(A.main_d=this.decorators,A.useDecorators=!0);var U=this.context,Q=U.programs,W=U.decorators;for(m=0,T=Q.length;m<T;m++)Q[m]&&(A[m]=Q[m],W[m]&&(A[m+"_d"]=W[m],A.useDecorators=!0));return this.environment.usePartial&&(A.usePartial=!0),this.options.data&&(A.useData=!0),this.useDepths&&(A.useDepths=!0),this.useBlockParams&&(A.useBlockParams=!0),this.options.compat&&(A.compat=!0),E?A.compilerOptions=this.options:(A.compiler=JSON.stringify(A.compiler),this.source.currentLocation={start:{line:1,column:0}},A=this.objectLiteral(A),d.srcName?(A=A.toStringWithSourceMap({file:d.destName}),A.map=A.map&&A.map.toString()):A=A.toString()),A},preamble:function(){this.lastContext=0,this.source=new a.default(this.options.srcName),this.decorators=new a.default(this.options.srcName)},createFunctionContext:function(h){var d=this,g="",E=this.stackVars.concat(this.registers.list);E.length>0&&(g+=", "+E.join(", "));var w=0;Object.keys(this.aliases).forEach(function(m){var T=d.aliases[m];T.children&&T.referenceCount>1&&(g+=", alias"+ ++w+"="+m,T.children[0]="alias"+w)}),this.lookupPropertyFunctionIsUsed&&(g+=", "+this.lookupPropertyFunctionVarDeclaration());var _=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&_.push("blockParams"),this.useDepths&&_.push("depths");var I=this.mergeSource(g);return h?(_.push(I),Function.apply(this,_)):this.source.wrap(["function(",_.join(","),`) {
  `,I,"}"])},mergeSource:function(h){var d=this.environment.isSimple,g=!this.forceBuffer,E=void 0,w=void 0,_=void 0,I=void 0;return this.source.each(function(m){m.appendToBuffer?(_?m.prepend("  + "):_=m,I=m):(_&&(w?_.prepend("buffer += "):E=!0,I.add(";"),_=I=void 0),w=!0,d||(g=!1))}),g?_?(_.prepend("return "),I.add(";")):w||this.source.push('return "";'):(h+=", buffer = "+(E?"":this.initializeBuffer()),_?(_.prepend("return buffer + "),I.add(";")):this.source.push("return buffer;")),h&&this.source.prepend("var "+h.substring(2)+(E?"":`;
`)),this.source.merge()},lookupPropertyFunctionVarDeclaration:function(){return`
      lookupProperty = container.lookupProperty || function(parent, propertyName) {
        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {
          return parent[propertyName];
        }
        return undefined
    }
    `.trim()},blockValue:function(h){var d=this.aliasable("container.hooks.blockHelperMissing"),g=[this.contextName(0)];this.setupHelperArgs(h,0,g);var E=this.popStack();g.splice(1,0,E),this.push(this.source.functionCall(d,"call",g))},ambiguousBlockValue:function(){var h=this.aliasable("container.hooks.blockHelperMissing"),d=[this.contextName(0)];this.setupHelperArgs("",0,d,!0),this.flushInline();var g=this.topStack();d.splice(1,0,g),this.pushSource(["if (!",this.lastHelper,") { ",g," = ",this.source.functionCall(h,"call",d),"}"])},appendContent:function(h){this.pendingContent?h=this.pendingContent+h:this.pendingLocation=this.source.currentLocation,this.pendingContent=h},append:function(){if(this.isInline())this.replaceStack(function(d){return[" != null ? ",d,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var h=this.popStack();this.pushSource(["if (",h," != null) { ",this.appendToBuffer(h,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(h){this.lastContext=h},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(h,d,g,E){var w=0;!E&&this.options.compat&&!this.lastContext?this.push(this.depthedLookup(h[w++])):this.pushContext(),this.resolvePath("context",h,w,d,g)},lookupBlockParam:function(h,d){this.useBlockParams=!0,this.push(["blockParams[",h[0],"][",h[1],"]"]),this.resolvePath("context",d,1)},lookupData:function(h,d,g){h?this.pushStackLiteral("container.data(data, "+h+")"):this.pushStackLiteral("data"),this.resolvePath("data",d,0,!0,g)},resolvePath:function(h,d,g,E,w){var _=this;if(this.options.strict||this.options.assumeObjects){this.push(p(this.options.strict&&w,this,d,g,h));return}for(var I=d.length;g<I;g++)this.replaceStack(function(m){var T=_.nameLookup(m,d[g],h);return E?[" && ",T]:[" != null ? ",T," : ",m]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(h,d){this.pushContext(),this.pushString(d),d!=="SubExpression"&&(typeof h=="string"?this.pushString(h):this.pushStackLiteral(h))},emptyHash:function(h){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(h?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:{},types:[],contexts:[],ids:[]}},popHash:function(){var h=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(h.ids)),this.stringParams&&(this.push(this.objectLiteral(h.contexts)),this.push(this.objectLiteral(h.types))),this.push(this.objectLiteral(h.values))},pushString:function(h){this.pushStackLiteral(this.quotedString(h))},pushLiteral:function(h){this.pushStackLiteral(h)},pushProgram:function(h){h!=null?this.pushStackLiteral(this.programExpression(h)):this.pushStackLiteral(null)},registerDecorator:function(h,d){var g=this.nameLookup("decorators",d,"decorator"),E=this.setupHelperArgs(d,h);this.decorators.push(["fn = ",this.decorators.functionCall(g,"",["fn","props","container",E])," || fn;"])},invokeHelper:function(h,d,g){var E=this.popStack(),w=this.setupHelper(h,d),_=[];g&&_.push(w.name),_.push(E),this.options.strict||_.push(this.aliasable("container.hooks.helperMissing"));var I=["(",this.itemsSeparatedBy(_,"||"),")"],m=this.source.functionCall(I,"call",w.callParams);this.push(m)},itemsSeparatedBy:function(h,d){var g=[];g.push(h[0]);for(var E=1;E<h.length;E++)g.push(d,h[E]);return g},invokeKnownHelper:function(h,d){var g=this.setupHelper(h,d);this.push(this.source.functionCall(g.name,"call",g.callParams))},invokeAmbiguous:function(h,d){this.useRegister("helper");var g=this.popStack();this.emptyHash();var E=this.setupHelper(0,h,d),w=this.lastHelper=this.nameLookup("helpers",h,"helper"),_=["(","(helper = ",w," || ",g,")"];this.options.strict||(_[0]="(helper = ",_.push(" != null ? helper : ",this.aliasable("container.hooks.helperMissing"))),this.push(["(",_,E.paramsInit?["),(",E.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",E.callParams)," : helper))"])},invokePartial:function(h,d,g){var E=[],w=this.setupParams(d,1,E);h&&(d=this.popStack(),delete w.name),g&&(w.indent=JSON.stringify(g)),w.helpers="helpers",w.partials="partials",w.decorators="container.decorators",h?E.unshift(d):E.unshift(this.nameLookup("partials",d,"partial")),this.options.compat&&(w.depths="depths"),w=this.objectLiteral(w),E.push(w),this.push(this.source.functionCall("container.invokePartial","",E))},assignToHash:function(h){var d=this.popStack(),g=void 0,E=void 0,w=void 0;this.trackIds&&(w=this.popStack()),this.stringParams&&(E=this.popStack(),g=this.popStack());var _=this.hash;g&&(_.contexts[h]=g),E&&(_.types[h]=E),w&&(_.ids[h]=w),_.values[h]=d},pushId:function(h,d,g){h==="BlockParam"?this.pushStackLiteral("blockParams["+d[0]+"].path["+d[1]+"]"+(g?" + "+JSON.stringify("."+g):"")):h==="PathExpression"?this.pushString(d):h==="SubExpression"?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:f,compileChildren:function(h,d){for(var g=h.children,E=void 0,w=void 0,_=0,I=g.length;_<I;_++){E=g[_],w=new this.compiler;var m=this.matchExistingProgram(E);if(m==null){this.context.programs.push("");var T=this.context.programs.length;E.index=T,E.name="program"+T,this.context.programs[T]=w.compile(E,d,this.context,!this.precompile),this.context.decorators[T]=w.decorators,this.context.environments[T]=E,this.useDepths=this.useDepths||w.useDepths,this.useBlockParams=this.useBlockParams||w.useBlockParams,E.useDepths=this.useDepths,E.useBlockParams=this.useBlockParams}else E.index=m.index,E.name="program"+m.index,this.useDepths=this.useDepths||m.useDepths,this.useBlockParams=this.useBlockParams||m.useBlockParams}},matchExistingProgram:function(h){for(var d=0,g=this.context.environments.length;d<g;d++){var E=this.context.environments[d];if(E&&E.equals(h))return E}},programExpression:function(h){var d=this.environment.children[h],g=[d.index,"data",d.blockParams];return(this.useBlockParams||this.useDepths)&&g.push("blockParams"),this.useDepths&&g.push("depths"),"container.program("+g.join(", ")+")"},useRegister:function(h){this.registers[h]||(this.registers[h]=!0,this.registers.list.push(h))},push:function(h){return h instanceof u||(h=this.source.wrap(h)),this.inlineStack.push(h),h},pushStackLiteral:function(h){this.push(new u(h))},pushSource:function(h){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),h&&this.source.push(h)},replaceStack:function(h){var d=["("],g=void 0,E=void 0,w=void 0;if(!this.isInline())throw new o.default("replaceStack on non-inline");var _=this.popStack(!0);if(_ instanceof u)g=[_.value],d=["(",g],w=!0;else{E=!0;var I=this.incrStack();d=["((",this.push(I)," = ",_,")"],g=this.topStack()}var m=h.call(this,g);w||this.popStack(),E&&this.stackSlot--,this.push(d.concat(m,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var h=this.inlineStack;this.inlineStack=[];for(var d=0,g=h.length;d<g;d++){var E=h[d];if(E instanceof u)this.compileStack.push(E);else{var w=this.incrStack();this.pushSource([w," = ",E,";"]),this.compileStack.push(w)}}},isInline:function(){return this.inlineStack.length},popStack:function(h){var d=this.isInline(),g=(d?this.inlineStack:this.compileStack).pop();if(!h&&g instanceof u)return g.value;if(!d){if(!this.stackSlot)throw new o.default("Invalid stack pop");this.stackSlot--}return g},topStack:function(){var h=this.isInline()?this.inlineStack:this.compileStack,d=h[h.length-1];return d instanceof u?d.value:d},contextName:function(h){return this.useDepths&&h?"depths["+h+"]":"depth"+h},quotedString:function(h){return this.source.quotedString(h)},objectLiteral:function(h){return this.source.objectLiteral(h)},aliasable:function(h){var d=this.aliases[h];return d?(d.referenceCount++,d):(d=this.aliases[h]=this.source.wrap(h),d.aliasable=!0,d.referenceCount=1,d)},setupHelper:function(h,d,g){var E=[],w=this.setupHelperArgs(d,h,E,g),_=this.nameLookup("helpers",d,"helper"),I=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})");return{params:E,paramsInit:w,name:_,callParams:[I].concat(E)}},setupParams:function(h,d,g){var E={},w=[],_=[],I=[],m=!g,T=void 0;m&&(g=[]),E.name=this.quotedString(h),E.hash=this.popStack(),this.trackIds&&(E.hashIds=this.popStack()),this.stringParams&&(E.hashTypes=this.popStack(),E.hashContexts=this.popStack());var O=this.popStack(),A=this.popStack();(A||O)&&(E.fn=A||"container.noop",E.inverse=O||"container.noop");for(var U=d;U--;)T=this.popStack(),g[U]=T,this.trackIds&&(I[U]=this.popStack()),this.stringParams&&(_[U]=this.popStack(),w[U]=this.popStack());return m&&(E.args=this.source.generateArray(g)),this.trackIds&&(E.ids=this.source.generateArray(I)),this.stringParams&&(E.types=this.source.generateArray(_),E.contexts=this.source.generateArray(w)),this.options.data&&(E.data="data"),this.useBlockParams&&(E.blockParams="blockParams"),E},setupHelperArgs:function(h,d,g,E){var w=this.setupParams(h,d,g);return w.loc=JSON.stringify(this.source.currentLocation),w=this.objectLiteral(w),E?(this.useRegister("options"),g.push("options"),["options=",w]):g?(g.push(w),""):w}},function(){for(var c="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),h=f.RESERVED_WORDS={},d=0,g=c.length;d<g;d++)h[c[d]]=!0}(),f.isValidJavaScriptVariableName=function(c){return!f.RESERVED_WORDS[c]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(c)};function p(c,h,d,g,E){var w=h.popStack(),_=d.length;for(c&&_--;g<_;g++)w=h.nameLookup(w,d[g],E);return c?[h.aliasable("container.strict"),"(",w,", ",h.quotedString(d[g]),", ",JSON.stringify(h.source.currentLocation)," )"]:w}t.default=f,e.exports=t.default})(vi,vi.exports);var Xd=vi.exports;(function(e,t){t.__esModule=!0;function n(_){return _&&_.__esModule?_:{default:_}}var r=gd,i=n(r),o=Pa,s=n(o),l=tn,a=nn,u=Xd,f=n(u),p=Na,c=n(p),h=Ca,d=n(h),g=i.default.create;function E(){var _=g();return _.compile=function(I,m){return a.compile(I,m,_)},_.precompile=function(I,m){return a.precompile(I,m,_)},_.AST=s.default,_.Compiler=a.Compiler,_.JavaScriptCompiler=f.default,_.Parser=l.parser,_.parse=l.parse,_.parseWithoutProcessing=l.parseWithoutProcessing,_}var w=E();w.create=E,d.default(w),w.Visitor=c.default,w.default=w,t.default=w,e.exports=t.default})(Vr,Vr.exports);var Qd=Vr.exports,at=Kc(Qd),Jd=Object.defineProperty,Za=Object.getOwnPropertySymbols,eh=Object.prototype.hasOwnProperty,th=Object.prototype.propertyIsEnumerable,Ka=(e,t,n)=>t in e?Jd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Xa=(e,t)=>{for(var n in t||(t={}))eh.call(t,n)&&Ka(e,n,t[n]);if(Za)for(var n of Za(t))th.call(t,n)&&Ka(e,n,t[n]);return e};class cn extends Hr{constructor(){super();const t=cn.getBuiltInHandlebarsHelpers();for(const[n,r]of Object.entries(t))at.registerHelper(n,r)}static getBuiltInHandlebarsHelpers(){return{subVar:dh,each:gh,isPreview:ph}}getContent(t,n,r,i){var o,s;let l=`transformation ${n.transformerName}`;r!==void 0&&(l=`personalization ${r.personalizationId}, `+l);const a=this,u=this.getHandlebarsTemplate(t),f=Xa({},(o=n.substitutionValues)!=null?o:{}),p=(s=t.substitutionDefinitions)!=null?s:{},c={},h=Mr(r==null?void 0:r.personalizationId,i.pec.name);eo("DEBUG")&&y.log.debug(`For ${l}, rendering of template: \r
	${u} \r
SubstitutionValues: \r
	${JSON.stringify(f)} \r
Preview: ${String(h)}`),Object.entries(p).forEach(([T,O])=>{var A;c[T]=(A=O.configType)!=null?A:Re.SchemaPath,(!(T in f)||T in f&&(D(f[T])||f[T]===""))&&(f[T]=O.defaultValue)});const d=Ue(),g=ia(i.pec.transformationConfig.engagementDestination,t.name,t.transformerType,d),E=sa(),w=this.transformerSupportsAutoInjection(t),_={data:{_sf_personalization:{subVar:f,subConfigTypes:c,destinationName:g,engagementConfig:d,ecSupportsAutoInjection:E,transformerSupportsAutoInjection:w,transformerInstance:a,isPreview:h}}};let I=a.compileTransformerDetails(u,r,_,i.status);E&&w&&r!==void 0?I=oh(a,I,r.personalizationId,g):(y.log.trace(`${E?"Transformer":"Engagement Config"} does not support auto-injection of default engagement attributes`),i.status.update(new k("No auto-injection of default engagement attributes")));const m=_n();return b(m)&&(I=ih(I,m)),y.log.trace(`Rendered Content: ${I}`),i.status.update(new k("Rendered Content")),String(I)}compileTransformerDetails(t,n,r,i){const o=document.createElement("script");i.update(new k("Precompiling template"));const s=at.precompile(t);if(!b(s))throw new Error("Error while compiling handlebars template, precompilation did not result in a string");o.textContent="window.SalesforceInteractions.Personalization.precompiledTemplate = "+s;const l=_n();b(l)&&(y.log.debug("Adding nonce to inline script for handlebars precompile"),o.nonce=l),document.head.appendChild(o);const a=window.SalesforceInteractions.Personalization.precompiledTemplate;let u;try{if(!N(a))throw new Error("Error while compiling handlebars template, compiled template is undefined. This is likely due to a Content Security Policy (CSP) violation.");i.update(new k("Forming template")),u=at.template(a)}finally{delete window.SalesforceInteractions.Personalization.precompiledTemplate,document.head.removeChild(o)}const f=n!==void 0?Hr.sanitizer.sanitizeObject(n):{};return i.update(new k("Using template")),u(f,r)}}function nh(e,t){if(!b(e))throw new B(j.InvalidHandlebarsHelperName,"Handlebars helper name is undefined");if(D(t))throw new B(j.InvalidHandlebarsHelperFunction,"Handlebars helper function is undefined");if(Object.keys(cn.getBuiltInHandlebarsHelpers()).includes(e))throw new B(j.InvalidHandlebarsHelperName,`Handlebars helper ${e} is a reserved name. Please use a different name.`)}function rh(e,t){if(y.log.debug(`Adding the following custom handlebars helper: ${e}`),!Ge()){y.log.error("Handlebars helpers can only be added before SalesforceInteractions.init is called.");return}try{nh(e,t),at.registerHelper(e,(...n)=>{y.log.debug(`Custom handlebars helper ${e} called with following parameters:`,n);const r=t(...n);return y.log.debug(`Custom handlebars helper ${e} returned:`,r),r})}catch(n){y.log.error(`Custom handlebars helper ${e} could not be added due to: ${K(n).message}`)}}function ih(e,t){return Ai(e,n=>{for(const r of n)r instanceof HTMLStyleElement&&(y.log.debug("Adding nonce to inline style",r),r.nonce=t)})}function oh(e,t,n,r){return Ai(t,i=>{for(let o=0;o<i.length;o++)e.autoInjectDefaultRootAttributes(i[o],n,r,!0)})}function jn(e,t,n,r){if(!N(e))return;let i;for(const o of Object.values(e)){if(i!==void 0)break;if(H(o))if(n!==void 0)o[n]===r?i=t!=null?t:e:i=jn(o[n],e,n,r);else for(const s of o){if(i!==void 0)break;if(s===r)return t!=null?t:e;i=jn(s,e,void 0,r)}else N(o)&&(i=jn(o,e,n,r))}return i}function ah(e,t,n,r){var i,o,s,l;if(((i=r==null?void 0:r.data)==null?void 0:i.root)===void 0)return[e,!1];let a=Xa({},e),u=!1;if(t.startsWith("@root"))a=(o=r==null?void 0:r.data)==null?void 0:o.root,u=!0;else if(n.depth===1){const f=jn((s=r==null?void 0:r.data)==null?void 0:s.root,void 0,(l=r==null?void 0:r.data)==null?void 0:l.index,e);f!==void 0&&(a=f)}return[a,u]}function sh(e,t,n){let r=!1,i=!1;return n.parts.forEach(o=>{if(!i&&!(t&&o==="root")){const s=parseInt(o);!isNaN(s)&&H(e)?(e=e[s],r=!0):o in e?(e=e[o],r=!0):(i=!0,r=!1,e=void 0)}}),[e,r]}function lh(e){let t;return b(e,!0)?t=e:D(e)?(y.log.debug("Null/undefined substitution value provided to handlebars"),t=""):(y.log.debug("Coercing ${} substitution value provided to handlebars"),t=String(e)),t}function uh(e,t,n,r){const i=lh(t);try{let o;return n===Re.Static?o=fh(i):o=ch(e,i,r),y.log.trace("Handlebars helper subVar returned:",o),o}catch(o){y.log.warn(`Could not parse the substitution value path ${i} due to an error`,o)}return null}function ch(e,t,n){const r=at.parseWithoutProcessing(`{{${t}}}`);if((r==null?void 0:r.body)===void 0||r.body.length===0||r.body[0].type!=="MustacheStatement")return y.log.warn(`Could not parse the substitution value path ${t} via handlebars`),null;const i=r.body[0];if(i.path===void 0)return y.log.warn(`Could not parse the substitution value path ${t} via handlebars treating it as a Mustache Statement`),null;const o=i.path;if(o.type!=="PathExpression")return y.log.warn(`Could not parse the substitution value path ${t} via handlebars expecting it to be a Path Expression`),null;const s=o,[l,a]=ah(e,t,s,n),[u,f]=sh(l,a,s);return f?u:null}function fh(e){const t=at.parseWithoutProcessing(`${e}`);return(t==null?void 0:t.body)===void 0||t.body.length===0||t.body[0].type!=="ContentStatement"?(y.log.warn(`Could not parse the substitution value ${e} via handlebars`),null):e}function dh(e,t){var n,r,i;if(y.log.trace("Handlebars helper subVar called with following parameters:",e),!b(e)||((r=(n=t==null?void 0:t.data)==null?void 0:n._sf_personalization)==null?void 0:r.subVar)===void 0||!(e in t.data._sf_personalization.subVar))return null;const o=t.data._sf_personalization.subVar[e],s=(i=t.data._sf_personalization.subConfigTypes[e])!=null?i:Re.SchemaPath;return uh(this,o,s,t)}function hh(e,t,n){let r=n;if(e._sf_personalization.ecSupportsAutoInjection&&e._sf_personalization.transformerSupportsAutoInjection){const i=e._sf_personalization.transformerInstance.buildModifiersIfItemRelated(t,e._sf_personalization.destinationName,e._sf_personalization.engagementConfig);!D(i)&&b(n)&&(r=Ai(n,o=>{for(let s=0,l=o.length;s<l;s++){const a=o[s],u=s===0;e._sf_personalization.transformerInstance.autoInjectDefaultItemAttributes(a,void 0,i,u)}}))}else y.log.trace(`${e._sf_personalization.ecSupportsAutoInjection?"Transformer":"Engagement Config"} does not support auto-injection of default item engagement attributes`);return r}function Ai(e,t){try{const n=document.createElement("div");return n.innerHTML=e,t(n.children),n.innerHTML}catch(n){return y.log.debug(`Could not parse/modify string as html (and might not be), so returning as-is: "${e}"`),e}}function ph(e){var t,n,r;y.log.trace("Handlebars helper isPreview called");const i=(r=(n=(t=e==null?void 0:e.data)==null?void 0:t._sf_personalization)==null?void 0:n.isPreview)!=null?r:!1;return y.log.trace("Handlebars helper isPreview returned:",i),i}function gh(e,t){if(y.log.trace("Handlebars helper each called with following parameters:",e),!N(t))throw new Error("Must pass iterator to #each");const n=t.fn,r=t.inverse;let i=0,o="",s;at.Utils.isFunction(e)&&(e=e.call(this)),N(t.data)&&(s=at.Utils.createFrame(t.data));const l=(a,u,f,p)=>{s!==void 0&&(s.key=a,s.index=f,s.first=f===0,s.last=!!p);const c=n(u,{data:s,blockParams:[e[a],a]}),h=hh(s,u,c);o=o+h};if(!D(e)&&typeof e=="object"){const a=e;if(H(e,!0))for(let u=e.length;i<u;i++)i in e&&l(i,e[i],i,i===e.length-1);else if(Pl(e,!0)){const u=e.size;for(const[f,p]of e)l(f,p,i++,i===u)}else if(Nl(e,!0)){const u=e.size;for(const f of e)l(i,f,i++,i===u)}else if(typeof Symbol=="function"&&a[Symbol.iterator.toString()]!==void 0){const u=[],f=a[Symbol.iterator.toString()]();for(let p=f.next();p.done===!1;p=f.next())u.push(p.value);e=u;for(let p=e.length;i<p;i++)l(i,e[i],i,i===e.length-1)}else{let u;Object.keys(a).forEach(f=>{u!==void 0&&l(u,a[u],i-1,!1),u=f,i++}),u!==void 0&&l(u,a[u],i-1,!0)}}return i===0&&(o=r(this)),y.log.trace("Handlebars helper each returned:",o),o}class mh extends cn{validateTransformerDetails(t){if(!this.isHandlebarsTransformerDetails(t))throw new B(j.InvalidTransformerTypeDetails,"Transformer Type Details is not the correct type.",{context:{expectedType:"HandlebarsTransformerDetails"}});this.validateHandlebarsTransformerDetails(t)}isHandlebarsTransformerDetails(t){return(t==null?void 0:t.html)!==void 0}validateHandlebarsTransformerDetails(t){if(!N(t))throw new B(j.InvalidTransformerTypeDetailsType,"Transformer Type Details is not a valid object.");if(!b(t.html))throw new B(j.MissingTransformerTypeDetailsHtml,"Transformer Type Details html is required for the specific Transformer Type Details.",{context:{type:"HandlebarsTransformerDetails"}})}validateMethod(t){if(t===void 0)throw new M(R.MissingTransformationConfigMethod,"Transformation Config method is required for specific transformer type.",{context:{transformerType:ge.Handlebars}})}transform(t,n,r,i,o){const s=()=>this.getContent(t,n,i,o);return this.setContent(r,s,n,t.transformerType,o,i==null?void 0:i.personalizationId,o.pec.transformationConfig.method)}getHandlebarsTemplate(t){return t.transformerTypeDetails.html}transformerSupportsAutoInjection(t){var n;return!((n=t.transformerTypeDetails.disableAutoInjectionOfEngagementAttributes)!=null&&n)}}class vh extends cn{validateTransformerDetails(t){if(!this.isAgentTransformerDetails(t))throw new B(j.InvalidTransformerTypeDetails,"Transformer Type Details is not the correct type.",{context:{expectedType:"AgentScriptTransformerDetails"}});this.validateAgentTransformerDetails(t)}isAgentTransformerDetails(t){return(t==null?void 0:t.script)!==void 0}validateAgentTransformerDetails(t){if(!N(t))throw new B(j.InvalidTransformerTypeDetailsType,"Transformer Type Details is not a valid object.");if(!b(t.script))throw new B(j.MissingTransformerTypeDetailsHtml,"Transformer Type Details script is required for the specific Transformer Type Details.",{context:{expectedType:"AgentScriptTransformerDetails"}})}validateMethod(t){if(t!==void 0)throw new M(R.InvalidTransformationConfigMethod,"Transformation Config method is not allowed for specific transformer type.",{context:{transformerType:ge.AgentScript}})}transform(t,n,r,i,o){const s=()=>this.getContent(t,n,i,o);return this.setContent(r,s,n,t.transformerType,o,i==null?void 0:i.personalizationId,o.pec.transformationConfig.method)}getHandlebarsTemplate(t){return t.transformerTypeDetails.script}transformerSupportsAutoInjection(){return!1}supportsEngagementSelection(){return!1}}function Qa(e){switch(e){case ge.HtmlElementModifier:return new Zc;case ge.Handlebars:return new mh;case ge.AgentScript:return new vh;default:return}}function Ci(e){const t=Qa(e);if(t===void 0)throw new B(j.MissingImplementation,"Transformer does not have an implementation",{context:{transformerType:e}});return t}var Eh={name:"HTMLElementModifier",transformerType:ge.HtmlElementModifier,transformerCategory:nt.EmbeddedContent,transformerTypeDetails:{}};let Ke=Object.assign([],[Eh]);function Wn(){return Ke!=null?Ke:[]}function Ja(e,t=!1){function n(r){if(Ge()){if(!H(r,!0)){y.log.error("A list of transformers is required when adding to Transformers.");return}Ke===void 0&&(Ke=[]);let i=r;if(t){const o=Ke.map(s=>s.name);i=[],r.forEach(s=>{!b(s.name)||!o.includes(s.name)?i.push(s):y.log.debug(`Not adding Transformer "${s.name}" because it already exists`)})}i.forEach(o=>{try{if(wh(o),Ke.find(s=>o.name===s.name)!==void 0)throw new B(j.DuplicateTransformer,"Transformer already exists.",{context:{transformerName:o.name}});y.log.info("Adding the following Transformer: ",o),Ke.push(o)}catch(s){y.log.error(`Transformers could not be added due to: ${K(s).message}`,o)}})}else y.log.error("The list of Transformers can only be modified before SalesforceInteractions.init is called.")}if(b(e))try{const r=JSON.parse(e,Ji);n(r)}catch(r){y.log.error("JSON Transformers list could not be added due to: ",r)}else n(e)}function es(e){Ja(e)}function yh(e){Ja(e,!0)}function ts(e=Re.SchemaPath){switch(e){case Re.SchemaPath:case Re.Static:return Tn.String;default:throw new B(j.InvalidSubstitutionConfigType,"Substitution Definition config type is not supported.",{context:{configType:e}})}}function _h(e,t=nt.EmbeddedContent){if(!Vl[t].supportedTypes.includes(e))throw new B(j.InvalidTransformerTypeForCategory,"Transformer Type is not allowed for Transformer Category.",{context:{category:t,type:e}})}function ns(e=Tn.String,t){switch(e){case Tn.String:if(!b(t))throw new B(j.InvalidSubstitutionDefinitionValue,"Substitution Definition value is incorrect type.",{context:{expectedType:e,value:t}});break;default:throw new B(j.InvalidSubstitutionDefinitionConfigDataType,"",{context:{configDataType:e}})}}function Th(e){var t;if(!N(e))throw new B(j.MissingTransformerSubstitutionDefinition,"Transformer substitution definition object is required.");if(e.label!==void 0&&!b(e.label))throw new B(j.InvalidSubstitutionDefinitionLabel,"Transformer substitution definition label is required to be a string if provided.");if(e.description!==void 0&&!b(e.description))throw new B(j.InvalidSubstitutionDefinitionDescription,"Transformer substitution definition description is required to be a string if provided.");if(e.configType!==void 0&&!((t=Object.values(Re))!=null&&t.includes(e.configType)))throw new B(j.InvalidSubstitutionDefinitionConfigType,"Transformer substitution definition config type should be a valid Substitution Definition Config Type if provided.",{context:{configType:e.configType}});e.defaultValue!==void 0&&ns(ts(e.configType),e.defaultValue)}function bh(e){if(!N(e))throw new B(j.InvalidSubstitutionDefinitions,"Transformer substitution definitions is not a record.");Object.entries(e).forEach(([t,n])=>{if(!b(t))throw new B(j.MissingTransformerSubstitutionDefinitionKey,"Transformer substitution definition key is required.");Th(n)})}function wh(e){var t,n;if(!N(e))throw new B(j.MissingTransformer,"Transformer is required.");if(!b(e.name))throw new B(j.MissingTransformerName,"Transformer name is required.");if(e.label!==void 0&&!b(e.label))throw new B(j.InvalidTransformerLabel,"Transformer label is required to be a string if provided.");if(e.description!==void 0&&!b(e.description))throw new B(j.InvalidTransformerDescription,"Transformer description is required to be a string if provided.");if(e.schemaReference!==void 0&&!b(e.schemaReference))throw new B(j.InvalidTransformerSchemaReference,"Transformer schema reference is required to be a string if provided.");if(!((t=Object.values(ge))!=null&&t.includes(e.transformerType)))throw new B(j.InvalidTransformerType,"Transformer type is not a valid Transformer Type.",{context:{transformerType:e.transformerType}});if(e.transformerCategory!==void 0&&!((n=Object.values(nt))!=null&&n.includes(e.transformerCategory)))throw new B(j.InvalidTransformerCategory,"Transformer category is not a valid Transformer Category.",{context:{transformerCategory:e.transformerCategory}});if(_h(e.transformerType,e.transformerCategory),e.substitutionDefinitions!==void 0&&bh(e.substitutionDefinitions),!N(e.transformerTypeDetails))throw new B(j.MissingTransformerTypeDetails,"Transformer transformer type details are required.");if(e.publishedDate!==void 0)try{e.publishedDate=Ft("publishedDate",e.publishedDate)}catch(r){throw new B(j.InvalidPublishedDate,"Transformer published date should be a number or date if provided.")}if(e.lastModifiedDate!==void 0)try{e.lastModifiedDate=Ft("lastModifiedDate",e.lastModifiedDate)}catch(r){throw new B(j.InvalidLastModifiedDate,"Transformer last modified date should be a number or date if provided.")}Ci(e.transformerType).validateTransformerDetails(e.transformerTypeDetails)}function rs(e){return H(Ke)?Ke.filter(t=>{var n;return((n=t.transformerCategory)!=null?n:nt.EmbeddedContent)===e}):[]}function Sh(e){return Ci(e.transformerType).supportsEngagementSelection()}const is=/\*\s*\*/;function Ih(e){var t;if(!N(e))throw new M(R.InvalidSourceMatchers,"Source Matchers is not a valid array.");if(!((t=Object.values(Te))!=null&&t.includes(e.type)))throw new M(R.InvalidSourceMatcherType,"Source Matcher type is not a valid Source Matcher Type.",{context:{sourceMatcherType:e.type}});if(!b(e.value))throw new M(R.MissingSourceMatcherValue,"Source Matcher value is required.");if(e.value!==e.value.trim())throw new M(R.PaddedSourceMatcherValue,"Source Matcher value has leading or trailing spaces.",{context:{sourceMatcherValue:e.value}});if(e.type===Te.PageUrlMatcher){if(e.value==="*")throw new M(R.InvalidSourceMatcherValueOnlyStar,"Source Matcher value cannot be only * char.");if(e.value.includes("**"))throw new M(R.InvalidSourceMatcherValueRepeatedStars,"Source Matcher value cannot have repeated * chars.");if(is.lastIndex=0,is.test(e.value))throw new M(R.InvalidSourceMatcherValueSpaceWithStars,"Source Matcher value cannot have * followed by a space followed by a *.")}}function Ah(e){if(!H(e))throw new M(R.MissingSourceMatchers,"Source Matchers are required.");e.forEach(t=>Ih(t))}function os(e,t,n){switch(e.type){case Te.PageType:return Oh(e,t);case Te.PageUrlMatcher:return Nh(e,n);default:return y.log.warn(`Support missing for SourceMatcherType: ${e.type}`),!1}}function Ch(e){if(e.type!==Te.PageUrlMatcher){y.log.warn("Ignoring SourceMatcher, since type is not PageUrlMatcher");return}let t=encodeURIComponent(e.value.trim());return t=t.replace(/[.()!']/g,"\\$&"),t=t.replace(/\*/g,".*"),new RegExp(t,"i")}function Ph(e){if(b(e))return encodeURIComponent(e)}function Nh(e,t){const n=Ph(t);if(!b(n))return y.log.debug("Ignoring match, url is not a non-empty string"),!1;const r=Ch(e);return D(r)?!1:r.test(n)}function Oh(e,t){return b(t)?t===e.value.trim():(y.log.debug("Ignoring match, pageType is not a non-empty string"),!1)}var Dh=Object.defineProperty,Mh=Object.defineProperties,Rh=Object.getOwnPropertyDescriptors,as=Object.getOwnPropertySymbols,Lh=Object.prototype.hasOwnProperty,xh=Object.prototype.propertyIsEnumerable,ss=(e,t,n)=>t in e?Dh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ls=(e,t)=>{for(var n in t||(t={}))Lh.call(t,n)&&ss(e,n,t[n]);if(as)for(var n of as(t))xh.call(t,n)&&ss(e,n,t[n]);return e},us=(e,t)=>Mh(e,Rh(t)),Pi=(e=>(e.DataCloudModuleConfig="DATA_CLOUD_MODULE_CONFIG",e.Other="OTHER",e))(Pi||{});let fn=[];const qn={DATA_CLOUD_MODULE_CONFIG:null,OTHER:[]};function Ie(){return fn!=null?fn:[]}function kh(e){fn=[...e]}function Uh(e,t){const n=H(t,!0)?t:Ie();if(!(!H(n)||!b(e)))return n.find(r=>sr(r.name,e))}function cs(e,t){return b(e)?(H(t,!0)?t:Ie()).filter(n=>n.sourceMatchers.some(r=>r.type===Te.PageUrlMatcher&&os(r,"",e))):[]}function fs(e,t){return b(e)?(H(t,!0)?t:Ie()).filter(n=>n.sourceMatchers.some(r=>r.type===Te.PageType&&os(r,e,""))):[]}function Hh(e,t){return Object.values(Te).includes(e)?(H(t,!0)?t:Ie()).filter(n=>n.sourceMatchers.some(r=>r.type===e)):[]}function Fh(e){var t,n,r,i;if(!N(e))throw new M(R.MissingDataProvider,"DataProvider is required.");if(e.type!==void 0&&!((t=Object.values(bn))!=null&&t.includes(e.type)))throw new M(R.InvalidDataProviderType,"Data Provider type should be a valid Data Provider Type if provided.",{context:{type:e.type}});if(e.referenceType!==void 0&&!((n=Object.values(wn))!=null&&n.includes(e.referenceType)))throw new M(R.InvalidDataProviderReferenceType,"Data Provider reference type should be a valid Reference Type if provided.",{context:{referenceType:e.referenceType}});if(!b(e.value))throw new M(R.MissingDataProviderValue,"Data Provider value is required.");if(e.dataSpaceReferenceType!==void 0&&!((r=Object.values(wn))!=null&&r.includes(e.dataSpaceReferenceType)))throw new M(R.InvalidDataProviderDataSpaceReferenceType,"Data Provider data space reference type should be a valid Reference Type if provided.",{context:{referenceType:e.dataSpaceReferenceType}});if(!b(e.dataSpaceValue)&&e.dataSpaceReferenceType!==void 0)throw new M(R.MissingDataSpaceValue,"Data Provider data space value is required if Data Provider data space reference type is set.");if(e.groupByType!==void 0&&!Object.values(lo).includes(e.groupByType))throw new M(R.InvalidDataProviderGroupByType,"Data Provider group by type should be a valid Data Provider Group By Type if provided.",{context:{groupByType:e.groupByType}});if(e.groupByReferenceType!==void 0&&!((i=Object.values(wn))!=null&&i.includes(e.groupByReferenceType)))throw new M(R.InvalidDataProviderGroupByReferenceType,"Data Provider group by reference type should be a valid Reference Type if provided.",{context:{referenceType:e.groupByReferenceType}});if(!b(e.groupByValue)&&(e.groupByType!==void 0||e.groupByReferenceType!==void 0))throw new M(R.MissingDataGroupByValue,"Data Provider group by value is required if Data Provider group by type or reference type is set.")}function zh(e){if(J(e,"name"))throw new M(R.TransformationNameNotSupported,"Transformation Name is not supported for method type.",{context:{methodType:$.AddOverlay}});if(J(e,"tag"))throw new M(R.TransformationTagNotSupported,"Transformation Tag is not supported for method type.",{context:{methodType:$.AddOverlay}});if(J(e,"path"))throw new M(R.TransformationPathNotSupported,"Transformation Path is not supported for method type.",{context:{methodType:$.AddOverlay}})}function Vh(e){if(!b(e.name))throw new M(R.MissingTransformationName,"Transformation Name is required.",{context:{transformationType:"ContentZone"}})}function Bh(e){if(!b(e.tag))throw new M(R.MissingTransformationTag,"Transformation Tag is required.",{context:{transformationType:"Element"}});if(!b(e.path))throw new M(R.MissingTransformationPath,"Transformation Path is required.",{context:{transformationType:"Element"}})}function Gh(e){return Object.keys(e).some(t=>!["transformerName","substitutionValues"].includes(t))}function jh(e){return Wh(e,Wn())}function Wh(e,t){if(!b(e))throw new M(R.MissingTransformerName,"Transformer Name is required.");if(t.length===0)throw new M(R.TransformersNotAvailable,"There are no transformers available.");const n=t.find(r=>r.name===e);if(n===void 0)throw new M(R.InvalidTransformerName,"Transformation Transformer Name is not a valid transformer.",{context:{transformerName:e}});return n}function ds(e,t,n){Object.entries(t).forEach(([r,i])=>{var o;if(r in e)y.log.debug(`using substitution value for Substitution Definition of ${r} for Transformer ${n}`);else{if(i.defaultValue===void 0&&((o=i.required)==null||o))throw new M(R.MissingSubstitutionDefinitionDefaultValue,"Substitution Definition value is required and there is no default value specified.",{context:{key:r}});y.log.debug(`using default value for Substitution Definition of ${r} for Transformer ${n}`)}})}function qh(e,t,n){var r;if(!((r=t.overrideable)!=null&&r)&&n!==void 0)throw new M(R.InvalidTransformationSubstitutionValue,"Substitution Value is not allowed when Substitution Definition is not overridable.",{context:{key:e}})}function $h(e,t){if(e.substitutionDefinitions!==void 0&&Object.values(e.substitutionDefinitions).find(n=>{var r;return((r=n.configType)!=null?r:Re.SchemaPath)===Re.SchemaPath})!==void 0&&(!N(t)||!In(t==null?void 0:t.type)))throw new M(R.InvalidTransformationSubstitutionValueType,"Personalization Point Data Provider is required when using Schema Path Substitution Definitions")}function Yh(e,t,n){var r;if($h(t,n),e===void 0){t.substitutionDefinitions!==void 0&&ds({},t.substitutionDefinitions,t.name);return}if(!N(e))throw new M(R.InvalidTransformationSubstitutionValues,"Substitution Values is not a valid object.");if(t.substitutionDefinitions!==void 0){const i=(r=t.substitutionDefinitions)!=null?r:{};Object.entries(e).forEach(([o,s])=>{if(o in i){const l=i[o];qh(o,l,s),ns(ts(l.configType),s)}else throw new M(R.SubstitutionDefinitionKeyNotSupported,"Transformer does not support Substitution Definition Key.",{context:{key:o}})}),ds(e,t.substitutionDefinitions,t.name)}else if(t.transformerType!==ge.HtmlElementModifier)if(Object.entries(e).length===0)y.log.warn(`transformer "${t.name}" does not accept substitutionValues`);else throw new M(R.TransformerDoesNotSupportSubstitutionValues,"Substitution Values are provided when transformer does not support Substitution Definitions.")}function hs(e,t,n){var r;const i=jh(e.transformerName);if(!((r=i.isEnabled)==null||r))throw new M(R.DisabledTransformer,"Transformer is disabled.",{context:{transformer:i.name}});Yh(e.substitutionValues,i,n);const o=Ci(i.transformerType);o.validateMethod(t),o.validateSubstitutionValues(e.substitutionValues)}function Zh(e,t,n){if(!N(e))throw new M(R.MissingTransformation,"Transformation is required.");if(!b(e.transformerName))throw new M(R.MissingTransformerName,"Transformer Name is required.");if(e.substitutionValues!==void 0&&!N(e.substitutionValues))throw new M(R.InvalidTransformationSubstitutionValues,"Substitution Values is not a valid object.");if(_t(t))zh(e);else if(Gh(e))if(Gt(e))Vh(e);else if(rt(e))Bh(e);else throw new M(R.InvalidTransformationType,"Transformation is not one of the supported types.");Ge()||hs(e,t,n)}function Kh(e,t,n){if(!H(e))throw new M(R.InvalidTransformations,"Transformations is required to be an array.");if(e.forEach(r=>Zh(r,t,n)),t!==void 0&&t!==$.AddOverlay){if(t===$.ReplaceContentZoneContent&&!e.every(r=>Sn(r,t)))throw new M(R.MethodRequiresSpecificTransformations,"Method requires specific transformation type(s).",{context:{transformationType:"ContentZone",methods:[$.ReplaceContentZoneContent]}});if(t===$.ContentZoneHandler&&!e.every(r=>pr(r,t)))throw new M(R.MethodRequiresSpecificTransformations,"Method requires specific transformation type(s).",{context:{transformationType:"ContentZone",methods:[$.ContentZoneHandler]}});if(t!==$.ReplaceContentZoneContent&&t!==$.ContentZoneHandler&&!e.every(r=>rt(r)))throw new M(R.MethodRequiresSpecificTransformations,"Method requires specific transformation type(s).",{context:{transformationType:"Element",methods:[$.ReplaceElementContent,$.AddAfterElement,$.AddBeforeElement]}})}}function Xh(e,t){var n,r;if(!N(e))throw new M(R.MissingTransformationConfig,"Transformation Config is required.");if(e.renderIfEmpty!==void 0&&!et(e.renderIfEmpty))throw new M(R.InvalidRenderIfEmpty,"Transformation Config Render If Empty should be a boolean if provided.");if(!((n=Object.values(Ce))!=null&&n.includes(e.when)))throw new M(R.InvalidTransformationConfigWhen,"Transformation Config has an invalid Transformation Config When Type.",{context:{whenType:e.when}});if(e.method!==void 0&&!((r=Object.values($))!=null&&r.includes(e.method)))throw new M(R.InvalidTransformationConfigMethod,"Transformation Config has an invalid Target Method Type.",{context:{methodType:e.method}});switch(e.when){case Ce.Immediately:if(e.whenValues!==void 0)throw new M(R.WhenValuesNotSupported,"Transformation Config does not support when values for the specific Transformation Config When Type.",{context:{whenType:e.when}});break;case Ce.ExitIntent:if(!_t(e.method))throw new M(R.WhenTypeRequiresSpecificMethodType,"Transformation Config when type requires specific method type.",{context:{whenType:e.when,methodType:$.AddOverlay}});if(!ho(e.whenValues))throw new M(R.InvalidTransformationConfigWhenTypes,"Transformation Config when values is invalid for the specific Transformation Config When Type.",{context:{whenType:e.when}});if(!Ht(e.whenValues.delay)||e.whenValues.delay<0)throw new M(R.InvalidWhenValueDelay,"Transformation Config requires a numeric when values delay of 0 or greater for the specific Transformation Config When Type.",{context:{whenType:e.when}});break;case Ce.ElementClick:if(!_t(e.method))throw new M(R.WhenTypeRequiresSpecificMethodType,"Transformation Config when type requires specific method type.",{context:{whenType:e.when,methodType:$.AddOverlay}});if(!co(e.whenValues))throw new M(R.InvalidTransformationConfigWhenTypes,"Transformation Config when values is invalid for the specific Transformation Config When Type.",{context:{whenType:e.when}});if(!b(e.whenValues.path))throw new M(R.InvalidWhenValuePath,"Transformation Config requires a string when values path for the specific Transformation Config When Type.",{context:{whenType:e.when}});if(e.whenValues.tag!==void 0&&!b(e.whenValues.tag))throw new M(R.InvalidWhenValueTag,"Transformation Config requires a string when values tag, if provided, for the specific Transformation Config When Type.",{context:{whenType:e.when}});break;case Ce.ScrollPercent:if(!_t(e.method))throw new M(R.WhenTypeRequiresSpecificMethodType,"Transformation Config when type requires specific method type.",{context:{whenType:e.when,methodType:$.AddOverlay}});if(!fo(e.whenValues))throw new M(R.InvalidTransformationConfigWhenTypes,"Transformation Config when values is invalid for the specific Transformation Config When Type.",{context:{whenType:e.when}});if(!Ht(e.whenValues.percent)||e.whenValues.percent<0||e.whenValues.percent>1)throw new M(R.InvalidWhenValuePercent,"Transformation Config requires a numeric when values percent between 0 and 1 for the specific Transformation Config When Type.",{context:{whenType:e.when}});break;default:throw new M(R.WhenValuesValidationLogicNotImplemented,"Transformation Config when values validation logic has not been implemented for the specific Transformation Config When Type.",{context:{whenType:e.when}})}if(e.engagementDestination!==void 0&&!b(e.engagementDestination))throw new M(R.InvalidTransformationConfigEngagementDestination,"Transformation Config engagement destination should be a valid string if provided.");Kh(e.transformations,e.method,t)}function Ni(e,t,n,r){if(!N(e))throw new M(R.MissingConfig,"Config is required.");if(!b(e.name))throw new M(R.MissingName,"Name is required.");if(e.label!==void 0&&!b(e.label))throw new M(R.InvalidLabel,"Label is required to be a string if provided.");if(e.description!==void 0&&!b(e.description))throw new M(R.InvalidDescription,"Description is required to be a string if provided.");if(e.dataProvider!==void 0&&Fh(e.dataProvider),Ah(e.sourceMatchers),Xh(e.transformationConfig,e.dataProvider),e.publishedDate!==void 0&&!mn(e.publishedDate))try{e.publishedDate=Ft("publishedDate",e.publishedDate)}catch(i){throw new M(R.InvalidPublishedDate,"Published date should be a number or date if provided.")}if(e.lastModifiedDate!==void 0&&!mn(e.lastModifiedDate))try{e.lastModifiedDate=Ft("lastModifiedDate",e.lastModifiedDate)}catch(i){throw new M(R.InvalidLastModifiedDate,"Last modified date should be a number or date if provided.")}if(t!=null&&t&&n!==void 0){const i=[];if(gs(e,n,[],i),i.length>0)throw i[0]}if(r!=null&&r){const i=[];if(ms(e,[],i),i.length>0)throw i[0]}}function Oi(e){var t,n,r,i;if(((t=e==null?void 0:e.dataProvider)==null?void 0:t.type)!==void 0&&((n=e==null?void 0:e.dataProvider)==null?void 0:n.type)!==bn.PersonalizationPoint)throw new En(cr.OnlySupportPersonalizationPoint,"Personalization Experience Config has Data Provider Type that is not Personalization Point, which is not currently supported.",{context:{configName:e.name}});!Ge()&&(((r=e==null?void 0:e.dataProvider)==null?void 0:r.type)===bn.PersonalizationPoint||b((i=e==null?void 0:e.dataProvider)==null?void 0:i.dataSpaceValue))&&ps(e)}function ps(e){var t,n,r;const i=D((t=e==null?void 0:e.dataProvider)==null?void 0:t.dataSpaceValue)?"":(n=e==null?void 0:e.dataProvider)==null?void 0:n.dataSpaceValue;if(Bt()!==i)throw new En(cr.OnlySupportConfiguredDataSpace,"Personalization Experience Config has Data Provider Data Space Value that does not match Sitemap value, which is not currently supported.",{context:{configName:e.name,configDataSpace:(r=e==null?void 0:e.dataProvider)==null?void 0:r.dataSpaceValue,configuredDataSpace:Bt()}})}function Di(e,t="OTHER"){function n(r){if(Ge()){if(!H(r,!0)){y.log.error("A list of personalization experience configs is required.");return}t==="OTHER"&&qn.OTHER.push(...r);const i=[];r.forEach(o=>{!b(o.name)||fn.findIndex(s=>sr(s.name,o.name))<0&&i.findIndex(s=>sr(s.name,o.name))<0?i.push(o):y.log.error(`Not adding Personalization Experience Config "${o.name}" because it already exists`)}),i.forEach(o=>{try{Ni(o),Oi(o),y.log.info("Adding the following Personalization Experience Config: ",o),fn.push(o)}catch(s){y.log.error(`Personalization Experience Configs could not be added due to: ${K(s).message}`,o)}})}else y.log.error("The list of Personalization Experience Configs can only be modified before SalesforceInteractions.init is called.")}if(b(e))try{const r=JSON.parse(e,Ji);n(r)}catch(r){y.log.error(`JSON Personalization Experience Config list could not be initialized due to: ${K(r).message}`,r)}else n(e)}function Qh(e){Di(e)}function Jh(){document.addEventListener(y.CustomEvents.OnInit,()=>{sp(),ip(),up()}),document.addEventListener(y.CustomEvents.OnInitSitemap,e=>{np(e.detail.sitemapConfig)})}function ep(e){if(!H(e))return y.log.debug("Ignoring non/empty array of personalizationExperienceConfigs"),{};const t={};return e.forEach(n=>{var r,i,o;if(!In((r=n.dataProvider)==null?void 0:r.type))y.log.warn(`Ignoring config: ${n.name} with unsupported dataProvider.type: ${String((i=n.dataProvider)==null?void 0:i.type)}`);else{const s=(o=n.dataProvider.groupByValue)!=null?o:Bl;let l=t[s];D(l)&&(l={},t[s]=l);const a=n.dataProvider.value;let u=l[a];D(u)&&(u={point:{name:a},pecNames:[]},l[a]=u),u.pecNames.includes(n.name)||u.pecNames.push(n.name)}}),t}function $n(e){const t=e.filter(n=>b(n.getConfigName()));if(t.length>0){t.forEach(r=>{const i=r.getConfigName(),o=Ie().find(s=>s.name===i);o===void 0?y.log.error(`Could not find Personalization Experience Config with name ${i}`):y.log.error(`Personalization Experience Config with name ${i} is invalid due to: ${r.getMessageWithContext()} Config: `,o)});const n=t.map(r=>r.getConfigName());kh(Ie().filter(r=>!n.includes(r.name)))}}function gs(e,t,n,r){e.transformationConfig.transformations.forEach(i=>{Sn(i,e.transformationConfig.method)&&(n.length===0&&gc(t).forEach(o=>n.push(o)),n.length===0?r.push(new M(R.ContentZonesNotAvailable,"There are no content zones configured in the sitemap or content zone is defined more than once.",{context:{configName:e.name}})):n.find(o=>o===i.name)===void 0&&r.push(new M(R.InvalidTransformationContentZone,"Content zone is not defined in the sitemap or content zone is defined more than once.",{context:{configName:e.name,contentZone:i.name}})))})}function tp(e){const t=[],n=[];return Ie().forEach(r=>{gs(r,e,t,n)}),n}function np(e){const t=tp(e);$n(t)}function ms(e,t,n){b(e.transformationConfig.engagementDestination)&&(t.length===0&&ua().forEach(r=>t.push(r)),t.length===0?n.push(new M(R.EngagementDestinationsNotAvailable,"There are no engagement destinations configured.",{context:{configName:e.name}})):t.find(r=>r===e.transformationConfig.engagementDestination)===void 0&&n.push(new M(R.InvalidTransformationConfigEngagementDestinationName,"Engagement destination is not defined.",{context:{configName:e.name,engagementDestination:e.transformationConfig.engagementDestination}})))}function rp(){const e=[],t=[];return Ie().forEach(n=>{ms(n,e,t)}),t}function ip(){const e=rp();$n(e)}function vs(){return qn}function op(e,t){e==="DATA_CLOUD_MODULE_CONFIG"&&"list"in t&&H(t.list,!0)?qn.DATA_CLOUD_MODULE_CONFIG=t:e==="OTHER"&&H(t,!0)&&(qn.OTHER=t)}function ap(){const e=[];return Ie().forEach(t=>{var n;try{const r=t.transformationConfig.method;t.transformationConfig.transformations.forEach(i=>{hs(i,r,t.dataProvider)})}catch(r){if(r instanceof Error)if(r instanceof M||r instanceof B){const i={context:us(ls({},r.context),{configName:t.name}),cause:(n=r.cause)!=null?n:r},o=r instanceof M?new M(r.name,r.message,i):new B(r.name,r.message,i);e.push(o)}else e.push(new M(R.UnexpectedError,r.message,{context:{configName:t.name}}))}}),e}function sp(){const e=ap();$n(e)}function lp(){const e=[];return Ie().forEach(t=>{var n;try{ps(t)}catch(r){if(r instanceof Error)if(r instanceof En){const i=new En(r.name,r.message,{context:us(ls({},r.context),{configName:t.name}),cause:(n=r.cause)!=null?n:r});e.push(i)}else e.push(new M(R.UnexpectedError,r.message,{context:{configName:t.name}}))}}),e}function up(){const e=lp();$n(e)}var z=(e=>(e.SingleElementHtmlTransformer="SingleElementHtmlTransformer",e.MultiElementModifier="MultiElementModifier",e.WhenElementClick="WhenElementClick",e.Agent="Agent",e))(z||{}),dn=(e=>(e.Prod="prod",e.Test="test",e.ProdSandbox="prod_sandbox",e.TestSandbox="test_sandbox",e))(dn||{});const cp={configOptions:{SingleElementHtmlTransformer:{allowedElements:{div:{},p:{},header:{},footer:{},section:{},article:{},nav:{},table:{}}},MultiElementModifier:{allowedElements:{h1:{allowedProperties:["innerText"]},h2:{allowedProperties:["innerText"]},h3:{allowedProperties:["innerText"]},h4:{allowedProperties:["innerText"]},h5:{allowedProperties:["innerText"]},h6:{allowedProperties:["innerText"]},p:{allowedProperties:["innerText"]},div:{allowedProperties:["innerText","style.backgroundImage"]},a:{allowedProperties:["innerText","attributes.href"]},img:{allowedProperties:["attributes.src"]}}},WhenElementClick:{allowedElements:{input:{},button:{},img:{}}}}};var Es=(e,t,n)=>new Promise((r,i)=>{var o=a=>{try{l(n.next(a))}catch(u){i(u)}},s=a=>{try{l(n.throw(a))}catch(u){i(u)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,s);l((n=n.apply(e,t)).next())});const te={pageUrl:{},pageType:{}};function ys(){return Es(this,null,function*(){return D(te.pageUrl.matchedPromise)?yield Promise.reject(new Error("getPromiseUrlMatch called too soon")):yield te.pageUrl.matchedPromise})}function _s(){return Es(this,null,function*(){return D(te.pageType.matchedPromise)?yield Promise.reject(new Error("getPromisePageMatch called too soon")):yield te.pageType.matchedPromise})}const Yn="sf_personalization_wpm";function fp(){Ri(!1);const e=Cl(Yn);window.history.replaceState({},document==null?void 0:document.title,e.toString()),window.location.reload()}function Mi(){try{return window.localStorage.getItem(Yn)==="true"}catch(e){return!1}}function Ri(e){try{window.localStorage.setItem(Yn,e?"true":"false")}catch(t){throw y.log.error("Error trying to save client side editor mode.",t),t}}const Ts="sf_personalization_wpm_env",bs="2",dp=`https://cdn.c360a.salesforce.com/npm/@salesforce/interactions-website-personalization-manager/${bs}/build/dist/index.min.js`,hp=`https://cdn.pc-rnd.c360a.salesforce.com/npm/@salesforce/interactions-website-personalization-manager/${bs}/build/dist/index.min.js`,ws={configOptions:{}};let Zn=cp;function Ss(){return Zn!=null?Zn:ws}function pp(e){e===void 0?Zn=ws:Zn=e}function gp(){Xi(Yn)&&Ri(!0),document.addEventListener(y.CustomEvents.OnInit,Cs)}function Is(){if(Xi(Ts)){const e=Il(Ts);if(e!==null){const t=e.toLowerCase();if(Object.values(dn).includes(t))return t}}return dn.Prod}function mp(){const e=Is(),t=e===dn.Test||e===dn.TestSandbox?hp:dp;return y.log.debug(`WPM (client side editor) CDN Script is set to ${t}`),t}function vp(e,t){return kn(e,t,Ue())}function Ep(){const e=Wn();if(e.length>0){const t=e.find(n=>n.transformerType===ge.HtmlElementModifier);if(t!==void 0)return kn(t.name,t.transformerType,Ue())}return kn("",ge.HtmlElementModifier,Ue())}function yp(){return rs(nt.EmbeddedContent)}function _p(){return rs(nt.Agent)}function As(){var e;const t={closeEditorMode:fp,determineEditorOption:Ns,getConfig:Ss,getAppSourceId:Ul,getPspConfig:Hl,isInEditorMode:Mi,isPECSupported:Dp,checkPECSupport:Ds,getPromiseUrlMatch:ys,getPromisePageMatch:_s,findContentZoneNamesForPageConfig:hc,findContentZoneNamesForPageConfigs:pc,getEngagementDestinationNames:ua,determineHtmlElementModifierTransformerEngagementDestination:Ep,determineTransformerEngagementDestination:vp,findPersonalizationExperienceConfigsMatchingPageType:fs,findPersonalizationExperienceConfigsMatchingPageUrl:cs,getContentZoneSelectorByName:$o,getPersonalizationExperienceConfigsByInitializationSource:vs,matchesDataCloudHostname:Mp,determineWpmEnvironment:Is,getAllContentZoneHandlers:Du,evaluateContextualAttributes:Or,getAllEmbeddedContentTransformers:yp,isEngagementSelectionSupported:Sh,getAllWebAgentTransformers:_p};(e=window.SalesforceInteractions.Wpm)==null||e.initialize(t)}function Cs(){var e;if(Mi())if(((e=window.SalesforceInteractions.Wpm)==null?void 0:e.initialize)!==void 0)As();else{const t=document.createElement("script");t.src=mp(),t.type="text/javascript",t.onload=As,t.onerror=n=>{y.log.error("Error trying to initialize WPM (client side editor)",n)},document.head.appendChild(t)}}function Tp(){Ri(!0),Cs()}function bp(e){if(!N(e))throw new ye(pe.InvalidConfig,"Config is invalid.",{context:{configType:z.SingleElementHtmlTransformer}});if((e==null?void 0:e.allowedElements)!==void 0){const t=e==null?void 0:e.allowedElements;if(!N(t))throw new ye(pe.InvalidAllowedElements,"Allowed Elements is invalid.",{context:{configType:z.SingleElementHtmlTransformer}});Object.entries(t).forEach(([n])=>{if(!N(t[n]))throw new ye(pe.InvalidAllowedElementKey,"Allowed Elements key is invalid.",{context:{configType:z.SingleElementHtmlTransformer,key:n}})})}if((e==null?void 0:e.allowedTargetMethodTypes)!==void 0){if(!H(e==null?void 0:e.allowedTargetMethodTypes,!0))throw new ye(pe.InvalidAllowedTargetMethodTypes,"Allowed Target Method Types is invalid.",{context:{configType:z.SingleElementHtmlTransformer}});e==null||e.allowedTargetMethodTypes.forEach(t=>{var n;if(!((n=Object.values($))!=null&&n.includes(t)))throw new ye(pe.InvalidAllowedTargetMethodTypeMethod,"Allowed Target Method Types method is not a valid Target Method Type.",{context:{configType:z.SingleElementHtmlTransformer,method:t}})})}if((e==null?void 0:e.allowedTransformers)!==void 0&&!H(e==null?void 0:e.allowedTransformers,!0))throw new ye(pe.InvalidAllowedTransformers,"Allowed Transformers is invalid.",{context:{configType:z.SingleElementHtmlTransformer}})}function wp(e){if(!N(e))throw new ye(pe.InvalidConfig,"Config is invalid.",{context:{configType:z.MultiElementModifier}});if((e==null?void 0:e.allowedElements)!==void 0){const t=e==null?void 0:e.allowedElements;if(!N(t))throw new ye(pe.InvalidAllowedElements,"Allowed Elements is invalid.",{context:{configType:z.MultiElementModifier}});Object.entries(t).forEach(([n])=>{var r,i;if(!N(t[n]))throw new ye(pe.InvalidAllowedElementKey,"Allowed Elements key is invalid.",{context:{configType:z.MultiElementModifier,key:n}});if(((r=t[n])==null?void 0:r.allowedProperties)!==void 0&&!H((i=t[n])==null?void 0:i.allowedProperties,!0))throw new ye(pe.InvalidAllowedProperties,"Allowed Elements allowed properties is invalid.",{context:{configType:z.MultiElementModifier,key:n}})})}}function Sp(e){if(!N(e))throw new ye(pe.InvalidConfig,"Config is invalid.",{context:{configType:z.WhenElementClick}});if((e==null?void 0:e.allowedElements)!==void 0){const t=e==null?void 0:e.allowedElements;if(!N(t))throw new ye(pe.InvalidAllowedElements,"Allowed Elements is invalid.",{context:{configType:z.WhenElementClick}});Object.entries(t).forEach(([n])=>{if(!N(t[n]))throw new ye(pe.InvalidAllowedElementKey,"Allowed Elements key is invalid.",{context:{configType:z.WhenElementClick,key:n}})})}}function Ps(e){if(!N(e))throw new Et(st.WpmConfigIsRequired,"Wpm Config is required.");if(!N(e.configOptions))throw new ye(pe.InvalidConfigOptions,"Config Options are required.");z.SingleElementHtmlTransformer in e.configOptions?bp(e.configOptions[z.SingleElementHtmlTransformer]):y.log.info("WPM Config does not contain any restrictions for SingleElementHtmlTransformer"),z.MultiElementModifier in e.configOptions?wp(e.configOptions[z.MultiElementModifier]):y.log.info("WPM Config does not contain any restrictions for MultiElementModifier"),z.WhenElementClick in e.configOptions?Sp(e.configOptions[z.WhenElementClick]):y.log.info("WPM Config does not contain any restrictions for WhenElementClick")}function Ns(e,t){var n;if(!N(e))throw new Et(st.ConfigIsRequired,"Config is required.");if(!H(t))throw new Et(st.TransformersAreRequired,"Transformers are required.");const r=t.filter(i=>i.transformerType===ge.HtmlElementModifier).map(i=>i.name);return r.length>0&&e.transformationConfig.transformations.length>0&&(e.transformationConfig.method===void 0||e.transformationConfig.method===$.ReplaceElementContent)&&e.transformationConfig.transformations.every(i=>r.includes(i.transformerName))?z.MultiElementModifier:((n=t==null?void 0:t[0])==null?void 0:n.transformerCategory)===nt.Agent?z.Agent:z.SingleElementHtmlTransformer}function Os(e,t,n){if(e===void 0)return;const r=t.filter(i=>rt(i)).map(i=>i.tag).filter(i=>!Object.keys(e).includes(i.toLowerCase()));if(r.length>0)throw new Me(Ae.TagsNotAllowed,"Tags are not allowed.",{context:{configType:n,disallowedTags:JSON.stringify(r)}})}function Ip(e,t,n){e!==void 0&&t.filter(r=>rt(r)).map(r=>r).forEach(r=>{const i=e[r.tag.toLowerCase()].allowedProperties;i!==void 0&&(r.substitutionValues!==void 0?Object.keys(r.substitutionValues):[]).forEach(o=>{if(!i.includes(o))throw new Me(Ae.PropertyNotAllowed,"Property is not allowed.",{context:{configType:n,property:`${r.tag}.${o}`}})})})}function Ap(e,t,n){if(e!==void 0&&t.method!==void 0&&!e.includes(t.method))throw new Me(Ae.MethodNotAllowed,"Method is not allowed.",{context:{configType:n,method:t.method}})}function Cp(e,t,n){if(e!==void 0)if(e.length===0){const r=t.map(i=>i.transformerName);throw new Me(Ae.TransformersAreDisabled,"Transformers are disabled.",{context:{configType:n,transformers:JSON.stringify(r)}})}else{const r=t.filter(i=>!e.includes(i.transformerName)).map(i=>i.transformerName);if(r.length>0)throw new Me(Ae.TransformersAreDisabled,"Transformers are disabled.",{context:{configType:n,transformers:JSON.stringify(r)}})}}function Pp(e,t){t!==void 0&&(Os(t.allowedElements,e.transformationConfig.transformations,"SingleElementHtmlTransformer"),Ap(t.allowedTargetMethodTypes,e.transformationConfig,"SingleElementHtmlTransformer"),Cp(t.allowedTransformers,e.transformationConfig.transformations,"SingleElementHtmlTransformer"))}function Np(e,t){t!==void 0&&(Os(t.allowedElements,e.transformationConfig.transformations,"MultiElementModifier"),Ip(t.allowedElements,e.transformationConfig.transformations,"MultiElementModifier"))}function Op(e,t){var n,r;if(t!==void 0&&t.allowedElements!==void 0){const i=(r=(n=e.transformationConfig.whenValues)==null?void 0:n.tag)!=null?r:"";if(!Object.keys(t.allowedElements).includes(i))throw new Me(Ae.TagsNotAllowed,"Tags are not allowed.",{context:{configType:z.WhenElementClick,disallowedTags:i}})}}function Ds(e,t,n){if(!N(e))throw new Et(st.ConfigIsRequired,"Config is required.");if(!N(t))throw new Et(st.WpmConfigIsRequired,"Wpm Config is required.");if(!H(n))throw new Et(st.TransformersAreRequired,"Transformers are required.");if(e.sourceMatchers.length>1)throw new Me(Ae.OneSourceMatcherSupported,"Only one source matcher is allowed.");switch(Ns(e,n)){case z.SingleElementHtmlTransformer:if(e.transformationConfig.transformations.length>1)throw new Me(Ae.OneTransformerSupported,"Only one transformation is allowed.",{context:{configType:z.SingleElementHtmlTransformer}});if(e.transformationConfig.method===void 0)throw new Me(Ae.MethodIsRequired,"Method is required.",{context:{configType:z.SingleElementHtmlTransformer}});z.SingleElementHtmlTransformer in t.configOptions&&Pp(e,t.configOptions[z.SingleElementHtmlTransformer]);break;case z.MultiElementModifier:if(e.transformationConfig.transformations.some(r=>Gt(r)))throw new Me(Ae.OnlyElementsSupported,"Can only target elements.",{context:{configType:z.MultiElementModifier}});z.MultiElementModifier in t.configOptions&&Np(e,t.configOptions[z.MultiElementModifier]);break}z.WhenElementClick in t.configOptions&&e.transformationConfig.when===Ce.ElementClick&&Op(e,t.configOptions[z.WhenElementClick])}function Dp(e,t,n){try{return Ds(e,t,n),!0}catch(r){return!1}}function Ms(e){function t(n){if(Ge()){if(!N(n,!1)){y.log.error("A config is required when setting WPM Config.");return}try{Ps(n),pp(n),y.log.info("Set WPMConfig to the following: ",n)}catch(r){y.log.error(`WPMConfig could not be set due to: ${K(r).message}`,r)}}else y.log.error("WPMConfig can only be set before SalesforceInteractions.init is called.")}if(b(e))try{const n=JSON.parse(e);t(n)}catch(n){y.log.error("JSON WPM Config list could not be initialized due to: ",n)}else t(e)}function Mp(e){const t=hr();if(b(t)){const n=new URL(e),r=new URL(t);return n.hostname===r.hostname}return!0}var Rs=(e=>(e.Cart="cart",e.CartItem="cartItem",e.Catalog="catalog",e.Consent="consentLog",e.Order="order",e.OrderItem="orderItem",e))(Rs||{}),Ls=(e=>(e.Engagement="Engagement",e.Profile="Profile",e))(Ls||{}),Li=(e=>(e.Category="category",e.DateTime="dateTime",e.DeviceId="deviceId",e.EventId="eventId",e.EventType="eventType",e.SessionId="sessionId",e))(Li||{}),xs=(e=>(e.OnBeforeEventSend="dataCloud:onBeforeEventSend",e))(xs||{}),ht=(e=>(e.Id="personalizationId",e.ContentId="personalizationContentId",e))(ht||{});function Rp(){document.addEventListener(xs.OnBeforeEventSend,e=>{const t=e.detail.actionEvent;if(!Lp(t))return;const n=t.personalization;if(N(n)){if((n==null?void 0:n.isTesting)===!0)ks(e,Us,"Cancelling event since we are in test mode and all events are engagement events","Not sending engagement event since we are in test mode");else if((b(n.id)||b(n.contentId))&&!ks(e,xp,"Cancelling event since Personalization fields are already present in events with different values","Not sending event since Personalization fields are already present in event with different values")){const r=e.detail.events;kp(n,r)}}})}function Lp(e){return"personalization"in e}function ks(e,t,n,r){let i=e.detail.events;const o=t(i,e.detail.actionEvent.personalization);if(o.length>0){if(o.length===i.length)return P.log.warn(n,JSON.stringify(i)),e.detail.events=[],e.preventDefault(),!0;o.forEach(s=>P.log.warn(r,JSON.stringify(s))),i=i.filter(s=>!o.includes(s)),e.detail.events=i}return!1}function Us(e,t){return e.filter(n=>n[Li.Category]===Ls.Engagement.toString()&&n[Li.EventType]!==Rs.Consent)}function xp(e,t){return e.filter(n=>J(n,ht.Id)&&n[ht.Id]!==t.id||J(n,ht.ContentId)&&n[ht.ContentId]!==t.contentId)}function kp(e,t){Us(t).forEach(n=>{b(e.id)&&(n[ht.Id]=e.id),b(e.contentId)&&(n[ht.ContentId]=e.contentId)})}function Up(){document.addEventListener(P.CustomEvents.OnInit,()=>{const e=Ue();if(e===void 0||e.attributes===void 0){P.log.warn("Engagement Configuration does not have any Config for Attributes");return}const t=e.attributes.engagements;Object.keys(t).forEach(n=>{t[n].qualify()})}),document.addEventListener(P.CustomEvents.OnShutDown,()=>{zc()})}var Oe=(e,t,n)=>new Promise((r,i)=>{var o=a=>{try{l(n.next(a))}catch(u){i(u)}},s=a=>{try{l(n.throw(a))}catch(u){i(u)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,s);l((n=n.apply(e,t)).next())});function Hs(e){const t=Wn().find(r=>r.name===e.transformerName);if(t===void 0){y.log.error(`transformer with name ${e.transformerName} could not be found`);return}const n=Qa(t.transformerType);if(n===void 0){y.log.error(`transformer ${t.transformerType} does not have an implementation`);return}return[n,t]}function Fs(e,t,n,r){return e.map((i,o)=>{const s=n+`, transformer ${i.transformation.transformerName}, element index ${o}`,l=Hs(i.transformation);if(D(l)){const c=new Error(`Cannot transform, handler not found for ${s}`);return y.log.error(c.message),t.status.update(new k(c)),xn(i.transformation),null}const[a,u]=l,f=`Providing transformer with element promise etc, ${s}`;y.log.trace(f),t.status.update(new k(f));const p=a.transform(u,i.transformation,i.pageElementReady,r,t);return p.promise=p.promise.then(()=>{const c=`Finished transformation for ${s}`;y.log.trace(c),t.status.update(new k(c))}).catch(c=>{const h=new Error(`Issue handling transformation for ${s}`+K(c).message);throw y.log.error(h.message),t.status.update(new k(h)),c}).finally(()=>xn(i.transformation)),p}).filter(i=>!D(i))}function Hp(e,t=!1){const n=`PEC ${e.pec.name}`,r=Gs(e.pec);if(!H(r)){const o=new ie(fe.MissingPersonalization,`Could not find any elements, PEC ${n}`);throw y.log.warn(o.message),o}t&&jo({personalizationExperienceConfigName:e.pec.name});const i=Fs(r,e,n);zs(e,Promise.resolve({transformResponses:i}),n)}function zs(e,t,n,r){e.status.update(new k(`Awaiting response and processing for ${n}`),t.then(i=>Oe(this,null,function*(){yield Promise.allSettled(i.transformResponses.map(o=>Oe(this,null,function*(){return yield o.promise}))).then(o=>{const s=o.filter(l=>l.status==="rejected").map(l=>K(l.reason).message);if(s.length>0)throw new Error(`Issue(s) with transformation(s) for ${n}: ${JSON.stringify(s)}`)})}))),e.initiateRevert=()=>{const i=new ur(t.then(o=>Oe(this,null,function*(){yield Promise.allSettled(o.transformResponses.map(s=>Oe(this,null,function*(){yield s.revert(i)}))).then(s=>{const l=s.filter(a=>a.status==="rejected").map(a=>K(a.reason).message);if(l.length>0)throw new Error(`Issue(s) with revert (see 'statuses' for more detail): ${JSON.stringify(l)}`);i.update(new k("Revert (as applicable) finished")),!D(o.personalizationId)&&et(r)&&!r?Rr(o.personalizationId):D(o.personalizationId)&&Rr(e.pec.name)})}),o=>{if(o instanceof ie)i.update(new k("Nothing to revert, no transformation attempt"));else throw o}));return i}}function Fp(e,t,n){const r=e.pec.name;let i=`PEC ${r}`;const o=t.then(s=>{const l=s.personalizations.filter(p=>{var c;return In((c=e.pec.dataProvider)==null?void 0:c.type)&&e.pec.dataProvider.value===p.personalizationPointName});if(H(l)){if(l.length>1){const p=`Received multiple responses for [${i}] when only one is expected. Using the first response.`;y.log.warn(p),e.status.update(new k(p))}}else{const p=new ie(fe.MissingPersonalization,`Did not receive a personalization response for ${i}`);throw y.log.warn(p.message),p}const a=l[0],u=a.personalizationId;if(!Wo(a))if(b(a.decisionId)){const p=new ie(fe.MissingPersonalizationDataAttributes,'Personalization invalid. Expected to include either "data" or "attributes".',{context:{configName:r,personalization:a}});throw y.log.warn(p.message),p}else{const p=`User did not qualify for a decision for the following personalization experience config: ${r}`;return y.log.debug(p),e.status.update(new k(p)),{personalizationId:u,transformResponses:[]}}e.status.update(new k(`Found response personalizationId ${u} ${i}`));const f=Gs(e.pec);if(!H(f)){const p=new ie(fe.MissingPersonalization,`Could not find any elements, ${i}, personalization ${u}`);throw y.log.warn(p.message),n||Rr(u),p}return i=i+`, personalization ${u}`,{personalizationId:u,transformResponses:Fs(f,e,i,a)}});zs(e,o,i,n)}function zp(e,t,n){if(!H(e)){y.log.warn("ignoring empty personalization experience configs");return}if(D(t)){const i="null/undefined personalization response promise";y.log.warn(`ignoring ${i}`);const o=new Error(i);vn.updateForAll(e,new k(o),Promise.reject(o)),Ur(e.map(s=>s.pec));return}const r=t.then(i=>{if(!N(i)){const o=D(i)?new Error("null/undefined personalization response"):new Error("unexpected personalization response type");throw y.log.error(o.message),Ur(e.map(s=>s.pec)),o}return eo("DEBUG")&&y.log.debug(`handling personalization response: ${JSON.stringify(i)}`),i},i=>{throw Ur(e.map(o=>o.pec)),i instanceof se&&i.level==="warning"?(y.log.warn("Personalization response promise rejection: ",i.message),i):(y.log.error("error handling personalization response",i),new Error("Personalization response promise rejection: "+K(i).message))});e.filter(i=>{var o;return In((o=i.pec.dataProvider)==null?void 0:o.type)}).forEach(i=>{const o=Object.values(n!=null?n:{}).flatMap(s=>Object.values(s)).filter(s=>{var l;return s.point.name===((l=i.pec.dataProvider)==null?void 0:l.value)}).flatMap(s=>s.pecNames).length>1;Fp(i,r,o)})}function Vp(e){var t;const n=e.name;return(t=$o(n))!=null?t:""}function Bp(e){return e.path}function Vs(e,t){var n;if(pr(e,t))return"html";if(Sn(e,t))return Vp(e);if(rt(e))return Bp(e);if(_t(t))return"body";if(uo((n=Hs(e))==null?void 0:n[1].transformerType))return"head"}function Bs(e){return Oe(this,null,function*(){return yield new Promise((t,n)=>{const r=lr("findElementOnPage:"+e);document.addEventListener(y.CustomEvents.OnShutDown,()=>{y.DisplayUtils.unbind(r),n(new Ve(De.NotWaitingForElementPath,"No longer waiting for element at path.",{context:{path:e}}))}),y.DisplayUtils.bind(r).pageElementLoaded(e).then(i=>{t(i)}).catch(i=>{y.log.warn("error with DisplayUtils",i),n(i)})})})}function Kn(e){const t=[];for(const n of e.transformations){const r=Vs(n,e.method),i=r!==void 0?t.find(o=>Vs(o.transformation,e.method)===r):void 0;i!==void 0?t.push({transformation:n,pageElementReady:i.pageElementReady}):r!==void 0?t.push({transformation:n,pageElementReady:Bs(r)}):y.log.warn(`could not get the element path for transformerConfig: ${JSON.stringify(e)}`)}return t}function Gp(e){return Kn(e.transformationConfig)}function jp(e){var t;const n=e.transformationConfig,r=fo(n.whenValues)&&(t=n.whenValues.percent)!=null?t:0,i=new Promise((s,l)=>{const a=lr("pageElementsReadyOnPageScroll:"+e.name);document.addEventListener(y.CustomEvents.OnShutDown,()=>{y.DisplayUtils.unbind(a),l(new Ve(De.NotWaitingForPageScroll,"No longer waiting for page scroll.",{context:{config:e.name}}))});const u=window.scrollY/(document.documentElement.scrollHeight-window.innerHeight);try{u>=r?s():y.DisplayUtils.bind(a).pageScroll(r).then(s).catch(f=>{l(new Ve(De.DisplayUtilsPageScrollError,"Error with DisplayUtils pageScroll method.",{cause:f}))})}catch(f){l(new Ve(De.DisplayUtilsPageScrollError,"Error with DisplayUtils pageScroll method.",{cause:f}))}}),o=s=>Oe(this,null,function*(){const[l]=yield Promise.all([s,i]);return l});return Kn(n).map(s=>(s.pageElementReady=o(s.pageElementReady),s))}function Wp(e){var t;const n=e.transformationConfig,r=ho(n.whenValues)&&(t=n.whenValues.delay)!=null?t:0,i=new Promise((s,l)=>{const a=lr("pageElementsReadyOnExitIntent:"+e.name);document.addEventListener(y.CustomEvents.OnShutDown,()=>{y.DisplayUtils.unbind(a),l(new Ve(De.NotWaitingForPageExit,"No longer waiting for page exit.",{context:{config:e.name}}))});try{y.DisplayUtils.bind(a).pageExit(r).then(s).catch(u=>{l(new Ve(De.DisplayUtilsPageExitError,"Error with DisplayUtils pageExit method.",{cause:u}))})}catch(u){l(new Ve(De.DisplayUtilsPageExitError,"Error with DisplayUtils pageExit method.",{cause:u}))}}),o=s=>Oe(this,null,function*(){const[l]=yield Promise.all([s,i]);return l});return Kn(n).map(s=>(s.pageElementReady=o(s.pageElementReady),s))}function qp(e){const t=e.transformationConfig,n=co(t.whenValues)?t.whenValues.path:"";if(!b(n))return[];function r(s){return Oe(this,null,function*(){return yield new Promise((l,a)=>{const u=()=>{y.log.debug(`Add Overlay Personalization Element '${s.id}' was clicked`),l(s)};document.addEventListener(y.CustomEvents.OnShutDown,()=>{s.removeEventListener("click",u),a(new Ve(De.NotWaitingForElementClick,"No longer waiting for element click.",{context:{element:s.id}}))});try{s.addEventListener("click",u)}catch(f){a(new Ve(De.AddingClickListenerError,"Error with adding click listener",{cause:f}))}})})}function i(){return Oe(this,null,function*(){yield Bs(n).then(s=>Oe(this,null,function*(){return yield r(s)}))})}const o=s=>Oe(this,null,function*(){const[l]=yield Promise.all([s,i()]);return l});return Kn(t).map(s=>(s.pageElementReady=o(s.pageElementReady),s))}function Gs(e){const t=e.transformationConfig.when;return t===Ce.Immediately?Gp(e):t===Ce.ScrollPercent?jp(e):t===Ce.ExitIntent?Wp(e):t===Ce.ElementClick?qp(e):(y.log.warn(`whenType [${t}] not explicitly handled`),[])}var Xn=(e,t,n)=>new Promise((r,i)=>{var o=a=>{try{l(n.next(a))}catch(u){i(u)}},s=a=>{try{l(n.throw(a))}catch(u){i(u)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,s);l((n=n.apply(e,t)).next())});function $p(){document.addEventListener(y.CustomEvents.OnShutDown,js),js()}function js(){Pu(),Yp(),Zp(),Qp(),Jp()}function Yp(){const e=te.pageUrl.listener,t=te.pageUrl.reject,n=te.pageUrl={};D(e)||document.removeEventListener(y.CustomEvents.OnInitSitemap,e),D(t)||t(new Error("shutdown/reinit")),n.matchedPromise=new Promise((r,i)=>{n.reject=i,n.listener=()=>{const o=Kp();n.matchedPECs=o,r(o)},document.addEventListener(y.CustomEvents.OnInitSitemap,n.listener)}),n.matchedPromise.catch(r=>{y.log.error(`Issue matching page URLs: ${K(r).message}`,r)})}function Zp(){const e=te.pageType.listener,t=te.pageType.reject,n=te.pageType={};D(e)||document.removeEventListener(y.CustomEvents.OnSettledSitemap,e),D(t)||t(new Error("shutdown/reinit")),n.matchedPromise=new Promise((r,i)=>{n.reject=i,n.listener=o=>{const s=Xp(o.detail.result);n.matchedPECs=s,r(s)},document.addEventListener(y.CustomEvents.OnSettledSitemap,n.listener)}),n.matchedPromise.catch(r=>{y.log.error(`Issue matching page types: ${K(r).message}`,r)})}function Kp(){var e;const t=(e=window==null?void 0:window.location)==null?void 0:e.href;return y.log.debug(`current page url: ${t}`),cs(t)}function Xp(e){var t,n;const r=(t=e==null?void 0:e.matchedConfig)==null?void 0:t.name,i=(n=window==null?void 0:window.location)==null?void 0:n.href;return y.log.debug(`sitemap result pageType: ${r} url: ${i}`),fs(r)}function Qp(){if(te.pageUrl.processedPromise=void 0,D(te.pageUrl.matchedPromise)){y.log.error("Unable to process page URL matches. Missing Promise.");return}te.pageUrl.processedPromise=te.pageUrl.matchedPromise.then(e=>Xn(this,null,function*(){yield $s(e)})),te.pageUrl.processedPromise.catch(e=>{y.log.error(`Issue processing page URL matches: ${K(e).message}`,e)})}function Jp(){if(te.pageType.processedPromise=void 0,D(te.pageUrl.matchedPromise)||D(te.pageType.matchedPromise)){y.log.error("Unable to process page type matches. Missing Promise(s).");return}te.pageType.processedPromise=Promise.all([te.pageUrl.matchedPromise,te.pageType.matchedPromise]).then(e=>Xn(this,null,function*(){if(e.length!==2)throw new Error(`Unable to process page type matches. Expected results for 2 promises (url matches, page-type matches), but found: ${e==null?void 0:e.length}`);const t=[],n=[];e[1].forEach(r=>{e[0].some(i=>i.name===r.name)?n.push(r.name):t.push(r)}),n.length>0&&y.log.debug(`Avoiding processing, already url-matched: ${JSON.stringify(n)}`),yield $s(t)})),te.pageType.processedPromise.catch(e=>{y.log.error(`Issue processing page type matches: ${K(e).message}`,e)})}function eg(e){if(!D(e)){if(!D(e.individualId)&&!b(e.individualId))throw new he(ce.IndividualIdNotValid,"Individual Id must be a valid string if provided.",{context:{value:e.individualId}});if(D(e.endpoint)||so(e.endpoint),!D(e.perPersonalizationPoint)){if(!N(e.perPersonalizationPoint))throw new Vt(vt.PointOptionsNotValid,"perPersonalizationPoint must be an object if provided.",{context:{value:e.perPersonalizationPoint}});Object.entries(e.perPersonalizationPoint).forEach(([t,n])=>{if(!b(t))throw new Vt(vt.PointOptionKeyInvalid,"perPersonalizationPoint key must be a valid string.",{context:{value:t}});if(!N(n))throw new Vt(vt.PointOptionsNotValid,"PreviewPersonalizationPointOptions must be an object.",{context:{value:n}});if(!D(n.decisionId)&&!b(n.decisionId))throw new he(ce.DecisionIdNotValid,"PreviewPersonalizationPointOptions decisionId must be a valid string if provided.",{context:{value:n.decisionId}})})}}}function tg(e,t){if(!H(e))throw new Vt(vt.MissingPersonalizationExperienceConfig,"Valid PersonalizationExperienceConfig(s) expected to Preview.");ng(e),y.log.debug(`Previewing personalization experience config(s): ${JSON.stringify(e.map(s=>s==null?void 0:s.name))}`),e.forEach(s=>{Ni(s),Oi(s)}),eg(t);const n={individualId:t==null?void 0:t.individualId,dataspaceApiName:Bt(),isPreview:!0,endpoint:t==null?void 0:t.endpoint},r=e.map(s=>new vn(s));Ws(r,!0),qs(r,n,t);const i=r.reduce((s,l)=>(s[l.pec.name]=l.status,s),{}),o=()=>{const s=r.reduce((l,a)=>(l[a.pec.name]=a.revert(),l),{});return new Bu(s)};return new Vu(i,o)}function ng(e){const t=e.map(r=>r.name),n=rg(t);if(n.length>0)throw new Vt(vt.DuplicatePersonalizationExperienceConfigs,"",{context:{value:n}})}function rg(e){const t=new Set,n=new Array;return e.forEach(r=>{const i=r.toLowerCase();t.has(i)?n.push(r):t.add(i)}),n}function ig(e){const t=new Set,n=new Set;return e.forEach(r=>{r.isEnabled===void 0||r.isEnabled?t.add(r):n.add(r.name)}),y.log.debug(`skipping matched disabled personalization experience config names: ${JSON.stringify(n)}`),[...t]}function Ws(e,t=!1){e.filter(n=>D(n.pec.dataProvider)).forEach(n=>{Hp(n,t)})}function qs(e,t,n){const r=e.filter(s=>!D(s.pec.dataProvider));if(y.log.debug(`matched enabled and with data providers personalization experience config names: ${JSON.stringify(r.map(s=>s.pec.name))}`),r.length<=0)return;const i=r.map(s=>s.pec),o=ep(i);t=t!=null?t:{dataspaceApiName:Bt()},et(t.isPreview)&&t.isPreview&&Object.values(o).forEach(s=>{Object.values(s).forEach(l=>{var a,u;const f=(u=(a=n==null?void 0:n.perPersonalizationPoint)==null?void 0:a[l.point.name])==null?void 0:u.decisionId;b(f)&&(l.point.decisionId=f)})}),og(r,o,t)}function $s(e){return Xn(this,null,function*(){e=ig(e);const t=e.map(r=>r.name);if(y.log.debug(`matched enabled personalization experience config names: ${JSON.stringify(t)}`),e.length<=0)return;if(Mi()){y.log.info(`WPM (client side editor) active, suppressing live/non-preview fetch for PECs: ${JSON.stringify(t)}`);return}const n=e.map(r=>new vn(r));Ws(n),qs(n),yield Promise.allSettled(n.map(r=>Xn(this,null,function*(){return yield r.status.finished}))).then(r=>{const i=r.filter(l=>l.status==="rejected"),o=i.filter(l=>{var a;return((a=l.reason)==null?void 0:a.level)==="warning"}).map(l=>K(l.reason));o.length>0&&y.log.warn(`Warnings processing matched PECs: ${JSON.stringify(t)}: ${JSON.stringify(o.map(l=>l.message))}`);const s=i.filter(l=>{var a;return((a=l.reason)==null?void 0:a.level)!=="warning"}).map(l=>K(l.reason));if(s.length>0)throw new Error(`Issues processing matched PECs: ${JSON.stringify(t)} : ${JSON.stringify(s.map(l=>l.message))}`)})})}function og(e,t,n){var r;const i=(r=n==null?void 0:n.dataspaceApiName)!=null?r:"";if(y.log.debug(`fetching for dataspace ["${i}]" points: ${JSON.stringify(t)}`),Object.keys(t).length<1){const s=JSON.stringify(e.map(a=>a.pec.name)),l=new Error(`No personalization points across PECs ${s} using dataspace [${i}]`);vn.updateForAll(e,new k(l),Promise.reject(l));return}const o={};b(n==null?void 0:n.dataspaceApiName)&&(o.dataspace=n.dataspaceApiName),b(n==null?void 0:n.individualId)&&(o.individualId=n.individualId),Object.values(t).forEach(s=>{const l=Bo(Object.values(s).map(u=>u.point),o,n==null?void 0:n.isPreview),a=Vo(l,{endpoint:n==null?void 0:n.endpoint});zp(e,a,t)})}var xi=(e,t,n)=>new Promise((r,i)=>{var o=a=>{try{l(n.next(a))}catch(u){i(u)}},s=a=>{try{l(n.throw(a))}catch(u){i(u)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,s);l((n=n.apply(e,t)).next())});function ag(){document.addEventListener(P.CustomEvents.OnInitSitemap,()=>{if(!Ho()){P.log.warn("No consent opt-in exists, skipping flicker defense");return}const e=Ie();for(const n of Object.values(Te))ki(n,e);const t=sg();Promise.race([cg(),t]).then(n=>{n=n!=null?n:[],ki(Te.PageUrlMatcher,n)}).catch(n=>{P.log.error("Unexpected error updating paths for flicker defense while evaluating Personalization Experience Config URL matches.",n)}),Promise.race([ug(),t]).then(n=>{n=n!=null?n:[],ki(Te.PageType,n)}).catch(n=>{P.log.error("Unexpected error updating paths for flicker defense while evaluating Personalization Experience Config page type matches.",n)})})}function sg(){return xi(this,null,function*(){yield new Promise(e=>{Qo(!1),setTimeout(()=>{P.log.debug(`flicker defense redisplay timeout of ${Ln().redisplayTimeoutMilliseconds}ms elapsed`),Qo(!0),lg(),e()},Ln().redisplayTimeoutMilliseconds)})})}function lg(){ct.PageUrlMatcher=[],ct.PageType=[],kr()}function ug(){return xi(this,null,function*(){return[...yield _s()]})}function cg(){return xi(this,null,function*(){return[...yield ys()]})}function ki(e,t){const n=Hh(e,t);ct[e]=ea(n),P.log.debug(`flicker defense currently hiding the following transformations for source matcher type ${e}: ${JSON.stringify(Object.values(ct[e]))}`),kr()}function fg(e){if(!Ge()){y.log.error("The config can only be modified before SalesforceInteractions.init is called.");return}if(!N(e)){y.log.error("A config is required.");return}if(e.customEngagementConfig!==void 0&&ma(e.customEngagementConfig),e.customWpmConfig!==void 0&&Ms(e.customWpmConfig),e.customFlickerDefenseConfig!==void 0&&na(e.customFlickerDefenseConfig),e.additionalTransformers!==void 0&&(J(e.additionalTransformers,"list")&&H(e.additionalTransformers.list,!0)?es(e.additionalTransformers.list):H(e.additionalTransformers,!0)?es(e.additionalTransformers):y.log.error("A list of transformers is required when adding to Transformers.")),e.personalizationExperienceConfigs!==void 0)if(J(e.personalizationExperienceConfigs,"list")&&H(e.personalizationExperienceConfigs.list,!0)){const t=vs().DATA_CLOUD_MODULE_CONFIG;if(N(t)){y.log.error("Initializing personalization experience configs using this format can only be used once.");return}op(Pi.DataCloudModuleConfig,e.personalizationExperienceConfigs),Di(e.personalizationExperienceConfigs.list,Pi.DataCloudModuleConfig)}else H(e.personalizationExperienceConfigs,!0)?Di(e.personalizationExperienceConfigs):y.log.error("A list of personalization experience configs is required.");if(e.additionalHandlebarsHelpers!==void 0){if(!N(e.additionalHandlebarsHelpers)){y.log.error("An object is required when adding custom handlebars helpers.");return}for(const[t,n]of Object.entries(e.additionalHandlebarsHelpers))rh(t,n)}}var dg=(e,t,n)=>new Promise((r,i)=>{var o=a=>{try{l(n.next(a))}catch(u){i(u)}},s=a=>{try{l(n.throw(a))}catch(u){i(u)}},l=a=>a.done?r(a.value):Promise.resolve(a.value).then(o,s);l((n=n.apply(e,t)).next())});function hg(e,t){return dg(this,null,function*(){try{if(!H(e))throw new he(ce.PersonalizationPointsIsNotAnArray,"The Personalization Points parameter must be an array of length >= 1.",{context:{value:e}});const n=e.map(i=>({name:i})),r=Bo(n,t);return yield Vo(r)}catch(n){return n instanceof se&&n.level==="warning"?y.log.warn(n.message):y.log.error(n),yield Promise.reject(n)}})}Fl(),zl(),Rp(),Up(),$p(),ju(),Jh(),gp(),ag(),window.SalesforceInteractions.Personalization={fetch:hg,Config:{initialize:fg,PersonalizationExperience:{findByName:Uh,getAll:Ie,addNew:Qh,isSupported:Oi,validate:Ni,preview:tg},Transformer:{getAll:Wn,addNew:yh},Engagement:{initializeCustom:ma,get:Ue,validate:ga},Wpm:{initializeCustom:Ms,get:Ss,validate:Ps},FlickerDefense:{initializeCustom:na,get:Ln},ContentZoneHandler:{set:Nu,get:Ou}},launchWpm:Tp}})(window.SalesforceInteractions);

        
      } catch (e) {
        console.error("[Salesforce personalization] Error initializing module: personalization", e);
      }
      })();

// SITEMAP AND INIT
try {
  (function () {
    console.log('Starting Website_PD initializing Salesforce Interactions...');

window.userInfo = window.userInfo || {};  //Added By kushal Rakhecha

SalesforceInteractions.init({
  cookieDomain: 'porsche.com',
  consents: new Promise(resolve => {
    // check for Salesfoce Audience Layer

    // Check if a specific value is stored in localStorage
    if (localStorage.getItem('enableDebugLogs') === 'true') {
      SalesforceInteractions.setLoggingLevel('debug'); // Enable debug logging
    } else {
      SalesforceInteractions.setLoggingLevel('none'); // Disable logs
    }
    //console.log('cookie domain is ', SalesforceInteractions.getCookieDomain());

   const findconsent = (frequencyCheck = 3000, numberCheckMax = 400) => {
      let intervalCount = 0;
      return new Promise((resolve, reject) => {
        let interval = setInterval(() => {
          intervalCount += 1;
          if (typeof usercentrics === 'undefined')
            return;
          let result = usercentrics?.getConsents()?.find((k) => k.technicalName == "uc-salesforceaudiencelayer")
          if (result) {
            clearInterval(interval);
            resolve(result);
          }
           else if (intervalCount > numberCheckMax) {
            clearInterval(interval);
            reject('undefined');
          }
        }, frequencyCheck);
      });
    };


    findconsent().then(pageDetails => {

     const layer = pageDetails["Salesforce Audience Layer"]; //findSalesforceAudienceLayer(data);
      if (pageDetails && pageDetails.consentStatus == true) {
        resolve([{
          provider: 'uc-salesforceaudiencelayer',
          purpose: SalesforceInteractions.ConsentPurpose.Tracking,
          status: SalesforceInteractions.ConsentStatus.OptIn
        }]);
      } else {
        try {
          SalesforceInteractions.sendEvent({
            user: {
              attributes: {
                eventType: 'Profile',
                consentStatus: "Opt Out"
              }
            }
          });
          
        } 
        catch (error) {

        }
        resolve([{
          provider: 'uc-salesforceaudiencelayer',
          purpose: SalesforceInteractions.ConsentPurpose.Tracking,
          status: SalesforceInteractions.ConsentStatus.OptOut
        }]);
      }
    });
  })
}).
then(() => {
  // This function is used to set emailaddress in the cookies so we can validate against it before sending an anonyomous profile // Yousef + Kushal

  function setEmailCookie(email) {
    const daysToExpire = 25 * 30.44;
    const date = new Date();
    date.setTime(date.getTime() + (daysToExpire * 24 * 60 * 60 * 1000));
    const expires = "expires=" + date.toUTCString();
    document.cookie = "userExists=" + encodeURIComponent(email) + ";" + expires + ";path=/";
  }

  //Retreieve  email cookie 
  function getEmailCookie(name) {
    const cookies = document.cookie.split('; ');
    const result = {};

    for (let cookie of cookies) {
      const [key, value] = cookie.split('=');
      if (key === 'userExists') {
        result[key] = decodeURIComponent(value);
      }
    }

    return result;
  }

  const findPagData = (attribute_pagData, frequencyCheck = 3000, numberCheckMax = 10) => {
    let intervalCount = 0;
    return new Promise((resolve, reject) => {
      let interval = setInterval(() => {
        intervalCount += 1;
        if (typeof pagData === 'undefined')
          return;
        let result = pagData
          .slice()
          .reverse()
          .find((k) => k[attribute_pagData]);

        if (result) {
          clearInterval(interval);
          resolve(result);
        } else if (intervalCount > numberCheckMax) {
          clearInterval(interval);
          reject('undefined');
        }
      }, frequencyCheck);
    });
  };
  let pageDetails;
  const setPageDetailsFromPagData = (det) => {
    pageDetails = det;
  };

  const userexists = getEmailCookie();
 
  //let consent = usercentrics?.getConsents()?.find((k) => k.technicalName == "uc-salesforceaudiencelayer")
  // findPagData('ids').then(pageDetails => {
  //   if (pageDetails && pageDetails.ids && pageDetails.ids.ciamId && pageDetails.ids.userId) {
  //     setTimeout(() => {

  //       if (pageDetails.context.country === 'DE') {
  //         sitemapUtils.sendIdentityData('Profile', {
  //           ciamId: pageDetails.ids.ciamId,
  //           language: pageDetails.context.language,
  //           userId: pageDetails.ids.userId,
  //           countryCode: pageDetails.context.country,
  //           eventType: 'Profile',
  //           isAnonymous: 0, // Standard
  //           isanonymous: '0', // custom
  //           consentStatus: consent?.consentStatus == true? "Opt In": "Opt Out"
  //         });
  //       }
  //     }, 8000);
  //   }

  // }, pageDetails => {
  //   if (!userexists.userExists && consent) {
  //     findPagData('context').then((data) => {
  //       if (data.context.country === 'DE') {
  //         SalesforceInteractions.sendEvent({
  //           user: {
  //             attributes: {
  //               eventType: 'Profile',
  //               countryCode: data.context.country,
  //               language: data.context.language,
  //               isAnonymous: 1, // Standard
  //               isanonymous: '1', // custom
  //               consentStatus: consent?.consentStatus == true? "Opt In": "Opt Out"
  //             }
  //           }
  //         });
  //         //setEmailCookie('true');
  //       }
  //     }).catch((e) => { })


  //   };
  // }).catch((e) => {
  //   if (!userexists.userExists && consent) {
  //     findPagData('context').then((data) => {
  //       if (data.context.country === 'DE') {
  //         SalesforceInteractions.sendEvent({
  //           user: {
  //             attributes: {
  //               eventType: 'Profile',
  //               countryCode: data.context.country,
  //               language: data.context.language,
  //               isAnonymous: 1, // Standard
  //               isanonymous: '1', // custom
  //               consentStatus: consent?.consentStatus == true? "Opt In": "Opt Out"
  //             }
  //           }
  //         });
  //         //setEmailCookie('true');
  //       }
  //     }).catch((e) => { })
      

  //   };
  // });


  const { sendEvent } = SalesforceInteractions;
  //PAGES
  const global = {
    // attach optional data to every actionEvent that is sent out

  };
    window.addEventListener('consents_changed_finished', function (event) {
    console.log('consent was changed: consents_changed_finished Events')
    let result = usercentrics?.getConsents()?.find((k) => k.technicalName == "uc-salesforceaudiencelayer")
    if (result && result.consentStatus == true) {
      SalesforceInteractions.updateConsents({
        provider: 'uc-salesforceaudiencelayer',
        purpose: SalesforceInteractions.ConsentPurpose.Tracking,
        status: SalesforceInteractions.ConsentStatus.OptIn
      });
      findPagData('ids').then(pageDetails => {
        if (pageDetails && pageDetails.ids && pageDetails.ids.ciamId && pageDetails.ids.userId) {
          setTimeout(() => {

            if (pageDetails.context.country === 'DE') {
              sitemapUtils.sendIdentityData('Profile', {
                ciamId: pageDetails.ids.ciamId,
                language: pageDetails.context.language,
                userId: pageDetails.ids.userId,
                countryCode: pageDetails.context.country,
                eventType: 'Profile',
                isAnonymous: 0, // Standard
                isanonymous: '0', // custom
                consentStatus: result?.consentStatus == true? "Opt In": "Opt Out"
              });
            }
          }, 8000);
        }

      }, pageDetails => {
        if (!userexists.userExists) {
          findPagData('context').then((data) => {
            if (data.context.country === 'DE') {
              SalesforceInteractions.sendEvent({
                user: {
                  attributes: {
                    eventType: 'Profile',
                    countryCode: data.context.country,
                    language: data.context.language,
                    isAnonymous: 1, // Standard
                    isanonymous: '1', // custom
                    consentStatus: result?.consentStatus == true? "Opt In": "Opt Out"
                  }
                }
              });
            }
          }).catch((e) => { })


        };
      })

      return;
    }
    findPagData('context').then(pageDetails => {
      if (pageDetails.context.country === 'DE') {
        sitemapUtils.sendIdentityData('Profile', {
          //ciamId: pageDetails.ids.ciamId,
          language: pageDetails.context.language,
          // userId: pageDetails.ids.userId,
          countryCode: pageDetails.context.country,
          eventType: 'Profile',
          isAnonymous: 1, // Standard
          isanonymous: '1', // custom
          consentStatus: result?.consentStatus == true? "Opt In": "Opt Out"
        });
      }
      SalesforceInteractions.updateConsents({
        provider: 'uc-salesforceaudiencelayer',
        purpose: SalesforceInteractions.ConsentPurpose.Tracking,
        status: SalesforceInteractions.ConsentStatus.OptOut
      });
    })

  })

  const finder_homePage = {
    name: 'home',
    isMatch: () => {
      return findPagData('pageExperience')
        .then((pageDetails) => {
          setPageDetailsFromPagData(pageDetails);
          let pageName = pageDetails.pageExperience.pageName;
          let actionName = pageDetails.context.eventAction;
          //console.log('pageDetails:', pageDetails);
          //console.log('pageName:', pageName);

          if (pageName == 'home') {

            if (pageDetails.context.country === 'DE') {
              SalesforceInteractions.sendEvent({
                name: 'homepage',
                interaction: {
                  name: 'homepage', // The name of the interaction (e.g., the action being performed)
                  eventType: 'Engagement', // The type of the event
                  countryCode: pageDetails.context.country,
                  currency: pageDetails.context.currency,
                  actionName: 'homepage', // Specific name for the action
                  actionId: 'finder_pageView', // Unique identifier for the action
                },
              });
            }

            //console.log('pageView - Home');
          };
          return pageName == 'home' || actionName.includes('Home');
        })
        .catch((e) => {
          return false;
        })
    },
  };

  const finder_searchListPage = {
    name: 'search_list',
    isMatch: () => {
      return findPagData('pageExperience')
        .then((pageDetails) => {
          setPageDetailsFromPagData(pageDetails);
          let pageName = pageDetails.pageExperience.pageName;
          let pageId = pageDetails.pageExperience.pageId;
          //console.log(pageDetails);
          const url = pageId;
          const urlParams = new URL(url).searchParams;
          if (pageId.includes('search/') && pageId.includes('?model=') && !pageId.includes('&')) { // checking if "model is the only parameter"

            const model = urlParams.get("model");
            //console.log('model = ',model);

            if (pageDetails.context.country === 'DE') {
              SalesforceInteractions.sendEvent({
                interaction: {
                  name: 'Engagement',
                  eventType: 'Engagement',
                  countryCode: pageDetails.context.country,
                  currency: pageDetails.context.currency,
                  actionName: 'searchModelPage',
                  actionId: 'finder_pageView',
                  modelName: model,
                },
              });
            }
          }
          else if (pageId.includes('maximum-price=')) {
            const model = urlParams.get("model");
            if (pageDetails.context.country === 'DE') {
              SalesforceInteractions.sendEvent({
                interaction: {
                  name: 'Engagement',
                  eventType: 'Engagement',
                  countryCode: pageDetails.context.country,
                  currency: pageDetails.context.currency,
                  actionName: 'searchModelPage',
                  actionId: 'finder_pageView',
                  modelName: model,
                },
              });
            }
          }
          else if (pageName == 'search_list') {
            if (pageDetails.context.country === 'DE') {
              SalesforceInteractions.sendEvent({
                interaction: {
                  name: 'Engagement',
                  eventType: 'Engagement',
                  countryCode: pageDetails.context.country,
                  currency: pageDetails.context.currency,
                  actionName: 'searchPage',
                  actionId: 'finder_pageView',
                },
              });
            }



          }
          // Calculator Event
          const leasingOrFinancing = document.querySelectorAll('li[class^="StaticPeriodicPaymentLinks_productList"]')
            .forEach(element => {
              element.addEventListener('click', function (event) {
                //console.log('Calculator Clicked:', event.currentTarget);

                //console.log('Calculator Event triggered');
                findPagData('financialProduct')
                  .then((data) => {
                    if (data) {
                      if (data.financialProduct.productCategory) {
                        //console.log('SFfinancialProduct.productCategory:', data.financialProduct.productCategory);
                        if (data.context.country === 'DE') {
                          SalesforceInteractions.sendEvent({
                            interaction: {
                              name: 'Engagement',
                              eventType: 'Engagement',
                              countryCode: data.context.country,
                              currency: data.context.currency,
                              actionName: (data.financialProduct.productCategory === 'leasing') ? 'searchModelPageLeasing' : (data.financialProduct.productCategory === 'loan') ? 'searchModelPageFinancing' : '',
                              actionId: 'finder_pageView',
                            },
                          });
                        }
                        //console.log('Calculator SalesforceInteractions event sent successfully.');
                      } else {
                        //console.log('SFfinancialProduct does not exist');
                      }
                    }
                  })
                  .catch((error) => {
                    //console.log('Error fetching componentClick: ', error);
                  });


              });
            });

          // Select all addToFavButtons with the class "_1725l2y4"
          const addToFavButtons = document.querySelectorAll('button._1725l2y4');

          // Loop through each button and add a click listener
          addToFavButtons.forEach(button => {
            button.addEventListener('click', () => {
              // You can add your custom logic here
              findPagData('componentClick') // put breakpoints at onurl change and on click in console to debug
                .then((data) => {
                  if (data.context.country === 'DE' && pageName === 'search_list') {
                    SalesforceInteractions.sendEvent({
                      interaction: {
                        name: 'Engagement',
                        eventType: 'Engagement',
                        actionName: (data.componentClick.clickElementId === "favlist-added-item-on-search-list") ? 'carSaved' : 'carSavedUncheck',
                        actionId: 'finder_searchModelPage',
                        countryCode: data.context.country,
                        currency: data.context.currency,
                        engineType: data.car.engineType,
                        isPorscheApproved: data.car.isPorscheApproved + '',
                        listingId: data.car.listingId,
                        modelCode: data.car.modelCode,
                        modelModelYear: Number(data.car.modelModelYear),
                        modelName: data.car.modelName,
                        mileage: data.car.mileageValue,
                        mileageUnit: data.car.mileageUnit == 'kilometer' ? 'KM' : data.car.mileageUnit,
                        priceTotalTotal: data.car.priceTotalTotal,
                        realCarStatus: data.car.realcarStatus,
                      },
                    });
                  }
                })
                .catch((error) => {
                });
            });
          });

          //Filters
          const checkboxSelectors = [
            "#filter-content-Zustand input[type=checkbox]", //condition
            "#filter-content-Modellvarianten input[type=checkbox]", //derivative
            "#filter-content-Karosserie input[type=checkbox]", //body style
            "#filter-content-Aktionen\\&Finanzprodukte input[type=checkbox]", //finance product
          ];
          const inputSelectors = [
            "#filter-content-Preis input",               // maxPrice input
            "#filter-content-Preis select",               // maxPrice select
            "#filter-content-Laufleistung input",        // maxMileage input
            "#filter-content-Laufleistung select",        // maxMileage select
            "#filter-content-Modelle select"             // model
          ];
          // Attach to checkboxes
          const funnelFilterButton = document.querySelector("body > div:nth-child(5) > main > div > div._2hx07f5 > aside > button")
            .addEventListener('click', function (event) {
              console.log('funnelFilterButton clicked!')
              setTimeout(() => {
                const ffb_plusIconButtonDivs = document.querySelectorAll('div.jh358c2').forEach(icon => {
                  icon.addEventListener('click', function (event) {
                    console.log('ffb_plusIconButtonDivs clicked!')
                    setTimeout(() => {

                      checkboxSelectors.forEach(selector => {
                        document.querySelectorAll(selector).forEach(checkbox => {
                          checkbox.addEventListener('change', handleCheckboxChange);
                        });
                      });

                      inputSelectors.forEach(selector => {
                        document.querySelectorAll(selector).forEach(input => {
                          input.addEventListener('change', handleInputChange);
                        });
                      });
                    }, 0);
                  });
                });

                checkboxSelectors.forEach(selector => {
                  document.querySelectorAll(selector).forEach(checkbox => {
                    checkbox.addEventListener('change', handleCheckboxChange);
                  });
                });

                inputSelectors.forEach(selector => {
                  document.querySelectorAll(selector).forEach(input => {
                    input.addEventListener('change', handleInputChange);
                  });
                });
              }, 0);
            });
          ;

          checkboxSelectors.forEach(selector => {
            document.querySelectorAll(selector).forEach(checkbox => {
              checkbox.addEventListener('change', handleCheckboxChange);
            });
          });

          inputSelectors.forEach(selector => {
            document.querySelectorAll(selector).forEach(input => {
              input.addEventListener('change', handleInputChange);
            });
          });
          return pageName == 'search_list';
        })
        .catch((e) => {
          return false;
        });
    },
  };
  let listenerPlaced = false;
  
  //listener on pagdata, activates whenever an element is pushed into pagdata
  const pagDataListener = setTimeout(() => {
    const originalPush = pagData.push
    pagData.push = function (...args) {
      console.log('entered pagdata push function')
      console.log('item entered: ' + JSON.stringify(args[0]));
      setPageDetailsFromPagData(args[0]);
      let pageName = pageDetails.pageExperience.pageName;
      const componentClicked = pageDetails.componentClick;
      if (pageDetails.event == 'page' && pageName == "contact_callback_screen") {
        setTimeout(() => {
          const buttons = document.querySelectorAll('[data-testid="submit-contact-form"]')// document.querySelectorAll('contact-form-p-button.sc-bPkUNa.ghiLuj.hydrated');
          const button = buttons[buttons.length - 1]
          if (button&& !listenerPlaced) {
            listenerPlaced  = true
            button.addEventListener('click', () => {



              // Extract the +xxx code using regex

              const inputs = document.querySelectorAll('[name="callbackForm"] > div')[2].querySelectorAll('contact-form-p-text-field-wrapper > input');
              //console.log('Input fields found: ', inputs);
              //const Salutation = document.querySelector('[name="salutation"]').shadowRoot.textContent.split('*')[1];

              const Salutation = document.querySelectorAll('[name="callbackForm"] > div')[2].querySelector('[name="salutation"]').shadowRoot?.textContent?.split('*')[1] || '';
              const firstName = inputs[0]?.value || '';
              const lastName = inputs[1]?.value || '';
              const emailAddress = inputs[2]?.value || '';
              const phone = inputs[3]?.value || '';
              const lang = pageDetails?.context?.language || '';
              const Country = pageDetails?.context?.country || '';

              const selectElement = document.querySelector('form[name="callbackForm"] select[data-testid="phoneInput.select"]');
              const selectedText = selectElement?.selectedOptions[0]?.textContent;

              const e164Code = selectedText?.match(/\+\d+/)?.[0];


              window.userInfo = {
                emailAddress: emailAddress,
                firstName: firstName,
                lastName: lastName,
                phone: phone
              };

              if (emailAddress) {
                // //console.log('Sending identity data...');
                if (Country === 'DE') {
                  sitemapUtils.sendIdentityData('Profile', {
                    salutation: Salutation,
                    firstName: firstName,
                    lastName: lastName,
                    email: emailAddress.toLowerCase(),
                    porscheId: emailAddress.toLowerCase(),
                    phoneNumber: (e164Code + phone).replaceAll(' ', ''),
                    language: lang,
                    eventType: 'Profile',
                    countryCode: Country,
                    isAnonymous: 0, // Standard
                    isanonymous: '0' // custom
                  });
                  findPagData('car')
                    .then((data) => {
                      SalesforceInteractions.sendEvent({
                        interaction: {
                          name: 'finder_contactForm', // The name of the interaction (e.g., the action being performed)
                          eventType: 'Engagement', // The type of the event
                          countryCode: Country,
                          currency: data.context.currency,
                          engineType: data.car.engineType,
                          isPorscheApproved: data.car.isPorscheApproved + '',
                          listingId: data.car.listingId,
                          modelCode: data.car.modelCode,
                          modelName: data.car.modelName,
                          modelModelYear: Number(data.car.modelModelYear),
                          mileage: data.car.mileage,
                          mileageUnit: data.car.mileageUnit == 'kilometer' ? 'KM' : data.car.mileageUnit,
                          priceTotalTotal: data.car.priceTotalTotal,
                          realCarStatus: data.car.realCarStatus,
                          actionName: 'contactFormSubmitted', // Specific name for the action
                          actionId: 'finder_contactForm', // Unique identifier for the action
                        },
                      });
                    }).catch((e) => {
                      console.log(e);
                    });

                  //console.log('Identity data sent successfully for email: ', emailAddress);

                  setEmailCookie('true');
                }

              } else {
                //console.log('Email address is empty. Identity data not sent.');
              }
            });
          } else {
            //console.log('Button not found. Event listener not attached.');
          }
        }, 8000);
      }
      return originalPush.apply(pagData, args);
    }
  }, 5000);

  const finder_contactEmailScreenPage = {
    name: 'contact_email_screen',
    isMatch: () => {
      return findPagData('pageExperience')
        .then((pageDetails) => {
          setPageDetailsFromPagData(pageDetails);
          let pageName = pageDetails.pageExperience.pageName;
          // if (pageName == 'contact_email_screen') {
          if (window.location.href.includes("/contact/") && window.location.href.includes("finder")) {
            findPagData('ids').then(pageDetails => { // check if logged and id available
              if (pageDetails && pageDetails.ids) {
                window.userInfo.ciamId = pageDetails.ids.ciamId;
              };
            });

            setTimeout(() => {
              findPagData('car')
                .then((data) => {
                  if (data.context.country === 'DE') {
                    SalesforceInteractions.sendEvent({
                      interaction: {
                        name: 'Engagement',
                        eventType: 'Engagement',
                        countryCode: data.context.country,
                        currency: data.context.currency,
                        actionName: 'contactForm',
                        actionId: 'finder_pageView',
                        engineType: data.car.engineType,
                        isPorscheApproved: data.car.isPorscheApproved + '',
                        listingId: data.car.listingId,
                        mileage: data.car.mileage,
                        mileageUnit: data.car.mileageUnit == 'kilometer' ? 'KM' : data.car.mileageUnit,
                        modelCode: data.car.modelCode,
                        modelName: data.car.modelName,
                        modelModelYear: Number(data.car.modelModelYear),
                        realCarStatus: data.car.realcarStatus,
                        priceTotalTotal: data.car.priceTotalTotal,
                      },
                    });
                  }
                })
                .catch((e) => {
                  console.log(e);
                })
            }, 5000);


            setTimeout(() => {
              const button = document.querySelector('[data-testid="submit-contact-form"]').shadowRoot.querySelector("button");
              if (button) {
                button.addEventListener('click', () => {

                  const selectElement = document.querySelector('form[name="messageForm"] select[data-testid="phoneInput.select"]');
                  const selectedText = selectElement?.selectedOptions[0]?.textContent;

                  // Extract the +xxx code using regex
                  const e164Code = selectedText?.match(/\+\d+/)?.[0];


                  const inputs = document.querySelector('[name="messageForm"] > div').querySelectorAll('contact-form-p-text-field-wrapper > input');
                  const Salutation = document.querySelector('[name="salutation"]').shadowRoot.textContent.split('*')[1];
                  //document.querySelector('[name="salutation"]').shadowRoot.querySelector("#value > span").textContent; // Added by yousef and kushal
                  const firstName = inputs[0]?.value || '';
                  const lastName = inputs[1]?.value || '';
                  const emailAddress = inputs[2]?.value || '';
                  const phone = inputs[3]?.value || '';
                  const lang = pageDetails?.context?.language || '';
                  const Country = pageDetails?.context?.country || '';


                  window.userInfo = {
                    emailAddress: emailAddress,
                    firstName: firstName,
                    lastName: lastName,
                    phone: phone
                  };

                  if (emailAddress) {
                    // //console.log('Sending identity data...');
                    if (Country === 'DE') {
                      sitemapUtils.sendIdentityData('Profile', {
                        salutation: Salutation,
                        firstName: firstName,
                        lastName: lastName,
                        email: emailAddress.toLowerCase(),
                        porscheId: emailAddress.toLowerCase(),
                        phoneNumber: (e164Code + phone).replaceAll(' ', ''),
                        language: lang,
                        eventType: 'Profile',
                        countryCode: Country,
                        isAnonymous: 0, // Standard
                        isanonymous: '0' // custom
                      });
                      findPagData('car')
                        .then((data) => {
                          SalesforceInteractions.sendEvent({
                            interaction: {
                              name: 'finder_contactForm', // The name of the interaction (e.g., the action being performed)
                              eventType: 'Engagement', // The type of the event
                              countryCode: Country,
                              currency: data.context.currency,
                              engineType: data.car.engineType,
                              isPorscheApproved: data.car.isPorscheApproved + '',
                              listingId: data.car.listingId,
                              modelCode: data.car.modelCode,
                              modelName: data.car.modelName,
                              modelModelYear: Number(data.car.modelModelYear),
                              mileage: data.car.mileage,
                              mileageUnit: data.car.mileageUnit == 'kilometer' ? 'KM' : data.car.mileageUnit,
                              priceTotalTotal: data.car.priceTotalTotal,
                              realCarStatus: data.car.realCarStatus,
                              actionName: 'contactFormSubmitted', // Specific name for the action
                              actionId: 'finder_contactForm', // Unique identifier for the action
                            },
                          });
                        }).catch((e) => {
                          console.log(e);
                        });

                      //console.log('Identity data sent successfully for email: ', emailAddress);

                      setEmailCookie('true');
                    }

                  } else {
                    //console.log('Email address is empty. Identity data not sent.');
                  }
                });
              } else {
                //console.log('Button not found. Event listener not attached.');
              }
            }, 8000);
          };
          return pageName == 'contact_email_screen';
        })
        .catch((e) => {
          console.log(e);
          return false;
        });


    },
  };

  const finder_productPage = {
    name: 'product',
    isMatch: () => {
      return setTimeout(() => {
        findPagData('pageExperience')
          .then((pageDetails) => {
            setPageDetailsFromPagData(pageDetails);
            let pageName = pageDetails.pageExperience.pageName;
            let event = pageDetails.event;
            if (pageName == 'listing_details') {

              // //console.log('Starting to find page data for "car"...');
              var Currency;
              var Country;
              findPagData('context')
                .then((data) => {
                  //console.log('Page data for "context" found:', data);
                  Country = data.context.country;
                  Currency = data.context.currency;
                })
                .catch((err) => {
                  //console.log('Error occurred while finding page data for "contect":', err);
                })

              findPagData('car')
                .then((data) => {
                  if (Country === 'DE') {
                    SalesforceInteractions.sendEvent({
                      name: 'Engagement',
                      interaction: {
                        name: 'Engagement', // The name of the interaction (e.g., the action being performed)
                        eventType: 'Engagement', // The type of the event
                        actionId: 'finder_pageView',
                        actionName: 'detailPage',
                        countryCode: Country,
                        currency: Currency,
                        engineType: data.car.engineType,
                        isPorscheApproved: data.car.isPorscheApproved + '',
                        listingId: data.car.listingId,
                        modelCode: data.car.modelCode,
                        modelModelYear: data.car.modelModelYear,
                        modelName: data.car.modelName,
                        exteriorColorCode: data.car.exteriorColorCode,
                        interiorColorCode: data.car.interiorColorCode,
                        //modelRangeName: data.car.modelRangeName,
                        mileage: data.car.mileageValue,
                        mileageUnit: data.car.mileageUnit == 'kilometer' ? 'KM' : data.car.mileageUnit,
                        priceTotalTotal: data.car.priceTotalTotal,
                        realCarStatus: data.car.realcarStatus,
                        //type: data.car.type ???
                      }
                    });
                  }

                })
                .catch((err) => {
                  //console.log('Error occurred while finding page data for "car":', err);
                });

              //sitemapUtils.sendEngagementData("listing_details", "pageView");

              //console.log('car: ', pageDetails.car);
              //console.log('pageView - listing_details');

              //carSaveButton
              const carSavedButton = document.querySelector('button._1725l2y4._121ldsa0');

              if (carSavedButton) {
                carSavedButton.addEventListener('click', () => {
                  //console.log('carSavedButton clicked!');
                  findPagData('componentClick') // put breakpoints at onurl change and on click in console to debug
                    .then((data) => {
                      if (data.context.country === 'DE' && pageName === 'listing_details') {
                        SalesforceInteractions.sendEvent({
                          interaction: {
                            name: 'Engagement',
                            eventType: 'Engagement',
                            actionName: (data.componentClick.clickElementId === 'favlist-added-item-on-details') ? 'carSaved' : 'carSavedUncheck',
                            actionId: 'finder_detailPage',
                            countryCode: data.context.country,
                            currency: data.context.currency,
                            engineType: data.car.engineType,
                            isPorscheApproved: data.car.isPorscheApproved + '',
                            listingId: data.car.listingId,
                            modelCode: data.car.modelCode,
                            modelModelYear: Number(data.car.modelModelYear),
                            modelName: data.car.modelName,
                            exteriorColorCode: data.car.exteriorColorCode,
                            interiorColorCode: data.car.interiorColorCode,
                            mileage: data.car.mileageValue,
                            mileageUnit: data.car.mileageUnit == 'kilometer' ? 'KM' : data.car.mileageUnit,
                            priceTotalTotal: data.car.priceTotalTotal,
                            realCarStatus: data.car.realcarStatus,
                          },
                        });
                      }
                    })
                    .catch((error) => {
                      //console.log('Error fetching componentClick: ', error);
                    });
                });
              } else {
                console.warn('carSavedButton not found.');
              }


              //reserveButton
              const reserveButton = document.querySelector('fnssr-p-button[data-testid="detail-box-reservation"]');

              if (reserveButton) {
                reserveButton.addEventListener('click', () => {
                  //console.log('Reserve button clicked!');
                  findPagData('car') // put breakpoints at onurl change and on click in conso;le to debug
                    .then((data) => {
                      if (data.context.country === 'DE') {
                        SalesforceInteractions.sendEvent({
                          interaction: {
                            name: 'Engagement',
                            eventType: 'Engagement',
                            countryCode: data.context.country,
                            currency: data.context.currency,
                            actionName: 'carReservation',
                            actionId: 'finder_detailPage',
                            engineType: data.car.engineType,
                            isPorscheApproved: data.car.isPorscheApproved + '',
                            listingId: data.car.listingId,
                            mileage: data.car.mileageValue,
                            mileageUnit: data.car.mileageUnit == 'kilometer' ? 'KM' : data.car.mileageUnit,
                            exteriorColorCode: data.car.exteriorColorCode,
                            interiorColorCode: data.car.interiorColorCode,
                            modelCode: data.car.modelCode,
                            modelName: data.car.modelName,
                            modelModelYear: Number(data.car.modelModelYear),
                            realCarStatus: data.car.realCarStatus,
                            priceTotalTotal: data.car.priceTotalTotal,
                          },
                        });
                      }
                    })
                    .catch((error) => {
                      //console.log('Error fetching car: ', error);
                    });
                });
              } else {
                console.warn('Reserve button not found.');
              }
            };
            return pageName == 'listing_details' && event == 'page';
          })
          .catch((e) => {
            return false;
          })
      }, 5000);

    },

  };

  const icc_model = {
    name: 'model',
    isMatch: () => {
      return findPagData('car')
        .then((pageDetails) => {
          setPageDetailsFromPagData(pageDetails);
          let pageName = pageDetails.pageExperience.pageName;
          let pageId = pageDetails.pageExperience.pageId;
          let actionName = pageDetails.context.eventAction;
          //console.log('pageDetails:', pageDetails);
          //console.log('pageId:', pageId);
          //console.log('pageName:', pageName);

          if (pageId.includes('/model/') && !pageName) {
            //pageView: "model"
            if (pageDetails.context.country === 'DE') {
              SalesforceInteractions.sendEvent({
                interaction: {
                  name: 'model', // The name of the interaction (e.g., the action being performed)
                  eventType: 'Engagement', // The type of the event
                  actionName: 'modelConfigStart', // Specific name for the action
                  actionId: 'icc_configurationPage', // Unique identifier for the action
                  countryCode: pageDetails.context.country,
                  currency: pageDetails.context.currency,
                  modelCode: pageDetails.car.modelCode,
                  modelModelYear: Number(pageDetails.car.modelModelYear),
                  modelName: pageDetails.car.modelName,
                  // exteriorColorCode: pageDetails.car.exteriorColorCode,
                  // exteriorColorName: pageDetails.car.exteriorColorName,
                  // interiorColorCode: pageDetails.car.interiorColorCode,
                  // interiorColorName: pageDetails.car.interiorColorName,
                  engineType: pageDetails.car.engineType,
                  priceTotalBasic: pageDetails.car.priceTotalBasic,
                },
              });
            }
            attachShadowButtonListeners();
            attachScrollListener();
            attachContactDealerAndDownloadButtons();

          }
          return pageName.includes('/model/') || actionName.includes('model');
        })
        .catch((e) => {
          return false;
        });
    }

  };

  const icc_model_start = {
    name: 'model-start',
    isMatch: () => {
      return findPagData('pageExperience')
        .then((pageDetails) => {
          setPageDetailsFromPagData(pageDetails);
          let pageName = pageDetails.pageExperience.pageName;
          let pageId = pageDetails.pageExperience.pageId;
          let actionName = pageDetails.context.eventAction;
          if (pageId.includes('model-start/')) {
            if (pageDetails.context.country === 'DE') {
              SalesforceInteractions.sendEvent({
                interaction: {
                  name: 'model-start', // The name of the interaction (e.g., the action being performed)
                  eventType: 'Engagement', // The type of the event
                  countryCode: pageDetails.context.country,
                  currency: pageDetails.context.currency,
                  actionName: 'modelStartDerivative', // Specific name for the action
                  actionId: 'icc_pageView', // Unique identifier for the action
                },
              });
            }
            //console.log('pageView - model-start');
          }
          else if (pageId.includes('model-start')) {
            if (pageDetails.context.country === 'DE') {
              SalesforceInteractions.sendEvent({
                interaction: {
                  name: 'model-start', // The name of the interaction (e.g., the action being performed)
                  eventType: 'Engagement', // The type of the event
                  countryCode: pageDetails.context.country,
                  currency: pageDetails.context.currency,
                  actionName: 'modelStartHomepage', // Specific name for the action
                  actionId: 'icc_pageView', // Unique identifier for the action
                },
              });
            }
            //console.log('pageView - model-start');
          };
          return pageName == 'model-start' || actionName.includes('model-start');
        })
        .catch((e) => {
          return false;
        })
    },
    // interaction: 'Home',
  };

  const icc_handleContact = {
    name: 'handleContact',
    isMatch: () => {
      return findPagData('pageExperience')
        .then((pageDetails) => {
          setPageDetailsFromPagData(pageDetails);
          let pageId = pageDetails.pageExperience.pageId;
          let pageName = pageDetails.pageExperience.pageName;
          if (pageId.includes('contact/dealers')) {
            findPagData('ids').then(pageDetails => { // check if logged and id available
              if (pageDetails && pageDetails.ids) {
                window.userInfo.ciamId = pageDetails.ids.ciamId;
              };
            });
            findPagData('car').
              then((data) => {
                if (data.context.country === 'DE') {
                  SalesforceInteractions.sendEvent({
                    interaction: {
                      name: 'icc_contactForm', // The name of the interaction (e.g., the action being performed)
                      eventType: 'Engagement', // The type of the event
                      countryCode: data.context.country,
                      //currency: data.context.currency,
                      engineType: data.car.engineType,
                      modelCode: data.car.modelCode,
                      modelName: data.car.modelName,
                      porscheCode: data.car.porscheCode,
                      priceTotalTotal: data.car.priceTotalTotal,
                      actionName: 'contactForm', // Specific name for the action
                      actionId: 'icc_pageView', // Unique identifier for the action
                    },
                  });
                }
              })
              .catch((e) => {
                console.log(e);
              })
            var salutation = '';
            var firstName = '';
            var lastName = '';
            var emailAddress = '';
            var phone = '';
            var lang = '';
            var Country = '';
            setTimeout(() => {
              //console.log('Attempting to find the buttons...');
              var submitButton = document.querySelector('[data-testid="submit-contact-form"]').shadowRoot.querySelector("button")
              const arrangeAcallbackButton = Array.from(document.querySelectorAll('button')).find(btn => btn.textContent.trim() === 'Rckruf vereinbaren');
              const writeAmessageButton = Array.from(document.querySelectorAll('button')).find(btn => btn.textContent.trim() === 'Nachricht schreiben');
              //console.log('submitButton found : ', submitButton);
              //console.log('writeAmessageButton found: ', writeAmessageButton);
              //console.log('arrangeAcallbackButton found: ', arrangeAcallbackButton);

              //Inital submit button
              if (submitButton) {
                submitButton.addEventListener('click', () => {
                  //console.log('Button clicked.');

                  //console.log('Attempting to find input fields...');
                  const inputs = document.querySelector('[name="messageForm"] > div').querySelectorAll('contact-form-p-text-field-wrapper > input');

                  //console.log('Input fields found: ', inputs);

                  salutation = document.querySelector('[name="salutation"]').shadowRoot.textContent.split('*')[1] || '';
                  firstName = inputs[0]?.value || '';
                  lastName = inputs[1]?.value || '';
                  emailAddress = inputs[7]?.value || '';
                  phone = inputs[8]?.value || '';
                  lang = pageDetails?.context?.language || '';
                  Country = pageDetails?.context?.country || '';
                  const selectElement = document.querySelector('form[name="messageForm"] select[data-testid="phoneInput.select"]');
                  const selectedText = selectElement?.selectedOptions[0]?.textContent;

                  // Extract the +xxx code using regex
                  const e164Code = selectedText?.match(/\+\d+/)?.[0];

                  //console.log('Collected input values:');
                  //console.log('Salutaiton: ', salutation);
                  //console.log('First Name: ', firstName);
                  //console.log('Last Name: ', lastName);
                  //console.log('Email Address: ', emailAddress);
                  //console.log('Phone: ', phone);
                  //console.log('language: ', lang);
                  //console.log('Country: ', Country);

                  if (pageDetails?.ids?.ciamId) {
                    //console.log('iccCiamid: ', pageDetails.ids.ciamId);
                  } else {
                    //console.log('iccCiamid not found.');
                  }

                  window.userInfo = {
                    emailAddress: emailAddress,
                    firstName: firstName,
                    lastName: lastName,
                    phone: phone
                  };

                  if (emailAddress) {
                    if (Country === 'DE') {
                      //console.log('Sending identity data...');
                      sitemapUtils.sendIdentityData('Profile', {
                        salutation: salutation,
                        firstName: firstName,
                        lastName: lastName,
                        email: emailAddress.toLowerCase(),
                        porscheId: emailAddress.toLowerCase(),
                        phoneNumber: (e164Code + phone).replaceAll(' ', ''),
                        language: lang,
                        countryCode: Country,
                        eventType: 'Profile',
                        isAnonymous: 0, // Standard
                        isanonymous: '0' // custom
                      });
                      findPagData('car').
                        then((data) => {
                          SalesforceInteractions.sendEvent({
                            interaction: {
                              name: 'icc_contactForm', // The name of the interaction (e.g., the action being performed)
                              eventType: 'Engagement', // The type of the event
                              countryCode: Country,
                              //currency: data.context.currency,
                              engineType: data.car.engineType,
                              modelCode: data.car.modelCode,
                              modelName: data.car.modelName,
                              porscheCode: data.car.porscheCode,
                              priceTotalTotal: data.car.priceTotalTotal,
                              actionName: 'contactFormSubmitted', // Specific name for the action
                              actionId: 'icc_contactForm', // Unique identifier for the action
                            },
                          });
                        })
                        .catch((e) => {
                          console.log(e);
                        });

                      //console.log('Identity data sent successfully for email: ', emailAddress);
                      setEmailCookie('true');
                    }
                  } else {
                    //console.log('Email address is empty. Identity data not sent.');
                  }
                });
              } else {
                //console.log('submitButton not found. Event listener not attached.');
              }
              //arrange a call tab
              if (arrangeAcallbackButton) {
                arrangeAcallbackButton.addEventListener('click', () => {
                  //console.log('arrangeAcallbackButton clicked.');
                  var submitButton2 = document.querySelectorAll('[data-testid="submit-contact-form"]')[1]
                  //document.querySelectorAll('contact-form-p-button')[1];



                  //console.log('submitButton2 found in arrangeAcallbackButton tab: ', submitButton2);

                  if (submitButton2) {
                    //console.log('inside if condition submitbutton');
                    submitButton2.addEventListener('click', () => {
                      // submitButton2.addEventListener('click', () => {
                      //console.log('submitButton2 clicked in arrange a call tab.');

                      //console.log('Attempting to find input fields...');
                      const inputs = document.querySelectorAll('[name="callbackForm"] > div')[2].querySelectorAll('contact-form-p-text-field-wrapper > input');
                      //console.log('Input fields found: ', inputs);

                      salutation = document.querySelectorAll('[name="callbackForm"] > div')[2].querySelector('[name="salutation"]').shadowRoot.textContent.split('*')[1] || '';
                      firstName = inputs[0]?.value || '';
                      lastName = inputs[1]?.value || '';
                      emailAddress = inputs[2]?.value || '';
                      phone = inputs[3]?.value || '';
                      lang = pageDetails?.context?.language || '';
                      Country = pageDetails?.context?.country || '';

                      const selectElement = document.querySelector('form[name="callbackForm"] select[data-testid="phoneInput.select"]');
                      const selectedText = selectElement?.selectedOptions[0]?.textContent;

                      // Extract the +xxx code using regex
                      const e164Code = selectedText?.match(/\+\d+/)?.[0];

                      //console.log('Collected input values:');
                      //console.log('First Name: ', firstName);
                      //console.log('Last Name: ', lastName);
                      //console.log('Email Address: ', emailAddress);
                      //console.log('Phone: ', phone);
                      //console.log('language: ', lang);
                      //console.log('Country: ', Country);

                      if (pageDetails?.ids?.ciamId) {
                        //console.log('iccCiamid: ', pageDetails.ids.ciamId);
                      } else {
                        //console.log('iccCiamid not found.');
                      }

                      window.userInfo = {
                        emailAddress: emailAddress,
                        firstName: firstName,
                        lastName: lastName,
                        phone: phone
                      };

                      if (emailAddress) {
                        //console.log('Sending identity data...');
                        sitemapUtils.sendIdentityData('Profile', {
                          salutation: salutation,
                          firstName: firstName,
                          lastName: lastName,
                          email: emailAddress.toLowerCase(),
                          porscheId: emailAddress.toLowerCase(),
                          phoneNumber: (e164Code + phone).replaceAll(' ', ''),
                          language: lang,
                          countryCode: Country,
                          eventType: 'Profile',
                          isAnonymous: 0, // Standard
                          isanonymous: '0' // custom
                        });
                        findPagData('car').
                          then((data) => {
                            SalesforceInteractions.sendEvent({
                              interaction: {
                                name: 'icc_contactForm', // The name of the interaction (e.g., the action being performed)
                                eventType: 'Engagement', // The type of the event
                                countryCode: Country,
                                //currency: data.context.currency,
                                engineType: data.car.engineType,
                                modelCode: data.car.modelCode,
                                modelName: data.car.modelName,
                                porscheCode: data.car.porscheCode,
                                priceTotalTotal: data.car.priceTotalTotal,
                                actionName: 'contactFormSubmitted', // Specific name for the action
                                actionId: 'icc_contactForm', // Unique identifier for the action
                              },
                            });
                          })
                          .catch((e) => {
                            console.log(e);
                          })

                        //console.log('Identity data sent successfully for email: ', emailAddress);
                        setEmailCookie('true');
                      } else {
                        //console.log('Email address is empty. Identity data not sent.');
                      }
                    });
                  }
                  else {
                    //console.log('submitButton found in arrangeAcallbackButton tab. Event listener not attached.');
                  }
                });
              } else {
                //console.log('arrangeAcallbackButton not found. Event listener not attached.');
              }
              //write a message tab
              if (writeAmessageButton) {
                writeAmessageButton.addEventListener('click', () => {
                  //console.log('writeAmessageButton clicked.');
                  submitButton = document.querySelector('[data-testid="submit-contact-form"]').shadowRoot.querySelector("button")
                  //document.querySelector('contact-form-p-button');
                  //console.log('submitButton found in writeAmessageButton tab: ', submitButton);

                  if (submitButton) {
                    submitButton.addEventListener('click', () => {
                      //console.log('submitButton clicked in write a message tab.');

                      //console.log('Attempting to find input fields...');
                      const inputs = document.querySelector('[name="messageForm"] > div').querySelectorAll('contact-form-p-text-field-wrapper > input');
                      //console.log('Input fields found: ', inputs);

                      salutation = document.querySelector('[name="salutation"]').shadowRoot.textContent.split('*')[1] || '';
                      firstName = inputs[0]?.value || '';
                      lastName = inputs[1]?.value || '';
                      emailAddress = inputs[7]?.value || '';
                      phone = inputs[8]?.value || '';
                      lang = pageDetails?.context?.language || '';
                      Country = pageDetails?.context?.country || '';

                      const selectElement = document.querySelector('form[name="messageForm"] select[data-testid="phoneInput.select"]');
                      const selectedText = selectElement?.selectedOptions[0]?.textContent;

                      // Extract the +xxx code using regex
                      const e164Code = selectedText?.match(/\+\d+/)?.[0];

                      //console.log('Collected input values:');
                      //console.log('First Name: ', firstName);
                      //console.log('Last Name: ', lastName);
                      //console.log('Email Address: ', emailAddress);
                      //console.log('Phone: ', phone);
                      //console.log('language: ', lang);
                      //console.log('Country: ', Country);

                      if (pageDetails?.ids?.ciamId) {
                        //console.log('iccCiamid: ', pageDetails.ids.ciamId);
                      } else {
                        //console.log('iccCiamid not found.');
                      }

                      window.userInfo = {
                        emailAddress: emailAddress,
                        firstName: firstName,
                        lastName: lastName,
                        phone: phone
                      };

                      if (emailAddress) {
                        if (Country === 'DE') {
                          //console.log('Sending identity data...');
                          sitemapUtils.sendIdentityData('Profile', {
                            salutation: salutation,
                            firstName: firstName,
                            lastName: lastName,
                            email: emailAddress.toLowerCase(),
                            porscheId: emailAddress.toLowerCase(),
                            phoneNumber: (e164Code + phone).replaceAll(' ', ''),
                            language: lang,
                            countryCode: Country,
                            eventType: 'Profile',
                            isAnonymous: 0, // Standard
                            isanonymous: '0' // custom
                          });
                          findPagData('car').
                            then((data) => {
                              SalesforceInteractions.sendEvent({
                                interaction: {
                                  name: 'icc_contactForm', // The name of the interaction (e.g., the action being performed)
                                  eventType: 'Engagement', // The type of the event
                                  countryCode: Country,
                                  //currency: data.context.currency,
                                  engineType: data.car.engineType,
                                  modelCode: data.car.modelCode,
                                  modelName: data.car.modelName,
                                  porscheCode: data.car.porscheCode,
                                  priceTotalTotal: data.car.priceTotalTotal,
                                  actionName: 'contactFormSubmitted', // Specific name for the action
                                  actionId: 'icc_contactForm', // Unique identifier for the action
                                },
                              });
                            })
                            .catch((e) => {
                              console.log(e);
                            });

                          //console.log('Identity data sent successfully for email: ', emailAddress);
                          setEmailCookie('true');
                        }
                      } else {
                        //console.log('Email address is empty. Identity data not sent.');
                      }

                    });
                  }
                  else {
                    //console.log('submitButton found in writeAmessageButton tab. Event listener not attached.');
                  }

                });
              } else {
                //console.log('writeAmessageButton not found. Event listener not attached.');
              }
            }, 16000); // this is too long it should be dynamic when the page loads

          };
          return pageName == 'contact_email_screen';
        })
        .catch((e) => {
          console.log(e);
          return false;
        });
    },
  };

  const pageTypeDefault = {
    name: 'default'
  };

  //UTILITIES
  function getUrlQueryParameters() {
    const urlParams = new URLSearchParams(window.location.search);
    let formattedString = '';

    urlParams.forEach((value) => {
      formattedString += `${value},`;
    });

    // Remove the trailing ',' if it exists
    if (formattedString.endsWith(',')) {
      formattedString = formattedString.slice(0, -1);
    }

    return formattedString;
  }

  function getUrlQueryKeys() {
    const urlParams = new URLSearchParams(window.location.search);
    let formattedString = '';

    urlParams.forEach((_, key) => {
      formattedString += `${key},`;
    });

    // Remove the trailing ',' if it exists
    if (formattedString.endsWith(',')) {
      formattedString = formattedString.slice(0, -1);
    }

    return formattedString;
  }

  const sitemapUtils = {
    sendEngagementData: function (actionName, actionId) {
      SalesforceInteractions.sendEvent({
        interaction: {
          name: 'Engagement',
          eventType: 'Engagement',
          actionName: actionName,
          actionId: actionId,

        },
      });
    },
    sendIdentityData: function (interactionName, data) {
      //console.log('sendIdentityData', data);
      SalesforceInteractions.sendEvent({
        user: {
          attributes: data
        }
      });
    },
    sendUnstructuredData: function (data) {
      //console.log(data);
      SalesforceInteractions.sendEvent({ interaction: data }); //Modified by Kushal
    }
  };

  function attachShadowButtonListeners(retries = 20, delay = 500) {
    let attempts = 0;

    const interval = setInterval(() => {
      // --- Porsche save Configuration panel

      // Query the container div
      // Select all matching containers
      const buttonContainers = document.querySelectorAll('div.gap-sm.flex.flex-wrap.xl\\:flex-nowrap');

      // Check if there are at least two
      if (buttonContainers.length >= 2) {
        const secondContainer = buttonContainers[1];

        if (!secondContainer.dataset.listenerAttached) {
          //console.log('Attaching listener to second container:', secondContainer);

          secondContainer.addEventListener('click', (event) => {
            const clickedButton = event.target.closest('icc-p-button');
            if (clickedButton) {
              const buttonText = clickedButton.textContent.trim();
              //console.log(`Button clicked: ${buttonText}`);

              if (buttonText === 'Speichern') {
                //console.log('Speichern logic triggered');
                setTimeout(() => {
                  findPagData('car')
                    .then((data) => {
                      //console.log('Page data for "car" found:', data);

                      //console.log('Preparing to send SalesforceInteractions event with car data...');

                      //Submit Configuartion
                      var Currency;
                      var Country;

                      findPagData('car')
                        .then((data) => {
                          //console.log('Page data for "car" found:', data);
                          Country = data.context.country;
                          Currency = data.context.currency;
                          //console.log('Country in : ', Country);
                          //console.log('Currency in : ', Currency);
                          if (Country === 'DE') {
                            SalesforceInteractions.sendEvent({
                              interaction: {
                                name: 'Engagement', // The name of the interaction (e.g., the action being performed)
                                eventType: 'Engagement', // The type of the event
                                actionName: 'modelEndCarSaved',
                                actionId: 'icc_configurationPage',
                                engineType: data.car.engineType,
                                modelCode: data.car.modelCode,
                                modelModelYear: Number(data.car.modelModelYear),
                                modelName: data.car.modelName,
                                //modelRangeName: data.car.modelRangeName,
                                //type: data.car.type,
                                exteriorColorCode: (data.car.exteriorColorCode.length === 3 && data.car.exteriorColorCode.startsWith('F')) ? data.car.exteriorColorCode.slice(1) : data.car.exteriorColorCode,
                                exteriorColorName: data.car.exteriorColorName,
                                interiorColorCode: (data.car.interiorColorCode.length === 3 && data.car.interiorColorCode.startsWith('I')) ? data.car.interiorColorCode.slice(1) : data.car.interiorColorCode,
                                interiorColorName: data.car.interiorColorName,
                                porscheCode: data.car.porscheCode,
                                //preconfigId: data.car.preconfigId,
                                priceTotalTotal: data.car.priceTotalTotal,
                                priceTotalAdditional: data.car.priceTotalAdditional,
                                priceTotalBasic: data.car.priceTotalBasic,
                                //wheelsCode: data.car.wheelsCode,
                                // wheelsName: data.car.wheelsName,
                                //realcarStatus: data.car.realcarStatus,
                                countryCode: Country,
                                currency: Currency
                              }
                            });
                            //console.log('SalesforceInteractions event sent successfully.');
                          }

                        })
                        .catch((err) => {
                          //console.log('Error occurred while finding page data for "context":', err);
                        })
                    })
                    .catch((err) => {
                      //console.log('Error occurred while finding page data for "car":', err);
                    });
                }, 3000);

              } else if (buttonText === 'Porsche Code erstellen') {
                //console.log('Porsche Code logic triggered');
                findPagData('car')
                  .then((data) => {
                    //console.log('Page data for "car" found:', data);

                    //console.log('Preparing to send SalesforceInteractions event with car data...');

                    //Submit Configuartion
                    var Currency;
                    var Country;
                    setTimeout(() => {
                      findPagData('car')
                        .then((data) => {
                          //console.log('Page data for "car" found:', data);
                          Country = data.context.country;
                          Currency = data.context.currency;
                          //console.log('Country in : ', Country);
                          //console.log('Currency in : ', Currency);
                          if (Country === 'DE') {
                            SalesforceInteractions.sendEvent({
                              interaction: {
                                name: 'Engagement', // The name of the interaction (e.g., the action being performed)
                                eventType: 'Engagement', // The type of the event
                                actionName: 'modelEndPorscheCodeGenerated',
                                actionId: 'icc_configurationPage',
                                engineType: data.car.engineType,
                                modelCode: data.car.modelCode,
                                modelModelYear: Number(data.car.modelModelYear),
                                modelName: data.car.modelName,
                                //modelRangeName: data.car.modelRangeName,
                                //type: data.car.type,
                                exteriorColorCode: (data.car.exteriorColorCode.length === 3 && data.car.exteriorColorCode.startsWith('F')) ? data.car.exteriorColorCode.slice(1) : data.car.exteriorColorCode,
                                exteriorColorName: data.car.exteriorColorName,
                                interiorColorCode: (data.car.interiorColorCode.length === 3 && data.car.interiorColorCode.startsWith('I')) ? data.car.interiorColorCode.slice(1) : data.car.interiorColorCode,
                                interiorColorName: data.car.interiorColorName,
                                porscheCode: data.car.porscheCode,
                                //preconfigId: data.car.preconfigId,
                                priceTotalTotal: data.car.priceTotalTotal,
                                priceTotalAdditional: data.car.priceTotalAdditional,
                                priceTotalBasic: data.car.priceTotalBasic,
                                //wheelsCode: data.car.wheelsCode,
                                // wheelsName: data.car.wheelsName,
                                //realcarStatus: data.car.realcarStatus,
                                countryCode: Country,
                                currency: Currency
                              }
                            });
                            //console.log('SalesforceInteractions event sent successfully.');
                          }
                        })
                        .catch((err) => {
                          //console.log('Error occurred while finding page data for "context":', err);
                        })
                    }, 3000);

                  })
                  .catch((err) => {
                    //console.log('Error occurred while finding page data for "car":', err);
                  });
              }
            }
          });

          secondContainer.dataset.listenerAttached = 'true';
        }
      } else {
        console.warn('Second container not found.');
      }



      // --- Porsche Code erstellen ---
      const porscheButton = Array.from(document.querySelectorAll('icc-p-button-pure'))
        .find(el => el.textContent.trim() === 'Porsche Code erstellen');

      if (porscheButton && !porscheButton.dataset.listenerAttached) {
        const handlePorscheClick = () => {
          //console.log('Unique Porsche Code button clicked!');
          findPagData('car')
            .then((data) => {
              //console.log('Page data for "car" found:', data);

              //console.log('Preparing to send SalesforceInteractions event with car data...');

              //Submit Configuartion
              var Currency;
              var Country;
              setTimeout(() => {
                findPagData('car')
                  .then((data) => {
                    //console.log('Page data for "context" found:', data);
                    Country = data.context.country;
                    Currency = data.context.currency;
                    //console.log('Country in : ', Country);
                    //console.log('Currency in : ', Currency);
                    if (Country === 'DE') {
                      SalesforceInteractions.sendEvent({
                        interaction: {
                          name: 'Engagement', // The name of the interaction (e.g., the action being performed)
                          eventType: 'Engagement', // The type of the event
                          actionName: 'modelEndPorscheCodeGenerated',
                          actionId: 'icc_configurationPage',
                          engineType: data.car.engineType,
                          modelCode: data.car.modelCode,
                          modelModelYear: Number(data.car.modelModelYear),
                          modelName: data.car.modelName,
                          //modelRangeName: data.car.modelRangeName,
                          //type: data.car.type,
                          exteriorColorCode: (data.car.exteriorColorCode.length === 3 && data.car.exteriorColorCode.startsWith('F')) ? data.car.exteriorColorCode.slice(1) : data.car.exteriorColorCode,
                          exteriorColorName: data.car.exteriorColorName,
                          interiorColorCode: (data.car.interiorColorCode.length === 3 && data.car.interiorColorCode.startsWith('I')) ? data.car.interiorColorCode.slice(1) : data.car.interiorColorCode,
                          interiorColorName: data.car.interiorColorName,
                          porscheCode: data.car.porscheCode,
                          //preconfigId: data.car.preconfigId,
                          priceTotalTotal: data.car.priceTotalTotal,
                          priceTotalAdditional: data.car.priceTotalAdditional,
                          priceTotalBasic: data.car.priceTotalBasic,
                          //wheelsCode: data.car.wheelsCode,
                          // wheelsName: data.car.wheelsName,
                          //realcarStatus: data.car.realcarStatus,
                          countryCode: Country,
                          currency: Currency
                        }
                      });
                      //console.log('SalesforceInteractions event sent successfully.');
                    }
                  })
                  .catch((err) => {
                    //console.log('Error occurred while finding page data for "context":', err);
                  })
              }, 3000);

            })
            .catch((err) => {
              //console.log('Error occurred while finding page data for "car":', err);
            });
        };

        porscheButton.addEventListener('click', handlePorscheClick);
        porscheButton.dataset.listenerAttached = 'true';
      }

      // --- Speichern button ---
      const speichernHost = document.querySelector('icc-p-button-pure[data-testid="save-button-without-border"]');
      const saveConfiguration = speichernHost?.shadowRoot?.querySelector('button');

      if (saveConfiguration && !saveConfiguration.dataset.listenerAttached) {
        const handleSaveClick = () => {
          //console.log('saveConfiguration clicked');

          findPagData('car')
            .then((data) => {
              //console.log('Page data for "car" found:', data);

              //console.log('Preparing to send SalesforceInteractions event with car data...');

              //Submit Configuartion
              var Currency;
              var Country;
              setTimeout(() => {
                findPagData('car')
                  .then((data) => {
                    //console.log('Page data for "context" found:', data);
                    Country = data.context.country;
                    Currency = data.context.currency;
                    //console.log('Country in : ', Country);
                    //console.log('Currency in : ', Currency);
                    if (Country === 'DE') {
                      SalesforceInteractions.sendEvent({
                        interaction: {
                          name: 'Engagement', // The name of the interaction (e.g., the action being performed)
                          eventType: 'Engagement', // The type of the event
                          actionName: 'modelEndCarSaved',
                          actionId: 'icc_configurationPage',
                          engineType: data.car.engineType,
                          modelCode: data.car.modelCode,
                          modelModelYear: Number(data.car.modelModelYear),
                          modelName: data.car.modelName,
                          //modelRangeName: data.car.modelRangeName,
                          //type: data.car.type,
                          exteriorColorCode: (data.car.exteriorColorCode.length === 3 && data.car.exteriorColorCode.startsWith('F')) ? data.car.exteriorColorCode.slice(1) : data.car.exteriorColorCode,
                          exteriorColorName: data.car.exteriorColorName,
                          interiorColorCode: (data.car.interiorColorCode.length === 3 && data.car.interiorColorCode.startsWith('I')) ? data.car.interiorColorCode.slice(1) : data.car.interiorColorCode,
                          interiorColorName: data.car.interiorColorName,
                          porscheCode: data.car.porscheCode,
                          //preconfigId: data.car.preconfigId,
                          priceTotalTotal: data.car.priceTotalTotal,
                          priceTotalAdditional: data.car.priceTotalAdditional,
                          priceTotalBasic: data.car.priceTotalBasic,
                          //wheelsCode: data.car.wheelsCode,
                          // wheelsName: data.car.wheelsName,
                          //realcarStatus: data.car.realcarStatus,
                          countryCode: Country,
                          currency: Currency
                        }
                      });
                      //console.log('SalesforceInteractions event sent successfully.');
                    }
                  })
                  .catch((err) => {
                    //console.log('Error occurred while finding page data for "context":', err);
                  })
              }, 3000);

            })
            .catch((err) => {
              //console.log('Error occurred while finding page data for "car":', err);
            });
        };

        saveConfiguration.addEventListener('click', handleSaveClick);
        saveConfiguration.dataset.listenerAttached = 'true';
      }

      // --- Stop retrying if both buttons are found ---
      if (porscheButton && saveConfiguration) {
        clearInterval(interval);
        //console.log('Both buttons found and listeners attached.');
      } else {
        attempts++;
        if (attempts >= retries) {
          clearInterval(interval);
          //console.log('Buttons not found after retries.');
        }
      }
    }, delay);
  }

  function attachClickHandlerToExteriorColorSection() {
    const extColorSection = document.querySelector("#section-exterior-color-toggle-container");

    if (!extColorSection || extColorSection.dataset.listenerAttached === 'true') {
      return;
    }

    extColorSection.addEventListener('click', function (event) {
      // Only trigger if the click is on the container itself or a specific child
      const isDirectClick = event.target === extColorSection;
      const isValidChildClick = event.target.closest('#section-exterior-color-toggle-container');

      if (isDirectClick || isValidChildClick) {
        //console.log('extColorSection clicked');

        findPagData('componentClick').then((data) => {
          if (data.context.country === 'DE') {
            SalesforceInteractions.sendEvent({
              name: 'Engagement',
              interaction: {
                name: 'Engagement',
                eventType: 'Engagement',
                actionId: 'icc_configurationPage',
                actionName: 'modelColorChange',
                countryCode: data.context.country,
                currency: data.context.currency,
                exteriorColorCode: (data.componentClick.clickElementId.length === 3 && data.componentClick.clickElementId.startsWith('F')) ? data.componentClick.clickElementId.slice(1) : data.componentClick.clickElementId,
                exteriorColorName: data.componentClick.clickElementName,
                interiorColorCode: (data.car.interiorColorCode.length === 3 && data.car.interiorColorCode.startsWith('I')) ? data.car.interiorColorCode.slice(1) : data.car.interiorColorCode,
                interiorColorName: data.car.interiorColorName,
                priceTotalBasic: data.car.priceTotalBasic,
                modelName: data.car.modelName,
                modelCode: data.car.modelCode,
                engineType: data.car.engineType,
                modelModelYear: Number(data.car.modelModelYear),
              }
            });
          }
        }).catch((e) => {
          //console.log('error finding car data : ', e);
        });
      }
    });

    extColorSection.dataset.listenerAttached = 'true';
  }

  function attachContactDealerAndDownloadButtons() {

    // Hndler kontaktieren
    document.querySelectorAll('icc-p-button[data-testid="dealer-contact-button"]').forEach(button => {
      button.addEventListener('click', () => {
        //console.log('Dealer contact button clicked:', button);
        findPagData('car')
          .then((data) => {
            if (data.context.country === 'DE') {
              SalesforceInteractions.sendEvent({
                interaction: {
                  name: 'model', // The name of the interaction (e.g., the action being performed)
                  eventType: 'Engagement', // The type of the event
                  actionName: 'modelEndContactDealer', // Specific name for the action
                  actionId: 'icc_configurationPage', // Unique identifier for the action
                  countryCode: data.context.country,
                  currency: data.context.currency,
                  modelCode: data.car.modelCode,
                  modelModelYear: Number(data.car.modelModelYear),
                  modelName: data.car.modelName,
                  exteriorColorCode: (data.car.exteriorColorCode.length === 3 && data.car.exteriorColorCode.startsWith('F')) ? data.car.exteriorColorCode.slice(1) : data.car.exteriorColorCode,
                  exteriorColorName: data.car.exteriorColorName,
                  interiorColorCode: (data.car.interiorColorCode.length === 3 && data.car.interiorColorCode.startsWith('I')) ? data.car.interiorColorCode.slice(1) : data.car.interiorColorCode,
                  interiorColorName: data.car.interiorColorName,
                  engineType: data.car.engineType,
                  porscheCode: data.car.porscheCode,
                  priceTotalBasic: data.car.priceTotalBasic,
                  priceTotalAdditional: data.car.priceTotalAdditional,
                  priceTotalTotal: data.car.priceTotalTotal,
                },
              });
            }


          })
          .catch((e) => {
            //console.log('Error finding "car" in pagData: ', e);
          })

      });
    });

    // Download configuration (PDF)
    document.querySelector("#section-summary > div.gap-md.landscape\\:3xl\\:col-\\[span_5\\/full-end\\].landscape\\:md\\:me-md.landscape\\:me-sm.md\\:mx-md.col-\\[basic-start\\/basic-end\\].hidden.flex-col.landscape\\:sm\\:ml-0.landscape\\:md\\:col-\\[span_6\\/full-end\\].landscape\\:md\\:flex.landscape\\:lg\\:col-\\[span_6\\/full-end\\] > div > div.gap-md\\/static.pt-md.flex.flex-col.sm\\:pt-0 > div:nth-child(2) > div:nth-child(1) > icc-p-link-pure")
      .addEventListener('click', () => {
        //console.log('Download configuration button clicked');
        findPagData('car')
          .then((data) => {

            if (data.context.country === 'DE') {
              SalesforceInteractions.sendEvent({
                interaction: {
                  name: 'model', // The name of the interaction (e.g., the action being performed)
                  eventType: 'Engagement', // The type of the event
                  actionName: 'modelEndDownloadConfiguration', // Specific name for the action
                  actionId: 'icc_configurationPage', // Unique identifier for the action
                  countryCode: data.context.country,
                  currency: data.context.currency,
                  modelCode: data.car.modelCode,
                  modelModelYear: Number(data.car.modelModelYear),
                  modelName: data.car.modelName,
                  exteriorColorCode: (data.car.exteriorColorCode.length === 3 && data.car.exteriorColorCode.startsWith('F')) ? data.car.exteriorColorCode.slice(1) : data.car.exteriorColorCode,
                  exteriorColorName: data.car.exteriorColorName,
                  interiorColorCode: (data.car.interiorColorCode.length === 3 && data.car.interiorColorCode.startsWith('I')) ? data.car.interiorColorCode.slice(1) : data.car.interiorColorCode,
                  interiorColorName: data.car.interiorColorName,
                  engineType: data.car.engineType,
                  porscheCode: data.car.porscheCode,
                  priceTotalBasic: data.car.priceTotalBasic,
                  priceTotalAdditional: data.car.priceTotalAdditional,
                  priceTotalTotal: data.car.priceTotalTotal,
                },
              });
            }

          })
          .catch((e) => {
            //console.log('Error finding "car" in pagData: ', e);
          })

      });

  }
  function attachScrollListener() {
    let hasLogged = false; // flag to prevent multiple logs

    window.addEventListener('scroll', function () {
      const target = document.querySelector("#section-summary > div.gap-md.landscape\\:3xl\\:col-\\[span_5\\/full-end\\].landscape\\:md\\:me-md.landscape\\:me-sm.md\\:mx-md.col-\\[basic-start\\/basic-end\\].hidden.flex-col.landscape\\:sm\\:ml-0.landscape\\:md\\:col-\\[span_6\\/full-end\\].landscape\\:md\\:flex.landscape\\:lg\\:col-\\[span_6\\/full-end\\] > div > div.gap-md\\/static.pt-md.flex.flex-col.sm\\:pt-0");

      if (!target || hasLogged) return;

      const rect = target.getBoundingClientRect();

      // Check if the entire element is fully within the viewport
      if (rect.top >= 0 && rect.bottom <= window.innerHeight) {
        console.log('Target section is fully in view!');
        findPagData('car')
          .then((data) => {
            let Country = data.context.country;
            let Currency = data.context.currency;
            if (Country === 'DE') {
              SalesforceInteractions.sendEvent({
                interaction: {
                  name: 'Engagement', // The name of the interaction (e.g., the action being performed)
                  eventType: 'Engagement', // The type of the event
                  actionName: 'modelEndSummary',
                  actionId: 'icc_configurationPage',
                  engineType: data.car.engineType,
                  modelCode: data.car.modelCode,
                  modelModelYear: Number(data.car.modelModelYear),
                  modelName: data.car.modelName,
                  exteriorColorCode: (data.car.exteriorColorCode.length === 3 && data.car.exteriorColorCode.startsWith('F')) ? data.car.exteriorColorCode.slice(1) : data.car.exteriorColorCode,
                  exteriorColorName: data.car.exteriorColorName,
                  interiorColorCode: (data.car.interiorColorCode.length === 3 && data.car.interiorColorCode.startsWith('I')) ? data.car.interiorColorCode.slice(1) : data.car.interiorColorCode,
                  interiorColorName: data.car.interiorColorName,
                  //porscheCode: data.car.porscheCode,
                  priceTotalTotal: data.car.priceTotalTotal,
                  priceTotalAdditional: data.car.priceTotalAdditional,
                  priceTotalBasic: data.car.priceTotalBasic,
                  countryCode: Country,
                  currency: Currency
                }
              });
              console.log('SalesforceInteractions event sent successfully.');
            }

          })
          .catch((err) => {
            console.log('Error occurred while finding page data for "car":', err);
          })
        hasLogged = true; // prevent future logs
      }
    });
  }
  function savePagData(pagData) {
    localStorage.setItem('pagDataStatus', JSON.stringify(pagData));
  }

  function hasPagDataChanged(newPagData) {
    const oldPagData = localStorage.getItem('pagDataStatus');
    if (!oldPagData) return true; // No previous data, so it's "changed"
    return oldPagData !== JSON.stringify(newPagData);
  }
  function filterClickHandler() {
    setTimeout(() => {
      findPagData('componentClick') // put breakpoints at onurl change and on click in conso;le to debug
        .then((data) => {
          if (data) {
            //console.log('SFcomponentClick exists:', data);
            //console.log('SFcomponentClick.clickElementId:', data.componentClick.clickElementId);
            //console.log('SFcomponentClick.clickElementName', data.componentClick.clickElementName);

            if (data.componentClick.clickElementName.includes('filter')) {
              //console.log('SFFilter condition clicked');
              const filterKeys = getUrlQueryKeys();
              const filterValues = getUrlQueryParameters();
              //console.log('Formatted URL Query keys:', filterKeys);
              //console.log('Formatted URL Query Parameters:', filterValues);

              var filterActionName = '';
              var filterType = data.componentClick.clickElementName;
              var filterValue = data.componentClick.clickElementId;

              switch (filterType) {
                case 'filter-maximumprice':
                  filterType = 'maximumPrice';
                  filterValue = (data.componentClick.clickElementId).split("-")[0]; //extracting the number before hyphen
                  break;
                case 'filter-maximummileage':
                  filterType = 'maximumMileage';
                  filterValue = (data.componentClick.clickElementId).split("-")[0]; //extracting the number before hyphen
                  break;
                case 'filter-condition':
                  filterType = 'condition';
                  break;
                case 'filter-bodytype':
                  filterType = 'bodyType';
                  break;
                case 'filter-modelcategories':
                  filterType = 'derivative ';
                  break;
                case 'filter-modelseries':
                  filterType = 'model';
                  break;
                case 'filter-financingproducttype':
                  filterType = 'financingProductType';
                  break;
                default:
              }
              //console.log('GEORGE filterType:', filterType);
              //console.log('GEORGE Formatted URL Query keys:', filterKeys);
              //console.log('GEORGE Formatted URL Query Parameters:', filterValues);

              if (filterValues.includes(filterValue))
                filterActionName = 'filter';
              else filterActionName = 'filterUncheck'

              if (data.context.country === 'DE') {
                SalesforceInteractions.sendEvent({
                  interaction: {
                    name: 'Engagement',
                    eventType: 'Engagement',
                    actionName: filterActionName,
                    actionId: 'finder_searchModelPage',
                    countryCode: data.context.country,
                    currency: data.context.currency,
                    searchFilterType: filterType,
                    searchFilterValue: filterValue
                  },
                });
              }
            }
          } else {
            //console.log('componentClick does not exist');
          }
        })
        .catch((error) => {
          //console.log('Error fetching componentClick: ', error);
        })
    }, 5000);
  }

  function handleCheckboxChange(event) {
    const target = event.target;
    if (target.type === 'checkbox') {
      //console.log(`Checkbox ${target.checked ? 'checked' : 'unchecked'}:`, target);
      filterClickHandler();
    }
  }

  function handleInputChange(event) {
    const target = event.target;
    //console.log('Input changed:', target.value);
    filterClickHandler();
  }

  //alternative to filters implementation
  /*
  // Attach to checkboxes
                  const checkboxSelectors = [
                    "#filter-content-Zustand input[type=checkbox]",
                    "#filter-content-Aktionen\\&Finanzprodukte input[type=checkbox]",
                  ];

                  checkboxSelectors.forEach(selector => {
                    document.querySelectorAll(selector).forEach(checkbox => {
                      checkbox.addEventListener('change', handleCheckboxChange);
                    });
                  });

 

                  const inputSelectors = [
                    "#filter-content-Preis input",               // maxPrice
                    "#filter-content-Laufleistung input",        // maxMileage
                    "#filter-content-Modelle select"             // model
                  ];

                  inputSelectors.forEach(selector => {
                    document.querySelectorAll(selector).forEach(input => {
                      input.addEventListener('change', handleInputChange);
                    });
                  });
  */



  // Function to detect URL changes
  function onUrlChange(callback) {
    let lastUrl = location.href;
    new MutationObserver(() => {
      const currentUrl = location.href;
      if (currentUrl !== lastUrl) {
        lastUrl = currentUrl;
        callback();
      }
    }).observe(document, { subtree: true, childList: true });
  }
  // Callback function to reinitialize the sitemap
  function handleUrlChange() {
    SalesforceInteractions.initSitemap({
      global,
      pageTypeDefault,
      pageTypes: [finder_homePage, finder_searchListPage, finder_contactEmailScreenPage, finder_productPage, icc_handleContact, icc_model, icc_model_start]
    });
  }
  // Initialize the URL change listener with the callback
  onUrlChange(handleUrlChange);
  // Initialize sitemap for the first page load


  SalesforceInteractions.initSitemap({
    global,
    pageTypeDefault,
    pageTypes: [finder_homePage, finder_searchListPage, finder_contactEmailScreenPage, finder_productPage, icc_handleContact, icc_model, icc_model_start]
  });

})
  })()
} catch (e) {
  console.error("[Salesforce Data Cloud] Error loading sitemap:", e);
}
